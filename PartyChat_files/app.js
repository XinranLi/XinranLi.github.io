if(!String.prototype.endsWith){String.prototype.endsWith=function(searchString,position){var subjectString=this.toString();if(position===undefined||position>subjectString.length){position=subjectString.length}position-=searchString.length;var lastIndex=subjectString.indexOf(searchString,position);return lastIndex!==-1&&lastIndex===position}}if(!String.prototype.startsWith){String.prototype.startsWith=function(searchString,position){position=position||0;return this.indexOf(searchString,position)===position}}if(!String.prototype.includes){String.prototype.includes=function(text){return this.indexOf(text)!=-1}}(function(global){"use strict";var Logger={};Logger.VERSION="0.9.14";var logHandler;var contextualLoggersByNameMap={};var bind=function(scope,func){return function(){return func.apply(scope,arguments)}};var merge=function(){var args=arguments,target=args[0],key,i;for(i=1;i<args.length;i++){for(key in args[i]){if(!(key in target)&&args[i].hasOwnProperty(key)){target[key]=args[i][key]}}}return target};var defineLogLevel=function(value,name){return{value:value,name:name}};Logger.DEBUG=defineLogLevel(1,"DEBUG");Logger.INFO=defineLogLevel(2,"INFO");Logger.WARN=defineLogLevel(4,"WARN");Logger.ERROR=defineLogLevel(8,"ERROR");Logger.OFF=defineLogLevel(99,"OFF");var ContextualLogger=function(defaultContext){this.context=defaultContext;this.setLevel(defaultContext.filterLevel);this.log=this.info};ContextualLogger.prototype={setLevel:function(newLevel){if(newLevel&&"value"in newLevel){this.context.filterLevel=newLevel}},enabledFor:function(lvl){var filterLevel=this.context.filterLevel;return lvl.value>=filterLevel.value},debug:function(){this.invoke(Logger.DEBUG,arguments)},info:function(){this.invoke(Logger.INFO,arguments)},warn:function(){this.invoke(Logger.WARN,arguments)},error:function(){this.invoke(Logger.ERROR,arguments)},invoke:function(level,msgArgs){if(logHandler&&this.enabledFor(level)){logHandler(msgArgs,merge({level:level},this.context))}}};var globalLogger=new ContextualLogger({filterLevel:Logger.OFF});(function(){var L=Logger;L.enabledFor=bind(globalLogger,globalLogger.enabledFor);L.debug=bind(globalLogger,globalLogger.debug);L.info=bind(globalLogger,globalLogger.info);L.warn=bind(globalLogger,globalLogger.warn);L.error=bind(globalLogger,globalLogger.error);L.log=L.info})();Logger.setHandler=function(func){logHandler=func};Logger.setLevel=function(level){globalLogger.setLevel(level);for(var key in contextualLoggersByNameMap){if(contextualLoggersByNameMap.hasOwnProperty(key)){contextualLoggersByNameMap[key].setLevel(level)}}};Logger.get=function(name){return contextualLoggersByNameMap[name]||(contextualLoggersByNameMap[name]=new ContextualLogger(merge({name:name},globalLogger.context)))};Logger.useDefaults=function(defaultLevel){if(typeof console==="undefined"){return}Logger.setLevel(defaultLevel||Logger.DEBUG);Logger.setHandler(function(messages,context){var hdlr=console.log;if(context.name){messages[0]="["+context.name+"] "+messages[0]}if(context.level===Logger.WARN&&console.warn){hdlr=console.warn}else if(context.level===Logger.ERROR&&console.error){hdlr=console.error}else if(context.level===Logger.INFO&&console.info){hdlr=console.info}Function.prototype.apply.call(hdlr,console,messages)})};if(typeof define==="function"&&define.amd){define(Logger)}else if(typeof module!=="undefined"&&module.exports){module.exports=Logger}else{Logger._prevLogger=global.Logger;Logger.noConflict=function(){global.Logger=Logger._prevLogger;return Logger};global.Logger=Logger}})(this);(function(window,undefined){"use strict";var TraceKit={remoteFetching:false,collectWindowErrors:true,linesOfContext:7};var _slice=[].slice;var UNKNOWN_FUNCTION="?";TraceKit.wrap=function traceKitWrapper(func){function wrapped(){try{return func.apply(this,arguments)}catch(e){TraceKit.report(e);throw e}}return wrapped};TraceKit.report=function reportModuleWrapper(){var handlers=[],lastArgs=null,lastException=null,lastExceptionStack=null;function subscribe(handler){installGlobalHandler();handlers.push(handler)}function unsubscribe(handler){for(var i=handlers.length-1;i>=0;--i){if(handlers[i]===handler){handlers.splice(i,1)}}}function unsubscribeAll(){uninstallGlobalHandler();handlers=[]}function notifyHandlers(stack,isWindowError){var exception=null;if(isWindowError&&!TraceKit.collectWindowErrors){return}for(var i in handlers){if(hasKey(handlers,i)){try{handlers[i].apply(null,[stack].concat(_slice.call(arguments,2)))}catch(inner){exception=inner}}}if(exception){throw exception}}var _oldOnerrorHandler,_onErrorHandlerInstalled;function traceKitWindowOnError(message,url,lineNo,colNo,ex){var stack=null;if(lastExceptionStack){TraceKit.computeStackTrace.augmentStackTraceWithInitialElement(lastExceptionStack,url,lineNo,message);processLastException()}else if(ex){stack=TraceKit.computeStackTrace(ex);notifyHandlers(stack,true)}else{var location={url:url,line:lineNo,column:colNo};location.func=TraceKit.computeStackTrace.guessFunctionName(location.url,location.line);location.context=TraceKit.computeStackTrace.gatherContext(location.url,location.line);stack={message:message,url:document.location.href,stack:[location]};notifyHandlers(stack,true)}if(_oldOnerrorHandler){return _oldOnerrorHandler.apply(this,arguments)}return false}function installGlobalHandler(){if(_onErrorHandlerInstalled){return}_oldOnerrorHandler=window.onerror;window.onerror=traceKitWindowOnError;_onErrorHandlerInstalled=true}function uninstallGlobalHandler(){if(!_onErrorHandlerInstalled){return}window.onerror=_oldOnerrorHandler;_onErrorHandlerInstalled=false;_oldOnerrorHandler=undefined}function processLastException(){var _lastExceptionStack=lastExceptionStack,_lastArgs=lastArgs;lastArgs=null;lastExceptionStack=null;lastException=null;notifyHandlers.apply(null,[_lastExceptionStack,false].concat(_lastArgs))}function report(ex,rethrow){var args=_slice.call(arguments,1);if(lastExceptionStack){if(lastException===ex){return}else{processLastException()}}var stack=TraceKit.computeStackTrace(ex);lastExceptionStack=stack;lastException=ex;lastArgs=args;window.setTimeout(function(){if(lastException===ex){processLastException()}},stack.incomplete?2e3:0);if(rethrow!==false){throw ex}}report.subscribe=subscribe;report.unsubscribe=unsubscribe;report.uninstall=unsubscribeAll;return report}();TraceKit.computeStackTrace=function computeStackTraceWrapper(){var debug=false,sourceCache={};function loadSource(url){if(!TraceKit.remoteFetching){return""}try{var getXHR=function(){try{return new window.XMLHttpRequest}catch(e){return new window.ActiveXObject("Microsoft.XMLHTTP")}};var request=getXHR();request.open("GET",url,false);request.send("");return request.responseText}catch(e){return""}}function getSource(url){if(!isString(url))return[];if(!hasKey(sourceCache,url)){var source="";if(url.indexOf(document.domain)!==-1){source=loadSource(url)}sourceCache[url]=source?source.split("\n"):[]}return sourceCache[url]}function guessFunctionName(url,lineNo){var reFunctionArgNames=/function ([^(]*)\(([^)]*)\)/,reGuessFunction=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,line="",maxLines=10,source=getSource(url),m;if(!source.length){return UNKNOWN_FUNCTION}for(var i=0;i<maxLines;++i){line=source[lineNo-i]+line;if(!isUndefined(line)){if(m=reGuessFunction.exec(line)){return m[1]}else if(m=reFunctionArgNames.exec(line)){return m[1]}}}return UNKNOWN_FUNCTION}function gatherContext(url,line){var source=getSource(url);if(!source.length){return null}var context=[],linesBefore=Math.floor(TraceKit.linesOfContext/2),linesAfter=linesBefore+TraceKit.linesOfContext%2,start=Math.max(0,line-linesBefore-1),end=Math.min(source.length,line+linesAfter-1);line-=1;for(var i=start;i<end;++i){if(!isUndefined(source[i])){context.push(source[i])}}return context.length>0?context:null}function escapeRegExp(text){return text.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function escapeCodeAsRegExpForMatchingInsideHTML(body){return escapeRegExp(body).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function findSourceInUrls(re,urls){var source,m;for(var i=0,j=urls.length;i<j;++i){if((source=getSource(urls[i])).length){source=source.join("\n");if(m=re.exec(source)){return{url:urls[i],line:source.substring(0,m.index).split("\n").length,column:m.index-source.lastIndexOf("\n",m.index)-1}}}}return null}function findSourceInLine(fragment,url,line){var source=getSource(url),re=new RegExp("\\b"+escapeRegExp(fragment)+"\\b"),m;line-=1;if(source&&source.length>line&&(m=re.exec(source[line]))){return m.index}return null}function findSourceByFunctionBody(func){var urls=[window.location.href],scripts=document.getElementsByTagName("script"),body,code=""+func,codeRE=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,eventRE=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,re,parts,result;for(var i=0;i<scripts.length;++i){var script=scripts[i];if(script.src){urls.push(script.src)}}if(!(parts=codeRE.exec(code))){re=new RegExp(escapeRegExp(code).replace(/\s+/g,"\\s+"))}else{var name=parts[1]?"\\s+"+parts[1]:"",args=parts[2].split(",").join("\\s*,\\s*");body=escapeRegExp(parts[3]).replace(/;$/,";?");re=new RegExp("function"+name+"\\s*\\(\\s*"+args+"\\s*\\)\\s*{\\s*"+body+"\\s*}")}if(result=findSourceInUrls(re,urls)){return result}if(parts=eventRE.exec(code)){var event=parts[1];body=escapeCodeAsRegExpForMatchingInsideHTML(parts[2]);re=new RegExp("on"+event+"=[\\'\"]\\s*"+body+"\\s*[\\'\"]","i");if(result=findSourceInUrls(re,urls[0])){return result}re=new RegExp(body);if(result=findSourceInUrls(re,urls)){return result}}return null}function computeStackTraceFromStackProp(ex){if(!ex.stack){return null}var chrome=/^\s*at (?:((?:\[object object\])?\S+(?: \[as \S+\])?) )?\(?((?:file|https?|chrome-extension):.*?):(\d+)(?::(\d+))?\)?\s*$/i,gecko=/^\s*(\S*)(?:\((.*?)\))?@((?:file|https?|chrome).*?):(\d+)(?::(\d+))?\s*$/i,lines=ex.stack.split("\n"),stack=[],parts,element,reference=/^(.*) is undefined$/.exec(ex.message);for(var i=0,j=lines.length;i<j;++i){if(parts=gecko.exec(lines[i])){element={url:parts[3],func:parts[1]||UNKNOWN_FUNCTION,args:parts[2]?parts[2].split(","):"",line:+parts[4],column:parts[5]?+parts[5]:null}}else if(parts=chrome.exec(lines[i])){element={url:parts[2],func:parts[1]||UNKNOWN_FUNCTION,line:+parts[3],column:parts[4]?+parts[4]:null}}else{continue}if(!element.func&&element.line){element.func=guessFunctionName(element.url,element.line)}if(element.line){element.context=gatherContext(element.url,element.line)}stack.push(element)}if(!stack.length){return null}if(stack[0].line&&!stack[0].column&&reference){stack[0].column=findSourceInLine(reference[1],stack[0].url,stack[0].line)}else if(!stack[0].column&&!isUndefined(ex.columnNumber)){stack[0].column=ex.columnNumber+1}return{name:ex.name,message:ex.message,url:document.location.href,stack:stack}}function computeStackTraceFromStacktraceProp(ex){var stacktrace=ex.stacktrace;var testRE=/ line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,lines=stacktrace.split("\n"),stack=[],parts;for(var i=0,j=lines.length;i<j;i+=2){if(parts=testRE.exec(lines[i])){var element={line:+parts[1],column:+parts[2],func:parts[3]||parts[4],args:parts[5]?parts[5].split(","):[],url:parts[6]};if(!element.func&&element.line){element.func=guessFunctionName(element.url,element.line)}if(element.line){try{element.context=gatherContext(element.url,element.line)}catch(exc){}}if(!element.context){element.context=[lines[i+1]]}stack.push(element)}}if(!stack.length){return null}return{name:ex.name,message:ex.message,url:document.location.href,stack:stack}}function computeStackTraceFromOperaMultiLineMessage(ex){var lines=ex.message.split("\n");if(lines.length<4){return null}var lineRE1=/^\s*Line (\d+) of linked script ((?:file|https?)\S+)(?:: in function (\S+))?\s*$/i,lineRE2=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|https?)\S+)(?:: in function (\S+))?\s*$/i,lineRE3=/^\s*Line (\d+) of function script\s*$/i,stack=[],scripts=document.getElementsByTagName("script"),inlineScriptBlocks=[],parts,i,len,source;for(i in scripts){if(hasKey(scripts,i)&&!scripts[i].src){inlineScriptBlocks.push(scripts[i])}}for(i=2,len=lines.length;i<len;i+=2){var item=null;if(parts=lineRE1.exec(lines[i])){item={url:parts[2],func:parts[3],line:+parts[1]}}else if(parts=lineRE2.exec(lines[i])){item={url:parts[3],func:parts[4]};var relativeLine=+parts[1];var script=inlineScriptBlocks[parts[2]-1];if(script){source=getSource(item.url);if(source){source=source.join("\n");var pos=source.indexOf(script.innerText);if(pos>=0){item.line=relativeLine+source.substring(0,pos).split("\n").length}}}}else if(parts=lineRE3.exec(lines[i])){var url=window.location.href.replace(/#.*$/,""),line=parts[1];var re=new RegExp(escapeCodeAsRegExpForMatchingInsideHTML(lines[i+1]));source=findSourceInUrls(re,[url]);item={url:url,line:source?source.line:line,func:""}}if(item){if(!item.func){item.func=guessFunctionName(item.url,item.line)}var context=gatherContext(item.url,item.line);var midline=context?context[Math.floor(context.length/2)]:null;if(context&&midline.replace(/^\s*/,"")===lines[i+1].replace(/^\s*/,"")){item.context=context}else{item.context=[lines[i+1]]}stack.push(item)}}if(!stack.length){return null}return{name:ex.name,message:lines[0],url:document.location.href,stack:stack}}function augmentStackTraceWithInitialElement(stackInfo,url,lineNo,message){var initial={url:url,line:lineNo};if(initial.url&&initial.line){stackInfo.incomplete=false;if(!initial.func){initial.func=guessFunctionName(initial.url,initial.line)}if(!initial.context){initial.context=gatherContext(initial.url,initial.line)}var reference=/ '([^']+)' /.exec(message);if(reference){initial.column=findSourceInLine(reference[1],initial.url,initial.line)}if(stackInfo.stack.length>0){if(stackInfo.stack[0].url===initial.url){if(stackInfo.stack[0].line===initial.line){return false}else if(!stackInfo.stack[0].line&&stackInfo.stack[0].func===initial.func){stackInfo.stack[0].line=initial.line;stackInfo.stack[0].context=initial.context;return false}}}stackInfo.stack.unshift(initial);stackInfo.partial=true;return true}else{stackInfo.incomplete=true}return false}function computeStackTraceByWalkingCallerChain(ex,depth){var functionName=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,stack=[],funcs={},recursion=false,parts,item,source;for(var curr=computeStackTraceByWalkingCallerChain.caller;curr&&!recursion;curr=curr.caller){if(curr===computeStackTrace||curr===TraceKit.report){continue}item={url:null,func:UNKNOWN_FUNCTION,line:null,column:null};if(curr.name){item.func=curr.name}else if(parts=functionName.exec(curr.toString())){item.func=parts[1]}if(source=findSourceByFunctionBody(curr)){item.url=source.url;item.line=source.line;if(item.func===UNKNOWN_FUNCTION){item.func=guessFunctionName(item.url,item.line)}var reference=/ '([^']+)' /.exec(ex.message||ex.description);if(reference){item.column=findSourceInLine(reference[1],source.url,source.line)}}if(funcs[""+curr]){recursion=true}else{funcs[""+curr]=true}stack.push(item)}if(depth){stack.splice(0,depth)}var result={name:ex.name,message:ex.message,url:document.location.href,stack:stack};augmentStackTraceWithInitialElement(result,ex.sourceURL||ex.fileName,ex.line||ex.lineNumber,ex.message||ex.description);return result}function computeStackTrace(ex,depth){var stack=null;depth=depth==null?0:+depth;try{stack=computeStackTraceFromStacktraceProp(ex);if(stack){return stack}}catch(e){if(debug){throw e}}try{stack=computeStackTraceFromStackProp(ex);if(stack){return stack}}catch(e){if(debug){throw e}}try{stack=computeStackTraceFromOperaMultiLineMessage(ex);if(stack){return stack}}catch(e){if(debug){throw e}}try{stack=computeStackTraceByWalkingCallerChain(ex,depth+1);if(stack){return stack}}catch(e){if(debug){throw e}}return{}}function computeStackTraceOfCaller(depth){depth=(depth==null?0:+depth)+1;try{throw new Error}catch(ex){return computeStackTrace(ex,depth+1)}}computeStackTrace.augmentStackTraceWithInitialElement=augmentStackTraceWithInitialElement;computeStackTrace.guessFunctionName=guessFunctionName;computeStackTrace.gatherContext=gatherContext;computeStackTrace.ofCaller=computeStackTraceOfCaller;return computeStackTrace}();"use strict";var _Raven=window.Raven,hasJSON=!!(window.JSON&&window.JSON.stringify),lastCapturedException,lastEventId,globalServer,globalUser,globalKey,globalProject,globalOptions={logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],collectWindowErrors:true,tags:{},extra:{}},authQueryString,isRavenInstalled=false;var Raven={VERSION:"1.1.16",debug:true,noConflict:function(){window.Raven=_Raven;return Raven},config:function(dsn,options){if(globalServer){logDebug("error","Error: Raven has already been configured");return Raven}if(!dsn)return Raven;var uri=parseDSN(dsn),lastSlash=uri.path.lastIndexOf("/"),path=uri.path.substr(1,lastSlash);if(options){each(options,function(key,value){globalOptions[key]=value})}globalOptions.ignoreErrors.push("Script error.");globalOptions.ignoreErrors.push("Script error");globalOptions.ignoreErrors.push("Javascript error: Script error on line 0");globalOptions.ignoreErrors.push("Javascript error: Script error. on line 0");globalOptions.ignoreErrors=joinRegExp(globalOptions.ignoreErrors);globalOptions.ignoreUrls=globalOptions.ignoreUrls.length?joinRegExp(globalOptions.ignoreUrls):false;globalOptions.whitelistUrls=globalOptions.whitelistUrls.length?joinRegExp(globalOptions.whitelistUrls):false;globalOptions.includePaths=joinRegExp(globalOptions.includePaths);globalKey=uri.user;globalProject=uri.path.substr(lastSlash+1);globalServer="//"+uri.host+(uri.port?":"+uri.port:"")+"/"+path+"api/"+globalProject+"/store/";if(uri.protocol){globalServer=uri.protocol+":"+globalServer}if(globalOptions.fetchContext){TraceKit.remoteFetching=true}if(globalOptions.linesOfContext){TraceKit.linesOfContext=globalOptions.linesOfContext}TraceKit.collectWindowErrors=!!globalOptions.collectWindowErrors;setAuthQueryString();return Raven},install:function(){if(isSetup()&&!isRavenInstalled){TraceKit.report.subscribe(handleStackInfo);isRavenInstalled=true}return Raven},context:function(options,func,args){if(isFunction(options)){args=func||[];func=options;options=undefined}return Raven.wrap(options,func).apply(this,args)},wrap:function(options,func){if(isUndefined(func)&&!isFunction(options)){return options}if(isFunction(options)){func=options;options=undefined}if(!isFunction(func)){return func}if(func.__raven__){return func}function wrapped(){var args=[],i=arguments.length,deep=!options||options&&options.deep!==false;while(i--)args[i]=deep?Raven.wrap(options,arguments[i]):arguments[i];try{return func.apply(this,args)}catch(e){Raven.captureException(e,options);throw e}}for(var property in func){if(hasKey(func,property)){wrapped[property]=func[property]}}wrapped.__raven__=true;wrapped.__inner__=func;return wrapped},uninstall:function(){TraceKit.report.uninstall();isRavenInstalled=false;return Raven},captureException:function(ex,options){if(!(ex instanceof Error))return Raven.captureMessage(ex,options);lastCapturedException=ex;try{TraceKit.report(ex,options)}catch(ex1){if(ex!==ex1){throw ex1}}return Raven},captureMessage:function(msg,options){send(objectMerge({message:msg+""},options));return Raven},setUserContext:function(user){globalUser=user;return Raven},setExtraContext:function(extra){globalOptions.extra=extra||{};return Raven},setTagsContext:function(tags){globalOptions.tags=tags||{};return Raven},lastException:function(){return lastCapturedException},lastEventId:function(){return lastEventId}};Raven.setUser=Raven.setUserContext;function triggerEvent(eventType,options){var event,key;options=options||{};eventType="raven"+eventType.substr(0,1).toUpperCase()+eventType.substr(1);if(document.createEvent){event=document.createEvent("HTMLEvents");event.initEvent(eventType,true,true)}else{event=document.createEventObject();event.eventType=eventType}for(key in options)if(hasKey(options,key)){event[key]=options[key]}if(document.createEvent){document.dispatchEvent(event)}else{try{document.fireEvent("on"+event.eventType.toLowerCase(),event)}catch(e){}}}var dsnKeys="source protocol user pass host port path".split(" "),dsnPattern=/^(?:(\w+):)?\/\/(\w+)(:\w+)?@([\w\.-]+)(?::(\d+))?(\/.*)/;function RavenConfigError(message){this.name="RavenConfigError";this.message=message}RavenConfigError.prototype=new Error;RavenConfigError.prototype.constructor=RavenConfigError;function parseDSN(str){var m=dsnPattern.exec(str),dsn={},i=7;try{while(i--)dsn[dsnKeys[i]]=m[i]||""}catch(e){throw new RavenConfigError("Invalid DSN: "+str)}if(dsn.pass)throw new RavenConfigError("Do not specify your private key in the DSN!");return dsn}function isUndefined(what){return typeof what==="undefined"}function isFunction(what){return typeof what==="function"}function isString(what){return typeof what==="string"}function isEmptyObject(what){for(var k in what)return false;return true}function hasKey(object,key){return Object.prototype.hasOwnProperty.call(object,key)}function each(obj,callback){var i,j;if(isUndefined(obj.length)){for(i in obj){if(hasKey(obj,i)){callback.call(null,i,obj[i])}}}else{j=obj.length;if(j){for(i=0;i<j;i++){callback.call(null,i,obj[i])}}}}function setAuthQueryString(){authQueryString="?sentry_version=4"+"&sentry_client=raven-js/"+Raven.VERSION+"&sentry_key="+globalKey}function handleStackInfo(stackInfo,options){var frames=[];if(stackInfo.stack&&stackInfo.stack.length){each(stackInfo.stack,function(i,stack){var frame=normalizeFrame(stack);if(frame){frames.push(frame)}})}triggerEvent("handle",{stackInfo:stackInfo,options:options});processException(stackInfo.name,stackInfo.message,stackInfo.url,stackInfo.lineno,frames,options)}function normalizeFrame(frame){if(!frame.url)return;var normalized={filename:frame.url,lineno:frame.line,colno:frame.column,"function":frame.func||"?"},context=extractContextFromFrame(frame),i;if(context){var keys=["pre_context","context_line","post_context"];i=3;while(i--)normalized[keys[i]]=context[i]}normalized.in_app=!(!globalOptions.includePaths.test(normalized.filename)||/(Raven|TraceKit)\./.test(normalized["function"])||/raven\.(min\.)?js$/.test(normalized.filename));return normalized}function extractContextFromFrame(frame){if(!frame.context||!globalOptions.fetchContext)return;var context=frame.context,pivot=~~(context.length/2),i=context.length,isMinified=false;while(i--){if(context[i].length>300){isMinified=true;break}}if(isMinified){if(isUndefined(frame.column))return;return[[],context[pivot].substr(frame.column,50),[]]}return[context.slice(0,pivot),context[pivot],context.slice(pivot+1)]}function processException(type,message,fileurl,lineno,frames,options){var stacktrace,label,i;message+="";if(type==="Error"&&!message)return;if(globalOptions.ignoreErrors.test(message))return;if(frames&&frames.length){fileurl=frames[0].filename||fileurl;frames.reverse();stacktrace={frames:frames}}else if(fileurl){stacktrace={frames:[{filename:fileurl,lineno:lineno,in_app:true}]}}message=truncate(message,100);if(globalOptions.ignoreUrls&&globalOptions.ignoreUrls.test(fileurl))return;if(globalOptions.whitelistUrls&&!globalOptions.whitelistUrls.test(fileurl))return;label=lineno?message+" at "+lineno:message;send(objectMerge({exception:{type:type,value:message},stacktrace:stacktrace,culprit:fileurl,message:label},options))}function objectMerge(obj1,obj2){if(!obj2){return obj1}each(obj2,function(key,value){obj1[key]=value});return obj1}function truncate(str,max){return str.length<=max?str:str.substr(0,max)+"…"}function getHttpData(){var http={url:document.location.href,headers:{"User-Agent":navigator.userAgent}};if(document.referrer){http.headers.Referer=document.referrer}return http}function send(data){if(!isSetup())return;data=objectMerge({project:globalProject,logger:globalOptions.logger,site:globalOptions.site,platform:"javascript",request:getHttpData()},data);data.tags=objectMerge(globalOptions.tags,data.tags);data.extra=objectMerge(globalOptions.extra,data.extra);if(isEmptyObject(data.tags))delete data.tags;if(isEmptyObject(data.extra))delete data.extra;if(globalUser){data.user=globalUser}if(isFunction(globalOptions.dataCallback)){data=globalOptions.dataCallback(data)}if(isFunction(globalOptions.shouldSendCallback)&&!globalOptions.shouldSendCallback(data)){return}lastEventId=data.event_id||(data.event_id=uuid4());makeRequest(data)}function makeRequest(data){var img=new Image,src=globalServer+authQueryString+"&sentry_data="+encodeURIComponent(JSON.stringify(data));img.onload=function success(){triggerEvent("success",{data:data,src:src})};img.onerror=img.onabort=function failure(){triggerEvent("failure",{data:data,src:src})};img.src=src}function isSetup(){if(!hasJSON)return false;if(!globalServer){return false}return true}function joinRegExp(patterns){var sources=[],i=0,len=patterns.length,pattern;for(;i<len;i++){pattern=patterns[i];if(isString(pattern)){sources.push(pattern.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"))}else if(pattern&&pattern.source){sources.push(pattern.source)}}return new RegExp(sources.join("|"),"i")}function uuid4(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=="x"?r:r&3|8;return v.toString(16)})}function logDebug(level,message){if(window.console&&console[level]&&Raven.debug){console[level](message)}}function afterLoad(){var RavenConfig=window.RavenConfig;if(RavenConfig){Raven.config(RavenConfig.dsn,RavenConfig.config).install()}}afterLoad();window.Raven=Raven;if(typeof define==="function"&&define.amd){define("raven",[],function(){return Raven})}})(this);(function(window,Raven,Backbone){"use strict";if(!Backbone){return}function makeBackboneEventsOn(oldOn){return function BackboneEventsOn(name,callback,context){var _callback=callback._callback||callback;callback=Raven.wrap(callback);callback._callback=_callback;return oldOn.call(this,name,callback,context)}}var affectedObjects=[Backbone.Events,Backbone,Backbone.Model.prototype,Backbone.Collection.prototype,Backbone.View.prototype,Backbone.Router.prototype,Backbone.History.prototype],i=0,l=affectedObjects.length;for(;i<l;i++){var affected=affectedObjects[i];affected.on=makeBackboneEventsOn(affected.on);affected.bind=affected.on}})(this,Raven,window.Backbone);(function(window,Raven,$){"use strict";if(!$){return}var _oldEventAdd=$.event.add;$.event.add=function ravenEventAdd(elem,types,handler,data,selector){var _handler;if(handler&&handler.handler){_handler=handler.handler;handler.handler=Raven.wrap(handler.handler)}else{_handler=handler;handler=Raven.wrap(handler)}if(_handler.guid){handler.guid=_handler.guid}else{handler.guid=_handler.guid=$.guid++}return _oldEventAdd.call(this,elem,types,handler,data,selector)};var _oldReady=$.fn.ready;$.fn.ready=function ravenjQueryReadyWrapper(fn){return _oldReady.call(this,Raven.wrap(fn))};var _oldAjax=$.ajax;$.ajax=function ravenAjaxWrapper(url,options){var keys=["complete","error","success"],key;if(typeof url==="object"){options=url;url=undefined}options=options||{};while(key=keys.pop()){if($.isFunction(options[key])){options[key]=Raven.wrap(options[key])}}try{return _oldAjax.call(this,url,options)}catch(e){Raven.captureException(e);throw e}}})(this,Raven,window.jQuery);(function extendToAsynchronousCallbacks(window,Raven){"use strict";var _helper=function _helper(fnName){var originalFn=window[fnName];window[fnName]=function ravenAsyncExtension(){var args=[].slice.call(arguments);var originalCallback=args[0];if(typeof originalCallback==="function"){args[0]=Raven.wrap(originalCallback)}if(originalFn.apply){return originalFn.apply(this,args)}else{return originalFn(args[0],args[1])}}};_helper("setTimeout");_helper("setInterval")})(this,Raven);var MARVELAPP=MARVELAPP||{};MARVELAPP.models={};MARVELAPP.models.teams={};MARVELAPP.models.projects=undefined;MARVELAPP.models.my_projects={};MARVELAPP.models.current_user={};MARVELAPP.models.current_team={};MARVELAPP.models.selected_team_tab=undefined;MARVELAPP.models.selected_explorer_tab=undefined;MARVELAPP.models.poll_project=undefined;MARVELAPP.models.required_fonts=[];MARVELAPP.pollers={};MARVELAPP.pollers.team_first_run=false;MARVELAPP.pollers.team_poller=undefined;MARVELAPP.pollers.project_poller=undefined;MARVELAPP.pollers.project_delta_poller=undefined;MARVELAPP.utils={};MARVELAPP.utils.validator=undefined;MARVELAPP.utils.getEmbedCode=undefined;MARVELAPP.utils.sanitizeText=undefined;MARVELAPP.utils.stylizeText=undefined;MARVELAPP.utils.sanitizeEmbed=undefined;MARVELAPP.utils.isValidEmbedCode=undefined;MARVELAPP.utils.sanitizeCompletely=undefined;MARVELAPP.constants={VERSION_NO:"1.3.0",VERSION_NUM_COMPARE:1030,environments:{ENV_LIVE:"live"},user:{ALL_USER_PROPS:{ui_new_feature:"ui-new-feature",ui_pro_notify:"ui-pro-notify",USER_PROP_NOTIFICATION_LAST_SEEN:"ui-notify-last_seen",usr_email_notifications:"usr-email-notifications",ui_tour_seen:"ui-tour-seen"}},modal:{TOP_HEADER:"Modal header",CONTENT_HEADER:"Content header",BUTTON_TEXT:"button action",BUTTON_COLOR:"green",SIZE:""},profile:{delete_profile:{REMOVE_ACCOUNT:"Delete account?",NEXT_STEP:"Yes, delete my account"},delete_subscription:{REMOVE_SUBSCRIPTION:"Cancel Pro?",NEXT_SUBSCRIPTION:"Yes, cancel my subscription"},current_tab:""},projects:{POLL_TIMING:6e4,POLL_DELTA_TIMING:1e4,POLL_DELTA_TIMING_SLOW:3e4,ALL_PROJECTS_TEAM_ID:-1,MY_PROJECTS_TEAM_ID:-2,ARCHIVED_PROJECTS_TEAM_ID:-3,ARCHIVED_PROJECTS_TEAM_NAME:"Archived",PAGINATION_LIMIT:20,delete_modal:{DELETE_MODAL_HEADER:"Delete project?",DELETE_PROJECT_SUBMIT:"Yes, delete this project",DELETE_MODAL_SECOND_HEADER:"Are you sure you want to delete this project?"},create_project:{CREATE_NEW_PROJECT:"Create new project",NEXT_STEP:"Create project"}},content:{POLL_IMAGE_STATUS:15e3,SOURCE_TYPES:{SOURCE_DROPBOX:"1",SOURCE_GDRIVE:"2",SOURCE_CC:"3",SOURCE_DESKTOP:"4"}},team:{POLL_TIMING:4e4,DEFAULT_TEAM_NAME:"Team name",DEFAULT_TEAM_ICON_URL:"/static/assets/images/team-demo-logo.png",PEOPLE:"People",PERSON:"Person",categories:{HEADER_INVITED:"Teams you&apos;ve been invited to",HEADER_STARTED:"Your teams",HEADER_JOINED:"Teams you&apos;ve joined",EMPTY_CATEGORY:"There are no teams in the category"},invite:{TEAM_MEMBER_INVITE:"Invite team member",TEAM_MEMBER_REMOVE:"Remove team member",NEXT_STEP:"Send Invite",REMOVE_MEMBER:"Remove from team",REMOVE_TEAM:"Remove team?",REMOVE_TEAM_BUTTON:"Yes, remove this team"},create_team:{CREATE_NEW_TEAM:"Create new team",NEXT_STEP:"Create team &rarr;"}},invite:{TEAM_MEMBER_STATE_INVITED:"Invited",TEAM_MEMBER_STATE_ACCEPTED:"Accepted",TEAM_MEMBER_STATE_DECLINED:"Declined",TEAM_MEMBER_STATE_REMOVED:"Removed"},role:{ROLE_OWNER:"Owner",ROLE_ADMIN:"Administrator",ROLE_CLIENT:"Client",ROLE_TEAM_MEMBER:"Team Member"},subscription:{SUBSCRIPTION_ACTIVE:1,SUBSCRIPTION_INACTIVE:0,SUBSCRIPTION_CANCELLED:2,SUBSCRIPTION_IS_TRIAL:3,BILLING_CYCLE_MONTHLY:"monthly",BILLING_CYCLE_YEARLY:"yearly",SUB_TYPE_MONTHLY_EARLY:1,SUB_TYPE_MONTHLY_FULL:2,SUB_TYPE_YEARLY_EARLY:3,SUB_TYPE_YEARLY_FULL:4,PRICE_SUB_EARLY_MONTH:1e3,PRICE_SUB_EARLY_YEARLY:9600,PRICE_SUB_MONTHLY_FULL:1e3,PRICE_SUB_YEARLY_FULL:9600,PAYMENT_TYPE_NONE:0,PAYMENT_TYPE_PROCESSING:1,PAYMENT_TYPE_INVALIDATED:2,SOURCE_PAYPAL:1,SOURCE_STRIPE:2},allowance:{ALLOWANCE_APP_BUILD:"app_build",ALLOWANCE_ZIP_DOWNLOAD:"download prototypes",ALLOWANCE_TEAM_MEMBER:"team_member",ALLOWANCE_CREATE_TEAM:"create_team",ALLOWANCE_PASSWORD_PROTECT:"password_protect",ALLOWANCE_IOS_APP_BUILDS:"ios_app_builds",ALLOWANCE_COMMENT:"project_comments"},hotspot:{HOTSPOT_ACTIVE:1,HOTSPOT_DELETED:3,HOTSPOT_DETACHED:2,TYPE_STANDARD:1,TYPE_FIXED_HORIZONTAL:2,TYPE_FIXED_VERTICAL:3,TYPE_BACK:4,TYPE_URL:5,TYPE_ANCHOR:6,TYPE_EMBED:7,ACTION_TIMER:"timer"},prototype:{ARCHIVE_STATUS_READY:0,ARCHIVE_STATUS_WORKING:1,ARCHIVE_STATUS_APP_BUILDING:2,ARCHIVE_STATUS_APP_QUEUED:3,ARCHIVE_STATUS_APP_COMPILING:4,
ARCHIVE_STATUS_APP_UPLOADING:5,ARCHIVE_STATUS_FAILED:-1,ARCHIVE_TYPE_DOWNLOAD:1,ARCHIVE_TYPE_APP_IOS:2,ARCHIVE_TYPE_APP_ANDROID:3,ARCHIVE_TYPE_APP_PDF:4},pusher:{EVENT_MESSAGE:"notify_info",EVENT_IMAGE:"event_image",EVENT_CONTENT_CREATED:"event_content_created",EVENT_CONTENT_UPDATED:"event_content_updated",EVENT_ARCHIVE:"event_archive",EVENT_HOTSPOT:"event_hotspot",EVENT_PROJECT:"event_project",EVENT_SEQUENCE:"event_sequence",EVENT_TEAM:"event_team",EVENT_TEAM_PROJECT:"event_team_project",EVENT_TEAM_REMOVAL:"event_team_removal",EVENT_TEAM_INVITE:"event_team_invite",EVENT_TEAM_MEMBER_ADDED:"event_team_member_added",EVENT_TEAM_MEMBER_REMOVED:"event_team_member_removed",EVENT_COMMENT:"event_comment",EVENT_COMMENT_EXPLORE:"event_comment_explore",TYPE_COMMENT_DELETED:"comment_deleted",TYPE_ANNOTATION_DELETED:"annotation_deleted",TYPE_ANNOTATION_UPDATED:"annotation_updated",EVENT_SKETCH:"event_sketch",EVENT_NOTIFICATION:"event_notification",EVENT_COLLABORATOR_ADDED:"event_collaborator_added",EVENT_COLLABORATOR_REMOVED:"event_collaborator_removed",DIRECTORY_ENTRY_ADDED:"directory_entry_added",DIRECTORY_ENTRY_REMOVED:"directory_entry_removed",STATE_CONNECTED:"connected"},image_urls:{SKETCH_PREVIEW:"/static/assets/images/defaults/sketch.gif",DRIVE_PREVIEW:"/static/assets/images/defaults/drive.png"},comment_types:{EDIT:"edit",EXPLORE:"explore",PLAY:"play"},notifications:{NOTIFY_TYPES:{NOTIFY_TYPE_GLOBAL:1,NOTIFY_TYPE_ERROR:2,NOTIFY_TYPE_WARN:3,NOTIFY_TYPE_FEATURE:4}},integration:{INTEGRATION_KEY_LOOKBACK:"int_lookback"},canvasDimensions:{"desktop-view":[1440,1024],"web-frame":[1440,1024],"apple-watch-38-frame":[272,340],"apple-watch-42-frame":[312,390],"iphone6-frame":[750,1334],"iphone6plus-frame":[1242,2208],"iphone5-frame":[640,1136],"iphone5c-frame":[640,1136],"nexus5-frame":[1080,1920],"s5-frame":[1080,1920],"lumia920-frame":[768,1280],"htc-one-frame":[1080,1920],"ipad-frame":[768,1024],"iphone4s-frame":[640,960]}};MARVELAPP.messages={MEMBER_DELETE_FORBIDDEN:"You cannot remove your own user from a team",MEMBER_DELETE_SUCCESS:"User successfully removed",INVITE_SEND_ERROR:"There was a problem sending your invitation",INVITE_SEND_SUCCESS:"Your invite has been sent",INVITE_ACCEPT_ERROR:"There was a problem sending your invitation reply",INVITE_ACCEPT_SUCCESS:"Your reply has been sent",TEAM_NOT_FOUND:"Team not found",TEAM_CREATE_SUCCESS:"We have successfully created your team",TEAM_CREATE_ERROR:"We were unable to create your team",PROJECT_NOT_FOUND:"Project not found",PROJECT_DUPLICATE_ERROR:"Project could not be duplicated",PROJECT_DELETE_ERROR:"Project could not be deleted",PROJECT_ALREADY_EXISTS:"A project with this name already exists",PROJECT_DEMO_ERROR:"There was a problem creating your project demo",HOTSPOT_SYNC_ERROR:"There was a problem syncing the hotspot",ACCOUNT_DELETION_ERROR:"There was a problem deleting your account, please contact hello@marvelapp.com"};(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind,nativeCreate=Object.create;var Ctor=function(){};var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.8.3";var optimizeCb=function(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};var cb=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return optimizeCb(value,context,argCount);if(_.isObject(value))return _.matcher(value);return _.property(value)};_.iteratee=function(value,context){return cb(value,context,Infinity)};var createAssigner=function(keysFunc,undefinedOnly){return function(obj){var length=arguments.length;if(length<2||obj==null)return obj;for(var index=1;index<length;index++){var source=arguments[index],keys=keysFunc(source),l=keys.length;for(var i=0;i<l;i++){var key=keys[i];if(!undefinedOnly||obj[key]===void 0)obj[key]=source[key]}}return obj}};var baseCreate=function(prototype){if(!_.isObject(prototype))return{};if(nativeCreate)return nativeCreate(prototype);Ctor.prototype=prototype;var result=new Ctor;Ctor.prototype=null;return result};var property=function(key){return function(obj){return obj==null?void 0:obj[key]}};var MAX_ARRAY_INDEX=Math.pow(2,53)-1;var getLength=property("length");var isArrayLike=function(collection){var length=getLength(collection);return typeof length=="number"&&length>=0&&length<=MAX_ARRAY_INDEX};_.each=_.forEach=function(obj,iteratee,context){iteratee=optimizeCb(iteratee,context);var i,length;if(isArrayLike(obj)){for(i=0,length=obj.length;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,results=Array(length);for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};function createReduce(dir){function iterator(obj,iteratee,memo,keys,index,length){for(;index>=0&&index<length;index+=dir){var currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo}return function(obj,iteratee,memo,context){iteratee=optimizeCb(iteratee,context,4);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length,index=dir>0?0:length-1;if(arguments.length<3){memo=obj[keys?keys[index]:index];index+=dir}return iterator(obj,iteratee,memo,keys,index,length)}}_.reduce=_.foldl=_.inject=createReduce(1);_.reduceRight=_.foldr=createReduce(-1);_.find=_.detect=function(obj,predicate,context){var key;if(isArrayLike(obj)){key=_.findIndex(obj,predicate,context)}else{key=_.findKey(obj,predicate,context)}if(key!==void 0&&key!==-1)return obj[key]};_.filter=_.select=function(obj,predicate,context){var results=[];predicate=cb(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(cb(predicate)),context)};_.every=_.all=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false}return true};_.some=_.any=function(obj,predicate,context){predicate=cb(predicate,context);var keys=!isArrayLike(obj)&&_.keys(obj),length=(keys||obj).length;for(var index=0;index<length;index++){var currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true}return false};_.contains=_.includes=_.include=function(obj,item,fromIndex,guard){if(!isArrayLike(obj))obj=_.values(obj);if(typeof fromIndex!="number"||guard)fromIndex=0;return _.indexOf(obj,item,fromIndex)>=0};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){var func=isFunc?method:value[method];return func==null?func:func.apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matcher(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matcher(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=isArrayLike(obj)?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value}}}else{iteratee=cb(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed}})}return result};_.shuffle=function(obj){var set=isArrayLike(obj)?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index]}return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(!isArrayLike(obj))obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};_.sortBy=function(obj,iteratee,context){iteratee=cb(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=cb(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value]});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1});_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(isArrayLike(obj))return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return isArrayLike(obj)?obj.length:_.keys(obj).length};_.partition=function(obj,predicate,context){predicate=cb(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)});return[pass,fail]};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];return _.initial(array,array.length-n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return _.rest(array,Math.max(0,array.length-n))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,startIndex){var output=[],idx=0;for(var i=startIndex||0,length=getLength(input);i<length;i++){var value=input[i];if(isArrayLike(value)&&(_.isArray(value)||_.isArguments(value))){if(!shallow)value=flatten(value,shallow,strict);var j=0,len=value.length;output.length+=len;while(j<len){output[idx++]=value[j++]}}else if(!strict){output[idx++]=value}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false)};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null)iteratee=cb(iteratee,context);var result=[];var seen=[];for(var i=0,length=getLength(array);i<length;i++){var value=array[i],computed=iteratee?iteratee(value,i,array):value;if(isSorted){if(!i||seen!==computed)result.push(value);seen=computed}else if(iteratee){if(!_.contains(seen,computed)){seen.push(computed);result.push(value)}}else if(!_.contains(result,value)){result.push(value)}}return result};_.union=function(){return _.uniq(flatten(arguments,true,true))};_.intersection=function(array){var result=[];var argsLength=arguments.length;for(var i=0,length=getLength(array);i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break}if(j===argsLength)result.push(item)}return result};_.difference=function(array){var rest=flatten(arguments,true,true,1);return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(){return _.unzip(arguments)};_.unzip=function(array){var length=array&&_.max(array,getLength).length||0;var result=Array(length);for(var index=0;index<length;index++){result[index]=_.pluck(array,index)}return result};_.object=function(list,values){var result={};for(var i=0,length=getLength(list);i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};function createPredicateIndexFinder(dir){return function(array,predicate,context){predicate=cb(predicate,context);var length=getLength(array);var index=dir>0?0:length-1;for(;index>=0&&index<length;index+=dir){if(predicate(array[index],index,array))return index}return-1}}_.findIndex=createPredicateIndexFinder(1);_.findLastIndex=createPredicateIndexFinder(-1);_.sortedIndex=function(array,obj,iteratee,context){iteratee=cb(iteratee,context,1);var value=iteratee(obj);var low=0,high=getLength(array);while(low<high){var mid=Math.floor((low+high)/2);if(iteratee(array[mid])<value)low=mid+1;else high=mid}return low};function createIndexFinder(dir,predicateFind,sortedIndex){return function(array,item,idx){var i=0,length=getLength(array);if(typeof idx=="number"){if(dir>0){i=idx>=0?idx:Math.max(idx+length,i)}else{length=idx>=0?Math.min(idx+1,length):idx+length+1}}else if(sortedIndex&&idx&&length){idx=sortedIndex(array,item);return array[idx]===item?idx:-1}if(item!==item){idx=predicateFind(slice.call(array,i,length),_.isNaN);return idx>=0?idx+i:-1}for(idx=dir>0?i:length-1;idx>=0&&idx<length;idx+=dir){if(array[idx]===item)return idx}return-1}}_.indexOf=createIndexFinder(1,_.findIndex,_.sortedIndex);_.lastIndexOf=createIndexFinder(-1,_.findLastIndex);_.range=function(start,stop,step){if(stop==null){stop=start||0;start=0}step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};var executeBound=function(sourceFunc,boundFunc,context,callingContext,args){if(!(callingContext instanceof boundFunc))return sourceFunc.apply(context,args);var self=baseCreate(sourceFunc.prototype);var result=sourceFunc.apply(self,args);if(_.isObject(result))return result;return self};_.bind=function(func,context){if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");var args=slice.call(arguments,2);var bound=function(){return executeBound(func,bound,context,this,args.concat(slice.call(arguments)))};return bound};_.partial=function(func){var boundArgs=slice.call(arguments,1);var bound=function(){var position=0,length=boundArgs.length;var args=Array(length);for(var i=0;i<length;i++){args[i]=boundArgs[i]===_?arguments[position++]:boundArgs[i]}while(position<arguments.length)args.push(arguments[position++]);return executeBound(func,bound,this,this,args)};return bound};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj)}return obj};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=""+(hasher?hasher.apply(this,arguments):key);if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address]};memoize.cache={};return memoize};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=_.partial(_.delay,_,1);_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){if(timeout){clearTimeout(timeout);timeout=null}previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>=0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}if(times<=1)func=null;return memo}};_.once=_.partial(_.before,2);var hasEnumBug=!{toString:null}.propertyIsEnumerable("toString");var nonEnumerableProps=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];function collectNonEnumProps(obj,keys){var nonEnumIdx=nonEnumerableProps.length;var constructor=obj.constructor;var proto=_.isFunction(constructor)&&constructor.prototype||ObjProto;var prop="constructor";if(_.has(obj,prop)&&!_.contains(keys,prop))keys.push(prop);while(nonEnumIdx--){prop=nonEnumerableProps[nonEnumIdx];if(prop in obj&&obj[prop]!==proto[prop]&&!_.contains(keys,prop)){keys.push(prop)}}}_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.allKeys=function(obj){if(!_.isObject(obj))return[];var keys=[];for(var key in obj)keys.push(key);if(hasEnumBug)collectNonEnumProps(obj,keys);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.mapObject=function(obj,iteratee,context){iteratee=cb(iteratee,context);var keys=_.keys(obj),length=keys.length,results={},currentKey;for(var index=0;index<length;index++){currentKey=keys[index];results[currentKey]=iteratee(obj[currentKey],currentKey,obj)}return results};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=createAssigner(_.allKeys);_.extendOwn=_.assign=createAssigner(_.keys);_.findKey=function(obj,predicate,context){predicate=cb(predicate,context);var keys=_.keys(obj),key;for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(predicate(obj[key],key,obj))return key}};_.pick=function(object,oiteratee,context){var result={},obj=object,iteratee,keys;if(obj==null)return result;if(_.isFunction(oiteratee)){keys=_.allKeys(obj);iteratee=optimizeCb(oiteratee,context)}else{keys=flatten(arguments,false,false,1);iteratee=function(value,key,obj){return key in obj};obj=Object(obj)}for(var i=0,length=keys.length;i<length;i++){var key=keys[i];var value=obj[key];if(iteratee(value,key,obj))result[key]=value}return result};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee)}else{var keys=_.map(flatten(arguments,false,false,1),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)};_.defaults=createAssigner(_.allKeys,true);_.create=function(prototype,props){var result=baseCreate(prototype);if(props)_.extendOwn(result,props);return result};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};_.isMatch=function(object,attrs){var keys=_.keys(attrs),length=keys.length;if(object==null)return!length;var obj=Object(object);for(var i=0;i<length;i++){var key=keys[i];if(attrs[key]!==obj[key]||!(key in obj))return false}return true};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case"[object RegExp]":case"[object String]":return""+a===""+b;case"[object Number]":if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var areArrays=className==="[object Array]";if(!areArrays){if(typeof a!="object"||typeof b!="object")return false;var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)&&("constructor"in a&&"constructor"in b)){return false}}aStack=aStack||[];bStack=bStack||[];var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b}aStack.push(a);bStack.push(b);if(areArrays){length=a.length;if(length!==b.length)return false;while(length--){if(!eq(a[length],b[length],aStack,bStack))return false}}else{var keys=_.keys(a),key;length=keys.length;if(_.keys(b).length!==length)return false;while(length--){key=keys[length];if(!(_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))return false}}aStack.pop();bStack.pop();return true};_.isEqual=function(a,b){return eq(a,b)};_.isEmpty=function(obj){if(obj==null)return true;if(isArrayLike(obj)&&(_.isArray(obj)||_.isString(obj)||_.isArguments(obj)))return obj.length===0;return _.keys(obj).length===0};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};_.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,"callee")}}if(typeof/./!="function"&&typeof Int8Array!="object"){_.isFunction=function(obj){return typeof obj=="function"||false}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=property;_.propertyOf=function(obj){return obj==null?function(){}:function(key){return obj[key]}};_.matcher=_.matches=function(attrs){attrs=_.extendOwn({},attrs);return function(obj){return _.isMatch(obj,attrs)}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=optimizeCb(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+_.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property,fallback){var value=object==null?void 0:object[property];if(value===void 0){value=fallback}return _.isFunction(value)?value.call(object):value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else if(evaluate){source+="';\n"+evaluate+"\n__p+='"}return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}var template=function(data){return render.call(this,data,_)};var argument=settings.variable||"obj";template.source="function("+argument+"){\n"+source+"}";return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var result=function(instance,obj){return instance._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result(this,func.apply(_,args))}})};_.mixin(_);_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==="shift"||name==="splice")&&obj.length===0)delete obj[0];return result(this,obj)}});_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};_.prototype.valueOf=_.prototype.toJSON=_.prototype.value;_.prototype.toString=function(){return""+this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this);(function(window,undefined){var readyList,rootjQuery,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="1.10.2",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rvalidchars=/^[\],:{}\s]*$/,rvalidbraces=/(?:^|:|,)(?:\s*\[)+/g,rvalidescape=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,rvalidtokens=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()},completed=function(event){if(document.addEventListener||event.type==="load"||document.readyState==="complete"){detach();jQuery.ready()}},detach=function(){if(document.addEventListener){document.removeEventListener("DOMContentLoaded",completed,false);window.removeEventListener("load",completed,false)}else{document.detachEvent("onreadystatechange",completed);window.detachEvent("onload",completed)}};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem;if(!selector){return this}if(typeof selector==="string"){if(selector.charAt(0)==="<"&&selector.charAt(selector.length-1)===">"&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector)}this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}else if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else if(jQuery.isFunction(selector)){return rootjQuery.ready(selector)}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(num){return num==null?this.toArray():num<0?this[this.length+num]:this[num]},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){jQuery.ready.promise().done(fn);return this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,
sort:[].sort,splice:[].splice};jQuery.fn.init.prototype=jQuery.fn;jQuery.extend=jQuery.fn.extend=function(){var src,copyIsArray,copy,name,options,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!jQuery.isFunction(target)){target={}}if(length===i){target=this;--i}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery},isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}if(!document.body){return setTimeout(jQuery.ready)}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger("ready").off("ready")}},isFunction:function(obj){return jQuery.type(obj)==="function"},isArray:Array.isArray||function(obj){return jQuery.type(obj)==="array"},isWindow:function(obj){return obj!=null&&obj==obj.window},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){if(obj==null){return String(obj)}return typeof obj==="object"||typeof obj==="function"?class2type[core_toString.call(obj)]||"object":typeof obj},isPlainObject:function(obj){var key;if(!obj||jQuery.type(obj)!=="object"||obj.nodeType||jQuery.isWindow(obj)){return false}try{if(obj.constructor&&!core_hasOwn.call(obj,"constructor")&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}if(jQuery.support.ownLast){for(key in obj){return core_hasOwn.call(obj,key)}}for(key in obj){}return key===undefined||core_hasOwn.call(obj,key)},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},error:function(msg){throw new Error(msg)},parseHTML:function(data,context,keepScripts){if(!data||typeof data!=="string"){return null}if(typeof context==="boolean"){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts);if(scripts){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)},parseJSON:function(data){if(window.JSON&&window.JSON.parse){return window.JSON.parse(data)}if(data===null){return data}if(typeof data==="string"){data=jQuery.trim(data);if(data){if(rvalidchars.test(data.replace(rvalidescape,"@").replace(rvalidtokens,"]").replace(rvalidbraces,""))){return new Function("return "+data)()}}}jQuery.error("Invalid JSON: "+data)},parseXML:function(data){var xml,tmp;if(!data||typeof data!=="string"){return null}try{if(window.DOMParser){tmp=new DOMParser;xml=tmp.parseFromString(data,"text/xml")}else{xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(data)}}catch(e){xml=undefined}if(!xml||!xml.documentElement||xml.getElementsByTagName("parsererror").length){jQuery.error("Invalid XML: "+data)}return xml},noop:function(){},globalEval:function(data){if(data&&jQuery.trim(data)){(window.execScript||function(data){window["eval"].call(window,data)})(data)}},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray){for(;i<length;i++){value=callback.apply(obj[i],args);if(value===false){break}}}else{for(i in obj){value=callback.apply(obj[i],args);if(value===false){break}}}}else{if(isArray){for(;i<length;i++){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}else{for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}}return obj},trim:core_trim&&!core_trim.call("\ufeff ")?function(text){return text==null?"":core_trim.call(text)}:function(text){return text==null?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArraylike(Object(arr))){jQuery.merge(ret,typeof arr==="string"?[arr]:arr)}else{core_push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){var len;if(arr){if(core_indexOf){return core_indexOf.call(arr,elem,i)}len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in arr&&arr[i]===elem){return i}}}return-1},merge:function(first,second){var l=second.length,i=first.length,j=0;if(typeof l==="number"){for(;j<l;j++){first[i++]=second[j]}}else{while(second[j]!==undefined){first[i++]=second[j++]}}first.length=i;return first},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;inv=!!inv;for(;i<length;i++){retVal=!!callback(elems[i],i);if(inv!==retVal){ret.push(elems[i])}}return ret},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret[ret.length]=value}}}return core_concat.apply([],ret)},guid:1,proxy:function(fn,context){var args,proxy,tmp;if(typeof context==="string"){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=core_slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(core_slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},access:function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=key==null;if(jQuery.type(key)==="object"){chainable=true;for(i in key){jQuery.access(elems,fn,i,key[i],true,emptyGet,raw)}}else if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<length;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},now:function(){return(new Date).getTime()},swap:function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret}});jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==="complete"){setTimeout(jQuery.ready)}else if(document.addEventListener){document.addEventListener("DOMContentLoaded",completed,false);window.addEventListener("load",completed,false)}else{document.attachEvent("onreadystatechange",completed);window.attachEvent("onload",completed);var top=false;try{top=window.frameElement==null&&document.documentElement}catch(e){}if(top&&top.doScroll){(function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll("left")}catch(e){return setTimeout(doScrollCheck,50)}detach();jQuery.ready()}})()}}}return readyList.promise(obj)};jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);if(jQuery.isWindow(obj)){return false}if(obj.nodeType===1&&length){return true}return type==="array"||type!=="function"&&(length===0||typeof length==="number"&&length>0&&length-1 in obj)}rootjQuery=jQuery(document);(function(window,undefined){var i,support,cachedruns,Expr,getText,isXML,compile,outermostContext,sortInput,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),hasDuplicate=false,sortOrder=function(a,b){if(a===b){hasDuplicate=true;return 0}return 0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i}}return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:([*^$|!~]?=)"+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+attributes.replace(3,8)+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rsibling=new RegExp(whitespace+"*[+~]"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;results=results||[];if(!selector||typeof selector!=="string"){return results}if((nodeType=context.nodeType)!==1&&nodeType!==9){return[]}if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector)){if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType===9&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=="object"){groups=tokenize(selector);if(old=context.getAttribute("id")){nid=old.replace(rescape,"\\$&")}else{context.setAttribute("id",nid)}nid="[id='"+nid+"'] ";i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i])}newContext=rsibling.test(selector)&&context.parentNode||context;newSelector=groups.join(",")}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(!old){context.removeAttribute("id")}}}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+=" ")>Expr.cacheLength){delete cache[keys.shift()]}return cache[key]=value}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler){var arr=attrs.split("|"),i=attrs.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==="input"||name==="button")&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j])}}})})}isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=="HTML":false};support=Sizzle.support={};setDocument=Sizzle.setDocument=function(node){var doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=doc.documentElement;documentIsHTML=!isXML(doc);if(parent&&parent.attachEvent&&parent!==parent.top){parent.attachEvent("onbeforeunload",function(){setDocument()})}support.attributes=assert(function(div){div.className="i";return!div.getAttribute("className")});support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(""));return!div.getElementsByTagName("*").length});support.getElementsByClassName=assert(function(div){div.innerHTML="<div class='a'></div><div class='a i'></div>";div.firstChild.className="i";return div.getElementsByClassName("i").length===2});support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find["ID"]=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}}else{delete Expr.find["ID"];Expr.filter["ID"]=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}}Expr.find["TAG"]=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==="*"){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find["CLASS"]=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!==strundefined&&documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=rnative.test(doc.querySelectorAll)){assert(function(div){div.innerHTML="<select><option selected=''></option></select>";if(!div.querySelectorAll("[selected]").length){rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")")}if(!div.querySelectorAll(":checked").length){rbuggyQSA.push(":checked")}});assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden");div.appendChild(input).setAttribute("t","");if(div.querySelectorAll("[t^='']").length){rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")")}if(!div.querySelectorAll(":enabled").length){rbuggyQSA.push(":enabled",":disabled")}div.querySelectorAll("*,:x");rbuggyQSA.push(",.*:")})}if(support.matchesSelector=rnative.test(matches=docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)){assert(function(div){support.disconnectedMatch=matches.call(div,"div");matches.call(div,"[s!='']:x");rbuggyMatches.push("!=",pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|"));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|"));contains=rnative.test(docElem.contains)||docElem.compareDocumentPosition?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);if(compare){if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===doc||contains(preferredDoc,a)){return-1}if(b===doc||contains(preferredDoc,b)){return 1}return sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}return compare&4?-1:1}return a.compareDocumentPosition?-1:1}:function(a,b){var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(a===b){hasDuplicate=true;return 0}else if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}else if(aup===bup){return siblingCheck(a,b)}cur=a;while(cur=cur.parentNode){ap.unshift(cur)}cur=b;while(cur=cur.parentNode){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return doc};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,"='$1']");if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val===undefined?support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null:val};Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}return results};getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(!nodeType){for(;node=elem[i];i++){ret+=getText(node)}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==="string"){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:true}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:true},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[4]||match[5]||"").replace(runescape,funescape);if(match[2]==="~="){match[3]=" "+match[3]+" "}return match.slice(0,4)},CHILD:function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==="nth"){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==="even"||match[3]==="odd"));match[5]=+(match[7]+match[8]||match[3]==="odd")}else if(match[3]){Sizzle.error(match[0])}return match},PSEUDO:function(match){var excess,unquoted=!match[5]&&match[2];if(matchExpr["CHILD"].test(match[0])){return null}if(match[3]&&match[4]!==undefined){match[2]=match[4]}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==="*"?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test(typeof elem.className==="string"&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==="!="}if(!operator){return true}result+="";return operator==="="?result===check:operator==="!="?result!==check:operator==="^="?check&&result.indexOf(check)===0:operator==="*="?check&&result.indexOf(check)>-1:operator==="$="?check&&result.slice(-check.length)===check:operator==="~="?(" "+result+" ").indexOf(check)>-1:operator==="|="?result===check||result.slice(0,check.length+1)===check+"-":false}},CHILD:function(type,what,argument,first,last){var simple=type.slice(0,3)!=="nth",forward=type.slice(-4)!=="last",ofType=what==="of-type";return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==="only"&&!start&&"nextSibling"}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1]}else{while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff]}if(node===elem){break}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,"",argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){if(!ridentifier.test(lang||"")){Sizzle.error("unsupported lang: "+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang")){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+"-")===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===false},disabled:function(elem){return elem.disabled===true},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==="input"&&!!elem.checked||nodeName==="option"&&!!elem.selected},selected:function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeName>"@"||elem.nodeType===3||elem.nodeType===4){return false}}return true},parent:function(elem){return!Expr.pseudos["empty"](elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return name==="input"&&elem.type==="button"||name==="button"},text:function(elem){var attr;return elem.nodeName.toLowerCase()==="input"&&elem.type==="text"&&((attr=elem.getAttribute("type"))==null||attr.toLowerCase()===elem.type)},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos["nth"]=Expr.pseudos["eq"];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim," ")});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)}function toSelector(tokens){var i=0,len=tokens.length,selector="";for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==="parentNode",doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var data,cache,outerCache,dirkey=dirruns+" "+doneName;if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((cache=outerCache[dir])&&cache[0]===dirkey){if((data=cache[1])===true||data===cachedruns){return data===true}}else{cache=outerCache[dir]=[dirkey];cache[1]=matcher(elem,context,xml)||cachedruns;if(cache[1]===true){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem)}}postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{
matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===" "?"*":""})).replace(rtrim,"$1"),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var matcherCachedRuns=0,bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=expandContext!=null,contextBackup=outermostContext,elems=seed||byElement&&Expr.find["TAG"]("*",expandContext&&context.parentNode||context),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||.1;if(outermost){outermostContext=context!==document&&context;cachedruns=matcherCachedRuns}for(;(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while(matcher=elementMatchers[j++]){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique;cachedruns=++matcherCachedRuns}}if(bySet){if(elem=!matcher&&elem){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){if(!group){group=tokenize(selector)}i=group.length;while(i--){cached=matcherFromTokens(group[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))}return cached};function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function select(selector,context,results,seed){var i,tokens,token,type,find,match=tokenize(selector);if(!seed){if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==="ID"&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find["ID"](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}selector=selector.slice(tokens.shift().value.length)}i=matchExpr["needsContext"].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&context.parentNode||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}}compile(selector,match)(seed,context,!documentIsHTML,results,rsibling.test(selector));return results}support.sortStable=expando.split("").sort(sortOrder).join("")===expando;support.detectDuplicates=hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement("div"))&1});if(!assert(function(div){div.innerHTML="<a href='#'></a>";return div.firstChild.getAttribute("href")==="#"})){addHandle("type|href|height|width",function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==="type"?1:2)}})}if(!support.attributes||!assert(function(div){div.innerHTML="<input/>";div.firstChild.setAttribute("value","");return div.firstChild.getAttribute("value")===""})){addHandle("value",function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==="input"){return elem.defaultValue}})}if(!assert(function(div){return div.getAttribute("disabled")==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return(val=elem.getAttributeNode(name))&&val.specified?val.value:elem[name]===true?name.toLowerCase():null}})}jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[":"]=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains})(window);var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.match(core_rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==="string"?optionsCache[options]||createOptions(options):jQuery.extend({},options);var firing,memory,fired,firingLength,firingIndex,firingStart,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else if(memory){list=[]}else{self.disable()}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==="function"){if(!options.unique||!self.has(arg)){list.push(arg)}}else if(arg&&arg.length&&type!=="string"){add(arg)}})})(arguments);if(firing){firingLength=list.length}else if(memory){firingStart=start;fire(memory)}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!!(list&&list.length)},empty:function(){list=[];firingLength=0;return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return!list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return!stack},fireWith:function(context,args){if(list&&(!fired||stack)){args=args||[];args=[context,args.slice?args.slice():args];if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[action+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+"With"](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+"With"]=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?core_slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else if(!--remaining){deferred.resolveWith(contexts,values)}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});jQuery.support=function(support){var all,a,input,select,fragment,opt,eventName,isSupported,i,div=document.createElement("div");div.setAttribute("className","t");div.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";all=div.getElementsByTagName("*")||[];a=div.getElementsByTagName("a")[0];if(!a||!a.style||!all.length){return support}select=document.createElement("select");opt=select.appendChild(document.createElement("option"));input=div.getElementsByTagName("input")[0];a.style.cssText="top:1px;float:left;opacity:.5";support.getSetAttribute=div.className!=="t";support.leadingWhitespace=div.firstChild.nodeType===3;support.tbody=!div.getElementsByTagName("tbody").length;support.htmlSerialize=!!div.getElementsByTagName("link").length;support.style=/top/.test(a.getAttribute("style"));support.hrefNormalized=a.getAttribute("href")==="/a";support.opacity=/^0.5/.test(a.style.opacity);support.cssFloat=!!a.style.cssFloat;support.checkOn=!!input.value;support.optSelected=opt.selected;support.enctype=!!document.createElement("form").enctype;support.html5Clone=document.createElement("nav").cloneNode(true).outerHTML!=="<:nav></:nav>";support.inlineBlockNeedsLayout=false;support.shrinkWrapBlocks=false;support.pixelPosition=false;support.deleteExpando=true;support.noCloneEvent=true;support.reliableMarginRight=true;support.boxSizingReliable=true;input.checked=true;support.noCloneChecked=input.cloneNode(true).checked;select.disabled=true;support.optDisabled=!opt.disabled;try{delete div.test}catch(e){support.deleteExpando=false}input=document.createElement("input");input.setAttribute("value","");support.input=input.getAttribute("value")==="";input.value="t";input.setAttribute("type","radio");support.radioValue=input.value==="t";input.setAttribute("checked","t");input.setAttribute("name","t");fragment=document.createDocumentFragment();fragment.appendChild(input);support.appendChecked=input.checked;support.checkClone=fragment.cloneNode(true).cloneNode(true).lastChild.checked;if(div.attachEvent){div.attachEvent("onclick",function(){support.noCloneEvent=false});div.cloneNode(true).click()}for(i in{submit:true,change:true,focusin:true}){div.setAttribute(eventName="on"+i,"t");support[i+"Bubbles"]=eventName in window||div.attributes[eventName].expando===false}div.style.backgroundClip="content-box";div.cloneNode(true).style.backgroundClip="";support.clearCloneStyle=div.style.backgroundClip==="content-box";for(i in jQuery(support)){break}support.ownLast=i!=="0";jQuery(function(){var container,marginDiv,tds,divReset="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",body=document.getElementsByTagName("body")[0];if(!body){return}container=document.createElement("div");container.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";body.appendChild(container).appendChild(div);div.innerHTML="<table><tr><td></td><td>t</td></tr></table>";tds=div.getElementsByTagName("td");tds[0].style.cssText="padding:0;margin:0;border:0;display:none";isSupported=tds[0].offsetHeight===0;tds[0].style.display="";tds[1].style.display="none";support.reliableHiddenOffsets=isSupported&&tds[0].offsetHeight===0;div.innerHTML="";div.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";jQuery.swap(body,body.style.zoom!=null?{zoom:1}:{},function(){support.boxSizing=div.offsetWidth===4});if(window.getComputedStyle){support.pixelPosition=(window.getComputedStyle(div,null)||{}).top!=="1%";support.boxSizingReliable=(window.getComputedStyle(div,null)||{width:"4px"}).width==="4px";marginDiv=div.appendChild(document.createElement("div"));marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width="0";div.style.width="1px";support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight)}if(typeof div.style.zoom!==core_strundefined){div.innerHTML="";div.style.cssText=divReset+"width:1px;padding:1px;display:inline;zoom:1";support.inlineBlockNeedsLayout=div.offsetWidth===3;div.style.display="block";div.innerHTML="<div></div>";div.firstChild.style.width="5px";support.shrinkWrapBlocks=div.offsetWidth!==3;if(support.inlineBlockNeedsLayout){body.style.zoom=1}}body.removeChild(container);container=div=tds=marginDiv=null});all=select=fragment=opt=a=input=null;return support}({});var rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;function internalData(elem,name,data,pvt){if(!jQuery.acceptData(elem)){return}var ret,thisCache,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if((!id||!cache[id]||!pvt&&!cache[id].data)&&data===undefined&&typeof name==="string"){return}if(!id){if(isNode){id=elem[internalKey]=core_deletedIds.pop()||jQuery.guid++}else{id=internalKey}}if(!cache[id]){cache[id]=isNode?{}:{toJSON:jQuery.noop}}if(typeof name==="object"||typeof name==="function"){if(pvt){cache[id]=jQuery.extend(cache[id],name)}else{cache[id].data=jQuery.extend(cache[id].data,name)}}thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={}}thisCache=thisCache.data}if(data!==undefined){thisCache[jQuery.camelCase(name)]=data}if(typeof name==="string"){ret=thisCache[name];if(ret==null){ret=thisCache[jQuery.camelCase(name)]}}else{ret=thisCache}return ret}function internalRemoveData(elem,name,pvt){if(!jQuery.acceptData(elem)){return}var thisCache,i,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(!cache[id]){return}if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name]}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name]}else{name=name.split(" ")}}}else{name=name.concat(jQuery.map(name,jQuery.camelCase))}i=name.length;while(i--){delete thisCache[name[i]]}if(pvt?!isEmptyDataObject(thisCache):!jQuery.isEmptyObject(thisCache)){return}}}if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return}}if(isNode){jQuery.cleanData([elem],true)}else if(jQuery.support.deleteExpando||cache!=cache.window){delete cache[id]}else{cache[id]=null}}jQuery.extend({cache:{},noData:{applet:true,embed:true,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return!!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data){return internalData(elem,name,data)},removeData:function(elem,name){return internalRemoveData(elem,name)},_data:function(elem,name,data){return internalData(elem,name,data,true)},_removeData:function(elem,name){return internalRemoveData(elem,name,true)},acceptData:function(elem){if(elem.nodeType&&elem.nodeType!==1&&elem.nodeType!==9){return false}var noData=elem.nodeName&&jQuery.noData[elem.nodeName.toLowerCase()];return!noData||noData!==true&&elem.getAttribute("classid")===noData}});jQuery.fn.extend({data:function(key,value){var attrs,name,data=null,i=0,elem=this[0];if(key===undefined){if(this.length){data=jQuery.data(elem);if(elem.nodeType===1&&!jQuery._data(elem,"parsedAttrs")){attrs=elem.attributes;for(;i<attrs.length;i++){name=attrs[i].name;if(name.indexOf("data-")===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}jQuery._data(elem,"parsedAttrs",true)}}return data}if(typeof key==="object"){return this.each(function(){jQuery.data(this,key)})}return arguments.length>1?this.each(function(){jQuery.data(this,key,value)}):elem?dataAttr(elem,key,jQuery.data(elem,key)):null},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}});function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name="data-"+key.replace(rmultiDash,"-$1").toLowerCase();data=elem.getAttribute(name);if(typeof data==="string"){try{data=data==="true"?true:data==="false"?false:data==="null"?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}jQuery.data(elem,key,data)}else{data=undefined}}return data}function isEmptyDataObject(obj){var name;for(name in obj){if(name==="data"&&jQuery.isEmptyObject(obj[name])){continue}if(name!=="toJSON"){return false}}return true}jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||"fx")+"queue";queue=jQuery._data(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=jQuery._data(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==="inprogress"){fn=queue.shift();startLength--}if(fn){if(type==="fx"){queue.unshift("inprogress")}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+"queueHooks";return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){jQuery._removeData(elem,type+"queue");jQuery._removeData(elem,key)})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=="string"){data=type;type="fx";setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==="fx"&&queue[0]!=="inprogress"){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||"fx";return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!--count){defer.resolveWith(elements,[elements])}};if(typeof type!=="string"){obj=type;type=undefined}type=type||"fx";while(i--){tmp=jQuery._data(elements[i],type+"queueHooks");if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var nodeHook,boolHook,rclass=/[\t\r\n\f]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button|object)$/i,rclickable=/^(?:a|area)$/i,ruseDefault=/^(?:checked|selected)$/i,getSetAttribute=jQuery.support.getSetAttribute,getSetInput=jQuery.support.input;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name]}catch(e){}})},addClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ");if(cur){j=0;while(clazz=classes[j++]){if(cur.indexOf(" "+clazz+" ")<0){cur+=clazz+" "}}elem.className=jQuery.trim(cur)}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=arguments.length===0||typeof value==="string"&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if(proceed){classes=(value||"").match(core_rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"");if(cur){j=0;while(clazz=classes[j++]){while(cur.indexOf(" "+clazz+" ")>=0){cur=cur.replace(" "+clazz+" "," ")}}elem.className=value?jQuery.trim(cur):""}}}return this},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==="boolean"&&type==="string"){return stateVal?this.addClass(value):this.removeClass(value)}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==="string"){var className,i=0,self=jQuery(this),classNames=value.match(core_rnotwhite)||[];while(className=classNames[i++]){if(self.hasClass(className)){self.removeClass(className)}else{self.addClass(className)}}}else if(type===core_strundefined||type==="boolean"){if(this.className){jQuery._data(this,"__className__",this.className)}this.className=this.className||value===false?"":jQuery._data(this,"__className__")||""}})},hasClass:function(selector){var className=" "+selector+" ",i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0){return true}}return false},val:function(value){var ret,hooks,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined){return ret}ret=elem.value;return typeof ret==="string"?ret.replace(rreturn,""):ret==null?"":ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=""}else if(typeof val==="number"){val+=""}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?"":value+""})}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!("set"in hooks)||hooks.set(this,val,"value")===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,"value");return val!=null?val:elem.text}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==="select-one"||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(jQuery.support.optDisabled?!option.disabled:option.getAttribute("disabled")===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(option.selected=jQuery.inArray(jQuery(option).val(),values)>=0){optionSet=true}}if(!optionSet){elem.selectedIndex=-1}return values}}},attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute===core_strundefined){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name)}else if(hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,value+"");return value}}else if(hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(core_rnotwhite);if(attrNames&&elem.nodeType===1){while(name=attrNames[i++]){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){elem[propName]=false}else{elem[jQuery.camelCase("default-"+name)]=elem[propName]=false}}else{jQuery.attr(elem,name,"")}elem.removeAttribute(getSetAttribute?name:propName)}}},attrHooks:{type:{set:function(elem,value){if(!jQuery.support.radioValue&&value==="radio"&&jQuery.nodeName(elem,"input")){var val=elem.value;elem.setAttribute("type",value);if(val){elem.value=val}return value}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){return hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value}else{return hooks&&"get"in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]}},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){elem.setAttribute(!getSetAttribute&&jQuery.propFix[name]||name,name)}else{elem[jQuery.camelCase("default-"+name)]=elem[name]=true}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=jQuery.expr.attrHandle[name]||jQuery.find.attr;jQuery.expr.attrHandle[name]=getSetInput&&getSetAttribute||!ruseDefault.test(name)?function(elem,name,isXML){var fn=jQuery.expr.attrHandle[name],ret=isXML?undefined:(jQuery.expr.attrHandle[name]=undefined)!=getter(elem,name,isXML)?name.toLowerCase():null;jQuery.expr.attrHandle[name]=fn;return ret}:function(elem,name,isXML){return isXML?undefined:elem[jQuery.camelCase("default-"+name)]?name.toLowerCase():null}});if(!getSetInput||!getSetAttribute){jQuery.attrHooks.value={set:function(elem,value,name){if(jQuery.nodeName(elem,"input")){elem.defaultValue=value}else{return nodeHook&&nodeHook.set(elem,value,name)}}}}if(!getSetAttribute){nodeHook={set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(!ret){elem.setAttributeNode(ret=elem.ownerDocument.createAttribute(name))}ret.value=value+="";return name==="value"||value===elem.getAttribute(name)?value:undefined}};jQuery.expr.attrHandle.id=jQuery.expr.attrHandle.name=jQuery.expr.attrHandle.coords=function(elem,name,isXML){var ret;return isXML?undefined:(ret=elem.getAttributeNode(name))&&ret.value!==""?ret.value:null};jQuery.valHooks.button={get:function(elem,name){var ret=elem.getAttributeNode(name);return ret&&ret.specified?ret.value:undefined},set:nodeHook.set};jQuery.attrHooks.contenteditable={set:function(elem,value,name){nodeHook.set(elem,value===""?false:value,name)}};jQuery.each(["width","height"],function(i,name){jQuery.attrHooks[name]={set:function(elem,value){if(value===""){elem.setAttribute(name,"auto");return value}}}})}if(!jQuery.support.hrefNormalized){jQuery.each(["href","src"],function(i,name){jQuery.propHooks[name]={get:function(elem){return elem.getAttribute(name,4)}}})}if(!jQuery.support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText||undefined},set:function(elem,value){return elem.style.cssText=value+""}}}if(!jQuery.support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex}}return null}}}jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});if(!jQuery.support.enctype){jQuery.propFix.enctype="encoding"}jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}}};if(!jQuery.support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute("value")===null?"on":elem.value}}});var rformElems=/^(?:input|select|textarea)$/i,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var tmp,events,t,handleObjIn,special,eventHandle,handleObj,handlers,type,namespaces,origType,elemData=jQuery._data(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!==core_strundefined&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined};eventHandle.elem=elem}types=(types||"").match(core_rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}else if(elem.attachEvent){elem.attachEvent("on"+type,eventHandle)}}}if(special.add){special.add.call(elem,handleObj);
if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}elem=null},remove:function(elem,types,handler,selector,mappedTypes){var j,handleObj,tmp,origCount,t,events,special,handlers,type,namespaces,origType,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(!elemData||!(events=elemData.events)){return}types=(types||"").match(core_rnotwhite)||[""];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||"").split(".").sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)");origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==="**"&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;jQuery._removeData(elem,"events")}},trigger:function(event,data,elem,onlyHandlers){var handle,ontype,cur,bubbleType,special,tmp,i,eventPath=[elem||document],type=core_hasOwn.call(event,"type")?event.type:event,namespaces=core_hasOwn.call(event,"namespace")?event.namespace.split("."):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf(".")>=0){namespaces=type.split(".");type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(":")<0&&"on"+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==="object"&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join(".");event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(jQuery._data(cur,"events")||{})[event.type]&&jQuery._data(cur,"handle");if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===false){event.preventDefault()}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&jQuery.acceptData(elem)){if(ontype&&elem[type]&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;try{elem[type]()}catch(e){}jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,ret,handleObj,matched,j,handlerQueue=[],args=core_slice.call(arguments),handlers=(jQuery._data(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.namespace_re||event.namespace_re.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var sel,handleObj,matches,i,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||event.type!=="click")){for(;cur!=this;cur=cur.parentNode||this){if(cur.nodeType===1&&(cur.disabled!==true||event.type!=="click")){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+" ";if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(!event.target){event.target=originalEvent.srcElement||document}if(event.target.nodeType===3){event.target=event.target.parentNode}event.metaKey=!!event.metaKey;return fixHook.filter?fixHook.filter(event,originalEvent):event},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var body,eventDoc,doc,button=original.button,fromElement=original.fromElement;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement}if(!event.which&&button!==undefined){event.which=button&1?1:button&2?3:button&4?2:0}return event}},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){try{this.focus();return false}catch(e){}}},delegateType:"focusin"},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:"focusout"},click:{trigger:function(){if(jQuery.nodeName(this,"input")&&this.type==="checkbox"&&this.click){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){if(event.result!==undefined){event.originalEvent.returnValue=event.result}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}}:function(elem,type,handle){var name="on"+type;if(elem.detachEvent){if(typeof elem[name]===core_strundefined){elem[name]=null}elem.detachEvent(name,handle)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.returnValue===false||src.getPreventDefault&&src.getPreventDefault()?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(!e){return}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(!e){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()}};jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!jQuery.support.submitBubbles){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,"form")){return false}jQuery.event.add(this,"click._submit keypress._submit",function(e){var elem=e.target,form=jQuery.nodeName(elem,"input")||jQuery.nodeName(elem,"button")?elem.form:undefined;if(form&&!jQuery._data(form,"submitBubbles")){jQuery.event.add(form,"submit._submit",function(event){event._submit_bubble=true});jQuery._data(form,"submitBubbles",true)}})},postDispatch:function(event){if(event._submit_bubble){delete event._submit_bubble;if(this.parentNode&&!event.isTrigger){jQuery.event.simulate("submit",this.parentNode,event,true)}}},teardown:function(){if(jQuery.nodeName(this,"form")){return false}jQuery.event.remove(this,"._submit")}}}if(!jQuery.support.changeBubbles){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio"){jQuery.event.add(this,"propertychange._change",function(event){if(event.originalEvent.propertyName==="checked"){this._just_changed=true}});jQuery.event.add(this,"click._change",function(event){if(this._just_changed&&!event.isTrigger){this._just_changed=false}jQuery.event.simulate("change",this,event,true)})}return false}jQuery.event.add(this,"beforeactivate._change",function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!jQuery._data(elem,"changeBubbles")){jQuery.event.add(elem,"change._change",function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate("change",this.parentNode,event,true)}});jQuery._data(elem,"changeBubbles",true)}})},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||elem.type!=="radio"&&elem.type!=="checkbox"){return event.handleObj.handler.apply(this,arguments)}},teardown:function(){jQuery.event.remove(this,"._change");return!rformElems.test(this.nodeName)}}}if(!jQuery.support.focusinBubbles){jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){if(attaches++===0){document.addEventListener(orig,handler,true)}},teardown:function(){if(--attaches===0){document.removeEventListener(orig,handler,true)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var type,origFn;if(typeof types==="object"){if(typeof selector!=="string"){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else if(fn==null){if(typeof selector==="string"){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}if(fn===false){fn=returnFalse}else if(!fn){return this}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==="object"){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==="function"){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});var isSimple=/^.[^:#\[\.,]*$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if(typeof selector!=="string"){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+" "+selector:selector;return ret},has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;i<len;i++){if(jQuery.contains(this,targets[i])){return true}}})},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},is:function(selector){return!!winnow(this,typeof selector==="string"&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length},closest:function(selectors,context){var cur,i=0,l=this.length,ret=[],pos=rneedsContext.test(selectors)||typeof selectors!=="string"?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){cur=ret.push(cur);break}}}return this.pushStack(ret.length>1?jQuery.unique(ret):ret)},index:function(elem){if(!elem){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof elem==="string"){return jQuery.inArray(this[0],jQuery(elem))}return jQuery.inArray(elem.jquery?elem[0]:elem,this)},add:function(selector,context){var set=typeof selector==="string"?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(jQuery.unique(all))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){do{cur=cur[dir]}while(cur&&cur.nodeType!==1);return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,"iframe")?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(name.slice(-5)!=="Until"){selector=until}if(selector&&typeof selector==="string"){ret=jQuery.filter(selector,ret)}if(this.length>1){if(!guaranteedUnique[name]){ret=jQuery.unique(ret)}if(rparentsprev.test(name)){ret=ret.reverse()}}return this.pushStack(ret)}});jQuery.extend({filter:function(expr,elems,not){var elem=elems[0];if(not){expr=":not("+expr+")"}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))},dir:function(elem,dir,until){var matched=[],cur=elem[dir];while(cur&&cur.nodeType!==9&&(until===undefined||cur.nodeType!==1||!jQuery(cur).is(until))){if(cur.nodeType===1){matched.push(cur)}cur=cur[dir]}return matched},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){r.push(n)}}return r}});function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return elem===qualifier!==not})}if(typeof qualifier==="string"){if(isSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return jQuery.inArray(elem,qualifier)>=0!==not})}function createSafeFragment(document){var list=nodeNames.split("|"),safeFrag=document.createDocumentFragment();if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop())}}return safeFrag}var nodeNames="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|"+"header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rnoshimcache=new RegExp("<(?:"+nodeNames+")[\\s/>]","i"),rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:jQuery.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement("div"));wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},remove:function(selector,keepData){var elem,elems=selector?jQuery.filter(selector,this):this,i=0;for(;(elem=elems[i])!=null;i++){if(!keepData&&elem.nodeType===1){jQuery.cleanData(getAll(elem))}if(elem.parentNode){if(keepData&&jQuery.contains(elem.ownerDocument,elem)){setGlobalEval(getAll(elem,"script"))}elem.parentNode.removeChild(elem)}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false))}while(elem.firstChild){elem.removeChild(elem.firstChild)}if(elem.options&&jQuery.nodeName(elem,"select")){elem.options.length=0}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined){return elem.nodeType===1?elem.innerHTML.replace(rinlinejQuery,""):undefined}if(typeof value==="string"&&!rnoInnerhtml.test(value)&&(jQuery.support.htmlSerialize||!rnoshimcache.test(value))&&(jQuery.support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var args=jQuery.map(this,function(elem){return[elem.nextSibling,elem.parentNode]}),i=0;this.domManip(arguments,function(elem){var next=args[i++],parent=args[i++];if(parent){if(next&&next.parentNode!==parent){next=this.nextSibling}jQuery(this).remove();parent.insertBefore(elem,next)}},true);return i?this:this.remove()},detach:function(selector){return this.remove(selector,true)},domManip:function(args,callback,allowIntersection){args=core_concat.apply([],args);var first,node,hasScripts,scripts,doc,fragment,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||!(l<=1||typeof value!=="string"||jQuery.support.checkClone||!rchecked.test(value))){return this.each(function(index){var self=set.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}self.domManip(args,callback,allowIntersection)})}if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,false,!allowIntersection&&this);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){scripts=jQuery.map(getAll(fragment,"script"),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,"script"))}}callback.call(this[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||"")&&!jQuery._data(node,"globalEval")&&jQuery.contains(doc,node)){if(node.src){jQuery._evalUrl(node.src)}else{jQuery.globalEval((node.text||node.textContent||node.innerHTML||"").replace(rcleanScript,""))}}}}fragment=first=null}}return this}});function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(content.nodeType===1?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){elem.type=(jQuery.find.attr(elem,"type")!==null)+"/"+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute("type")}return elem}function setGlobalEval(elems,refElements){var elem,i=0;for(;(elem=elems[i])!=null;i++){jQuery._data(elem,"globalEval",!refElements||jQuery._data(refElements[i],"globalEval"))}}function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return}var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}if(curData.data){curData.data=jQuery.extend({},curData.data)}}function fixCloneNodeIssues(src,dest){var nodeName,e,data;if(dest.nodeType!==1){return}nodeName=dest.nodeName.toLowerCase();if(!jQuery.support.noCloneEvent&&dest[jQuery.expando]){data=jQuery._data(dest);for(e in data.events){jQuery.removeEvent(dest,e,data.handle)}dest.removeAttribute(jQuery.expando)}if(nodeName==="script"&&dest.text!==src.text){disableScript(dest).text=src.text;restoreScript(dest)}else if(nodeName==="object"){if(dest.parentNode){dest.outerHTML=src.outerHTML}if(jQuery.support.html5Clone&&(src.innerHTML&&!jQuery.trim(dest.innerHTML))){dest.innerHTML=src.innerHTML}}else if(nodeName==="input"&&manipulation_rcheckableType.test(src.type)){dest.defaultChecked=dest.checked=src.checked;if(dest.value!==src.value){dest.value=src.value}}else if(nodeName==="option"){dest.defaultSelected=dest.selected=src.defaultSelected}else if(nodeName==="input"||nodeName==="textarea"){dest.defaultValue=src.defaultValue}}jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){var elems,i=0,ret=[],insert=jQuery(selector),last=insert.length-1;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);core_push.apply(ret,elems.get())}return this.pushStack(ret)}});function getAll(context,tag){var elems,elem,i=0,found=typeof context.getElementsByTagName!==core_strundefined?context.getElementsByTagName(tag||"*"):typeof context.querySelectorAll!==core_strundefined?context.querySelectorAll(tag||"*"):undefined;if(!found){for(found=[],elems=context.childNodes||context;(elem=elems[i])!=null;i++){if(!tag||jQuery.nodeName(elem,tag)){found.push(elem)}else{jQuery.merge(found,getAll(elem,tag))}}}return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],found):found}function fixDefaultChecked(elem){if(manipulation_rcheckableType.test(elem.type)){elem.defaultChecked=elem.checked}}jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var destElements,node,clone,i,srcElements,inPage=jQuery.contains(elem.ownerDocument,elem);if(jQuery.support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test("<"+elem.nodeName+">")){clone=elem.cloneNode(true)}else{fragmentDiv.innerHTML=elem.outerHTML;fragmentDiv.removeChild(clone=fragmentDiv.firstChild)}if((!jQuery.support.noCloneEvent||!jQuery.support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0;(node=srcElements[i])!=null;++i){if(destElements[i]){fixCloneNodeIssues(node,destElements[i])}}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0;(node=srcElements[i])!=null;i++){cloneCopyEvent(node,destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,"script");if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,"script"))}destElements=srcElements=node=null;return clone},buildFragment:function(elems,context,scripts,selection){var j,elem,contains,tmp,tag,tbody,wrap,l=elems.length,safe=createSafeFragment(context),nodes=[],i=0;for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==="object"){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||safe.appendChild(context.createElement("div"));tag=(rtagName.exec(elem)||["",""])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild}if(!jQuery.support.leadingWhitespace&&rleadingWhitespace.test(elem)){nodes.push(context.createTextNode(rleadingWhitespace.exec(elem)[0]))}if(!jQuery.support.tbody){elem=tag==="table"&&!rtbody.test(elem)?tmp.firstChild:wrap[1]==="<table>"&&!rtbody.test(elem)?tmp:0;j=elem&&elem.childNodes.length;while(j--){if(jQuery.nodeName(tbody=elem.childNodes[j],"tbody")&&!tbody.childNodes.length){elem.removeChild(tbody)}}}jQuery.merge(nodes,tmp.childNodes);tmp.textContent="";while(tmp.firstChild){tmp.removeChild(tmp.firstChild)}tmp=safe.lastChild}}}if(tmp){safe.removeChild(tmp)}if(!jQuery.support.appendChecked){jQuery.grep(getAll(nodes,"input"),fixDefaultChecked)}i=0;while(elem=nodes[i++]){if(selection&&jQuery.inArray(elem,selection)!==-1){continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(safe.appendChild(elem),"script");if(contains){setGlobalEval(tmp)}if(scripts){j=0;while(elem=tmp[j++]){if(rscriptType.test(elem.type||"")){scripts.push(elem)}}}}tmp=null;return safe},cleanData:function(elems,acceptData){var elem,type,id,data,i=0,internalKey=jQuery.expando,cache=jQuery.cache,deleteExpando=jQuery.support.deleteExpando,special=jQuery.event.special;for(;(elem=elems[i])!=null;i++){if(acceptData||jQuery.acceptData(elem)){id=elem[internalKey];data=id&&cache[id];if(data){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(cache[id]){delete cache[id];if(deleteExpando){delete elem[internalKey]}else if(typeof elem.removeAttribute!==core_strundefined){elem.removeAttribute(internalKey)}else{elem[internalKey]=null}core_deletedIds.push(id)}}}}},_evalUrl:function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:false,global:false,"throws":true})}});jQuery.fn.extend({wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,"body")){jQuery(this).replaceWith(this.childNodes)}}).end()}});var iframe,getStyles,curCSS,ralpha=/alpha\([^)]*\)/i,ropacity=/opacity\s*=\s*([^)]*)/,rposition=/^(top|right|bottom|left)$/,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",
display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];function vendorPropName(style,name){if(name in style){return name}var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function isHidden(elem,el){elem=el||elem;return jQuery.css(elem,"display")==="none"||!jQuery.contains(elem.ownerDocument,elem)}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=jQuery._data(elem,"olddisplay");display=elem.style.display;if(show){if(!values[index]&&display==="none"){elem.style.display=""}if(elem.style.display===""&&isHidden(elem)){values[index]=jQuery._data(elem,"olddisplay",css_defaultDisplay(elem.nodeName))}}else{if(!values[index]){hidden=isHidden(elem);if(display&&display!=="none"||!hidden){jQuery._data(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))}}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==="none"||elem.style.display===""){elem.style.display=show?values[index]||"":"none"}}return elements}jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){var len,styles,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){if(typeof state==="boolean"){return state?this.show():this.hide()}return this.each(function(){if(isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return ret===""?"1":ret}}}},cssNumber:{columnCount:true,fillOpacity:true,fontWeight:true,lineHeight:true,opacity:true,order:true,orphans:true,widows:true,zIndex:true,zoom:true},cssProps:{"float":jQuery.support.cssFloat?"cssFloat":"styleFloat"},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==="string"&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type="number"}if(value==null||type==="number"&&isNaN(value)){return}if(type==="number"&&!jQuery.cssNumber[origName]){value+="px"}if(!jQuery.support.clearCloneStyle&&value===""&&name.indexOf("background")===0){style[name]="inherit"}if(!hooks||!("set"in hooks)||(value=hooks.set(elem,value,extra))!==undefined){try{style[name]=value}catch(e){}}}else{if(hooks&&"get"in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var num,val,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&"get"in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==="normal"&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===""||extra){num=parseFloat(val);return extra===true||jQuery.isNumeric(num)?num||0:val}return val}});if(window.getComputedStyle){getStyles=function(elem){return window.getComputedStyle(elem,null)};curCSS=function(elem,name,_computed){var width,minWidth,maxWidth,computed=_computed||getStyles(elem),ret=computed?computed.getPropertyValue(name)||computed[name]:undefined,style=elem.style;if(computed){if(ret===""&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret}}else if(document.documentElement.currentStyle){getStyles=function(elem){return elem.currentStyle};curCSS=function(elem,name,_computed){var left,rs,rsLeft,computed=_computed||getStyles(elem),ret=computed?computed[name]:undefined,style=elem.style;if(ret==null&&style&&style[name]){ret=style[name]}if(rnumnonpx.test(ret)&&!rposition.test(name)){left=style.left;rs=elem.runtimeStyle;rsLeft=rs&&rs.left;if(rsLeft){rs.left=elem.currentStyle.left}style.left=name==="fontSize"?"1em":ret;ret=style.pixelLeft+"px";style.left=left;if(rsLeft){rs.left=rsLeft}}return ret===""?"auto":ret}}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?"border":"content")?4:name==="width"?1:0,val=0;for(;i<4;i+=2){if(extra==="margin"){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==="content"){val-=jQuery.css(elem,"padding"+cssExpand[i],true,styles)}if(extra!=="margin"){val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}else{val+=jQuery.css(elem,"padding"+cssExpand[i],true,styles);if(extra!=="padding"){val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==="width"?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box";if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]);val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function css_defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==="none"||!display){iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(doc.documentElement);doc=(iframe[0].contentWindow||iframe[0].contentDocument).document;doc.write("<!doctype html><html><body>");doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");elem.remove();return display}jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return elem.offsetWidth===0&&rdisplayswap.test(jQuery.css(elem,"display"))?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&jQuery.css(elem,"boxSizing",false,styles)==="border-box",styles):0)}}});if(!jQuery.support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":computed?"1":""},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?"alpha(opacity="+value*100+")":"",filter=currentStyle&&currentStyle.filter||style.filter||"";style.zoom=1;if((value>=1||value==="")&&jQuery.trim(filter.replace(ralpha,""))===""&&style.removeAttribute){style.removeAttribute("filter");if(value===""||currentStyle&&!currentStyle.filter){return}}style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+" "+opacity}}}jQuery(function(){if(!jQuery.support.reliableMarginRight){jQuery.cssHooks.marginRight={get:function(elem,computed){if(computed){return jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"])}}}}if(!jQuery.support.pixelPosition&&jQuery.fn.position){jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed}}}})}});if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0||!jQuery.support.reliableHiddenOffsets&&(elem.style&&elem.style.display||jQuery.css(elem,"display"))==="none"};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)}}jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==="string"?value.split(" "):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!manipulation_rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}});jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?"":value;s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a)){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join("&").replace(r20,"+")};function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+"["+(typeof v==="object"?i:"")+"]",v,traditional,add)}})}else if(!traditional&&jQuery.type(obj)==="object"){for(name in obj){buildParams(prefix+"["+name+"]",obj[name],traditional,add)}}else{add(prefix,obj)}}jQuery.each(("blur focus focusin focusout load resize scroll unload click dblclick "+"mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave "+"change select submit keydown keypress keyup error contextmenu").split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a");ajaxLocation.href="";ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=="string"){func=dataTypeExpression;dataTypeExpression="*"}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(func)){while(dataType=dataTypes[i++]){if(dataType[0]==="+"){dataType=dataType.slice(1)||"*";(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==="string"&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else if(seekingTransport){return!(selected=dataTypeOrTransport)}});return selected}return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var deep,key,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:deep||(deep={}))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}jQuery.fn.load=function(url,params,callback){if(typeof url!=="string"&&_load){return _load.apply(this,arguments)}var selector,response,type,self=this,off=url.indexOf(" ");if(off>=0){selector=url.slice(off,url.length);url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else if(params&&typeof params==="object"){type="POST"}if(self.length>0){jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])})}return this};jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":true,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==="object"){options=url;url=undefined}options=options||{};var parts,i,cacheURL,responseHeadersString,timeoutTimer,fireGlobals,transport,responseHeaders,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//");s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(core_rnotwhite)||[""];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==="http:"?"80":"443"))!==(ajaxLocParts[3]||(ajaxLocParts[1]==="http:"?"80":"443"))))}if(s.data&&s.processData&&typeof s.data!=="string"){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger("ajaxStart")}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=s.url+=(ajax_rquery.test(cacheURL)?"&":"?")+s.data;delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+ajax_nonce++):cacheURL+(ajax_rquery.test(cacheURL)?"&":"?")+"_="+ajax_nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader("Content-Type",s.contentType)}jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=="*"?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort="abort";for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,"No Transport")}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger("ajaxSend",[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||"";jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader("Last-Modified");if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader("etag");if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==="HEAD"){statusText="nocontent"}else if(status===304){statusText="notmodified"}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}else{error=statusText;if(status||!statusText){statusText="error";if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+"";if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger("ajaxComplete",[jqXHR,s]);if(!--jQuery.active){jQuery.event.trigger("ajaxStop")}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}});jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}});function ajaxHandleResponses(s,jqXHR,responses){var firstDataType,ct,finalDataType,type,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==="*"){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader("Content-Type")}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==="*"){current=prev}else if(prev!=="*"&&prev!==current){conv=converters[prev+" "+current]||converters["* "+current];if(!conv){for(conv2 in converters){tmp=conv2.split(" ");if(tmp[1]===current){conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}break}}}}if(conv!==true){if(conv&&s["throws"]){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}}}}}return{state:"success",data:response}}jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter("script",function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type="GET";s.global=false}});jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,head=document.head||jQuery("head")[0]||document.documentElement;return{send:function(_,callback){script=document.createElement("script");script.async=true;if(s.scriptCharset){script.charset=s.scriptCharset}script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(script.parentNode){script.parentNode.removeChild(script)}script=null;if(!isAbort){callback(200,"success")}}};head.insertBefore(script,head.firstChild)},abort:function(){if(script){script.onload(undefined,true)}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+ajax_nonce++;this[callback]=true;return callback}});jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?"url":typeof s.data==="string"&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");if(jsonProp||s.dataTypes[0]==="jsonp"){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName)}else if(s.jsonp!==false){s.url+=(ajax_rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName}s.converters["script json"]=function(){if(!responseContainer){jQuery.error(callbackName+" was not called")}return responseContainer[0]};s.dataTypes[0]="json";overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return"script"}});var xhrCallbacks,xhrSupported,xhrId=0,xhrOnUnloadAbort=window.ActiveXObject&&function(){var key;for(key in xhrCallbacks){xhrCallbacks[key](undefined,true)}};function createStandardXHR(){try{return new window.XMLHttpRequest}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}jQuery.ajaxSettings.xhr=window.ActiveXObject?function(){return!this.isLocal&&createStandardXHR()||createActiveXHR()}:createStandardXHR;xhrSupported=jQuery.ajaxSettings.xhr();jQuery.support.cors=!!xhrSupported&&"withCredentials"in xhrSupported;xhrSupported=jQuery.support.ajax=!!xhrSupported;if(xhrSupported){jQuery.ajaxTransport(function(s){if(!s.crossDomain||jQuery.support.cors){var callback;return{send:function(headers,complete){var handle,i,xhr=s.xhr();if(s.username){xhr.open(s.type,s.url,s.async,s.username,s.password)}else{xhr.open(s.type,s.url,s.async)}if(s.xhrFields){for(i in s.xhrFields){xhr[i]=s.xhrFields[i]}}if(s.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(s.mimeType)}if(!s.crossDomain&&!headers["X-Requested-With"]){headers["X-Requested-With"]="XMLHttpRequest"}try{for(i in headers){xhr.setRequestHeader(i,headers[i])}}catch(err){}xhr.send(s.hasContent&&s.data||null);callback=function(_,isAbort){var status,responseHeaders,statusText,responses;try{if(callback&&(isAbort||xhr.readyState===4)){callback=undefined;if(handle){xhr.onreadystatechange=jQuery.noop;if(xhrOnUnloadAbort){delete xhrCallbacks[handle]}}if(isAbort){if(xhr.readyState!==4){xhr.abort()}}else{responses={};status=xhr.status;responseHeaders=xhr.getAllResponseHeaders();if(typeof xhr.responseText==="string"){responses.text=xhr.responseText}try{statusText=xhr.statusText}catch(e){statusText=""}if(!status&&s.isLocal&&!s.crossDomain){status=responses.text?200:404}else if(status===1223){status=204}}}}catch(firefoxAccessException){if(!isAbort){complete(-1,firefoxAccessException)}}if(responses){complete(status,statusText,responses,responseHeaders)}};if(!s.async){callback()}else if(xhr.readyState===4){setTimeout(callback)}else{handle=++xhrId;if(xhrOnUnloadAbort){if(!xhrCallbacks){xhrCallbacks={};jQuery(window).unload(xhrOnUnloadAbort)}xhrCallbacks[handle]=callback}xhr.onreadystatechange=callback}},abort:function(){if(callback){callback(undefined,true)}}}}})}var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||unit!=="px"&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3];parts=parts||[];start=+target||1;do{scale=scale||".5";start=start/scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}if(parts){start=tween.start=+start||+target||0;tween.unit=unit;tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined});return fxNow=jQuery.now()}function createTween(value,prop,animation){var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;for(;index<length;index++){if(tween=collection[index].call(animation,prop,value)){return tween}}}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&"expand"in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=["*"]}else{props=props.split(" ")}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{
animationPrefilters.push(callback)}}});function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=jQuery._data(elem,"fxshow");if(!opts.queue){hooks=jQuery._queueHooks(elem,"fx");if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,"fx").length){hooks.empty.fire()}})})}if(elem.nodeType===1&&("height"in props||"width"in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];if(jQuery.css(elem,"display")==="inline"&&jQuery.css(elem,"float")==="none"){if(!jQuery.support.inlineBlockNeedsLayout||css_defaultDisplay(elem.nodeName)==="inline"){style.display="inline-block"}else{style.zoom=1}}}if(opts.overflow){style.overflow="hidden";if(!jQuery.support.shrinkWrapBlocks){anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==="toggle";if(value===(hidden?"hide":"show")){continue}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if("hidden"in dataShow){hidden=dataShow.hidden}}else{dataShow=jQuery._data(elem,"fxshow",{})}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;jQuery._removeData(elem,"fxshow");for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==="width"||prop==="height"?1:0}}}}}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||"swing";this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,"");return!result||result==="auto"?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==="boolean"?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||jQuery._data(this,"finish")){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=="string"){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||"fx",[])}return this.each(function(){var dequeue=true,index=type!=null&&type+"queueHooks",timers=jQuery.timers,data=jQuery._data(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||"fx"}return this.each(function(){var index,data=jQuery._data(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs["margin"+which]=attrs["padding"+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==="object"?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==="number"?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue="fx"}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}};jQuery.timers=[];jQuery.fx=Tween.prototype.init;jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){if(timer()&&jQuery.timers.push(timer)){jQuery.fx.start()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fx.step={};if(jQuery.expr&&jQuery.expr.filters){jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length}}jQuery.fn.offset=function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!==core_strundefined){box=elem.getBoundingClientRect()}win=getWindow(doc);return{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)}};jQuery.offset={setOffset:function(elem,options,i){var position=jQuery.css(elem,"position");if(position==="static"){elem.style.position="relative"}var curElem=jQuery(elem),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=(position==="absolute"||position==="fixed")&&jQuery.inArray("auto",[curCSSTop,curCSSLeft])>-1,props={},curPosition={},curTop,curLeft;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=options.top-curOffset.top+curTop}if(options.left!=null){props.left=options.left-curOffset.left+curLeft}if("using"in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({position:function(){if(!this[0]){return}var offsetParent,offset,parentOffset={top:0,left:0},elem=this[0];if(jQuery.css(elem,"position")==="fixed"){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],"html")){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",true);parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",true),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||docElem;while(offsetParent&&(!jQuery.nodeName(offsetParent,"html")&&jQuery.css(offsetParent,"position")==="static")){offsetParent=offsetParent.offsetParent}return offsetParent||docElem})}});jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?prop in win?win[prop]:win.document.documentElement[method]:elem[method]}if(win){win.scrollTo(!top?val:jQuery(win).scrollLeft(),top?val:jQuery(win).scrollTop())}else{elem[method]=val}},method,val,arguments.length,null)}});function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false}jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=="boolean"),extra=defaultExtra||(margin===true||value===true?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement["client"+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof module==="object"&&module&&typeof module.exports==="object"){module.exports=jQuery}else{window.jQuery=window.$=jQuery;if(typeof define==="function"&&define.amd){define("jquery",[],function(){return jQuery})}}})(window);(function(factory){"use strict";if(typeof define==="function"&&define.amd){define(["jquery","jquery.ui.widget","jquery.iframe-transport","jquery.fileupload"],factory)}else{var $=window.jQuery;factory($);$(function(){if($.fn.cloudinary_fileupload!==undefined){$("input.cloudinary-fileupload[type=file]").cloudinary_fileupload()}})}})(function($){"use strict";var CF_SHARED_CDN="d3jpl91pxevbkh.cloudfront.net";var OLD_AKAMAI_SHARED_CDN="cloudinary-a.akamaihd.net";var AKAMAI_SHARED_CDN="res.cloudinary.com";var SHARED_CDN=AKAMAI_SHARED_CDN;function utf8_encode(argString){if(argString===null||typeof argString==="undefined"){return""}var string=argString+"";var utftext="",start,end,stringl=0;start=end=0;stringl=string.length;for(var n=0;n<stringl;n++){var c1=string.charCodeAt(n);var enc=null;if(c1<128){end++}else if(c1>127&&c1<2048){enc=String.fromCharCode(c1>>6|192,c1&63|128)}else{enc=String.fromCharCode(c1>>12|224,c1>>6&63|128,c1&63|128)}if(enc!==null){if(end>start){utftext+=string.slice(start,end)}utftext+=enc;start=end=n+1}}if(end>start){utftext+=string.slice(start,stringl)}return utftext}function crc32(str){str=utf8_encode(str);var table="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";var crc=0;var x=0;var y=0;crc=crc^-1;for(var i=0,iTop=str.length;i<iTop;i++){y=(crc^str.charCodeAt(i))&255;x="0x"+table.substr(y*9,8);crc=crc>>>8^x}crc=crc^-1;if(crc<0){crc+=4294967296}return crc}function option_consume(options,option_name,default_value){var result=options[option_name];delete options[option_name];return typeof result=="undefined"?default_value:result}function build_array(arg){if(!arg){return[]}else if($.isArray(arg)){return arg}else{return[arg]}}function present(value){return typeof value!="undefined"&&(""+value).length>0}function process_base_transformations(options){var transformations=build_array(options.transformation);var all_named=true;for(var i=0;i<transformations.length;i++){all_named=all_named&&typeof transformations[i]=="string"}if(all_named){return[]}delete options.transformation;var base_transformations=[];for(var i=0;i<transformations.length;i++){var transformation=transformations[i];if(typeof transformation=="string"){base_transformations.push("t_"+transformation)}else{base_transformations.push(generate_transformation_string($.extend({},transformation)))}}return base_transformations}function process_size(options){var size=option_consume(options,"size");if(size){var split_size=size.split("x");options.width=split_size[0];options.height=split_size[1]}}function process_html_dimensions(options){var width=options.width,height=options.height;var has_layer=options.overlay||options.underlay;var crop=options.crop;var use_as_html_dimensions=!has_layer&&!options.angle&&crop!="fit"&&crop!="limit"&&crop!="lfill";if(use_as_html_dimensions){if(width&&!options.html_width&&width!=="auto"&&parseFloat(width)>=1)options.html_width=width;if(height&&!options.html_height&&parseFloat(height)>=1)options.html_height=height}if(!crop&&!has_layer){delete options.width;delete options.height}}var TRANSFORMATION_PARAM_NAME_MAPPING={angle:"a",background:"b",border:"bo",color:"co",color_space:"cs",crop:"c",default_image:"d",delay:"dl",density:"dn",dpr:"dpr",effect:"e",fetch_format:"f",flags:"fl",gravity:"g",height:"h",opacity:"o",overlay:"l",page:"pg",prefix:"p",quality:"q",radius:"r",transformation:"t",underlay:"u",width:"w",x:"x",y:"y"};var TRANSFORMATION_PARAM_VALUE_MAPPING={angle:function(angle){return build_array(angle).join(".")},background:function(background){return background.replace(/^#/,"rgb:")},border:function(border){if($.isPlainObject(border)){var border_width=""+(border.width||2);var border_color=(border.color||"black").replace(/^#/,"rgb:");border=border_width+"px_solid_"+border_color}return border},color:function(color){return color.replace(/^#/,"rgb:")},dpr:function(dpr){dpr=dpr.toString();if(dpr==="auto"){return"1.0"}else if(dpr.match(/^\d+$/)){return dpr+".0"}else{return dpr}},effect:function(effect){return build_array(effect).join(":")},flags:function(flags){return build_array(flags).join(".")},transformation:function(transformation){return build_array(transformation).join(".")}};function generate_transformation_string(options){var base_transformations=process_base_transformations(options);process_size(options);process_html_dimensions(options);var params=[];for(var param in TRANSFORMATION_PARAM_NAME_MAPPING){var value=option_consume(options,param);if(!present(value))continue;if(TRANSFORMATION_PARAM_VALUE_MAPPING[param]){value=TRANSFORMATION_PARAM_VALUE_MAPPING[param](value)}if(!present(value))continue;params.push(TRANSFORMATION_PARAM_NAME_MAPPING[param]+"_"+value)}params.sort();var raw_transformation=option_consume(options,"raw_transformation");if(present(raw_transformation))params.push(raw_transformation);var transformation=params.join(",");if(present(transformation))base_transformations.push(transformation);return base_transformations.join("/")}function absolutize(url){if(!url.match(/^https?:\//)){var prefix=document.location.protocol+"//"+document.location.host;if(url[0]=="?"){prefix+=document.location.pathname}else if(url[0]!="/"){prefix+=document.location.pathname.replace(/\/[^\/]*$/,"/")}url=prefix+url}return url}function cloudinary_url(public_id,options){options=options||{};var type=option_consume(options,"type","upload");if(type=="fetch"){options.fetch_format=options.fetch_format||option_consume(options,"format")}var transformation=generate_transformation_string(options);var resource_type=option_consume(options,"resource_type","image");var version=option_consume(options,"version");var format=option_consume(options,"format");var cloud_name=option_consume(options,"cloud_name",$.cloudinary.config().cloud_name);if(!cloud_name)throw"Unknown cloud_name";var private_cdn=option_consume(options,"private_cdn",$.cloudinary.config().private_cdn);var secure_distribution=option_consume(options,"secure_distribution",$.cloudinary.config().secure_distribution);var cname=option_consume(options,"cname",$.cloudinary.config().cname);var cdn_subdomain=option_consume(options,"cdn_subdomain",$.cloudinary.config().cdn_subdomain);var shorten=option_consume(options,"shorten",$.cloudinary.config().shorten);var secure=option_consume(options,"secure",window.location.protocol=="https:");var protocol=option_consume(options,"protocol",$.cloudinary.config().protocol);var trust_public_id=option_consume(options,"trust_public_id");if(type=="fetch"){public_id=absolutize(public_id)}if(public_id.match(/^https?:/)){if(type=="upload"||type=="asset")return public_id;public_id=encodeURIComponent(public_id).replace(/%3A/g,":").replace(/%2F/g,"/")}else{public_id=encodeURIComponent(decodeURIComponent(public_id)).replace(/%3A/g,":").replace(/%2F/g,"/");if(format){if(!trust_public_id)public_id=public_id.replace(/\.(jpg|png|gif|webp)$/,"");public_id=public_id+"."+format}}var prefix=secure?"https://":window.location.protocol==="file:"?"file://":"http://";prefix=protocol?protocol+"//":prefix;if(cloud_name.match(/^\//)&&!secure){prefix="/res"+cloud_name}else{var shared_domain=!private_cdn;if(secure){if(!secure_distribution||secure_distribution==OLD_AKAMAI_SHARED_CDN){secure_distribution=private_cdn?cloud_name+"-res.cloudinary.com":SHARED_CDN}shared_domain=shared_domain||secure_distribution==SHARED_CDN;prefix+=secure_distribution}else{var subdomain=cdn_subdomain?"a"+(crc32(public_id)%5+1)+".":"";var host=cname||(private_cdn?cloud_name+"-res.cloudinary.com":"res.cloudinary.com");prefix+=subdomain+host}if(shared_domain)prefix+="/"+cloud_name}if(shorten&&resource_type=="image"&&type=="upload"){resource_type="iu";type=undefined}if(public_id.search("/")>=0&&!public_id.match(/^v[0-9]+/)&&!public_id.match(/^https?:\//)&&!present(version)){version=1}var url=[prefix,resource_type,type,transformation,version?"v"+version:"",public_id].join("/").replace(/([^:])\/+/g,"$1/");return url}function default_stoppoints(width){return 10*Math.ceil(width/10)}function prepare_html_url(public_id,options){if($.cloudinary.config("dpr")&&!options.dpr){options.dpr=$.cloudinary.config("dpr")}var url=cloudinary_url(public_id,options);var width=option_consume(options,"html_width");var height=option_consume(options,"html_height");if(width)options.width=width;if(height)options.height=height;return url}function get_config(name,options,default_value){var value=options[name]||$.cloudinary.config(name);if(typeof value=="undefined")value=default_value;return value}var cloudinary_config=null;var responsive_config=null;var responsive_resize_initialized=false;var device_pixel_ratio_cache={};$.cloudinary={CF_SHARED_CDN:CF_SHARED_CDN,OLD_AKAMAI_SHARED_CDN:OLD_AKAMAI_SHARED_CDN,AKAMAI_SHARED_CDN:AKAMAI_SHARED_CDN,SHARED_CDN:SHARED_CDN,config:function(new_config,new_value){if(!cloudinary_config){cloudinary_config={};$('meta[name^="cloudinary_"]').each(function(){cloudinary_config[$(this).attr("name").replace("cloudinary_","")]=$(this).attr("content")})}if(typeof new_value!="undefined"){cloudinary_config[new_config]=new_value}else if(typeof new_config=="string"){return cloudinary_config[new_config]}else if(new_config){cloudinary_config=new_config}return cloudinary_config},url:function(public_id,options){options=$.extend({},options);return cloudinary_url(public_id,options)},url_internal:cloudinary_url,transformation_string:function(options){options=$.extend({},options);return generate_transformation_string(options)},image:function(public_id,options){options=$.extend({},options);var url=prepare_html_url(public_id,options);var img=$("<img/>").data("src-cache",url).attr(options).cloudinary_update(options);return img},facebook_profile_image:function(public_id,options){return $.cloudinary.image(public_id,$.extend({type:"facebook"},options))},twitter_profile_image:function(public_id,options){return $.cloudinary.image(public_id,$.extend({type:"twitter"},options))},twitter_name_profile_image:function(public_id,options){return $.cloudinary.image(public_id,$.extend({type:"twitter_name"},options))},gravatar_image:function(public_id,options){return $.cloudinary.image(public_id,$.extend({type:"gravatar"},options))},fetch_image:function(public_id,options){return $.cloudinary.image(public_id,$.extend({type:"fetch"},options))},sprite_css:function(public_id,options){options=$.extend({type:"sprite"},options);if(!public_id.match(/.css$/))options.format="css";return $.cloudinary.url(public_id,options)},responsive:function(options){responsive_config=$.extend(responsive_config||{},options);$("img.cld-responsive, img.cld-hidpi").cloudinary_update(responsive_config);var responsive_resize=get_config("responsive_resize",responsive_config,true);if(responsive_resize&&!responsive_resize_initialized){responsive_config.resizing=responsive_resize_initialized=true;var timeout=null;$(window).on("resize",function(){var debounce=get_config("responsive_debounce",responsive_config,100);function reset(){if(timeout){clearTimeout(timeout);timeout=null}}function run(){$("img.cld-responsive").cloudinary_update(responsive_config)}function wait(){reset();setTimeout(function(){reset();run()},debounce)}if(debounce){wait()}else{run()}})}},calc_stoppoint:function(element,width){var stoppoints=$(element).data("stoppoints")||$.cloudinary.config().stoppoints||default_stoppoints;if(typeof stoppoints==="function"){return stoppoints(width)}if(typeof stoppoints==="string"){stoppoints=$.map(stoppoints.split(","),function(val){return parseInt(val)})}var i=stoppoints.length-2;while(i>=0&&stoppoints[i]>=width){i--}return stoppoints[i+1]},device_pixel_ratio:function(){var dpr=window.devicePixelRatio||1;var dpr_string=device_pixel_ratio_cache[dpr];if(!dpr_string){dpr_string=dpr.toString();if(dpr_string.match(/^\d+$/))dpr_string+=".0";device_pixel_ratio_cache[dpr]=dpr_string}return dpr_string}};$.fn.cloudinary=function(options){this.filter("img").each(function(){var img_options=$.extend({width:$(this).attr("width"),height:$(this).attr("height"),src:$(this).attr("src")},$(this).data(),options);var public_id=option_consume(img_options,"source",option_consume(img_options,"src"));var url=prepare_html_url(public_id,img_options);$(this).data("src-cache",url).attr({width:img_options.width,height:img_options.height})}).cloudinary_update(options);return this};$.fn.cloudinary_update=function(options){options=options||{};var responsive_use_stoppoints=get_config("responsive_use_stoppoints",options,"resize");var exact=responsive_use_stoppoints===false||responsive_use_stoppoints=="resize"&&!options.resizing;this.filter("img").each(function(){if(options.responsive){$(this).addClass("cld-responsive")}var attrs={};var src=$(this).data("src-cache")||$(this).data("src");if(!src)return;var responsive=$(this).hasClass("cld-responsive")&&src.match(/\bw_auto\b/);if(responsive){var container=$(this).parent()[0];var containerWidth=container?container.clientWidth:0;if(containerWidth==0){return}var requestedWidth=exact?containerWidth:$.cloudinary.calc_stoppoint(this,containerWidth);var currentWidth=$(this).data("width")||0;if(requestedWidth>currentWidth){$(this).data("width",requestedWidth)}else{requestedWidth=currentWidth}src=src.replace(/\bw_auto\b/g,"w_"+requestedWidth);attrs.width=null;attrs.height=null}attrs.src=src.replace(/\bdpr_(1\.0|auto)\b/g,"dpr_"+$.cloudinary.device_pixel_ratio());$(this).attr(attrs)});return this};var webp=null;$.fn.webpify=function(options,webp_options){var that=this;options=options||{};webp_options=webp_options||options;if(!webp){webp=$.Deferred();var webp_canary=new Image;webp_canary.onerror=webp.reject;webp_canary.onload=webp.resolve;webp_canary.src="data:image/webp;base64,UklGRi4AAABXRUJQVlA4TCEAAAAvAUAAEB8wAiMwAgSSNtse/cXjxyCCmrYNWPwmHRH9jwMA"}$(function(){webp.done(function(){$(that).cloudinary($.extend({},webp_options,{format:"webp"}))}).fail(function(){$(that).cloudinary(options)})});return this};$.fn.fetchify=function(options){return this.cloudinary($.extend(options,{type:"fetch"}))};if(!$.fn.fileupload){return}$.cloudinary.delete_by_token=function(delete_token,options){options=options||{};var url=options.url;if(!url){var cloud_name=options.cloud_name||$.cloudinary.config().cloud_name;url="https://api.cloudinary.com/v1_1/"+cloud_name+"/delete_by_token"}var dataType=$.support.xhrFileUpload?"json":"iframe json";return $.ajax({url:url,method:"POST",data:{token:delete_token},headers:{"X-Requested-With":"XMLHttpRequest"},dataType:dataType})};$.fn.cloudinary_fileupload=function(options){var initializing=!this.data("blueimpFileupload");if(initializing){options=$.extend({maxFileSize:2e7,dataType:"json",headers:{"X-Requested-With":"XMLHttpRequest"}},options)}this.fileupload(options);if(initializing){this.bind("fileuploaddone",function(e,data){if(data.result.error)return;data.result.path=["v",data.result.version,"/",data.result.public_id,data.result.format?"."+data.result.format:""].join("");if(data.cloudinaryField&&data.form.length>0){var upload_info=[data.result.resource_type,data.result.type,data.result.path].join("/")+"#"+data.result.signature;var multiple=$(e.target).prop("multiple");var add_field=function(){$("<input></input>").attr({type:"hidden",name:data.cloudinaryField}).val(upload_info).appendTo(data.form)};if(multiple){add_field()}else{var field=$(data.form).find('input[name="'+data.cloudinaryField+'"]');if(field.length>0){field.val(upload_info)}else{add_field()}}}$(e.target).trigger("cloudinarydone",data)});this.bind("fileuploadstart",function(e){$(e.target).trigger("cloudinarystart")});this.bind("fileuploadstop",function(e){$(e.target).trigger("cloudinarystop")});this.bind("fileuploadprogress",function(e,data){$(e.target).trigger("cloudinaryprogress",data)});this.bind("fileuploadprogressall",function(e,data){$(e.target).trigger("cloudinaryprogressall",data)});this.bind("fileuploadfail",function(e,data){$(e.target).trigger("cloudinaryfail",data)});this.bind("fileuploadalways",function(e,data){$(e.target).trigger("cloudinaryalways",data)});if(!this.fileupload("option").url){var cloud_name=options.cloud_name||$.cloudinary.config().cloud_name;var upload_url="https://api.cloudinary.com/v1_1/"+cloud_name+"/upload";this.fileupload("option","url",upload_url)}}return this};$.fn.cloudinary_upload_url=function(remote_url){this.fileupload("option","formData").file=remote_url;this.fileupload("add",{files:[remote_url]});delete this.fileupload("option","formData").file};$.fn.unsigned_cloudinary_upload=function(upload_preset,upload_params,options){options=options||{};upload_params=$.extend({},upload_params)||{};if(upload_params.cloud_name){options.cloud_name=upload_params.cloud_name;delete upload_params.cloud_name}for(var key in upload_params){var value=upload_params[key];if($.isPlainObject(value)){upload_params[key]=$.map(value,function(v,k){return k+"="+v}).join("|")}else if($.isArray(value)){if(value.length>0&&$.isArray(value[0])){upload_params[key]=$.map(value,function(array_value){return array_value.join(",")}).join("|")}else{upload_params[key]=value.join(",")}}}if(!upload_params.callback){upload_params.callback="/cloudinary_cors.html"}upload_params.upload_preset=upload_preset;options.formData=upload_params;if(options.cloudinary_field){options.cloudinaryField=options.cloudinary_field;delete options.cloudinary_field}var html_options=options.html||{};html_options["class"]="cloudinary_fileupload "+(html_options["class"]||"");if(options.multiple)html_options.multiple=true;this.attr(html_options).cloudinary_fileupload(options);return this};$.cloudinary.unsigned_upload_tag=function(upload_preset,upload_params,options){return $("<input/>").attr({type:"file",name:"file"}).unsigned_cloudinary_upload(upload_preset,upload_params,options)}});jQuery.easing["jswing"]=jQuery.easing["swing"];jQuery.extend(jQuery.easing,{def:"easeOutQuad",swing:function(x,t,b,c,d){return jQuery.easing[jQuery.easing.def](x,t,b,c,d)},easeInQuad:function(x,t,b,c,d){return c*(t/=d)*t+b},easeOutQuad:function(x,t,b,c,d){return-c*(t/=d)*(t-2)+b;
},easeInOutQuad:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t+b;return-c/2*(--t*(t-2)-1)+b},easeInCubic:function(x,t,b,c,d){return c*(t/=d)*t*t+b},easeOutCubic:function(x,t,b,c,d){return c*((t=t/d-1)*t*t+1)+b},easeInOutCubic:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t+b;return c/2*((t-=2)*t*t+2)+b},easeInQuart:function(x,t,b,c,d){return c*(t/=d)*t*t*t+b},easeOutQuart:function(x,t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b},easeInOutQuart:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t+b;return-c/2*((t-=2)*t*t*t-2)+b},easeInQuint:function(x,t,b,c,d){return c*(t/=d)*t*t*t*t+b},easeOutQuint:function(x,t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},easeInOutQuint:function(x,t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t*t+b;return c/2*((t-=2)*t*t*t*t+2)+b},easeInSine:function(x,t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b},easeOutSine:function(x,t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b},easeInOutSine:function(x,t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b},easeInExpo:function(x,t,b,c,d){return t==0?b:c*Math.pow(2,10*(t/d-1))+b},easeOutExpo:function(x,t,b,c,d){return t==d?b+c:c*(-Math.pow(2,-10*t/d)+1)+b},easeInOutExpo:function(x,t,b,c,d){if(t==0)return b;if(t==d)return b+c;if((t/=d/2)<1)return c/2*Math.pow(2,10*(t-1))+b;return c/2*(-Math.pow(2,-10*--t)+2)+b},easeInCirc:function(x,t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b},easeOutCirc:function(x,t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b},easeInOutCirc:function(x,t,b,c,d){if((t/=d/2)<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b},easeInElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4}else var s=p/(2*Math.PI)*Math.asin(c/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b},easeOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d)==1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;var s=p/4}else var s=p/(2*Math.PI)*Math.asin(c/a);return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b},easeInOutElastic:function(x,t,b,c,d){var s=1.70158;var p=0;var a=c;if(t==0)return b;if((t/=d/2)==2)return b+c;if(!p)p=d*(.3*1.5);if(a<Math.abs(c)){a=c;var s=p/4}else var s=p/(2*Math.PI)*Math.asin(c/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b},easeInBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b},easeOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b},easeInOutBack:function(x,t,b,c,d,s){if(s==undefined)s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=1.525)+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b},easeInBounce:function(x,t,b,c,d){return c-jQuery.easing.easeOutBounce(x,d-t,0,c,d)+b},easeOutBounce:function(x,t,b,c,d){if((t/=d)<1/2.75){return c*(7.5625*t*t)+b}else if(t<2/2.75){return c*(7.5625*(t-=1.5/2.75)*t+.75)+b}else if(t<2.5/2.75){return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b}else{return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b}},easeInOutBounce:function(x,t,b,c,d){if(t<d/2)return jQuery.easing.easeInBounce(x,t*2,0,c,d)*.5+b;return jQuery.easing.easeOutBounce(x,t*2-d,0,c,d)*.5+c*.5+b}});(function(t,e){function i(e,i){var n,o,a,r=e.nodeName.toLowerCase();return"area"===r?(n=e.parentNode,o=n.name,e.href&&o&&"map"===n.nodeName.toLowerCase()?(a=t("img[usemap=#"+o+"]")[0],!!a&&s(a)):!1):(/input|select|textarea|button|object/.test(r)?!e.disabled:"a"===r?e.href||i:i)&&s(e)}function s(e){return t.expr.filters.visible(e)&&!t(e).parents().addBack().filter(function(){return"hidden"===t.css(this,"visibility")}).length}var n=0,o=/^ui-id-\d+$/;t.ui=t.ui||{},t.extend(t.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),t.fn.extend({focus:function(e){return function(i,s){return"number"==typeof i?this.each(function(){var e=this;setTimeout(function(){t(e).focus(),s&&s.call(e)},i)}):e.apply(this,arguments)}}(t.fn.focus),scrollParent:function(){var e;return e=t.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.css(this,"position"))&&/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.css(this,"overflow")+t.css(this,"overflow-y")+t.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(i){if(i!==e)return this.css("zIndex",i);if(this.length)for(var s,n,o=t(this[0]);o.length&&o[0]!==document;){if(s=o.css("position"),("absolute"===s||"relative"===s||"fixed"===s)&&(n=parseInt(o.css("zIndex"),10),!isNaN(n)&&0!==n))return n;o=o.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++n)})},removeUniqueId:function(){return this.each(function(){o.test(this.id)&&t(this).removeAttr("id")})}}),t.extend(t.expr[":"],{data:t.expr.createPseudo?t.expr.createPseudo(function(e){return function(i){return!!t.data(i,e)}}):function(e,i,s){return!!t.data(e,s[3])},focusable:function(e){return i(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var s=t.attr(e,"tabindex"),n=isNaN(s);return(n||s>=0)&&i(e,!n)}}),t("<a>").outerWidth(1).jquery||t.each(["Width","Height"],function(i,s){function n(e,i,s,n){return t.each(o,function(){i-=parseFloat(t.css(e,"padding"+this))||0,s&&(i-=parseFloat(t.css(e,"border"+this+"Width"))||0),n&&(i-=parseFloat(t.css(e,"margin"+this))||0)}),i}var o="Width"===s?["Left","Right"]:["Top","Bottom"],a=s.toLowerCase(),r={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+s]=function(i){return i===e?r["inner"+s].call(this):this.each(function(){t(this).css(a,n(this,i)+"px")})},t.fn["outer"+s]=function(e,i){return"number"!=typeof e?r["outer"+s].call(this,e):this.each(function(){t(this).css(a,n(this,e,!0,i)+"px")})}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(t.fn.removeData=function(e){return function(i){return arguments.length?e.call(this,t.camelCase(i)):e.call(this)}}(t.fn.removeData)),t.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),t.support.selectstart="onselectstart"in document.createElement("div"),t.fn.extend({disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.extend(t.ui,{plugin:{add:function(e,i,s){var n,o=t.ui[e].prototype;for(n in s)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,s[n]])},call:function(t,e,i){var s,n=t.plugins[e];if(n&&t.element[0].parentNode&&11!==t.element[0].parentNode.nodeType)for(s=0;n.length>s;s++)t.options[n[s][0]]&&n[s][1].apply(t.element,i)}},hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var s=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return e[s]>0?!0:(e[s]=1,n=e[s]>0,e[s]=0,n)}})})(jQuery),function(t,e){var i=0,s=Array.prototype.slice,n=t.cleanData;t.cleanData=function(e){for(var i,s=0;null!=(i=e[s]);s++)try{t(i).triggerHandler("remove")}catch(o){}n(e)},t.widget=function(i,s,n){var o,a,r,h,l={},c=i.split(".")[0];i=i.split(".")[1],o=c+"-"+i,n||(n=s,s=t.Widget),t.expr[":"][o.toLowerCase()]=function(e){return!!t.data(e,o)},t[c]=t[c]||{},a=t[c][i],r=t[c][i]=function(t,i){return this._createWidget?(arguments.length&&this._createWidget(t,i),e):new r(t,i)},t.extend(r,a,{version:n.version,_proto:t.extend({},n),_childConstructors:[]}),h=new s,h.options=t.widget.extend({},h.options),t.each(n,function(i,n){return t.isFunction(n)?(l[i]=function(){var t=function(){return s.prototype[i].apply(this,arguments)},e=function(t){return s.prototype[i].apply(this,t)};return function(){var i,s=this._super,o=this._superApply;return this._super=t,this._superApply=e,i=n.apply(this,arguments),this._super=s,this._superApply=o,i}}(),e):(l[i]=n,e)}),r.prototype=t.widget.extend(h,{widgetEventPrefix:a?h.widgetEventPrefix:i},l,{constructor:r,namespace:c,widgetName:i,widgetFullName:o}),a?(t.each(a._childConstructors,function(e,i){var s=i.prototype;t.widget(s.namespace+"."+s.widgetName,r,i._proto)}),delete a._childConstructors):s._childConstructors.push(r),t.widget.bridge(i,r)},t.widget.extend=function(i){for(var n,o,a=s.call(arguments,1),r=0,h=a.length;h>r;r++)for(n in a[r])o=a[r][n],a[r].hasOwnProperty(n)&&o!==e&&(i[n]=t.isPlainObject(o)?t.isPlainObject(i[n])?t.widget.extend({},i[n],o):t.widget.extend({},o):o);return i},t.widget.bridge=function(i,n){var o=n.prototype.widgetFullName||i;t.fn[i]=function(a){var r="string"==typeof a,h=s.call(arguments,1),l=this;return a=!r&&h.length?t.widget.extend.apply(null,[a].concat(h)):a,r?this.each(function(){var s,n=t.data(this,o);return n?t.isFunction(n[a])&&"_"!==a.charAt(0)?(s=n[a].apply(n,h),s!==n&&s!==e?(l=s&&s.jquery?l.pushStack(s.get()):s,!1):e):t.error("no such method '"+a+"' for "+i+" widget instance"):t.error("cannot call methods on "+i+" prior to initialization; "+"attempted to call method '"+a+"'")}):this.each(function(){var e=t.data(this,o);e?e.option(a||{})._init():t.data(this,o,new n(a,this))}),l}},t.Widget=function(){},t.Widget._childConstructors=[],t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(e,s){s=t(s||this.defaultElement||this)[0],this.element=t(s),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=t.widget.extend({},this.options,this._getCreateOptions(),e),this.bindings=t(),this.hoverable=t(),this.focusable=t(),s!==this&&(t.data(s,this.widgetFullName,this),this._on(!0,this.element,{remove:function(t){t.target===s&&this.destroy()}}),this.document=t(s.style?s.ownerDocument:s.document||s),this.window=t(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:t.noop,_getCreateEventData:t.noop,_create:t.noop,_init:t.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(t.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:t.noop,widget:function(){return this.element},option:function(i,s){var n,o,a,r=i;if(0===arguments.length)return t.widget.extend({},this.options);if("string"==typeof i)if(r={},n=i.split("."),i=n.shift(),n.length){for(o=r[i]=t.widget.extend({},this.options[i]),a=0;n.length-1>a;a++)o[n[a]]=o[n[a]]||{},o=o[n[a]];if(i=n.pop(),s===e)return o[i]===e?null:o[i];o[i]=s}else{if(s===e)return this.options[i]===e?null:this.options[i];r[i]=s}return this._setOptions(r),this},_setOptions:function(t){var e;for(e in t)this._setOption(e,t[e]);return this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!e).attr("aria-disabled",e),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(i,s,n){var o,a=this;"boolean"!=typeof i&&(n=s,s=i,i=!1),n?(s=o=t(s),this.bindings=this.bindings.add(s)):(n=s,s=this.element,o=this.widget()),t.each(n,function(n,r){function h(){return i||a.options.disabled!==!0&&!t(this).hasClass("ui-state-disabled")?("string"==typeof r?a[r]:r).apply(a,arguments):e}"string"!=typeof r&&(h.guid=r.guid=r.guid||h.guid||t.guid++);var l=n.match(/^(\w+)\s*(.*)$/),c=l[1]+a.eventNamespace,u=l[2];u?o.delegate(u,c,h):s.bind(c,h)})},_off:function(t,e){e=(e||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(e).undelegate(e)},_delay:function(t,e){function i(){return("string"==typeof t?s[t]:t).apply(s,arguments)}var s=this;return setTimeout(i,e||0)},_hoverable:function(e){this.hoverable=this.hoverable.add(e),this._on(e,{mouseenter:function(e){t(e.currentTarget).addClass("ui-state-hover")},mouseleave:function(e){t(e.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e),this._on(e,{focusin:function(e){t(e.currentTarget).addClass("ui-state-focus")},focusout:function(e){t(e.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,i,s){var n,o,a=this.options[e];if(s=s||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,s),!(t.isFunction(a)&&a.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},t.each({show:"fadeIn",hide:"fadeOut"},function(e,i){t.Widget.prototype["_"+e]=function(s,n,o){"string"==typeof n&&(n={effect:n});var a,r=n?n===!0||"number"==typeof n?i:n.effect||i:e;n=n||{},"number"==typeof n&&(n={duration:n}),a=!t.isEmptyObject(n),n.complete=o,n.delay&&s.delay(n.delay),a&&t.effects&&t.effects.effect[r]?s[e](n):r!==e&&s[r]?s[r](n.duration,n.easing,o):s.queue(function(i){t(this)[e](),o&&o.call(s[0]),i()})}})}(jQuery),function(t){var e=!1;t(document).mouseup(function(){e=!1}),t.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):undefined}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(i){if(!e){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var s=this,n=1===i.which,o="string"==typeof this.options.cancel&&i.target.nodeName?t(i.target).closest(this.options.cancel).length:!1;return n&&!o&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){s.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===t.data(i.target,this.widgetName+".preventClickEvent")&&t.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return s._mouseMove(t)},this._mouseUpDelegate=function(t){return s._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),e=!0,!0)):!0}},_mouseMove:function(e){return t.ui.ie&&(!document.documentMode||9>document.documentMode)&&!e.button?this._mouseUp(e):this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target===this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(t){t.widget("ui.draggable",t.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(e),this.handle?(t(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){t("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!i){var s=this._uiHash();if(this._trigger("drag",e,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=this,s=!1;return t.ui.ddmanager&&!this.options.dropBehaviour&&(s=t.ui.ddmanager.drop(this,e)),this.dropped&&(s=this.dropped,this.dropped=!1),"original"!==this.options.helper||t.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!s||"valid"===this.options.revert&&s||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,s)?t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",e)!==!1&&i._clear()}):this._trigger("stop",e)!==!1&&this._clear(),!1):!1},_mouseUp:function(e){return t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){return this.options.handle?!!t(e.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return s.parents("body").length||s.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),s[0]===this.element[0]||/(fixed|absolute)/.test(s.css("position"))||s.css("position","absolute"),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;return n.containment?"window"===n.containment?(this.containment=[t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,t(window).scrollLeft()+t(window).width()-this.helperProportions.width-this.margins.left,t(window).scrollTop()+(t(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):"document"===n.containment?(this.containment=[0,0,t(document).width()-this.helperProportions.width-this.margins.left,(t(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],undefined):n.containment.constructor===Array?(this.containment=n.containment,undefined):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),i=t(n.containment),s=i[0],s&&(e="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(e?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(e?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i),undefined):(this.containment=null,undefined)},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:n.scrollTop(),left:n.scrollLeft()}),{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*s}},_generatePosition:function(e){var i,s,n,o,a=this.options,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=e.pageX,l=e.pageY;return this.offset.scroll||(this.offset.scroll={top:r.scrollTop(),left:r.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(s=this.relative_container.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(h=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(h=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(l=i[3]+this.offset.click.top)),a.grid&&(n=a.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/a.grid[1])*a.grid[1]:this.originalPageY,l=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-a.grid[1]:n+a.grid[1]:n,o=a.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/a.grid[0])*a.grid[0]:this.originalPageX,h=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-a.grid[0]:o+a.grid[0]:o)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,i,s){return s=s||this._uiHash(),t.ui.plugin.call(this,e,[i,s]),"drag"===e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i){var s=t(this).data("ui-draggable"),n=s.options,o=t.extend({},i,{item:s.element});s.sortables=[],t(n.connectToSortable).each(function(){var i=t.data(this,"ui-sortable");i&&!i.options.disabled&&(s.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",e,o))})},stop:function(e,i){var s=t(this).data("ui-draggable"),n=t.extend({},i,{item:s.element});t.each(s.sortables,function(){this.instance.isOver?(this.instance.isOver=0,s.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"===s.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,n))})},drag:function(e,i){var s=t(this).data("ui-draggable"),n=this;t.each(s.sortables,function(){var o=!1,a=this;this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,t.each(s.sortables,function(){return this.instance.positionAbs=s.positionAbs,this.instance.helperProportions=s.helperProportions,this.instance.offset.click=s.offset.click,this!==a&&this.instance._intersectsWith(this.instance.containerCache)&&t.contains(a.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(n).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=s.offset.click.top,this.instance.offset.click.left=s.offset.click.left,this.instance.offset.parent.left-=s.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=s.offset.parent.top-this.instance.offset.parent.top,s._trigger("toSortable",e),s.dropped=this.instance.element,s.currentItem=s.element,this.instance.fromOutside=s),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),s._trigger("fromSortable",e),s.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(){var e=t("body"),i=t(this).data("ui-draggable").options;e.css("cursor")&&(i._cursor=e.css("cursor")),e.css("cursor",i.cursor)},stop:function(){var e=t(this).data("ui-draggable").options;e._cursor&&t("body").css("cursor",e._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i){var s=t(i.helper),n=t(this).data("ui-draggable").options;s.css("opacity")&&(n._opacity=s.css("opacity")),s.css("opacity",n.opacity)},stop:function(e,i){var s=t(this).data("ui-draggable").options;s._opacity&&t(i.helper).css("opacity",s._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(){var e=t(this).data("ui-draggable");e.scrollParent[0]!==document&&"HTML"!==e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var i=t(this).data("ui-draggable"),s=i.options,n=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(s.axis&&"x"===s.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-e.pageY<s.scrollSensitivity?i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop+s.scrollSpeed:e.pageY-i.overflowOffset.top<s.scrollSensitivity&&(i.scrollParent[0].scrollTop=n=i.scrollParent[0].scrollTop-s.scrollSpeed)),s.axis&&"y"===s.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-e.pageX<s.scrollSensitivity?i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft+s.scrollSpeed:e.pageX-i.overflowOffset.left<s.scrollSensitivity&&(i.scrollParent[0].scrollLeft=n=i.scrollParent[0].scrollLeft-s.scrollSpeed))):(s.axis&&"x"===s.axis||(e.pageY-t(document).scrollTop()<s.scrollSensitivity?n=t(document).scrollTop(t(document).scrollTop()-s.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<s.scrollSensitivity&&(n=t(document).scrollTop(t(document).scrollTop()+s.scrollSpeed))),s.axis&&"y"===s.axis||(e.pageX-t(document).scrollLeft()<s.scrollSensitivity?n=t(document).scrollLeft(t(document).scrollLeft()-s.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<s.scrollSensitivity&&(n=t(document).scrollLeft(t(document).scrollLeft()+s.scrollSpeed)))),n!==!1&&t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(i,e);
}}),t.ui.plugin.add("draggable","snap",{start:function(){var e=t(this).data("ui-draggable"),i=e.options;e.snapElements=[],t(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var i=t(this),s=i.offset();this!==e.element[0]&&e.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:s.top,left:s.left})})},drag:function(e,i){var s,n,o,a,r,h,l,c,u,d,p=t(this).data("ui-draggable"),f=p.options,g=f.snapTolerance,m=i.offset.left,v=m+p.helperProportions.width,_=i.offset.top,b=_+p.helperProportions.height;for(u=p.snapElements.length-1;u>=0;u--)r=p.snapElements[u].left,h=r+p.snapElements[u].width,l=p.snapElements[u].top,c=l+p.snapElements[u].height,r-g>v||m>h+g||l-g>b||_>c+g||!t.contains(p.snapElements[u].item.ownerDocument,p.snapElements[u].item)?(p.snapElements[u].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,e,t.extend(p._uiHash(),{snapItem:p.snapElements[u].item})),p.snapElements[u].snapping=!1):("inner"!==f.snapMode&&(s=g>=Math.abs(l-b),n=g>=Math.abs(c-_),o=g>=Math.abs(r-v),a=g>=Math.abs(h-m),s&&(i.position.top=p._convertPositionTo("relative",{top:l-p.helperProportions.height,left:0}).top-p.margins.top),n&&(i.position.top=p._convertPositionTo("relative",{top:c,left:0}).top-p.margins.top),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:r-p.helperProportions.width}).left-p.margins.left),a&&(i.position.left=p._convertPositionTo("relative",{top:0,left:h}).left-p.margins.left)),d=s||n||o||a,"outer"!==f.snapMode&&(s=g>=Math.abs(l-_),n=g>=Math.abs(c-b),o=g>=Math.abs(r-m),a=g>=Math.abs(h-v),s&&(i.position.top=p._convertPositionTo("relative",{top:l,left:0}).top-p.margins.top),n&&(i.position.top=p._convertPositionTo("relative",{top:c-p.helperProportions.height,left:0}).top-p.margins.top),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:r}).left-p.margins.left),a&&(i.position.left=p._convertPositionTo("relative",{top:0,left:h-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[u].snapping&&(s||n||o||a||d)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,e,t.extend(p._uiHash(),{snapItem:p.snapElements[u].item})),p.snapElements[u].snapping=s||n||o||a||d)}}),t.ui.plugin.add("draggable","stack",{start:function(){var e,i=this.data("ui-draggable").options,s=t.makeArray(t(i.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});s.length&&(e=parseInt(t(s[0]).css("zIndex"),10)||0,t(s).each(function(i){t(this).css("zIndex",e+i)}),this.css("zIndex",e+s.length))}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i){var s=t(i.helper),n=t(this).data("ui-draggable").options;s.css("zIndex")&&(n._zIndex=s.css("zIndex")),s.css("zIndex",n.zIndex)},stop:function(e,i){var s=t(this).data("ui-draggable").options;s._zIndex&&t(i.helper).css("zIndex",s._zIndex)}})}(jQuery),function(t){function e(t,e,i){return t>e&&e+i>t}t.widget("ui.droppable",{version:"1.10.3",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var e=this.options,i=e.accept;this.isover=!1,this.isout=!0,this.accept=t.isFunction(i)?i:function(t){return t.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},t.ui.ddmanager.droppables[e.scope]=t.ui.ddmanager.droppables[e.scope]||[],t.ui.ddmanager.droppables[e.scope].push(this),e.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var e=0,i=t.ui.ddmanager.droppables[this.options.scope];i.length>e;e++)i[e]===this&&i.splice(e,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(e,i){"accept"===e&&(this.accept=t.isFunction(i)?i:function(t){return t.is(i)}),t.Widget.prototype._setOption.apply(this,arguments)},_activate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",e,this.ui(i))},_deactivate:function(e){var i=t.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",e,this.ui(i))},_over:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",e,this.ui(i)))},_out:function(e){var i=t.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",e,this.ui(i)))},_drop:function(e,i){var s=i||t.ui.ddmanager.current,n=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var e=t.data(this,"ui-droppable");return e.options.greedy&&!e.options.disabled&&e.options.scope===s.options.scope&&e.accept.call(e.element[0],s.currentItem||s.element)&&t.ui.intersect(s,t.extend(e,{offset:e.element.offset()}),e.options.tolerance)?(n=!0,!1):undefined}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",e,this.ui(s)),this.element):!1):!1},ui:function(t){return{draggable:t.currentItem||t.element,helper:t.helper,position:t.position,offset:t.positionAbs}}}),t.ui.intersect=function(t,i,s){if(!i.offset)return!1;var n,o,a=(t.positionAbs||t.position.absolute).left,r=a+t.helperProportions.width,h=(t.positionAbs||t.position.absolute).top,l=h+t.helperProportions.height,c=i.offset.left,u=c+i.proportions.width,d=i.offset.top,p=d+i.proportions.height;switch(s){case"fit":return a>=c&&u>=r&&h>=d&&p>=l;case"intersect":return a+t.helperProportions.width/2>c&&u>r-t.helperProportions.width/2&&h+t.helperProportions.height/2>d&&p>l-t.helperProportions.height/2;case"pointer":return n=(t.positionAbs||t.position.absolute).left+(t.clickOffset||t.offset.click).left,o=(t.positionAbs||t.position.absolute).top+(t.clickOffset||t.offset.click).top,e(o,d,i.proportions.height)&&e(n,c,i.proportions.width);case"touch":return(h>=d&&p>=h||l>=d&&p>=l||d>h&&l>p)&&(a>=c&&u>=a||r>=c&&u>=r||c>a&&r>u);default:return!1}},t.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(e,i){var s,n,o=t.ui.ddmanager.droppables[e.options.scope]||[],a=i?i.type:null,r=(e.currentItem||e.element).find(":data(ui-droppable)").addBack();t:for(s=0;o.length>s;s++)if(!(o[s].options.disabled||e&&!o[s].accept.call(o[s].element[0],e.currentItem||e.element))){for(n=0;r.length>n;n++)if(r[n]===o[s].element[0]){o[s].proportions.height=0;continue t}o[s].visible="none"!==o[s].element.css("display"),o[s].visible&&("mousedown"===a&&o[s]._activate.call(o[s],i),o[s].offset=o[s].element.offset(),o[s].proportions={width:o[s].element[0].offsetWidth,height:o[s].element[0].offsetHeight})}},drop:function(e,i){var s=!1;return t.each((t.ui.ddmanager.droppables[e.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&t.ui.intersect(e,this,this.options.tolerance)&&(s=this._drop.call(this,i)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],e.currentItem||e.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(e,i){e.element.parentsUntil("body").bind("scroll.droppable",function(){e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)})},drag:function(e,i){e.options.refreshPositions&&t.ui.ddmanager.prepareOffsets(e,i),t.each(t.ui.ddmanager.droppables[e.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,n,o,a=t.ui.intersect(e,this,this.options.tolerance),r=!a&&this.isover?"isout":a&&!this.isover?"isover":null;r&&(this.options.greedy&&(n=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return t.data(this,"ui-droppable").options.scope===n}),o.length&&(s=t.data(o[0],"ui-droppable"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,i),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(e,i){e.element.parentsUntil("body").unbind("scroll.droppable"),e.options.refreshPositions||t.ui.ddmanager.prepareOffsets(e,i)}}}(jQuery),function(t){function e(t){return parseInt(t,10)||0}function i(t){return!isNaN(parseInt(t,10))}t.widget("ui.resizable",t.ui.mouse,{version:"1.10.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var e,i,s,n,o,a=this,r=this.options;if(this.element.addClass("ui-resizable"),t.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(t("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=r.handles||(t(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),e=this.handles.split(","),this.handles={},i=0;e.length>i;i++)s=t.trim(e[i]),o="ui-resizable-"+s,n=t("<div class='ui-resizable-handle "+o+"'></div>"),n.css({zIndex:r.zIndex}),"se"===s&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[s]=".ui-resizable-"+s,this.element.append(n);this._renderAxis=function(e){var i,s,n,o;e=e||this.element;for(i in this.handles)this.handles[i].constructor===String&&(this.handles[i]=t(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(s=t(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),e.css(n,o),this._proportionallyResize()),t(this.handles[i]).length},this._renderAxis(this.element),this._handles=t(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){a.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),a.axis=n&&n[1]?n[1]:"se")}),r.autoHide&&(this._handles.hide(),t(this.element).addClass("ui-resizable-autohide").mouseenter(function(){r.disabled||(t(this).removeClass("ui-resizable-autohide"),a._handles.show())}).mouseleave(function(){r.disabled||a.resizing||(t(this).addClass("ui-resizable-autohide"),a._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var e,i=function(e){t(e).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),e=this.element,this.originalElement.css({position:e.css("position"),width:e.outerWidth(),height:e.outerHeight(),top:e.css("top"),left:e.css("left")}).insertAfter(e),e.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(e){var i,s,n=!1;for(i in this.handles)s=t(this.handles[i])[0],(s===e.target||t.contains(s,e.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(i){var s,n,o,a=this.options,r=this.element.position(),h=this.element;return this.resizing=!0,/absolute/.test(h.css("position"))?h.css({position:"absolute",top:h.css("top"),left:h.css("left")}):h.is(".ui-draggable")&&h.css({position:"absolute",top:r.top,left:r.left}),this._renderProxy(),s=e(this.helper.css("left")),n=e(this.helper.css("top")),a.containment&&(s+=t(a.containment).scrollLeft()||0,n+=t(a.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:s,top:n},this.size=this._helper?{width:h.outerWidth(),height:h.outerHeight()}:{width:h.width(),height:h.height()},this.originalSize=this._helper?{width:h.outerWidth(),height:h.outerHeight()}:{width:h.width(),height:h.height()},this.originalPosition={left:s,top:n},this.sizeDiff={width:h.outerWidth()-h.width(),height:h.outerHeight()-h.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof a.aspectRatio?a.aspectRatio:this.originalSize.width/this.originalSize.height||1,o=t(".ui-resizable-"+this.axis).css("cursor"),t("body").css("cursor","auto"===o?this.axis+"-resize":o),h.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(e){var i,s=this.helper,n={},o=this.originalMousePosition,a=this.axis,r=this.position.top,h=this.position.left,l=this.size.width,c=this.size.height,u=e.pageX-o.left||0,d=e.pageY-o.top||0,p=this._change[a];return p?(i=p.apply(this,[e,u,d]),this._updateVirtualBoundaries(e.shiftKey),(this._aspectRatio||e.shiftKey)&&(i=this._updateRatio(i,e)),i=this._respectSize(i,e),this._updateCache(i),this._propagate("resize",e),this.position.top!==r&&(n.top=this.position.top+"px"),this.position.left!==h&&(n.left=this.position.left+"px"),this.size.width!==l&&(n.width=this.size.width+"px"),this.size.height!==c&&(n.height=this.size.height+"px"),s.css(n),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),t.isEmptyObject(n)||this._trigger("resize",e,this.ui()),!1):!1},_mouseStop:function(e){this.resizing=!1;var i,s,n,o,a,r,h,l=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,s=i.length&&/textarea/i.test(i[0].nodeName),n=s&&t.ui.hasScroll(i[0],"left")?0:c.sizeDiff.height,o=s?0:c.sizeDiff.width,a={width:c.helper.width()-o,height:c.helper.height()-n},r=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,h=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null,l.animate||this.element.css(t.extend(a,{top:h,left:r})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!l.animate&&this._proportionallyResize()),t("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",e),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(t){var e,s,n,o,a,r=this.options;a={minWidth:i(r.minWidth)?r.minWidth:0,maxWidth:i(r.maxWidth)?r.maxWidth:1/0,minHeight:i(r.minHeight)?r.minHeight:0,maxHeight:i(r.maxHeight)?r.maxHeight:1/0},(this._aspectRatio||t)&&(e=a.minHeight*this.aspectRatio,n=a.minWidth/this.aspectRatio,s=a.maxHeight*this.aspectRatio,o=a.maxWidth/this.aspectRatio,e>a.minWidth&&(a.minWidth=e),n>a.minHeight&&(a.minHeight=n),a.maxWidth>s&&(a.maxWidth=s),a.maxHeight>o&&(a.maxHeight=o)),this._vBoundaries=a},_updateCache:function(t){this.offset=this.helper.offset(),i(t.left)&&(this.position.left=t.left),i(t.top)&&(this.position.top=t.top),i(t.height)&&(this.size.height=t.height),i(t.width)&&(this.size.width=t.width)},_updateRatio:function(t){var e=this.position,s=this.size,n=this.axis;return i(t.height)?t.width=t.height*this.aspectRatio:i(t.width)&&(t.height=t.width/this.aspectRatio),"sw"===n&&(t.left=e.left+(s.width-t.width),t.top=null),"nw"===n&&(t.top=e.top+(s.height-t.height),t.left=e.left+(s.width-t.width)),t},_respectSize:function(t){var e=this._vBoundaries,s=this.axis,n=i(t.width)&&e.maxWidth&&e.maxWidth<t.width,o=i(t.height)&&e.maxHeight&&e.maxHeight<t.height,a=i(t.width)&&e.minWidth&&e.minWidth>t.width,r=i(t.height)&&e.minHeight&&e.minHeight>t.height,h=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,c=/sw|nw|w/.test(s),u=/nw|ne|n/.test(s);return a&&(t.width=e.minWidth),r&&(t.height=e.minHeight),n&&(t.width=e.maxWidth),o&&(t.height=e.maxHeight),a&&c&&(t.left=h-e.minWidth),n&&c&&(t.left=h-e.maxWidth),r&&u&&(t.top=l-e.minHeight),o&&u&&(t.top=l-e.maxHeight),t.width||t.height||t.left||!t.top?t.width||t.height||t.top||!t.left||(t.left=null):t.top=null,t},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var t,e,i,s,n,o=this.helper||this.element;for(t=0;this._proportionallyResizeElements.length>t;t++){if(n=this._proportionallyResizeElements[t],!this.borderDif)for(this.borderDif=[],i=[n.css("borderTopWidth"),n.css("borderRightWidth"),n.css("borderBottomWidth"),n.css("borderLeftWidth")],s=[n.css("paddingTop"),n.css("paddingRight"),n.css("paddingBottom"),n.css("paddingLeft")],e=0;i.length>e;e++)this.borderDif[e]=(parseInt(i[e],10)||0)+(parseInt(s[e],10)||0);n.css({height:o.height()-this.borderDif[0]-this.borderDif[2]||0,width:o.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var e=this.element,i=this.options;this.elementOffset=e.offset(),this._helper?(this.helper=this.helper||t("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(t,e){return{width:this.originalSize.width+e}},w:function(t,e){var i=this.originalSize,s=this.originalPosition;return{left:s.left+e,width:i.width-e}},n:function(t,e,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(t,e,i){return{height:this.originalSize.height+i}},se:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},sw:function(e,i,s){return t.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[e,i,s]))},ne:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[e,i,s]))},nw:function(e,i,s){return t.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[e,i,s]))}},_propagate:function(e,i){t.ui.plugin.call(this,e,[i,this.ui()]),"resize"!==e&&this._trigger(e,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),t.ui.plugin.add("resizable","animate",{stop:function(e){var i=t(this).data("ui-resizable"),s=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),a=o&&t.ui.hasScroll(n[0],"left")?0:i.sizeDiff.height,r=o?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-a},l=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(t.extend(h,c&&l?{top:c,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&t(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate("resize",e)}})}}),t.ui.plugin.add("resizable","containment",{start:function(){var i,s,n,o,a,r,h,l=t(this).data("ui-resizable"),c=l.options,u=l.element,d=c.containment,p=d instanceof t?d.get(0):/parent/.test(d)?u.parent().get(0):d;p&&(l.containerElement=t(p),/document/.test(d)||d===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:t(document),left:0,top:0,width:t(document).width(),height:t(document).height()||document.body.parentNode.scrollHeight}):(i=t(p),s=[],t(["Top","Right","Left","Bottom"]).each(function(t,n){s[t]=e(i.css("padding"+n))}),l.containerOffset=i.offset(),l.containerPosition=i.position(),l.containerSize={height:i.innerHeight()-s[3],width:i.innerWidth()-s[1]},n=l.containerOffset,o=l.containerSize.height,a=l.containerSize.width,r=t.ui.hasScroll(p,"left")?p.scrollWidth:a,h=t.ui.hasScroll(p)?p.scrollHeight:o,l.parentData={element:p,left:n.left,top:n.top,width:r,height:h}))},resize:function(e){var i,s,n,o,a=t(this).data("ui-resizable"),r=a.options,h=a.containerOffset,l=a.position,c=a._aspectRatio||e.shiftKey,u={top:0,left:0},d=a.containerElement;d[0]!==document&&/static/.test(d.css("position"))&&(u=h),l.left<(a._helper?h.left:0)&&(a.size.width=a.size.width+(a._helper?a.position.left-h.left:a.position.left-u.left),c&&(a.size.height=a.size.width/a.aspectRatio),a.position.left=r.helper?h.left:0),l.top<(a._helper?h.top:0)&&(a.size.height=a.size.height+(a._helper?a.position.top-h.top:a.position.top),c&&(a.size.width=a.size.height*a.aspectRatio),a.position.top=a._helper?h.top:0),a.offset.left=a.parentData.left+a.position.left,a.offset.top=a.parentData.top+a.position.top,i=Math.abs((a._helper?a.offset.left-u.left:a.offset.left-u.left)+a.sizeDiff.width),s=Math.abs((a._helper?a.offset.top-u.top:a.offset.top-h.top)+a.sizeDiff.height),n=a.containerElement.get(0)===a.element.parent().get(0),o=/relative|absolute/.test(a.containerElement.css("position")),n&&o&&(i-=a.parentData.left),i+a.size.width>=a.parentData.width&&(a.size.width=a.parentData.width-i,c&&(a.size.height=a.size.width/a.aspectRatio)),s+a.size.height>=a.parentData.height&&(a.size.height=a.parentData.height-s,c&&(a.size.width=a.size.height*a.aspectRatio))},stop:function(){var e=t(this).data("ui-resizable"),i=e.options,s=e.containerOffset,n=e.containerPosition,o=e.containerElement,a=t(e.helper),r=a.offset(),h=a.outerWidth()-e.sizeDiff.width,l=a.outerHeight()-e.sizeDiff.height;e._helper&&!i.animate&&/relative/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l}),e._helper&&!i.animate&&/static/.test(o.css("position"))&&t(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),t.ui.plugin.add("resizable","alsoResize",{start:function(){var e=t(this).data("ui-resizable"),i=e.options,s=function(e){t(e).each(function(){var e=t(this);e.data("ui-resizable-alsoresize",{width:parseInt(e.width(),10),height:parseInt(e.height(),10),left:parseInt(e.css("left"),10),top:parseInt(e.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?s(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],s(i.alsoResize)):t.each(i.alsoResize,function(t){s(t)})},resize:function(e,i){var s=t(this).data("ui-resizable"),n=s.options,o=s.originalSize,a=s.originalPosition,r={height:s.size.height-o.height||0,width:s.size.width-o.width||0,top:s.position.top-a.top||0,left:s.position.left-a.left||0},h=function(e,s){t(e).each(function(){var e=t(this),n=t(this).data("ui-resizable-alsoresize"),o={},a=s&&s.length?s:e.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];t.each(a,function(t,e){var i=(n[e]||0)+(r[e]||0);i&&i>=0&&(o[e]=i||null)}),e.css(o)})};"object"!=typeof n.alsoResize||n.alsoResize.nodeType?h(n.alsoResize):t.each(n.alsoResize,function(t,e){h(t,e)})},stop:function(){t(this).removeData("resizable-alsoresize")}}),t.ui.plugin.add("resizable","ghost",{start:function(){var e=t(this).data("ui-resizable"),i=e.options,s=e.size;e.ghost=e.originalElement.clone(),e.ghost.css({opacity:.25,display:"block",position:"relative",height:s.height,width:s.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),e.ghost.appendTo(e.helper)},resize:function(){var e=t(this).data("ui-resizable");e.ghost&&e.ghost.css({position:"relative",height:e.size.height,width:e.size.width})},stop:function(){var e=t(this).data("ui-resizable");e.ghost&&e.helper&&e.helper.get(0).removeChild(e.ghost.get(0))}}),t.ui.plugin.add("resizable","grid",{resize:function(){var e=t(this).data("ui-resizable"),i=e.options,s=e.size,n=e.originalSize,o=e.originalPosition,a=e.axis,r="number"==typeof i.grid?[i.grid,i.grid]:i.grid,h=r[0]||1,l=r[1]||1,c=Math.round((s.width-n.width)/h)*h,u=Math.round((s.height-n.height)/l)*l,d=n.width+c,p=n.height+u,f=i.maxWidth&&d>i.maxWidth,g=i.maxHeight&&p>i.maxHeight,m=i.minWidth&&i.minWidth>d,v=i.minHeight&&i.minHeight>p;i.grid=r,m&&(d+=h),v&&(p+=l),f&&(d-=h),g&&(p-=l),/^(se|s|e)$/.test(a)?(e.size.width=d,e.size.height=p):/^(ne)$/.test(a)?(e.size.width=d,e.size.height=p,e.position.top=o.top-u):/^(sw)$/.test(a)?(e.size.width=d,e.size.height=p,e.position.left=o.left-c):(e.size.width=d,e.size.height=p,e.position.top=o.top-u,e.position.left=o.left-c)}})}(jQuery),function(t){t.widget("ui.selectable",t.ui.mouse,{version:"1.10.3",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var e,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){e=t(i.options.filter,i.element[0]),e.addClass("ui-selectee"),e.each(function(){var e=t(this),i=e.offset();t.data(this,"selectable-item",{element:this,$element:e,left:i.left,top:i.top,right:i.left+e.outerWidth(),bottom:i.top+e.outerHeight(),startselected:!1,selected:e.hasClass("ui-selected"),selecting:e.hasClass("ui-selecting"),unselecting:e.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=e.addClass("ui-selectee"),this._mouseInit(),this.helper=t("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(e){var i=this,s=this.options;this.opos=[e.pageX,e.pageY],this.options.disabled||(this.selectees=t(s.filter,this.element[0]),this._trigger("start",e),t(s.appendTo).append(this.helper),this.helper.css({left:e.pageX,top:e.pageY,width:0,height:0}),s.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var s=t.data(this,"selectable-item");s.startselected=!0,e.metaKey||e.ctrlKey||(s.$element.removeClass("ui-selected"),s.selected=!1,s.$element.addClass("ui-unselecting"),s.unselecting=!0,i._trigger("unselecting",e,{unselecting:s.element}))}),t(e.target).parents().addBack().each(function(){var s,n=t.data(this,"selectable-item");return n?(s=!e.metaKey&&!e.ctrlKey||!n.$element.hasClass("ui-selected"),n.$element.removeClass(s?"ui-unselecting":"ui-selected").addClass(s?"ui-selecting":"ui-unselecting"),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger("selecting",e,{selecting:n.element}):i._trigger("unselecting",e,{unselecting:n.element}),!1):undefined}))},_mouseDrag:function(e){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,o=this.opos[0],a=this.opos[1],r=e.pageX,h=e.pageY;return o>r&&(i=r,r=o,o=i),a>h&&(i=h,h=a,a=i),this.helper.css({left:o,top:a,width:r-o,height:h-a}),this.selectees.each(function(){var i=t.data(this,"selectable-item"),l=!1;i&&i.element!==s.element[0]&&("touch"===n.tolerance?l=!(i.left>r||o>i.right||i.top>h||a>i.bottom):"fit"===n.tolerance&&(l=i.left>o&&r>i.right&&i.top>a&&h>i.bottom),l?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,s._trigger("selecting",e,{selecting:i.element}))):(i.selecting&&((e.metaKey||e.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),s._trigger("unselecting",e,{unselecting:i.element}))),i.selected&&(e.metaKey||e.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,s._trigger("unselecting",e,{unselecting:i.element})))))}),!1}},_mouseStop:function(e){var i=this;return this.dragged=!1,t(".ui-unselecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");s.$element.removeClass("ui-unselecting"),s.unselecting=!1,s.startselected=!1,i._trigger("unselected",e,{unselected:s.element})}),t(".ui-selecting",this.element[0]).each(function(){var s=t.data(this,"selectable-item");s.$element.removeClass("ui-selecting").addClass("ui-selected"),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger("selected",e,{selected:s.element})}),this._trigger("stop",e),this.helper.remove(),!1}})}(jQuery),function(t){function e(t,e,i){return t>e&&e+i>t}function i(t){return/left|right/.test(t.css("float"))||/inline|table-cell/.test(t.css("display"))}t.widget("ui.sortable",t.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===t.axis||i(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,i){"disabled"===e?(this.options[e]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):t.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,i){var s=null,n=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(e),t(e.target).parents().each(function(){return t.data(this,o.widgetName+"-item")===o?(s=t(this),!1):undefined}),t.data(e.target,o.widgetName+"-item")===o&&(s=t(e.target)),s?!this.options.handle||i||(t(this.options.handle,s).find("*").addBack().each(function(){this===e.target&&(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(e,i,s){var n,o,a=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),
relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,a.cursorAt&&this._adjustOffsetFromHelper(a.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),a.containment&&this._setContainment(),a.cursor&&"auto"!==a.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",a.cursor),this.storedStylesheet=t("<style>*{ cursor: "+a.cursor+" !important; }</style>").appendTo(o)),a.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",a.opacity)),a.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",a.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",e,this._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){var i,s,n,o,a=this.options,r=!1;for(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<a.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+a.scrollSpeed:e.pageY-this.overflowOffset.top<a.scrollSensitivity&&(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-a.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<a.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+a.scrollSpeed:e.pageX-this.overflowOffset.left<a.scrollSensitivity&&(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-a.scrollSpeed)):(e.pageY-t(document).scrollTop()<a.scrollSensitivity?r=t(document).scrollTop(t(document).scrollTop()-a.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<a.scrollSensitivity&&(r=t(document).scrollTop(t(document).scrollTop()+a.scrollSpeed)),e.pageX-t(document).scrollLeft()<a.scrollSensitivity?r=t(document).scrollLeft(t(document).scrollLeft()-a.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<a.scrollSensitivity&&(r=t(document).scrollLeft(t(document).scrollLeft()+a.scrollSpeed))),r!==!1&&t.ui.ddmanager&&!a.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(s=this.items[i],n=s.item[0],o=this._intersectsWithPointer(s),o&&s.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!t.contains(this.placeholder[0],n)&&("semi-dynamic"===this.options.type?!t.contains(this.element[0],n):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(s))break;this._rearrange(e,s),this._trigger("change",e,this._uiHash());break}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var s=this,n=this.placeholder.offset(),o=this.options.axis,a={};o&&"x"!==o||(a.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(a.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,t(this.helper).animate(a,parseInt(this.options.revert,10)||500,function(){s._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var e=this.containers.length-1;e>=0;e--)this.containers[e]._trigger("deactivate",null,this._uiHash(this)),this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",null,this._uiHash(this)),this.containers[e].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[\-=_](.+)/);i&&s.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!s.length&&e.key&&s.push(e.key+"="),s.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),s=[];return e=e||{},i.each(function(){s.push(t(e.item||this).attr(e.attribute||"id")||"")}),s},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,o=t.left,a=o+t.width,r=t.top,h=r+t.height,l=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||s+l>r&&h>s+l,d="y"===this.options.axis||e+c>o&&a>e+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?p:e+this.helperProportions.width/2>o&&a>i-this.helperProportions.width/2&&s+this.helperProportions.height/2>r&&h>n-this.helperProportions.height/2},_intersectsWithPointer:function(t){var i="x"===this.options.axis||e(this.positionAbs.top+this.offset.click.top,t.top,t.height),s="y"===this.options.axis||e(this.positionAbs.left+this.offset.click.left,t.left,t.width),n=i&&s,o=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return n?this.floating?a&&"right"===a||"down"===o?2:1:o&&("down"===o?2:1):!1},_intersectsWithSides:function(t){var i=e(this.positionAbs.top+this.offset.click.top,t.top+t.height/2,t.height),s=e(this.positionAbs.left+this.offset.click.left,t.left+t.width/2,t.width),n=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"===o&&s||"left"===o&&!s:n&&("down"===n&&i||"up"===n&&!i)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!==t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!==t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor===String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){var i,s,n,o,a=[],r=[],h=this._connectWith();if(h&&e)for(i=h.length-1;i>=0;i--)for(n=t(h[i]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&r.push([t.isFunction(o.options.items)?o.options.items.call(o.element):t(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(r.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=r.length-1;i>=0;i--)r[i][0].each(function(){a.push(this)});return t(a)},_removeCurrentsFromItems:function(){var e=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=t.grep(this.items,function(t){for(var i=0;e.length>i;i++)if(e[i]===t.item[0])return!1;return!0})},_refreshItems:function(e){this.items=[],this.containers=[this];var i,s,n,o,a,r,h,l,c=this.items,u=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(n=t(d[i]),s=n.length-1;s>=0;s--)o=t.data(n[s],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([t.isFunction(o.options.items)?o.options.items.call(o.element[0],e,{item:this.currentItem}):t(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(a=u[i][1],r=u[i][0],s=0,l=r.length;l>s;s++)h=t(r[s]),h.data(this.widgetName+"-item",a),c.push({item:h,instance:a,width:0,height:0,left:0,top:0})},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,s,n,o;for(i=this.items.length-1;i>=0;i--)s=this.items[i],s.instance!==this.currentContainer&&this.currentContainer&&s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?t(this.options.toleranceElement,s.item):s.item,e||(s.width=n.outerWidth(),s.height=n.outerHeight()),o=n.offset(),s.left=o.left,s.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(e){e=e||this;var i,s=e.options;s.placeholder&&s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=e.currentItem[0].nodeName.toLowerCase(),n=t("<"+s+">",e.document[0]).addClass(i||e.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===s?e.currentItem.children().each(function(){t("<td>&#160;</td>",e.document[0]).attr("colspan",t(this).attr("colspan")||1).appendTo(n)}):"img"===s&&n.attr("src",e.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(t,n){(!i||s.forcePlaceholderSize)&&(n.height()||n.height(e.currentItem.innerHeight()-parseInt(e.currentItem.css("paddingTop")||0,10)-parseInt(e.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(e.currentItem.innerWidth()-parseInt(e.currentItem.css("paddingLeft")||0,10)-parseInt(e.currentItem.css("paddingRight")||0,10)))}}),e.placeholder=t(s.placeholder.element.call(e.element,e.currentItem)),e.currentItem.after(e.placeholder),s.placeholder.update(e,e.placeholder)},_contactContainers:function(s){var n,o,a,r,h,l,c,u,d,p,f=null,g=null;for(n=this.containers.length-1;n>=0;n--)if(!t.contains(this.currentItem[0],this.containers[n].element[0]))if(this._intersectsWith(this.containers[n].containerCache)){if(f&&t.contains(this.containers[n].element[0],f.element[0]))continue;f=this.containers[n],g=n}else this.containers[n].containerCache.over&&(this.containers[n]._trigger("out",s,this._uiHash(this)),this.containers[n].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[g].containerCache.over||(this.containers[g]._trigger("over",s,this._uiHash(this)),this.containers[g].containerCache.over=1);else{for(a=1e4,r=null,p=f.floating||i(this.currentItem),h=p?"left":"top",l=p?"width":"height",c=this.positionAbs[h]+this.offset.click[h],o=this.items.length-1;o>=0;o--)t.contains(this.containers[g].element[0],this.items[o].item[0])&&this.items[o].item[0]!==this.currentItem[0]&&(!p||e(this.positionAbs.top+this.offset.click.top,this.items[o].top,this.items[o].height))&&(u=this.items[o].item.offset()[h],d=!1,Math.abs(u-c)>Math.abs(u+this.items[o][l]-c)&&(d=!0,u+=this.items[o][l]),a>Math.abs(u-c)&&(a=Math.abs(u-c),r=this.items[o],this.direction=d?"up":"down"));if(!r&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[g])return;r?this._rearrange(s,r,null,!0):this._rearrange(s,null,this.containers[g].element,!0),this._trigger("change",s,this._uiHash()),this.containers[g]._trigger("change",s,this._uiHash(this)),this.currentContainer=this.containers[g],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[g]._trigger("over",s,this._uiHash(this)),this.containers[g].containerCache.over=1}},_createHelper:function(e){var i=this.options,s=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return s.parents("body").length||t("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!s[0].style.width||i.forceHelperSize)&&s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&&s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&t.ui.ie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e,i,s,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"===n.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"===n.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(e=t(n.containment)[0],i=t(n.containment).offset(),s="hidden"!==t(e).css("overflow"),this.containment=[i.left+(parseInt(t(e).css("borderLeftWidth"),10)||0)+(parseInt(t(e).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(t(e).css("borderTopWidth"),10)||0)+(parseInt(t(e).css("paddingTop"),10)||0)-this.margins.top,i.left+(s?Math.max(e.scrollWidth,e.offsetWidth):e.offsetWidth)-(parseInt(t(e).css("borderLeftWidth"),10)||0)-(parseInt(t(e).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(e.scrollHeight,e.offsetHeight):e.offsetHeight)-(parseInt(t(e).css("borderTopWidth"),10)||0)-(parseInt(t(e).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(e,i){i||(i=this.position);var s="absolute"===e?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*s}},_generatePosition:function(e){var i,s,n=this.options,o=e.pageX,a=e.pageY,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&t.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(a=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(a=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((a-this.originalPageY)/n.grid[1])*n.grid[1],a=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?s-this.offset.click.left>=this.containment[0]&&s-this.offset.click.left<=this.containment[2]?s:s-this.offset.click.left>=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(t,e,i,s){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!s)})},_clear:function(t,e){this.reverting=!1;var i,s=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)("auto"===this._storedCSS[i]||"static"===this._storedCSS[i])&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!e&&s.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||e||s.push(function(t){this._trigger("update",t,this._uiHash())}),this!==this.currentContainer&&(e||(s.push(function(t){this._trigger("remove",t,this._uiHash())}),s.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.currentContainer)),s.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)e||s.push(function(t){return function(e){t._trigger("deactivate",e,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(s.push(function(t){return function(e){t._trigger("out",e,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!e){for(this._trigger("beforeStop",t,this._uiHash()),i=0;s.length>i;i++)s[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!1}if(e||this._trigger("beforeStop",t,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!e){for(i=0;s.length>i;i++)s[i].call(this,t);this._trigger("stop",t,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}})}(jQuery),function(t,e){var i="ui-effects-";t.effects={effect:{}},function(t,e){function i(t,e,i){var s=u[e.type]||{};return null==t?i||!e.def?null:e.def:(t=s.floor?~~t:parseFloat(t),isNaN(t)?e.def:s.mod?(t+s.mod)%s.mod:0>t?0:t>s.max?s.max:t)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(t,o){var a,r=o.re.exec(i),h=r&&o.parse(r),l=o.space||"rgba";return h?(a=s[l](h),s[c[l].cache]=a[c[l].cache],n=s._rgba=a._rgba,!1):e}),n.length?("0,0,0,0"===n.join()&&t.extend(n,o.transparent),s):o[i]}function n(t,e,i){return i=(i+1)%1,1>6*i?t+6*(e-t)*i:1>2*i?e:2>3*i?t+6*(e-t)*(2/3-i):t}var o,a="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[t[1],t[2],t[3],t[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(t){return[2.55*t[1],2.55*t[2],2.55*t[3],t[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(t){return[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(t){return[parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(t){return[t[1],t[2]/100,t[3]/100,t[4]]}}],l=t.Color=function(e,i,s,n){return new t.Color.fn.parse(e,i,s,n)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=l.support={},p=t("<p>")[0],f=t.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(t,e){e.cache="_"+t,e.props.alpha={idx:3,type:"percent",def:1}}),l.fn=t.extend(l.prototype,{parse:function(n,a,r,h){if(n===e)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=t(n).css(a),a=e);var u=this,d=t.type(n),p=this._rgba=[];return a!==e&&(n=[n,a,r,h],d="array"),"string"===d?this.parse(s(n)||o._default):"array"===d?(f(c.rgba.props,function(t,e){p[e.idx]=i(n[e.idx],e)}),this):"object"===d?(n instanceof l?f(c,function(t,e){n[e.cache]&&(u[e.cache]=n[e.cache].slice())}):f(c,function(e,s){var o=s.cache;f(s.props,function(t,e){if(!u[o]&&s.to){if("alpha"===t||null==n[t])return;u[o]=s.to(u._rgba)}u[o][e.idx]=i(n[t],e,!0)}),u[o]&&0>t.inArray(null,u[o].slice(0,3))&&(u[o][3]=1,s.from&&(u._rgba=s.from(u[o])))}),this):e},is:function(t){var i=l(t),s=!0,n=this;return f(c,function(t,o){var a,r=i[o.cache];return r&&(a=n[o.cache]||o.to&&o.to(n._rgba)||[],f(o.props,function(t,i){return null!=r[i.idx]?s=r[i.idx]===a[i.idx]:e})),s}),s},_space:function(){var t=[],e=this;return f(c,function(i,s){e[s.cache]&&t.push(i)}),t.pop()},transition:function(t,e){var s=l(t),n=s._space(),o=c[n],a=0===this.alpha()?l("transparent"):this,r=a[o.cache]||o.to(a._rgba),h=r.slice();return s=s[o.cache],f(o.props,function(t,n){var o=n.idx,a=r[o],l=s[o],c=u[n.type]||{};null!==l&&(null===a?h[o]=l:(c.mod&&(l-a>c.mod/2?a+=c.mod:a-l>c.mod/2&&(a-=c.mod)),h[o]=i((l-a)*e+a,n)))}),this[n](h)},blend:function(e){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(e)._rgba;return l(t.map(i,function(t,e){return(1-s)*n[e]+s*t}))},toRgbaString:function(){var e="rgba(",i=t.map(this._rgba,function(t,e){return null==t?e>2?1:0:t});return 1===i[3]&&(i.pop(),e="rgb("),e+i.join()+")"},toHslaString:function(){var e="hsla(",i=t.map(this.hsla(),function(t,e){return null==t&&(t=e>2?1:0),e&&3>e&&(t=Math.round(100*t)+"%"),t});return 1===i[3]&&(i.pop(),e="hsl("),e+i.join()+")"},toHexString:function(e){var i=this._rgba.slice(),s=i.pop();return e&&i.push(~~(255*s)),"#"+t.map(i,function(t){return t=(t||0).toString(16),1===t.length?"0"+t:t}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,c.hsla.to=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e,i,s=t[0]/255,n=t[1]/255,o=t[2]/255,a=t[3],r=Math.max(s,n,o),h=Math.min(s,n,o),l=r-h,c=r+h,u=.5*c;return e=h===r?0:s===r?60*(n-o)/l+360:n===r?60*(o-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5>=u?l/c:l/(2-c),[Math.round(e)%360,i,u,null==a?1:a]},c.hsla.from=function(t){if(null==t[0]||null==t[1]||null==t[2])return[null,null,null,t[3]];var e=t[0]/360,i=t[1],s=t[2],o=t[3],a=.5>=s?s*(1+i):s+i-s*i,r=2*s-a;return[Math.round(255*n(r,a,e+1/3)),Math.round(255*n(r,a,e)),Math.round(255*n(r,a,e-1/3)),o]},f(c,function(s,n){var o=n.props,a=n.cache,h=n.to,c=n.from;l.fn[s]=function(s){if(h&&!this[a]&&(this[a]=h(this._rgba)),s===e)return this[a].slice();var n,r=t.type(s),u="array"===r||"object"===r?s:arguments,d=this[a].slice();return f(o,function(t,e){var s=u["object"===r?t:e.idx];null==s&&(s=d[e.idx]),d[e.idx]=i(s,e)}),c?(n=l(c(d)),n[a]=d,n):l(d)},f(o,function(e,i){l.fn[e]||(l.fn[e]=function(n){var o,a=t.type(n),h="alpha"===e?this._hsla?"hsla":"rgba":s,l=this[h](),c=l[i.idx];return"undefined"===a?c:("function"===a&&(n=n.call(this,c),a=t.type(n)),null==n&&i.empty?this:("string"===a&&(o=r.exec(n),o&&(n=c+parseFloat(o[2])*("+"===o[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(e){var i=e.split(" ");f(i,function(e,i){t.cssHooks[i]={set:function(e,n){var o,a,r="";if("transparent"!==n&&("string"!==t.type(n)||(o=s(n)))){if(n=l(o||n),!d.rgba&&1!==n._rgba[3]){for(a="backgroundColor"===i?e.parentNode:e;(""===r||"transparent"===r)&&a&&a.style;)try{r=t.css(a,"backgroundColor"),a=a.parentNode}catch(h){}n=n.blend(r&&"transparent"!==r?r:"_default")}n=n.toRgbaString()}try{e.style[i]=n}catch(h){}}},t.fx.step[i]=function(e){e.colorInit||(e.start=l(e.elem,i),e.end=l(e.end),e.colorInit=!0),t.cssHooks[i].set(e.elem,e.start.transition(e.end,e.pos))}})},l.hook(a),t.cssHooks.borderColor={expand:function(t){var e={};return f(["Top","Right","Bottom","Left"],function(i,s){e["border"+s+"Color"]=t}),e}},o=t.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function i(e){var i,s,n=e.ownerDocument.defaultView?e.ownerDocument.defaultView.getComputedStyle(e,null):e.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(s=n.length;s--;)i=n[s],"string"==typeof n[i]&&(o[t.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function s(e,i){var s,n,a={};for(s in i)n=i[s],e[s]!==n&&(o[s]||(t.fx.step[s]||!isNaN(parseFloat(n)))&&(a[s]=n));return a}var n=["add","remove","toggle"],o={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};t.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(e,i){t.fx.step[i]=function(t){("none"!==t.end&&!t.setAttr||1===t.pos&&!t.setAttr)&&(jQuery.style(t.elem,i,t.end),t.setAttr=!0)}}),t.fn.addBack||(t.fn.addBack=function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}),t.effects.animateClass=function(e,o,a,r){var h=t.speed(o,a,r);return this.queue(function(){var o,a=t(this),r=a.attr("class")||"",l=h.children?a.find("*").addBack():a;l=l.map(function(){var e=t(this);return{el:e,start:i(this)}}),o=function(){t.each(n,function(t,i){e[i]&&a[i+"Class"](e[i])})},o(),l=l.map(function(){return this.end=i(this.el[0]),this.diff=s(this.start,this.end),this}),a.attr("class",r),l=l.map(function(){var e=this,i=t.Deferred(),s=t.extend({},h,{queue:!1,complete:function(){i.resolve(e)}});return this.el.animate(this.diff,s),i.promise()}),t.when.apply(t,l.get()).done(function(){o(),t.each(arguments,function(){var e=this.el;t.each(this.diff,function(t){e.css(t,"")})}),h.complete.call(a[0])})})},t.fn.extend({addClass:function(e){return function(i,s,n,o){return s?t.effects.animateClass.call(this,{add:i},s,n,o):e.apply(this,arguments)}}(t.fn.addClass),removeClass:function(e){return function(i,s,n,o){return arguments.length>1?t.effects.animateClass.call(this,{remove:i},s,n,o):e.apply(this,arguments)}}(t.fn.removeClass),toggleClass:function(i){return function(s,n,o,a,r){return"boolean"==typeof n||n===e?o?t.effects.animateClass.call(this,n?{add:s}:{remove:s},o,a,r):i.apply(this,arguments):t.effects.animateClass.call(this,{toggle:s},n,o,a)}}(t.fn.toggleClass),switchClass:function(e,i,s,n,o){return t.effects.animateClass.call(this,{add:i,remove:e},s,n,o)}})}(),function(){function s(e,i,s,n){return t.isPlainObject(e)&&(i=e,e=e.effect),e={effect:e},null==i&&(i={}),t.isFunction(i)&&(n=i,s=null,i={}),("number"==typeof i||t.fx.speeds[i])&&(n=s,s=i,i={}),t.isFunction(s)&&(n=s,s=null),i&&t.extend(e,i),s=s||i.duration,e.duration=t.fx.off?0:"number"==typeof s?s:s in t.fx.speeds?t.fx.speeds[s]:t.fx.speeds._default,e.complete=n||i.complete,e}function n(e){return!e||"number"==typeof e||t.fx.speeds[e]?!0:"string"!=typeof e||t.effects.effect[e]?t.isFunction(e)?!0:"object"!=typeof e||e.effect?!1:!0:!0}t.extend(t.effects,{version:"1.10.3",save:function(t,e){for(var s=0;e.length>s;s++)null!==e[s]&&t.data(i+e[s],t[0].style[e[s]])},restore:function(t,s){var n,o;for(o=0;s.length>o;o++)null!==s[o]&&(n=t.data(i+s[o]),n===e&&(n=""),t.css(s[o],n))},setMode:function(t,e){return"toggle"===e&&(e=t.is(":hidden")?"show":"hide"),e},getBaseline:function(t,e){var i,s;switch(t[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=t[0]/e.height}switch(t[1]){case"left":s=0;break;case"center":s=.5;break;case"right":s=1;break;default:s=t[1]/e.width}return{x:s,y:i}},createWrapper:function(e){if(e.parent().is(".ui-effects-wrapper"))return e.parent();var i={width:e.outerWidth(!0),height:e.outerHeight(!0),"float":e.css("float")},s=t("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:e.width(),height:e.height()},o=document.activeElement;
try{o.id}catch(a){o=document.body}return e.wrap(s),(e[0]===o||t.contains(e[0],o))&&t(o).focus(),s=e.parent(),"static"===e.css("position")?(s.css({position:"relative"}),e.css({position:"relative"})):(t.extend(i,{position:e.css("position"),zIndex:e.css("z-index")}),t.each(["top","left","bottom","right"],function(t,s){i[s]=e.css(s),isNaN(parseInt(i[s],10))&&(i[s]="auto")}),e.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),e.css(n),s.css(i).show()},removeWrapper:function(e){var i=document.activeElement;return e.parent().is(".ui-effects-wrapper")&&(e.parent().replaceWith(e),(e[0]===i||t.contains(e[0],i))&&t(i).focus()),e},setTransition:function(e,i,s,n){return n=n||{},t.each(i,function(t,i){var o=e.cssUnit(i);o[0]>0&&(n[i]=o[0]*s+o[1])}),n}}),t.fn.extend({effect:function(){function e(e){function s(){t.isFunction(o)&&o.call(n[0]),t.isFunction(e)&&e()}var n=t(this),o=i.complete,r=i.mode;(n.is(":hidden")?"hide"===r:"show"===r)?(n[r](),s()):a.call(n[0],i,s)}var i=s.apply(this,arguments),n=i.mode,o=i.queue,a=t.effects.effect[i.effect];return t.fx.off||!a?n?this[n](i.duration,i.complete):this.each(function(){i.complete&&i.complete.call(this)}):o===!1?this.each(e):this.queue(o||"fx",e)},show:function(t){return function(e){if(n(e))return t.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="show",this.effect.call(this,i)}}(t.fn.show),hide:function(t){return function(e){if(n(e))return t.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="hide",this.effect.call(this,i)}}(t.fn.hide),toggle:function(t){return function(e){if(n(e)||"boolean"==typeof e)return t.apply(this,arguments);var i=s.apply(this,arguments);return i.mode="toggle",this.effect.call(this,i)}}(t.fn.toggle),cssUnit:function(e){var i=this.css(e),s=[];return t.each(["em","px","%","pt"],function(t,e){i.indexOf(e)>0&&(s=[parseFloat(i),e])}),s}})}(),function(){var e={};t.each(["Quad","Cubic","Quart","Quint","Expo"],function(t,i){e[i]=function(e){return Math.pow(e,t+2)}}),t.extend(e,{Sine:function(t){return 1-Math.cos(t*Math.PI/2)},Circ:function(t){return 1-Math.sqrt(1-t*t)},Elastic:function(t){return 0===t||1===t?t:-Math.pow(2,8*(t-1))*Math.sin((80*(t-1)-7.5)*Math.PI/15)},Back:function(t){return t*t*(3*t-2)},Bounce:function(t){for(var e,i=4;((e=Math.pow(2,--i))-1)/11>t;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*e-2)/22-t,2)}}),t.each(e,function(e,i){t.easing["easeIn"+e]=i,t.easing["easeOut"+e]=function(t){return 1-i(1-t)},t.easing["easeInOut"+e]=function(t){return.5>t?i(2*t)/2:1-i(-2*t+2)/2}})}()}(jQuery),function(t){var e=0,i={},s={};i.height=i.paddingTop=i.paddingBottom=i.borderTopWidth=i.borderBottomWidth="hide",s.height=s.paddingTop=s.paddingBottom=s.borderTopWidth=s.borderBottomWidth="show",t.widget("ui.accordion",{version:"1.10.3",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var e=this.options;this.prevShow=this.prevHide=t(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),e.collapsible||e.active!==!1&&null!=e.active||(e.active=0),this._processPanels(),0>e.active&&(e.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():t(),content:this.active.length?this.active.next():t()}},_createIcons:function(){var e=this.options.icons;e&&(t("<span>").addClass("ui-accordion-header-icon ui-icon "+e.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(e.header).addClass(e.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var t;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this._destroyIcons(),t=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),"content"!==this.options.heightStyle&&t.css("height","")},_setOption:function(t,e){return"active"===t?(this._activate(e),undefined):("event"===t&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(e)),this._super(t,e),"collapsible"!==t||e||this.options.active!==!1||this._activate(0),"icons"===t&&(this._destroyIcons(),e&&this._createIcons()),"disabled"===t&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!e),undefined)},_keydown:function(e){if(!e.altKey&&!e.ctrlKey){var i=t.ui.keyCode,s=this.headers.length,n=this.headers.index(e.target),o=!1;switch(e.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:o=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(e);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[s-1]}o&&(t(e.target).attr("tabIndex",-1),t(o).attr("tabIndex",0),o.focus(),e.preventDefault())}},_panelKeyDown:function(e){e.keyCode===t.ui.keyCode.UP&&e.ctrlKey&&t(e.currentTarget).prev().focus()},refresh:function(){var e=this.options;this._processPanels(),e.active===!1&&e.collapsible===!0||!this.headers.length?(e.active=!1,this.active=t()):e.active===!1?this._activate(0):this.active.length&&!t.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(e.active=!1,this.active=t()):this._activate(Math.max(0,e.active-1)):e.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var i,s=this.options,n=s.heightStyle,o=this.element.parent(),a=this.accordionId="ui-accordion-"+(this.element.attr("id")||++e);this.active=this._findActive(s.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(e){var i=t(this),s=i.attr("id"),n=i.next(),o=n.attr("id");s||(s=a+"-header-"+e,i.attr("id",s)),o||(o=a+"-panel-"+e,n.attr("id",o)),i.attr("aria-controls",o),n.attr("aria-labelledby",s)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false",tabIndex:-1}).next().attr({"aria-expanded":"false","aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true",tabIndex:0}).next().attr({"aria-expanded":"true","aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(s.event),"fill"===n?(i=o.height(),this.element.siblings(":visible").each(function(){var e=t(this),s=e.css("position");"absolute"!==s&&"fixed"!==s&&(i-=e.outerHeight(!0))}),this.headers.each(function(){i-=t(this).outerHeight(!0)}),this.headers.next().each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===n&&(i=0,this.headers.next().each(function(){i=Math.max(i,t(this).css("height","").height())}).height(i))},_activate:function(e){var i=this._findActive(e)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return"number"==typeof e?this.headers.eq(e):t()},_setupEvents:function(e){var i={keydown:"_keydown"};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(e){var i=this.options,s=this.active,n=t(e.currentTarget),o=n[0]===s[0],a=o&&i.collapsible,r=a?t():n.next(),h=s.next(),l={oldHeader:s,oldPanel:h,newHeader:a?t():n,newPanel:r};e.preventDefault(),o&&!i.collapsible||this._trigger("beforeActivate",e,l)===!1||(i.active=a?!1:this.headers.index(n),this.active=o?t():n,this._toggle(l),s.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&s.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),o||(n.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),n.next().addClass("ui-accordion-content-active")))},_toggle:function(e){var i=e.newPanel,s=this.prevShow.length?this.prevShow:e.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,e):(s.hide(),i.show(),this._toggleComplete(e)),s.attr({"aria-expanded":"false","aria-hidden":"true"}),s.prev().attr("aria-selected","false"),i.length&&s.length?s.prev().attr("tabIndex",-1):i.length&&this.headers.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),i.attr({"aria-expanded":"true","aria-hidden":"false"}).prev().attr({"aria-selected":"true",tabIndex:0})},_animate:function(t,e,n){var o,a,r,h=this,l=0,c=t.length&&(!e.length||t.index()<e.index()),u=this.options.animate||{},d=c&&u.down||u,p=function(){h._toggleComplete(n)};return"number"==typeof d&&(r=d),"string"==typeof d&&(a=d),a=a||d.easing||u.easing,r=r||d.duration||u.duration,e.length?t.length?(o=t.show().outerHeight(),e.animate(i,{duration:r,easing:a,step:function(t,e){e.now=Math.round(t)}}),t.hide().animate(s,{duration:r,easing:a,complete:p,step:function(t,i){i.now=Math.round(t),"height"!==i.prop?l+=i.now:"content"!==h.options.heightStyle&&(i.now=Math.round(o-e.outerHeight()-l),l=0)}}),undefined):e.animate(i,r,a,p):t.animate(s,r,a,p)},_toggleComplete:function(t){var e=t.oldPanel;e.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),e.length&&(e.parent()[0].className=e.parent()[0].className),this._trigger("activate",null,t)}})}(jQuery),function(t){var e=0;t.widget("ui.autocomplete",{version:"1.10.3",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var e,i,s,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,a="input"===n;this.isMultiLine=o?!0:a?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[o||a?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return e=!0,s=!0,i=!0,undefined;e=!1,s=!1,i=!1;var o=t.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:e=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:e=!0,this._move("nextPage",n);break;case o.UP:e=!0,this._keyEvent("previous",n);break;case o.DOWN:e=!0,this._keyEvent("next",n);break;case o.ENTER:case o.NUMPAD_ENTER:this.menu.active&&(e=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(e)return e=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&s.preventDefault(),undefined;if(!i){var n=t.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move("previousPage",s);break;case n.PAGE_DOWN:this._move("nextPage",s);break;case n.UP:this._keyEvent("previous",s);break;case n.DOWN:this._keyEvent("next",s)}}},input:function(t){return s?(s=!1,t.preventDefault(),undefined):(this._searchTimeout(t),undefined)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,undefined):(clearTimeout(this.searching),this.close(t),this._change(t),undefined)}}),this._initSource(),this.menu=t("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(e){e.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];t(e.target).closest(".ui-menu-item").length||this._delay(function(){var e=this;this.document.one("mousedown",function(s){s.target===e.element[0]||s.target===i||t.contains(i,s.target)||e.close()})})},menufocus:function(e,i){if(this.isNewMenu&&(this.isNewMenu=!1,e.originalEvent&&/^mouse/.test(e.originalEvent.type)))return this.menu.blur(),this.document.one("mousemove",function(){t(e.target).trigger(e.originalEvent)}),undefined;var s=i.item.data("ui-autocomplete-item");!1!==this._trigger("focus",e,{item:s})?e.originalEvent&&/^key/.test(e.originalEvent.type)&&this._value(s.value):this.liveRegion.text(s.value)},menuselect:function(t,e){var i=e.item.data("ui-autocomplete-item"),s=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s,this.selectedItem=i})),!1!==this._trigger("select",t,{item:i})&&this._value(i.value),this.term=this._value(),this.close(t),this.selectedItem=i}}),this.liveRegion=t("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(t,e){this._super(t,e),"source"===t&&this._initSource(),"appendTo"===t&&this.menu.element.appendTo(this._appendTo()),"disabled"===t&&e&&this.xhr&&this.xhr.abort()},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?t(e):this.document.find(e).eq(0)),e||(e=this.element.closest(".ui-front")),e.length||(e=this.document[0].body),e},_initSource:function(){var e,i,s=this;t.isArray(this.options.source)?(e=this.options.source,this.source=function(i,s){s(t.ui.autocomplete.filter(e,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(e,n){s.xhr&&s.xhr.abort(),s.xhr=t.ajax({url:i,data:e,dataType:"json",success:function(t){n(t)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(t){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,t))},this.options.delay)},search:function(t,e){return t=null!=t?t:this._value(),this.term=this._value(),t.length<this.options.minLength?this.close(e):this._trigger("search",e)!==!1?this._search(t):undefined},_search:function(t){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:t},this._response())},_response:function(){var t=this,i=++e;return function(s){i===e&&t.__response(s),t.pending--,t.pending||t.element.removeClass("ui-autocomplete-loading")}},__response:function(t){t&&(t=this._normalize(t)),this._trigger("response",null,{content:t}),!this.options.disabled&&t&&t.length&&!this.cancelSearch?(this._suggest(t),this._trigger("open")):this._close()},close:function(t){this.cancelSearch=!0,this._close(t)},_close:function(t){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",t))},_change:function(t){this.previous!==this._value()&&this._trigger("change",t,{item:this.selectedItem})},_normalize:function(e){return e.length&&e[0].label&&e[0].value?e:t.map(e,function(e){return"string"==typeof e?{label:e,value:e}:t.extend({label:e.label||e.value,value:e.value||e.label},e)})},_suggest:function(e){var i=this.menu.element.empty();this._renderMenu(i,e),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(t.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var t=this.menu.element;t.outerWidth(Math.max(t.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(e,i){var s=this;t.each(i,function(t,i){s._renderItemData(e,i)})},_renderItemData:function(t,e){return this._renderItem(t,e).data("ui-autocomplete-item",e)},_renderItem:function(e,i){return t("<li>").append(t("<a>").text(i.label)).appendTo(e)},_move:function(t,e){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(t)||this.menu.isLastItem()&&/^next/.test(t)?(this._value(this.term),this.menu.blur(),undefined):(this.menu[t](e),undefined):(this.search(null,e),undefined)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(t,e){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(t,e),e.preventDefault())}}),t.extend(t.ui.autocomplete,{escapeRegex:function(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(e,i){var s=RegExp(t.ui.autocomplete.escapeRegex(i),"i");return t.grep(e,function(t){return s.test(t.label||t.value||t)})}}),t.widget("ui.autocomplete",t.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(t){return t+(t>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var e;this._superApply(arguments),this.options.disabled||this.cancelSearch||(e=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.text(e))}})}(jQuery),function(t){var e,i,s,n,o="ui-button ui-widget ui-state-default ui-corner-all",a="ui-state-hover ui-state-active ",r="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",h=function(){var e=t(this);setTimeout(function(){e.find(":ui-button").button("refresh")},1)},l=function(e){var i=e.name,s=e.form,n=t([]);return i&&(i=i.replace(/'/g,"\\'"),n=s?t(s).find("[name='"+i+"']"):t("[name='"+i+"']",e.ownerDocument).filter(function(){return!this.form})),n};t.widget("ui.button",{version:"1.10.3",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,h),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var a=this,r=this.options,c="checkbox"===this.type||"radio"===this.type,u=c?"":"ui-state-active",d="ui-state-focus";null===r.label&&(r.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(o).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){r.disabled||this===e&&t(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){r.disabled||t(this).removeClass(u)}).bind("click"+this.eventNamespace,function(t){r.disabled&&(t.preventDefault(),t.stopImmediatePropagation())}),this.element.bind("focus"+this.eventNamespace,function(){a.buttonElement.addClass(d)}).bind("blur"+this.eventNamespace,function(){a.buttonElement.removeClass(d)}),c&&(this.element.bind("change"+this.eventNamespace,function(){n||a.refresh()}),this.buttonElement.bind("mousedown"+this.eventNamespace,function(t){r.disabled||(n=!1,i=t.pageX,s=t.pageY)}).bind("mouseup"+this.eventNamespace,function(t){r.disabled||(i!==t.pageX||s!==t.pageY)&&(n=!0)})),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return r.disabled||n?!1:undefined}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(r.disabled||n)return!1;t(this).addClass("ui-state-active"),a.buttonElement.attr("aria-pressed","true");var e=a.element[0];l(e).not(e).map(function(){return t(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return r.disabled?!1:(t(this).addClass("ui-state-active"),e=this,a.document.one("mouseup",function(){e=null}),undefined)}).bind("mouseup"+this.eventNamespace,function(){return r.disabled?!1:(t(this).removeClass("ui-state-active"),undefined)}).bind("keydown"+this.eventNamespace,function(e){return r.disabled?!1:((e.keyCode===t.ui.keyCode.SPACE||e.keyCode===t.ui.keyCode.ENTER)&&t(this).addClass("ui-state-active"),undefined)}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){t(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(e){e.keyCode===t.ui.keyCode.SPACE&&t(this).click()})),this._setOption("disabled",r.disabled),this._resetButton()},_determineButtonType:function(){var t,e,i;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(t=this.element.parents().last(),e="label[for='"+this.element.attr("id")+"']",this.buttonElement=t.find(e),this.buttonElement.length||(t=t.length?t.siblings():this.element.siblings(),this.buttonElement=t.filter(e),this.buttonElement.length||(this.buttonElement=t.find(e))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(o+" "+a+" "+r).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(t,e){return this._super(t,e),"disabled"===t?(e?this.element.prop("disabled",!0):this.element.prop("disabled",!1),undefined):(this._resetButton(),undefined)},refresh:function(){var e=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");e!==this.options.disabled&&this._setOption("disabled",e),"radio"===this.type?l(this.element[0]).each(function(){t(this).is(":checked")?t(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):t(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return this.options.label&&this.element.val(this.options.label),undefined;var e=this.buttonElement.removeClass(r),i=t("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(e.empty()).text(),s=this.options.icons,n=s.primary&&s.secondary,o=[];s.primary||s.secondary?(this.options.text&&o.push("ui-button-text-icon"+(n?"s":s.primary?"-primary":"-secondary")),s.primary&&e.prepend("<span class='ui-button-icon-primary ui-icon "+s.primary+"'></span>"),s.secondary&&e.append("<span class='ui-button-icon-secondary ui-icon "+s.secondary+"'></span>"),this.options.text||(o.push(n?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||e.attr("title",t.trim(i)))):o.push("ui-button-text-only"),e.addClass(o.join(" "))}}),t.widget("ui.buttonset",{version:"1.10.3",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(t,e){"disabled"===t&&this.buttons.button("option",t,e),this._super(t,e)},refresh:function(){var e="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(e?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(e?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return t(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(t,e){function i(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},t.extend(this._defaults,this.regional[""]),this.dpDiv=s(t("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function s(e){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return e.delegate(i,"mouseout",function(){t(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",function(){t.datepicker._isDisabledDatepicker(o.inline?e.parent()[0]:o.input[0])||(t(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),t(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&t(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&t(this).addClass("ui-datepicker-next-hover"))})}function n(e,i){t.extend(e,i);for(var s in i)null==i[s]&&(e[s]=i[s]);return e}t.extend(t.ui,{datepicker:{version:"1.10.3"}});var o,a="datepicker";t.extend(i.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return n(this._defaults,t||{}),this},_attachDatepicker:function(e,i){var s,n,o;s=e.nodeName.toLowerCase(),n="div"===s||"span"===s,e.id||(this.uuid+=1,e.id="dp"+this.uuid),o=this._newInst(t(e),n),o.settings=t.extend({},i||{}),"input"===s?this._connectDatepicker(e,o):n&&this._inlineDatepicker(e,o)},_newInst:function(e,i){var n=e[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:n,input:e,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?s(t("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(e,i){var s=t(e);i.append=t([]),i.trigger=t([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),t.data(e,a,i),i.settings.disabled&&this._disableDatepicker(e))},_attachments:function(e,i){var s,n,o,a=this._get(i,"appendText"),r=this._get(i,"isRTL");i.append&&i.append.remove(),a&&(i.append=t("<span class='"+this._appendClass+"'>"+a+"</span>"),e[r?"before":"after"](i.append)),e.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),s=this._get(i,"showOn"),("focus"===s||"both"===s)&&e.focus(this._showDatepicker),("button"===s||"both"===s)&&(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=t(this._get(i,"buttonImageOnly")?t("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):t("<button type='button'></button>").addClass(this._triggerClass).html(o?t("<img/>").attr({src:o,alt:n,title:n}):n)),e[r?"before":"after"](i.trigger),i.trigger.click(function(){return t.datepicker._datepickerShowing&&t.datepicker._lastInput===e[0]?t.datepicker._hideDatepicker():t.datepicker._datepickerShowing&&t.datepicker._lastInput!==e[0]?(t.datepicker._hideDatepicker(),t.datepicker._showDatepicker(e[0])):t.datepicker._showDatepicker(e[0]),!1}))},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e,i,s,n,o=new Date(2009,11,20),a=this._get(t,"dateFormat");a.match(/[DM]/)&&(e=function(t){for(i=0,s=0,n=0;t.length>n;n++)t[n].length>i&&(i=t[n].length,s=n);return s},o.setMonth(e(this._get(t,a.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(e(this._get(t,a.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),t.input.attr("size",this._formatDate(t,o).length)}},_inlineDatepicker:function(e,i){var s=t(e);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),t.data(e,a,i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(e),i.dpDiv.css("display","block"))},_dialogDatepicker:function(e,i,s,o,r){var h,l,c,u,d,p=this._dialogInst;return p||(this.uuid+=1,h="dp"+this.uuid,this._dialogInput=t("<input type='text' id='"+h+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),t("body").append(this._dialogInput),p=this._dialogInst=this._newInst(this._dialogInput,!1),p.settings={},t.data(this._dialogInput[0],a,p)),n(p.settings,o||{}),i=i&&i.constructor===Date?this._formatDate(p,i):i,this._dialogInput.val(i),this._pos=r?r.length?r:[r.pageX,r.pageY]:null,this._pos||(l=document.documentElement.clientWidth,c=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[l/2-100+u,c/2-150+d]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),p.settings.onSelect=s,
this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),t.blockUI&&t.blockUI(this.dpDiv),t.data(this._dialogInput[0],a,p),this},_destroyDatepicker:function(e){var i,s=t(e),n=t.data(e,a);s.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),t.removeData(e,a),"input"===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&s.removeClass(this.markerClassName).empty())},_enableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,a);n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}))},_disableDatepicker:function(e){var i,s,n=t(e),o=t.data(e,a);n.hasClass(this.markerClassName)&&(i=e.nodeName.toLowerCase(),"input"===i?(e.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(s=n.children("."+this._inlineClass),s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=t.map(this._disabledInputs,function(t){return t===e?null:t}),this._disabledInputs[this._disabledInputs.length]=e)},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;this._disabledInputs.length>e;e++)if(this._disabledInputs[e]===t)return!0;return!1},_getInst:function(e){try{return t.data(e,a)}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(i,s,o){var a,r,h,l,c=this._getInst(i);return 2===arguments.length&&"string"==typeof s?"defaults"===s?t.extend({},t.datepicker._defaults):c?"all"===s?t.extend({},c.settings):this._get(c,s):null:(a=s||{},"string"==typeof s&&(a={},a[s]=o),c&&(this._curInst===c&&this._hideDatepicker(),r=this._getDateDatepicker(i,!0),h=this._getMinMaxDate(c,"min"),l=this._getMinMaxDate(c,"max"),n(c.settings,a),null!==h&&a.dateFormat!==e&&a.minDate===e&&(c.settings.minDate=this._formatDate(c,h)),null!==l&&a.dateFormat!==e&&a.maxDate===e&&(c.settings.maxDate=this._formatDate(c,l)),"disabled"in a&&(a.disabled?this._disableDatepicker(i):this._enableDatepicker(i)),this._attachments(t(i),c),this._autoSize(c),this._setDate(c,r),this._updateAlternate(c),this._updateDatepicker(c)),e)},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(e){var i,s,n,o=t.datepicker._getInst(e.target),a=!0,r=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,t.datepicker._datepickerShowing)switch(e.keyCode){case 9:t.datepicker._hideDatepicker(),a=!1;break;case 13:return n=t("td."+t.datepicker._dayOverClass+":not(."+t.datepicker._currentClass+")",o.dpDiv),n[0]&&t.datepicker._selectDay(e.target,o.selectedMonth,o.selectedYear,n[0]),i=t.datepicker._get(o,"onSelect"),i?(s=t.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[s,o])):t.datepicker._hideDatepicker(),!1;case 27:t.datepicker._hideDatepicker();break;case 33:t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 34:t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 35:(e.ctrlKey||e.metaKey)&&t.datepicker._clearDate(e.target),a=e.ctrlKey||e.metaKey;break;case 36:(e.ctrlKey||e.metaKey)&&t.datepicker._gotoToday(e.target),a=e.ctrlKey||e.metaKey;break;case 37:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?1:-1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?-t.datepicker._get(o,"stepBigMonths"):-t.datepicker._get(o,"stepMonths"),"M");break;case 38:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,-7,"D"),a=e.ctrlKey||e.metaKey;break;case 39:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,r?-1:1,"D"),a=e.ctrlKey||e.metaKey,e.originalEvent.altKey&&t.datepicker._adjustDate(e.target,e.ctrlKey?+t.datepicker._get(o,"stepBigMonths"):+t.datepicker._get(o,"stepMonths"),"M");break;case 40:(e.ctrlKey||e.metaKey)&&t.datepicker._adjustDate(e.target,7,"D"),a=e.ctrlKey||e.metaKey;break;default:a=!1}else 36===e.keyCode&&e.ctrlKey?t.datepicker._showDatepicker(this):a=!1;a&&(e.preventDefault(),e.stopPropagation())},_doKeyPress:function(i){var s,n,o=t.datepicker._getInst(i.target);return t.datepicker._get(o,"constrainInput")?(s=t.datepicker._possibleChars(t.datepicker._get(o,"dateFormat")),n=String.fromCharCode(null==i.charCode?i.keyCode:i.charCode),i.ctrlKey||i.metaKey||" ">n||!s||s.indexOf(n)>-1):e},_doKeyUp:function(e){var i,s=t.datepicker._getInst(e.target);if(s.input.val()!==s.lastVal)try{i=t.datepicker.parseDate(t.datepicker._get(s,"dateFormat"),s.input?s.input.val():null,t.datepicker._getFormatConfig(s)),i&&(t.datepicker._setDateFromField(s),t.datepicker._updateAlternate(s),t.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(e){if(e=e.target||e,"input"!==e.nodeName.toLowerCase()&&(e=t("input",e.parentNode)[0]),!t.datepicker._isDisabledDatepicker(e)&&t.datepicker._lastInput!==e){var i,s,o,a,r,h,l;i=t.datepicker._getInst(e),t.datepicker._curInst&&t.datepicker._curInst!==i&&(t.datepicker._curInst.dpDiv.stop(!0,!0),i&&t.datepicker._datepickerShowing&&t.datepicker._hideDatepicker(t.datepicker._curInst.input[0])),s=t.datepicker._get(i,"beforeShow"),o=s?s.apply(e,[e,i]):{},o!==!1&&(n(i.settings,o),i.lastVal=null,t.datepicker._lastInput=e,t.datepicker._setDateFromField(i),t.datepicker._inDialog&&(e.value=""),t.datepicker._pos||(t.datepicker._pos=t.datepicker._findPos(e),t.datepicker._pos[1]+=e.offsetHeight),a=!1,t(e).parents().each(function(){return a|="fixed"===t(this).css("position"),!a}),r={left:t.datepicker._pos[0],top:t.datepicker._pos[1]},t.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),t.datepicker._updateDatepicker(i),r=t.datepicker._checkOffset(i,r,a),i.dpDiv.css({position:t.datepicker._inDialog&&t.blockUI?"static":a?"fixed":"absolute",display:"none",left:r.left+"px",top:r.top+"px"}),i.inline||(h=t.datepicker._get(i,"showAnim"),l=t.datepicker._get(i,"duration"),i.dpDiv.zIndex(t(e).zIndex()+1),t.datepicker._datepickerShowing=!0,t.effects&&t.effects.effect[h]?i.dpDiv.show(h,t.datepicker._get(i,"showOptions"),l):i.dpDiv[h||"show"](h?l:null),t.datepicker._shouldFocusInput(i)&&i.input.focus(),t.datepicker._curInst=i))}},_updateDatepicker:function(e){this.maxRows=4,o=e,e.dpDiv.empty().append(this._generateHTML(e)),this._attachHandlers(e),e.dpDiv.find("."+this._dayOverClass+" a").mouseover();var i,s=this._getNumberOfMonths(e),n=s[1],a=17;e.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&e.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",a*n+"em"),e.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),e.dpDiv[(this._get(e,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),e===t.datepicker._curInst&&t.datepicker._datepickerShowing&&t.datepicker._shouldFocusInput(e)&&e.input.focus(),e.yearshtml&&(i=e.yearshtml,setTimeout(function(){i===e.yearshtml&&e.yearshtml&&e.dpDiv.find("select.ui-datepicker-year:first").replaceWith(e.yearshtml),i=e.yearshtml=null},0))},_shouldFocusInput:function(t){return t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&!t.input.is(":focus")},_checkOffset:function(e,i,s){var n=e.dpDiv.outerWidth(),o=e.dpDiv.outerHeight(),a=e.input?e.input.outerWidth():0,r=e.input?e.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:t(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:t(document).scrollTop());return i.left-=this._get(e,"isRTL")?n-a:0,i.left-=s&&i.left===e.input.offset().left?t(document).scrollLeft():0,i.top-=s&&i.top===e.input.offset().top+r?t(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>h&&h>n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+o>l&&l>o?Math.abs(o+r):0),i},_findPos:function(e){for(var i,s=this._getInst(e),n=this._get(s,"isRTL");e&&("hidden"===e.type||1!==e.nodeType||t.expr.filters.hidden(e));)e=e[n?"previousSibling":"nextSibling"];return i=t(e).offset(),[i.left,i.top]},_hideDatepicker:function(e){var i,s,n,o,r=this._curInst;!r||e&&r!==t.data(e,a)||this._datepickerShowing&&(i=this._get(r,"showAnim"),s=this._get(r,"duration"),n=function(){t.datepicker._tidyDialog(r)},t.effects&&(t.effects.effect[i]||t.effects[i])?r.dpDiv.hide(i,t.datepicker._get(r,"showOptions"),s,n):r.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?s:null,n),i||n(),this._datepickerShowing=!1,o=this._get(r,"onClose"),o&&o.apply(r.input?r.input[0]:null,[r.input?r.input.val():"",r]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),t.blockUI&&(t.unblockUI(),t("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(e){if(t.datepicker._curInst){var i=t(e.target),s=t.datepicker._getInst(i[0]);(i[0].id!==t.datepicker._mainDivId&&0===i.parents("#"+t.datepicker._mainDivId).length&&!i.hasClass(t.datepicker.markerClassName)&&!i.closest("."+t.datepicker._triggerClass).length&&t.datepicker._datepickerShowing&&(!t.datepicker._inDialog||!t.blockUI)||i.hasClass(t.datepicker.markerClassName)&&t.datepicker._curInst!==s)&&t.datepicker._hideDatepicker()}},_adjustDate:function(e,i,s){var n=t(e),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===s?this._get(o,"showCurrentAtPos"):0),s),this._updateDatepicker(o))},_gotoToday:function(e){var i,s=t(e),n=this._getInst(s[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(e,i,s){var n=t(e),o=this._getInst(n[0]);o["selected"+("M"===s?"Month":"Year")]=o["draw"+("M"===s?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(e,i,s,n){var o,a=t(e);t(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(a[0])||(o=this._getInst(a[0]),o.selectedDay=o.currentDay=t("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=s,this._selectDate(e,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(e){var i=t(e);this._selectDate(i,"")},_selectDate:function(e,i){var s,n=t(e),o=this._getInst(n[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),s=this._get(o,"onSelect"),s?s.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.focus(),this._lastInput=null)},_updateAlternate:function(e){var i,s,n,o=this._get(e,"altField");o&&(i=this._get(e,"altFormat")||this._get(e,"dateFormat"),s=this._getDate(e),n=this.formatDate(i,s,this._getFormatConfig(e)),t(o).each(function(){t(this).val(n)}))},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e,i=new Date(t.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),e=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((e-i)/864e5)/7)+1},parseDate:function(i,s,n){if(null==i||null==s)throw"Invalid arguments";if(s="object"==typeof s?""+s:s+"",""===s)return null;var o,a,r,h,l=0,c=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff,u="string"!=typeof c?c:(new Date).getFullYear()%100+parseInt(c,10),d=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,p=(n?n.dayNames:null)||this._defaults.dayNames,f=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,g=(n?n.monthNames:null)||this._defaults.monthNames,m=-1,v=-1,_=-1,b=-1,y=!1,w=function(t){var e=i.length>o+1&&i.charAt(o+1)===t;return e&&o++,e},k=function(t){var e=w(t),i="@"===t?14:"!"===t?20:"y"===t&&e?4:"o"===t?3:2,n=RegExp("^\\d{1,"+i+"}"),o=s.substring(l).match(n);if(!o)throw"Missing number at position "+l;return l+=o[0].length,parseInt(o[0],10)},x=function(i,n,o){var a=-1,r=t.map(w(i)?o:n,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)});if(t.each(r,function(t,i){var n=i[1];return s.substr(l,n.length).toLowerCase()===n.toLowerCase()?(a=i[0],l+=n.length,!1):e}),-1!==a)return a+1;throw"Unknown name at position "+l},D=function(){if(s.charAt(l)!==i.charAt(o))throw"Unexpected literal at position "+l;l++};for(o=0;i.length>o;o++)if(y)"'"!==i.charAt(o)||w("'")?D():y=!1;else switch(i.charAt(o)){case"d":_=k("d");break;case"D":x("D",d,p);break;case"o":b=k("o");break;case"m":v=k("m");break;case"M":v=x("M",f,g);break;case"y":m=k("y");break;case"@":h=new Date(k("@")),m=h.getFullYear(),v=h.getMonth()+1,_=h.getDate();break;case"!":h=new Date((k("!")-this._ticksTo1970)/1e4),m=h.getFullYear(),v=h.getMonth()+1,_=h.getDate();break;case"'":w("'")?D():y=!0;break;default:D()}if(s.length>l&&(r=s.substr(l),!/^\s+/.test(r)))throw"Extra/unparsed characters found in date: "+r;if(-1===m?m=(new Date).getFullYear():100>m&&(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u>=m?0:-100)),b>-1)for(v=1,_=b;;){if(a=this._getDaysInMonth(m,v-1),a>=_)break;v++,_-=a}if(h=this._daylightSavingAdjust(new Date(m,v-1,_)),h.getFullYear()!==m||h.getMonth()+1!==v||h.getDate()!==_)throw"Invalid date";return h},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(t,e,i){if(!e)return"";var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,a=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(e){var i=t.length>s+1&&t.charAt(s+1)===e;return i&&s++,i},l=function(t,e,i){var s=""+e;if(h(t))for(;i>s.length;)s="0"+s;return s},c=function(t,e,i,s){return h(t)?s[e]:i[e]},u="",d=!1;if(e)for(s=0;t.length>s;s++)if(d)"'"!==t.charAt(s)||h("'")?u+=t.charAt(s):d=!1;else switch(t.charAt(s)){case"d":u+=l("d",e.getDate(),2);break;case"D":u+=c("D",e.getDay(),n,o);break;case"o":u+=l("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=l("m",e.getMonth()+1,2);break;case"M":u+=c("M",e.getMonth(),a,r);break;case"y":u+=h("y")?e.getFullYear():(10>e.getYear()%100?"0":"")+e.getYear()%100;break;case"@":u+=e.getTime();break;case"!":u+=1e4*e.getTime()+this._ticksTo1970;break;case"'":h("'")?u+="'":d=!0;break;default:u+=t.charAt(s)}return u},_possibleChars:function(t){var e,i="",s=!1,n=function(i){var s=t.length>e+1&&t.charAt(e+1)===i;return s&&e++,s};for(e=0;t.length>e;e++)if(s)"'"!==t.charAt(e)||n("'")?i+=t.charAt(e):s=!1;else switch(t.charAt(e)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":s=!0;break;default:i+=t.charAt(e)}return i},_get:function(t,i){return t.settings[i]!==e?t.settings[i]:this._defaults[i]},_setDateFromField:function(t,e){if(t.input.val()!==t.lastVal){var i=this._get(t,"dateFormat"),s=t.lastVal=t.input?t.input.val():null,n=this._getDefaultDate(t),o=n,a=this._getFormatConfig(t);try{o=this.parseDate(i,s,a)||n}catch(r){s=e?"":s}t.selectedDay=o.getDate(),t.drawMonth=t.selectedMonth=o.getMonth(),t.drawYear=t.selectedYear=o.getFullYear(),t.currentDay=s?o.getDate():0,t.currentMonth=s?o.getMonth():0,t.currentYear=s?o.getFullYear():0,this._adjustInstDate(t)}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(e,i,s){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},o=function(i){try{return t.datepicker.parseDate(t.datepicker._get(e,"dateFormat"),i,t.datepicker._getFormatConfig(e))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?t.datepicker._getDate(e):null)||new Date,o=n.getFullYear(),a=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":a+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a));break;case"y":case"Y":o+=parseInt(l[1],10),r=Math.min(r,t.datepicker._getDaysInMonth(o,a))}l=h.exec(i)}return new Date(o,a,r)},a=null==i||""===i?s:"string"==typeof i?o(i):"number"==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return a=a&&"Invalid Date"==""+a?s:a,a&&(a.setHours(0),a.setMinutes(0),a.setSeconds(0),a.setMilliseconds(0)),this._daylightSavingAdjust(a)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var s=!e,n=t.selectedMonth,o=t.selectedYear,a=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=a.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=a.getMonth(),t.drawYear=t.selectedYear=t.currentYear=a.getFullYear(),n===t.selectedMonth&&o===t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(s?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""===t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_attachHandlers:function(e){var i=this._get(e,"stepMonths"),s="#"+e.id.replace(/\\\\/g,"\\");e.dpDiv.find("[data-handler]").map(function(){var e={prev:function(){t.datepicker._adjustDate(s,-i,"M")},next:function(){t.datepicker._adjustDate(s,+i,"M")},hide:function(){t.datepicker._hideDatepicker()},today:function(){t.datepicker._gotoToday(s)},selectDay:function(){return t.datepicker._selectDay(s,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return t.datepicker._selectMonthYear(s,this,"M"),!1},selectYear:function(){return t.datepicker._selectMonthYear(s,this,"Y"),!1}};t(this).bind(this.getAttribute("data-event"),e[this.getAttribute("data-handler")])})},_generateHTML:function(t){var e,i,s,n,o,a,r,h,l,c,u,d,p,f,g,m,v,_,b,y,w,k,x,D,C,I,P,T,M,S,z,A,H,E,N,W,O,F,R,L=new Date,j=this._daylightSavingAdjust(new Date(L.getFullYear(),L.getMonth(),L.getDate())),Y=this._get(t,"isRTL"),B=this._get(t,"showButtonPanel"),V=this._get(t,"hideIfNoPrevNext"),K=this._get(t,"navigationAsDateFormat"),U=this._getNumberOfMonths(t),q=this._get(t,"showCurrentAtPos"),Q=this._get(t,"stepMonths"),X=1!==U[0]||1!==U[1],$=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),G=this._getMinMaxDate(t,"min"),J=this._getMinMaxDate(t,"max"),Z=t.drawMonth-q,te=t.drawYear;if(0>Z&&(Z+=12,te--),J)for(e=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-U[0]*U[1]+1,J.getDate())),e=G&&G>e?G:e;this._daylightSavingAdjust(new Date(te,Z,1))>e;)Z--,0>Z&&(Z=11,te--);for(t.drawMonth=Z,t.drawYear=te,i=this._get(t,"prevText"),i=K?this.formatDate(i,this._daylightSavingAdjust(new Date(te,Z-Q,1)),this._getFormatConfig(t)):i,s=this._canAdjustMonth(t,-1,te,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>":V?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"e":"w")+"'>"+i+"</span></a>",n=this._get(t,"nextText"),n=K?this.formatDate(n,this._daylightSavingAdjust(new Date(te,Z+Q,1)),this._getFormatConfig(t)):n,o=this._canAdjustMonth(t,1,te,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>":V?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(Y?"w":"e")+"'>"+n+"</span></a>",a=this._get(t,"currentText"),r=this._get(t,"gotoCurrent")&&t.currentDay?$:j,a=K?this.formatDate(a,r,this._getFormatConfig(t)):a,h=t.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(t,"closeText")+"</button>",l=B?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(Y?h:"")+(this._isInRange(t,r)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+a+"</button>":"")+(Y?"":h)+"</div>":"",c=parseInt(this._get(t,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(t,"showWeek"),d=this._get(t,"dayNames"),p=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),g=this._get(t,"monthNamesShort"),m=this._get(t,"beforeShowDay"),v=this._get(t,"showOtherMonths"),_=this._get(t,"selectOtherMonths"),b=this._getDefaultDate(t),y="",k=0;U[0]>k;k++){for(x="",this.maxRows=4,D=0;U[1]>D;D++){if(C=this._daylightSavingAdjust(new Date(te,Z,t.selectedDay)),I=" ui-corner-all",P="",X){if(P+="<div class='ui-datepicker-group",U[1]>1)switch(D){case 0:P+=" ui-datepicker-group-first",I=" ui-corner-"+(Y?"right":"left");break;case U[1]-1:P+=" ui-datepicker-group-last",I=" ui-corner-"+(Y?"left":"right");break;default:P+=" ui-datepicker-group-middle",I=""}P+="'>"}for(P+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+I+"'>"+(/all|left/.test(I)&&0===k?Y?o:s:"")+(/all|right/.test(I)&&0===k?Y?s:o:"")+this._generateMonthYearHeader(t,Z,te,G,J,k>0||D>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",T=u?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",w=0;7>w;w++)M=(w+c)%7,T+="<th"+((w+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+d[M]+"'>"+p[M]+"</span></th>";for(P+=T+"</tr></thead><tbody>",S=this._getDaysInMonth(te,Z),te===t.selectedYear&&Z===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,S)),z=(this._getFirstDayOfMonth(te,Z)-c+7)%7,A=Math.ceil((z+S)/7),H=X?this.maxRows>A?this.maxRows:A:A,this.maxRows=H,E=this._daylightSavingAdjust(new Date(te,Z,1-z)),N=0;H>N;N++){for(P+="<tr>",W=u?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(E)+"</td>":"",w=0;7>w;w++)O=m?m.apply(t.input?t.input[0]:null,[E]):[!0,""],F=E.getMonth()!==Z,R=F&&!_||!O[0]||G&&G>E||J&&E>J,W+="<td class='"+((w+c+6)%7>=5?" ui-datepicker-week-end":"")+(F?" ui-datepicker-other-month":"")+(E.getTime()===C.getTime()&&Z===t.selectedMonth&&t._keyEvent||b.getTime()===E.getTime()&&b.getTime()===C.getTime()?" "+this._dayOverClass:"")+(R?" "+this._unselectableClass+" ui-state-disabled":"")+(F&&!v?"":" "+O[1]+(E.getTime()===$.getTime()?" "+this._currentClass:"")+(E.getTime()===j.getTime()?" ui-datepicker-today":""))+"'"+(F&&!v||!O[2]?"":" title='"+O[2].replace(/'/g,"&#39;")+"'")+(R?"":" data-handler='selectDay' data-event='click' data-month='"+E.getMonth()+"' data-year='"+E.getFullYear()+"'")+">"+(F&&!v?"&#xa0;":R?"<span class='ui-state-default'>"+E.getDate()+"</span>":"<a class='ui-state-default"+(E.getTime()===j.getTime()?" ui-state-highlight":"")+(E.getTime()===$.getTime()?" ui-state-active":"")+(F?" ui-priority-secondary":"")+"' href='#'>"+E.getDate()+"</a>")+"</td>",E.setDate(E.getDate()+1),E=this._daylightSavingAdjust(E);P+=W+"</tr>"}Z++,Z>11&&(Z=0,te++),P+="</tbody></table>"+(X?"</div>"+(U[0]>0&&D===U[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),x+=P}y+=x}return y+=l,t._keyEvent=!1,y},_generateMonthYearHeader:function(t,e,i,s,n,o,a,r){var h,l,c,u,d,p,f,g,m=this._get(t,"changeMonth"),v=this._get(t,"changeYear"),_=this._get(t,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",y="";if(o||!m)y+="<span class='ui-datepicker-month'>"+a[e]+"</span>";else{for(h=s&&s.getFullYear()===i,l=n&&n.getFullYear()===i,y+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;12>c;c++)(!h||c>=s.getMonth())&&(!l||n.getMonth()>=c)&&(y+="<option value='"+c+"'"+(c===e?" selected='selected'":"")+">"+r[c]+"</option>");y+="</select>"}if(_||(b+=y+(!o&&m&&v?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(t,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(t){var e=t.match(/c[+\-].*/)?i+parseInt(t.substring(1),10):t.match(/[+\-].*/)?d+parseInt(t,10):parseInt(t,10);return isNaN(e)?d:e},f=p(u[0]),g=Math.max(f,p(u[1]||"")),f=s?Math.max(f,s.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,t.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)t.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";t.yearshtml+="</select>",b+=t.yearshtml,t.yearshtml=null}return b+=this._get(t,"yearSuffix"),_&&(b+=(!o&&m&&v?"":"&#xa0;")+y),b+="</div>"},_adjustInstDate:function(t,e,i){var s=t.drawYear+("Y"===i?e:0),n=t.drawMonth+("M"===i?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(s,n))+("D"===i?e:0),a=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(s,n,o)));t.selectedDay=a.getDate(),t.drawMonth=t.selectedMonth=a.getMonth(),t.drawYear=t.selectedYear=a.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),s=this._getMinMaxDate(t,"max"),n=i&&i>e?i:e;return s&&n>s?s:n},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,s){var n=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(i,s+(0>e?e:n[0]*n[1]),1));return 0>e&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var i,s,n=this._getMinMaxDate(t,"min"),o=this._getMinMaxDate(t,"max"),a=null,r=null,h=this._get(t,"yearRange");return h&&(i=h.split(":"),s=(new Date).getFullYear(),a=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(a+=s),i[1].match(/[+\-].*/)&&(r+=s)),(!n||e.getTime()>=n.getTime())&&(!o||e.getTime()<=o.getTime())&&(!a||e.getFullYear()>=a)&&(!r||r>=e.getFullYear())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,s){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var n=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(s,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),n,this._getFormatConfig(t))}}),t.fn.datepicker=function(e){if(!this.length)return this;t.datepicker.initialized||(t(document).mousedown(t.datepicker._checkExternalClick),t.datepicker.initialized=!0),0===t("#"+t.datepicker._mainDivId).length&&t("body").append(t.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof e||"isDisabled"!==e&&"getDate"!==e&&"widget"!==e?"option"===e&&2===arguments.length&&"string"==typeof arguments[1]?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof e?t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this].concat(i)):t.datepicker._attachDatepicker(this,e)}):t.datepicker["_"+e+"Datepicker"].apply(t.datepicker,[this[0]].concat(i))},t.datepicker=new i,t.datepicker.initialized=!1,t.datepicker.uuid=(new Date).getTime(),t.datepicker.version="1.10.3"}(jQuery),function(t){var e={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},i={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};t.widget("ui.dialog",{version:"1.10.3",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&t.fn.draggable&&this._makeDraggable(),this.options.resizable&&t.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var e=this.options.appendTo;return e&&(e.jquery||e.nodeType)?t(e):this.document.find(e||"body").eq(0)},_destroy:function(){var t,e=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),t=e.parent.children().eq(e.index),t.length&&t[0]!==this.element[0]?t.before(this.element):e.parent.append(this.element)},widget:function(){return this.uiDialog},disable:t.noop,enable:t.noop,close:function(e){var i=this;this._isOpen&&this._trigger("beforeClose",e)!==!1&&(this._isOpen=!1,this._destroyOverlay(),this.opener.filter(":focusable").focus().length||t(this.document[0].activeElement).blur(),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",e)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,e){var i=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return i&&!e&&this._trigger("focus",t),i},open:function(){var e=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),undefined):(this._isOpen=!0,this.opener=t(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){e._focusTabbable(),e._trigger("focus");
}),this._trigger("open"),undefined)},_focusTabbable:function(){var t=this.element.find("[autofocus]");t.length||(t=this.element.find(":tabbable")),t.length||(t=this.uiDialogButtonPane.find(":tabbable")),t.length||(t=this.uiDialogTitlebarClose.filter(":tabbable")),t.length||(t=this.uiDialog),t.eq(0).focus()},_keepFocus:function(e){function i(){var e=this.document[0].activeElement,i=this.uiDialog[0]===e||t.contains(this.uiDialog[0],e);i||this._focusTabbable()}e.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=t("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(e){if(this.options.closeOnEscape&&!e.isDefaultPrevented()&&e.keyCode&&e.keyCode===t.ui.keyCode.ESCAPE)return e.preventDefault(),this.close(e),undefined;if(e.keyCode===t.ui.keyCode.TAB){var i=this.uiDialog.find(":tabbable"),s=i.filter(":first"),n=i.filter(":last");e.target!==n[0]&&e.target!==this.uiDialog[0]||e.shiftKey?e.target!==s[0]&&e.target!==this.uiDialog[0]||!e.shiftKey||(n.focus(1),e.preventDefault()):(s.focus(1),e.preventDefault())}},mousedown:function(t){this._moveToTop(t)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var e;this.uiDialogTitlebar=t("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(e){t(e.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=t("<button></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(t){t.preventDefault(),this.close(t)}}),e=t("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(e),this.uiDialog.attr({"aria-labelledby":e.attr("id")})},_title:function(t){this.options.title||t.html("&#160;"),t.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=t("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=t("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var e=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),t.isEmptyObject(i)||t.isArray(i)&&!i.length?(this.uiDialog.removeClass("ui-dialog-buttons"),undefined):(t.each(i,function(i,s){var n,o;s=t.isFunction(s)?{click:s,text:i}:s,s=t.extend({type:"button"},s),n=s.click,s.click=function(){n.apply(e.element[0],arguments)},o={icons:s.icons,text:s.showText},delete s.icons,delete s.showText,t("<button></button>",s).button(o).appendTo(e.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),undefined)},_makeDraggable:function(){function e(t){return{position:t.position,offset:t.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(s,n){t(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",s,e(n))},drag:function(t,s){i._trigger("drag",t,e(s))},stop:function(n,o){s.position=[o.position.left-i.document.scrollLeft(),o.position.top-i.document.scrollTop()],t(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,e(o))}})},_makeResizable:function(){function e(t){return{originalPosition:t.originalPosition,originalSize:t.originalSize,position:t.position,size:t.size}}var i=this,s=this.options,n=s.resizable,o=this.uiDialog.css("position"),a="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:a,start:function(s,n){t(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",s,e(n))},resize:function(t,s){i._trigger("resize",t,e(s))},stop:function(n,o){s.height=t(this).height(),s.width=t(this).width(),t(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,e(o))}}).css("position",o)},_minHeight:function(){var t=this.options;return"auto"===t.height?t.minHeight:Math.min(t.minHeight,t.height)},_position:function(){var t=this.uiDialog.is(":visible");t||this.uiDialog.show(),this.uiDialog.position(this.options.position),t||this.uiDialog.hide()},_setOptions:function(s){var n=this,o=!1,a={};t.each(s,function(t,s){n._setOption(t,s),t in e&&(o=!0),t in i&&(a[t]=s)}),o&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",a)},_setOption:function(t,e){var i,s,n=this.uiDialog;"dialogClass"===t&&n.removeClass(this.options.dialogClass).addClass(e),"disabled"!==t&&(this._super(t,e),"appendTo"===t&&this.uiDialog.appendTo(this._appendTo()),"buttons"===t&&this._createButtons(),"closeText"===t&&this.uiDialogTitlebarClose.button({label:""+e}),"draggable"===t&&(i=n.is(":data(ui-draggable)"),i&&!e&&n.draggable("destroy"),!i&&e&&this._makeDraggable()),"position"===t&&this._position(),"resizable"===t&&(s=n.is(":data(ui-resizable)"),s&&!e&&n.resizable("destroy"),s&&"string"==typeof e&&n.resizable("option","handles",e),s||e===!1||this._makeResizable()),"title"===t&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var t,e,i,s=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),s.minWidth>s.width&&(s.width=s.minWidth),t=this.uiDialog.css({height:"auto",width:s.width}).outerHeight(),e=Math.max(0,s.minHeight-t),i="number"==typeof s.maxHeight?Math.max(0,s.maxHeight-t):"none","auto"===s.height?this.element.css({minHeight:e,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,s.height-t)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var e=t(this);return t("<div>").css({position:"absolute",width:e.outerWidth(),height:e.outerHeight()}).appendTo(e.parent()).offset(e.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(e){return t(e.target).closest(".ui-dialog").length?!0:!!t(e.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var e=this,i=this.widgetFullName;t.ui.dialog.overlayInstances||this._delay(function(){t.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(s){e._allowInteraction(s)||(s.preventDefault(),t(".ui-dialog:visible:last .ui-dialog-content").data(i)._focusTabbable())})}),this.overlay=t("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),t.ui.dialog.overlayInstances++}},_destroyOverlay:function(){this.options.modal&&this.overlay&&(t.ui.dialog.overlayInstances--,t.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),t.ui.dialog.overlayInstances=0,t.uiBackCompat!==!1&&t.widget("ui.dialog",t.ui.dialog,{_position:function(){var e,i=this.options.position,s=[],n=[0,0];i?(("string"==typeof i||"object"==typeof i&&"0"in i)&&(s=i.split?i.split(" "):[i[0],i[1]],1===s.length&&(s[1]=s[0]),t.each(["left","top"],function(t,e){+s[t]===s[t]&&(n[t]=s[t],s[t]=e)}),i={my:s[0]+(0>n[0]?n[0]:"+"+n[0])+" "+s[1]+(0>n[1]?n[1]:"+"+n[1]),at:s.join(" ")}),i=t.extend({},t.ui.dialog.prototype.options.position,i)):i=t.ui.dialog.prototype.options.position,e=this.uiDialog.is(":visible"),e||this.uiDialog.show(),this.uiDialog.position(i),e||this.uiDialog.hide()}})}(jQuery),function(t){var e=/up|down|vertical/,i=/up|left|vertical|horizontal/;t.effects.effect.blind=function(s,n){var o,a,r,h=t(this),l=["position","top","bottom","left","right","height","width"],c=t.effects.setMode(h,s.mode||"hide"),u=s.direction||"up",d=e.test(u),p=d?"height":"width",f=d?"top":"left",g=i.test(u),m={},v="show"===c;h.parent().is(".ui-effects-wrapper")?t.effects.save(h.parent(),l):t.effects.save(h,l),h.show(),o=t.effects.createWrapper(h).css({overflow:"hidden"}),a=o[p](),r=parseFloat(o.css(f))||0,m[p]=v?a:0,g||(h.css(d?"bottom":"right",0).css(d?"top":"left","auto").css({position:"absolute"}),m[f]=v?r:a+r),v&&(o.css(p,0),g||o.css(f,r+a)),o.animate(m,{duration:s.duration,easing:s.easing,queue:!1,complete:function(){"hide"===c&&h.hide(),t.effects.restore(h,l),t.effects.removeWrapper(h),n()}})}}(jQuery),function(t){t.effects.effect.bounce=function(e,i){var s,n,o,a=t(this),r=["position","top","bottom","left","right","height","width"],h=t.effects.setMode(a,e.mode||"effect"),l="hide"===h,c="show"===h,u=e.direction||"up",d=e.distance,p=e.times||5,f=2*p+(c||l?1:0),g=e.duration/f,m=e.easing,v="up"===u||"down"===u?"top":"left",_="up"===u||"left"===u,b=a.queue(),y=b.length;for((c||l)&&r.push("opacity"),t.effects.save(a,r),a.show(),t.effects.createWrapper(a),d||(d=a["top"===v?"outerHeight":"outerWidth"]()/3),c&&(o={opacity:1},o[v]=0,a.css("opacity",0).css(v,_?2*-d:2*d).animate(o,g,m)),l&&(d/=Math.pow(2,p-1)),o={},o[v]=0,s=0;p>s;s++)n={},n[v]=(_?"-=":"+=")+d,a.animate(n,g,m).animate(o,g,m),d=l?2*d:d/2;l&&(n={opacity:0},n[v]=(_?"-=":"+=")+d,a.animate(n,g,m)),a.queue(function(){l&&a.hide(),t.effects.restore(a,r),t.effects.removeWrapper(a),i()}),y>1&&b.splice.apply(b,[1,0].concat(b.splice(y,f+1))),a.dequeue()}}(jQuery),function(t){t.effects.effect.clip=function(e,i){var s,n,o,a=t(this),r=["position","top","bottom","left","right","height","width"],h=t.effects.setMode(a,e.mode||"hide"),l="show"===h,c=e.direction||"vertical",u="vertical"===c,d=u?"height":"width",p=u?"top":"left",f={};t.effects.save(a,r),a.show(),s=t.effects.createWrapper(a).css({overflow:"hidden"}),n="IMG"===a[0].tagName?s:a,o=n[d](),l&&(n.css(d,0),n.css(p,o/2)),f[d]=l?o:0,f[p]=l?0:o/2,n.animate(f,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){l||a.hide(),t.effects.restore(a,r),t.effects.removeWrapper(a),i()}})}}(jQuery),function(t){t.effects.effect.drop=function(e,i){var s,n=t(this),o=["position","top","bottom","left","right","opacity","height","width"],a=t.effects.setMode(n,e.mode||"hide"),r="show"===a,h=e.direction||"left",l="up"===h||"down"===h?"top":"left",c="up"===h||"left"===h?"pos":"neg",u={opacity:r?1:0};t.effects.save(n,o),n.show(),t.effects.createWrapper(n),s=e.distance||n["top"===l?"outerHeight":"outerWidth"](!0)/2,r&&n.css("opacity",0).css(l,"pos"===c?-s:s),u[l]=(r?"pos"===c?"+=":"-=":"pos"===c?"-=":"+=")+s,n.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===a&&n.hide(),t.effects.restore(n,o),t.effects.removeWrapper(n),i()}})}}(jQuery),function(t){t.effects.effect.explode=function(e,i){function s(){b.push(this),b.length===u*d&&n()}function n(){p.css({visibility:"visible"}),t(b).remove(),g||p.hide(),i()}var o,a,r,h,l,c,u=e.pieces?Math.round(Math.sqrt(e.pieces)):3,d=u,p=t(this),f=t.effects.setMode(p,e.mode||"hide"),g="show"===f,m=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/d),_=Math.ceil(p.outerHeight()/u),b=[];for(o=0;u>o;o++)for(h=m.top+o*_,c=o-(u-1)/2,a=0;d>a;a++)r=m.left+a*v,l=a-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-a*v,top:-o*_}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:_,left:r+(g?l*v:0),top:h+(g?c*_:0),opacity:g?0:1}).animate({left:r+(g?0:l*v),top:h+(g?0:c*_),opacity:g?1:0},e.duration||500,e.easing,s)}}(jQuery),function(t){t.effects.effect.fade=function(e,i){var s=t(this),n=t.effects.setMode(s,e.mode||"toggle");s.animate({opacity:n},{queue:!1,duration:e.duration,easing:e.easing,complete:i})}}(jQuery),function(t){t.effects.effect.fold=function(e,i){var s,n,o=t(this),a=["position","top","bottom","left","right","height","width"],r=t.effects.setMode(o,e.mode||"hide"),h="show"===r,l="hide"===r,c=e.size||15,u=/([0-9]+)%/.exec(c),d=!!e.horizFirst,p=h!==d,f=p?["width","height"]:["height","width"],g=e.duration/2,m={},v={};t.effects.save(o,a),o.show(),s=t.effects.createWrapper(o).css({overflow:"hidden"}),n=p?[s.width(),s.height()]:[s.height(),s.width()],u&&(c=parseInt(u[1],10)/100*n[l?0:1]),h&&s.css(d?{height:0,width:c}:{height:c,width:0}),m[f[0]]=h?n[0]:c,v[f[1]]=h?n[1]:0,s.animate(m,g,e.easing).animate(v,g,e.easing,function(){l&&o.hide(),t.effects.restore(o,a),t.effects.removeWrapper(o),i()})}}(jQuery),function(t){t.effects.effect.highlight=function(e,i){var s=t(this),n=["backgroundImage","backgroundColor","opacity"],o=t.effects.setMode(s,e.mode||"show"),a={backgroundColor:s.css("backgroundColor")};"hide"===o&&(a.opacity=0),t.effects.save(s,n),s.show().css({backgroundImage:"none",backgroundColor:e.color||"#ffff99"}).animate(a,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===o&&s.hide(),t.effects.restore(s,n),i()}})}}(jQuery),function(t){t.effects.effect.pulsate=function(e,i){var s,n=t(this),o=t.effects.setMode(n,e.mode||"show"),a="show"===o,r="hide"===o,h=a||"hide"===o,l=2*(e.times||5)+(h?1:0),c=e.duration/l,u=0,d=n.queue(),p=d.length;for((a||!n.is(":visible"))&&(n.css("opacity",0).show(),u=1),s=1;l>s;s++)n.animate({opacity:u},c,e.easing),u=1-u;n.animate({opacity:u},c,e.easing),n.queue(function(){r&&n.hide(),i()}),p>1&&d.splice.apply(d,[1,0].concat(d.splice(p,l+1))),n.dequeue()}}(jQuery),function(t){t.effects.effect.puff=function(e,i){var s=t(this),n=t.effects.setMode(s,e.mode||"hide"),o="hide"===n,a=parseInt(e.percent,10)||150,r=a/100,h={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()};t.extend(e,{effect:"scale",queue:!1,fade:!0,mode:n,complete:i,percent:o?a:100,from:o?h:{height:h.height*r,width:h.width*r,outerHeight:h.outerHeight*r,outerWidth:h.outerWidth*r}}),s.effect(e)},t.effects.effect.scale=function(e,i){var s=t(this),n=t.extend(!0,{},e),o=t.effects.setMode(s,e.mode||"effect"),a=parseInt(e.percent,10)||(0===parseInt(e.percent,10)?0:"hide"===o?0:100),r=e.direction||"both",h=e.origin,l={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},c={y:"horizontal"!==r?a/100:1,x:"vertical"!==r?a/100:1};n.effect="size",n.queue=!1,n.complete=i,"effect"!==o&&(n.origin=h||["middle","center"],n.restore=!0),n.from=e.from||("show"===o?{height:0,width:0,outerHeight:0,outerWidth:0}:l),n.to={height:l.height*c.y,width:l.width*c.x,outerHeight:l.outerHeight*c.y,outerWidth:l.outerWidth*c.x},n.fade&&("show"===o&&(n.from.opacity=0,n.to.opacity=1),"hide"===o&&(n.from.opacity=1,n.to.opacity=0)),s.effect(n)},t.effects.effect.size=function(e,i){var s,n,o,a=t(this),r=["position","top","bottom","left","right","width","height","overflow","opacity"],h=["position","top","bottom","left","right","overflow","opacity"],l=["width","height","overflow"],c=["fontSize"],u=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],d=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=t.effects.setMode(a,e.mode||"effect"),f=e.restore||"effect"!==p,g=e.scale||"both",m=e.origin||["middle","center"],v=a.css("position"),_=f?r:h,b={height:0,width:0,outerHeight:0,outerWidth:0};"show"===p&&a.show(),s={height:a.height(),width:a.width(),outerHeight:a.outerHeight(),outerWidth:a.outerWidth()},"toggle"===e.mode&&"show"===p?(a.from=e.to||b,a.to=e.from||s):(a.from=e.from||("show"===p?b:s),a.to=e.to||("hide"===p?b:s)),o={from:{y:a.from.height/s.height,x:a.from.width/s.width},to:{y:a.to.height/s.height,x:a.to.width/s.width}},("box"===g||"both"===g)&&(o.from.y!==o.to.y&&(_=_.concat(u),a.from=t.effects.setTransition(a,u,o.from.y,a.from),a.to=t.effects.setTransition(a,u,o.to.y,a.to)),o.from.x!==o.to.x&&(_=_.concat(d),a.from=t.effects.setTransition(a,d,o.from.x,a.from),a.to=t.effects.setTransition(a,d,o.to.x,a.to))),("content"===g||"both"===g)&&o.from.y!==o.to.y&&(_=_.concat(c).concat(l),a.from=t.effects.setTransition(a,c,o.from.y,a.from),a.to=t.effects.setTransition(a,c,o.to.y,a.to)),t.effects.save(a,_),a.show(),t.effects.createWrapper(a),a.css("overflow","hidden").css(a.from),m&&(n=t.effects.getBaseline(m,s),a.from.top=(s.outerHeight-a.outerHeight())*n.y,a.from.left=(s.outerWidth-a.outerWidth())*n.x,a.to.top=(s.outerHeight-a.to.outerHeight)*n.y,a.to.left=(s.outerWidth-a.to.outerWidth)*n.x),a.css(a.from),("content"===g||"both"===g)&&(u=u.concat(["marginTop","marginBottom"]).concat(c),d=d.concat(["marginLeft","marginRight"]),l=r.concat(u).concat(d),a.find("*[width]").each(function(){var i=t(this),s={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};f&&t.effects.save(i,l),i.from={height:s.height*o.from.y,width:s.width*o.from.x,outerHeight:s.outerHeight*o.from.y,outerWidth:s.outerWidth*o.from.x},i.to={height:s.height*o.to.y,width:s.width*o.to.x,outerHeight:s.height*o.to.y,outerWidth:s.width*o.to.x},o.from.y!==o.to.y&&(i.from=t.effects.setTransition(i,u,o.from.y,i.from),i.to=t.effects.setTransition(i,u,o.to.y,i.to)),o.from.x!==o.to.x&&(i.from=t.effects.setTransition(i,d,o.from.x,i.from),i.to=t.effects.setTransition(i,d,o.to.x,i.to)),i.css(i.from),i.animate(i.to,e.duration,e.easing,function(){f&&t.effects.restore(i,l)})})),a.animate(a.to,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){0===a.to.opacity&&a.css("opacity",a.from.opacity),"hide"===p&&a.hide(),t.effects.restore(a,_),f||("static"===v?a.css({position:"relative",top:a.to.top,left:a.to.left}):t.each(["top","left"],function(t,e){a.css(e,function(e,i){var s=parseInt(i,10),n=t?a.to.left:a.to.top;return"auto"===i?n+"px":s+n+"px"})})),t.effects.removeWrapper(a),i()}})}}(jQuery),function(t){t.effects.effect.shake=function(e,i){var s,n=t(this),o=["position","top","bottom","left","right","height","width"],a=t.effects.setMode(n,e.mode||"effect"),r=e.direction||"left",h=e.distance||20,l=e.times||3,c=2*l+1,u=Math.round(e.duration/c),d="up"===r||"down"===r?"top":"left",p="up"===r||"left"===r,f={},g={},m={},v=n.queue(),_=v.length;for(t.effects.save(n,o),n.show(),t.effects.createWrapper(n),f[d]=(p?"-=":"+=")+h,g[d]=(p?"+=":"-=")+2*h,m[d]=(p?"-=":"+=")+2*h,n.animate(f,u,e.easing),s=1;l>s;s++)n.animate(g,u,e.easing).animate(m,u,e.easing);n.animate(g,u,e.easing).animate(f,u/2,e.easing).queue(function(){"hide"===a&&n.hide(),t.effects.restore(n,o),t.effects.removeWrapper(n),i()}),_>1&&v.splice.apply(v,[1,0].concat(v.splice(_,c+1))),n.dequeue()}}(jQuery),function(t){t.effects.effect.slide=function(e,i){var s,n=t(this),o=["position","top","bottom","left","right","width","height"],a=t.effects.setMode(n,e.mode||"show"),r="show"===a,h=e.direction||"left",l="up"===h||"down"===h?"top":"left",c="up"===h||"left"===h,u={};t.effects.save(n,o),n.show(),s=e.distance||n["top"===l?"outerHeight":"outerWidth"](!0),t.effects.createWrapper(n).css({overflow:"hidden"}),r&&n.css(l,c?isNaN(s)?"-"+s:-s:s),u[l]=(r?c?"+=":"-=":c?"-=":"+=")+s,n.animate(u,{queue:!1,duration:e.duration,easing:e.easing,complete:function(){"hide"===a&&n.hide(),t.effects.restore(n,o),t.effects.removeWrapper(n),i()}})}}(jQuery),function(t){t.effects.effect.transfer=function(e,i){var s=t(this),n=t(e.to),o="fixed"===n.css("position"),a=t("body"),r=o?a.scrollTop():0,h=o?a.scrollLeft():0,l=n.offset(),c={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},u=s.offset(),d=t("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(e.className).css({top:u.top-r,left:u.left-h,height:s.innerHeight(),width:s.innerWidth(),position:o?"fixed":"absolute"}).animate(c,e.duration,e.easing,function(){d.remove(),i()})}}(jQuery),function(t){t.widget("ui.menu",{version:"1.10.3",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,t.proxy(function(t){this.options.disabled&&t.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(t){t.preventDefault()},"click .ui-state-disabled > a":function(t){t.preventDefault()},"click .ui-menu-item:has(a)":function(e){var i=t(e.target).closest(".ui-menu-item");!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.mouseHandled=!0,this.select(e),i.has(".ui-menu").length?this.expand(e):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(e){var i=t(e.currentTarget);i.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(e,i)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t,e){var i=this.active||this.element.children(".ui-menu-item").eq(0);e||this.focus(t,i)},blur:function(e){this._delay(function(){t.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(e)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){t(e.target).closest(".ui-menu").length||this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var e=t(this);e.data("ui-menu-submenu-carat")&&e.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(e){function i(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var s,n,o,a,r,h=!0;switch(e.keyCode){case t.ui.keyCode.PAGE_UP:this.previousPage(e);break;case t.ui.keyCode.PAGE_DOWN:this.nextPage(e);break;case t.ui.keyCode.HOME:this._move("first","first",e);break;case t.ui.keyCode.END:this._move("last","last",e);break;case t.ui.keyCode.UP:this.previous(e);break;case t.ui.keyCode.DOWN:this.next(e);break;case t.ui.keyCode.LEFT:this.collapse(e);break;case t.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(e);break;case t.ui.keyCode.ENTER:case t.ui.keyCode.SPACE:this._activate(e);break;case t.ui.keyCode.ESCAPE:this.collapse(e);break;default:h=!1,n=this.previousFilter||"",o=String.fromCharCode(e.keyCode),a=!1,clearTimeout(this.filterTimer),o===n?a=!0:o=n+o,r=RegExp("^"+i(o),"i"),s=this.activeMenu.children(".ui-menu-item").filter(function(){return r.test(t(this).children("a").text())}),s=a&&-1!==s.index(this.active.next())?this.active.nextAll(".ui-menu-item"):s,s.length||(o=String.fromCharCode(e.keyCode),r=RegExp("^"+i(o),"i"),s=this.activeMenu.children(".ui-menu-item").filter(function(){return r.test(t(this).children("a").text())})),s.length?(this.focus(e,s),s.length>1?(this.previousFilter=o,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}h&&e.preventDefault()},_activate:function(t){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(t):this.select(t))},refresh:function(){var e,i=this.options.icons.submenu,s=this.element.find(this.options.menus);s.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var e=t(this),s=e.prev("a"),n=t("<span>").addClass("ui-menu-icon ui-icon "+i).data("ui-menu-submenu-carat",!0);s.attr("aria-haspopup","true").prepend(n),e.attr("aria-labelledby",s.attr("id"))}),e=s.add(this.element),e.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),e.children(":not(.ui-menu-item)").each(function(){var e=t(this);/[^\-\u2014\u2013\s]/.test(e.text())||e.addClass("ui-widget-content ui-menu-divider")}),e.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!t.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(t,e){"icons"===t&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(e.submenu),this._super(t,e)},focus:function(t,e){var i,s;this.blur(t,t&&"focus"===t.type),this._scrollIntoView(e),this.active=e.first(),s=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",s.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),t&&"keydown"===t.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=e.children(".ui-menu"),i.length&&/^mouse/.test(t.type)&&this._startOpening(i),this.activeMenu=e.parent(),this._trigger("focus",t,{item:e})},_scrollIntoView:function(e){var i,s,n,o,a,r;this._hasScroll()&&(i=parseFloat(t.css(this.activeMenu[0],"borderTopWidth"))||0,s=parseFloat(t.css(this.activeMenu[0],"paddingTop"))||0,n=e.offset().top-this.activeMenu.offset().top-i-s,o=this.activeMenu.scrollTop(),a=this.activeMenu.height(),r=e.height(),0>n?this.activeMenu.scrollTop(o+n):n+r>a&&this.activeMenu.scrollTop(o+n-a+r))},blur:function(t,e){e||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",t,{item:this.active}))},_startOpening:function(t){clearTimeout(this.timer),"true"===t.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(t)},this.delay))},_open:function(e){var i=t.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(e.parents(".ui-menu")).hide().attr("aria-hidden","true"),e.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(e,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:t(e&&e.target).closest(this.element.find(".ui-menu"));s.length||(s=this.element),this._close(s),this.blur(e),this.activeMenu=s},this.delay)},_close:function(t){t||(t=this.active?this.active.parent():this.element),t.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(t){var e=this.active&&this.active.parent().closest(".ui-menu-item",this.element);e&&e.length&&(this._close(),this.focus(t,e))},expand:function(t){var e=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();e&&e.length&&(this._open(e.parent()),this._delay(function(){this.focus(t,e)}))},next:function(t){this._move("next","first",t)},previous:function(t){this._move("prev","last",t)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(t,e,i){var s;this.active&&(s="first"===t||"last"===t?this.active["first"===t?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[t+"All"](".ui-menu-item").eq(0)),s&&s.length&&this.active||(s=this.activeMenu.children(".ui-menu-item")[e]()),this.focus(i,s)},nextPage:function(e){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=t(this),0>i.offset().top-s-n}),this.focus(e,i)):this.focus(e,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())),undefined):(this.next(e),undefined)},previousPage:function(e){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=t(this),i.offset().top-s+n>0}),this.focus(e,i)):this.focus(e,this.activeMenu.children(".ui-menu-item").first())),undefined):(this.next(e),undefined)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){this.active=this.active||t(e.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(e,!0),this._trigger("select",e,i)}})}(jQuery),function(t,e){function i(t,e,i){return[parseFloat(t[0])*(p.test(t[0])?e/100:1),parseFloat(t[1])*(p.test(t[1])?i/100:1)]}function s(e,i){return parseInt(t.css(e,i),10)||0}function n(e){var i=e[0];return 9===i.nodeType?{width:e.width(),height:e.height(),offset:{top:0,left:0}}:t.isWindow(i)?{width:e.width(),height:e.height(),offset:{top:e.scrollTop(),left:e.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:e.outerWidth(),height:e.outerHeight(),offset:e.offset()}}t.ui=t.ui||{};var o,a=Math.max,r=Math.abs,h=Math.round,l=/left|center|right/,c=/top|center|bottom/,u=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,p=/%$/,f=t.fn.position;t.position={scrollbarWidth:function(){if(o!==e)return o;var i,s,n=t("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),a=n.children()[0];return t("body").append(n),i=a.offsetWidth,n.css("overflow","scroll"),s=a.offsetWidth,i===s&&(s=n[0].clientWidth),n.remove(),o=i-s},getScrollInfo:function(e){var i=e.isWindow?"":e.element.css("overflow-x"),s=e.isWindow?"":e.element.css("overflow-y"),n="scroll"===i||"auto"===i&&e.width<e.element[0].scrollWidth,o="scroll"===s||"auto"===s&&e.height<e.element[0].scrollHeight;return{width:o?t.position.scrollbarWidth():0,height:n?t.position.scrollbarWidth():0}},getWithinInfo:function(e){var i=t(e||window),s=t.isWindow(i[0]);return{element:i,isWindow:s,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s?i.width():i.outerWidth(),height:s?i.height():i.outerHeight()}}},t.fn.position=function(e){if(!e||!e.of)return f.apply(this,arguments);e=t.extend({},e);var o,p,g,m,v,_,b=t(e.of),y=t.position.getWithinInfo(e.within),w=t.position.getScrollInfo(y),k=(e.collision||"flip").split(" "),x={};return _=n(b),b[0].preventDefault&&(e.at="left top"),p=_.width,g=_.height,m=_.offset,v=t.extend({},m),t.each(["my","at"],function(){var t,i,s=(e[this]||"").split(" ");1===s.length&&(s=l.test(s[0])?s.concat(["center"]):c.test(s[0])?["center"].concat(s):["center","center"]),s[0]=l.test(s[0])?s[0]:"center",s[1]=c.test(s[1])?s[1]:"center",t=u.exec(s[0]),i=u.exec(s[1]),x[this]=[t?t[0]:0,i?i[0]:0],e[this]=[d.exec(s[0])[0],d.exec(s[1])[0]]}),1===k.length&&(k[1]=k[0]),"right"===e.at[0]?v.left+=p:"center"===e.at[0]&&(v.left+=p/2),"bottom"===e.at[1]?v.top+=g:"center"===e.at[1]&&(v.top+=g/2),o=i(x.at,p,g),v.left+=o[0],v.top+=o[1],this.each(function(){var n,l,c=t(this),u=c.outerWidth(),d=c.outerHeight(),f=s(this,"marginLeft"),_=s(this,"marginTop"),D=u+f+s(this,"marginRight")+w.width,C=d+_+s(this,"marginBottom")+w.height,I=t.extend({},v),P=i(x.my,c.outerWidth(),c.outerHeight());"right"===e.my[0]?I.left-=u:"center"===e.my[0]&&(I.left-=u/2),"bottom"===e.my[1]?I.top-=d:"center"===e.my[1]&&(I.top-=d/2),I.left+=P[0],I.top+=P[1],
t.support.offsetFractions||(I.left=h(I.left),I.top=h(I.top)),n={marginLeft:f,marginTop:_},t.each(["left","top"],function(i,s){t.ui.position[k[i]]&&t.ui.position[k[i]][s](I,{targetWidth:p,targetHeight:g,elemWidth:u,elemHeight:d,collisionPosition:n,collisionWidth:D,collisionHeight:C,offset:[o[0]+P[0],o[1]+P[1]],my:e.my,at:e.at,within:y,elem:c})}),e.using&&(l=function(t){var i=m.left-I.left,s=i+p-u,n=m.top-I.top,o=n+g-d,h={target:{element:b,left:m.left,top:m.top,width:p,height:g},element:{element:c,left:I.left,top:I.top,width:u,height:d},horizontal:0>s?"left":i>0?"right":"center",vertical:0>o?"top":n>0?"bottom":"middle"};u>p&&p>r(i+s)&&(h.horizontal="center"),d>g&&g>r(n+o)&&(h.vertical="middle"),h.important=a(r(i),r(s))>a(r(n),r(o))?"horizontal":"vertical",e.using.call(this,t,h)}),c.offset(t.extend(I,{using:l}))})},t.ui.position={fit:{left:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollLeft:s.offset.left,o=s.width,r=t.left-e.collisionPosition.marginLeft,h=n-r,l=r+e.collisionWidth-o-n;e.collisionWidth>o?h>0&&0>=l?(i=t.left+h+e.collisionWidth-o-n,t.left+=h-i):t.left=l>0&&0>=h?n:h>l?n+o-e.collisionWidth:n:h>0?t.left+=h:l>0?t.left-=l:t.left=a(t.left-r,t.left)},top:function(t,e){var i,s=e.within,n=s.isWindow?s.scrollTop:s.offset.top,o=e.within.height,r=t.top-e.collisionPosition.marginTop,h=n-r,l=r+e.collisionHeight-o-n;e.collisionHeight>o?h>0&&0>=l?(i=t.top+h+e.collisionHeight-o-n,t.top+=h-i):t.top=l>0&&0>=h?n:h>l?n+o-e.collisionHeight:n:h>0?t.top+=h:l>0?t.top-=l:t.top=a(t.top-r,t.top)}},flip:{left:function(t,e){var i,s,n=e.within,o=n.offset.left+n.scrollLeft,a=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=t.left-e.collisionPosition.marginLeft,c=l-h,u=l+e.collisionWidth-a-h,d="left"===e.my[0]?-e.elemWidth:"right"===e.my[0]?e.elemWidth:0,p="left"===e.at[0]?e.targetWidth:"right"===e.at[0]?-e.targetWidth:0,f=-2*e.offset[0];0>c?(i=t.left+d+p+f+e.collisionWidth-a-o,(0>i||r(c)>i)&&(t.left+=d+p+f)):u>0&&(s=t.left-e.collisionPosition.marginLeft+d+p+f-h,(s>0||u>r(s))&&(t.left+=d+p+f))},top:function(t,e){var i,s,n=e.within,o=n.offset.top+n.scrollTop,a=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=t.top-e.collisionPosition.marginTop,c=l-h,u=l+e.collisionHeight-a-h,d="top"===e.my[1],p=d?-e.elemHeight:"bottom"===e.my[1]?e.elemHeight:0,f="top"===e.at[1]?e.targetHeight:"bottom"===e.at[1]?-e.targetHeight:0,g=-2*e.offset[1];0>c?(s=t.top+p+f+g+e.collisionHeight-a-o,t.top+p+f+g>c&&(0>s||r(c)>s)&&(t.top+=p+f+g)):u>0&&(i=t.top-e.collisionPosition.marginTop+p+f+g-h,t.top+p+f+g>u&&(i>0||u>r(i))&&(t.top+=p+f+g))}},flipfit:{left:function(){t.ui.position.flip.left.apply(this,arguments),t.ui.position.fit.left.apply(this,arguments)},top:function(){t.ui.position.flip.top.apply(this,arguments),t.ui.position.fit.top.apply(this,arguments)}}},function(){var e,i,s,n,o,a=document.getElementsByTagName("body")[0],r=document.createElement("div");e=document.createElement(a?"div":"body"),s={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},a&&t.extend(s,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in s)e.style[o]=s[o];e.appendChild(r),i=a||document.documentElement,i.insertBefore(e,i.firstChild),r.style.cssText="position: absolute; left: 10.7432222px;",n=t(r).offset().left,t.support.offsetFractions=n>10&&11>n,e.innerHTML="",i.removeChild(e)}()}(jQuery),function(t,e){t.widget("ui.progressbar",{version:"1.10.3",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=t("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(t){return t===e?this.options.value:(this.options.value=this._constrainedValue(t),this._refreshValue(),e)},_constrainedValue:function(t){return t===e&&(t=this.options.value),this.indeterminate=t===!1,"number"!=typeof t&&(t=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,t))},_setOptions:function(t){var e=t.value;delete t.value,this._super(t),this.options.value=this._constrainedValue(e),this._refreshValue()},_setOption:function(t,e){"max"===t&&(e=Math.max(this.min,e)),this._super(t,e)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var e=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||e>this.min).toggleClass("ui-corner-right",e===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=t("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":e}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==e&&(this.oldValue=e,this._trigger("change")),e===this.options.max&&this._trigger("complete")}})}(jQuery),function(t){var e=5;t.widget("ui.slider",t.ui.mouse,{version:"1.10.3",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var e,i,s=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",a=[];for(i=s.values&&s.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),e=n.length;i>e;e++)a.push(o);this.handles=n.add(t(a.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(e){t(this).data("ui-slider-handle-index",e)})},_createRange:function(){var e=this.options,i="";e.range?(e.range===!0&&(e.values?e.values.length&&2!==e.values.length?e.values=[e.values[0],e.values[0]]:t.isArray(e.values)&&(e.values=e.values.slice(0)):e.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=t("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===e.range||"max"===e.range?" ui-slider-range-"+e.range:""))):this.range=t([])},_setupEvents:function(){var t=this.handles.add(this.range).filter("a");this._off(t),this._on(t,this._handleEvents),this._hoverable(t),this._focusable(t)},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(e){var i,s,n,o,a,r,h,l,c=this,u=this.options;return u.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:e.pageX,y:e.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(e){var i=Math.abs(s-c.values(e));(n>i||n===i&&(e===c._lastChangedValue||c.values(e)===u.min))&&(n=i,o=t(this),a=e)}),r=this._start(e,a),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=a,o.addClass("ui-state-active").focus(),h=o.offset(),l=!t(e.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:e.pageX-h.left-o.width()/2,top:e.pageY-h.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(e,a,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(t){var e={x:t.pageX,y:t.pageY},i=this._normValueFromMouse(e);return this._slide(t,this._handleIndex,i),!1},_mouseStop:function(t){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(t,this._handleIndex),this._change(t,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(t){var e,i,s,n,o;return"horizontal"===this.orientation?(e=this.elementSize.width,i=t.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(e=this.elementSize.height,i=t.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/e,s>1&&(s=1),0>s&&(s=0),"vertical"===this.orientation&&(s=1-s),n=this._valueMax()-this._valueMin(),o=this._valueMin()+s*n,this._trimAlignValue(o)},_start:function(t,e){var i={handle:this.handles[e],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("start",t,i)},_slide:function(t,e,i){var s,n,o;this.options.values&&this.options.values.length?(s=this.values(e?0:1),2===this.options.values.length&&this.options.range===!0&&(0===e&&i>s||1===e&&s>i)&&(i=s),i!==this.values(e)&&(n=this.values(),n[e]=i,o=this._trigger("slide",t,{handle:this.handles[e],value:i,values:n}),s=this.values(e?0:1),o!==!1&&this.values(e,i,!0))):i!==this.value()&&(o=this._trigger("slide",t,{handle:this.handles[e],value:i}),o!==!1&&this.value(i))},_stop:function(t,e){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._trigger("stop",t,i)},_change:function(t,e){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[e],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(e),i.values=this.values()),this._lastChangedValue=e,this._trigger("change",t,i)}},value:function(t){return arguments.length?(this.options.value=this._trimAlignValue(t),this._refreshValue(),this._change(null,0),undefined):this._value()},values:function(e,i){var s,n,o;if(arguments.length>1)return this.options.values[e]=this._trimAlignValue(i),this._refreshValue(),this._change(null,e),undefined;if(!arguments.length)return this._values();if(!t.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(e):this.value();for(s=this.options.values,n=arguments[0],o=0;s.length>o;o+=1)s[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(e,i){var s,n=0;switch("range"===e&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),t.isArray(this.options.values)&&(n=this.options.values.length),t.Widget.prototype._setOption.apply(this,arguments),e){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),s=0;n>s;s+=1)this._change(null,s);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var t=this.options.value;return t=this._trimAlignValue(t)},_values:function(t){var e,i,s;if(arguments.length)return e=this.options.values[t],e=this._trimAlignValue(e);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),s=0;i.length>s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(t){if(this._valueMin()>=t)return this._valueMin();if(t>=this._valueMax())return this._valueMax();var e=this.options.step>0?this.options.step:1,i=(t-this._valueMin())%e,s=t-i;return 2*Math.abs(i)>=e&&(s+=i>0?e:-e),parseFloat(s.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var e,i,s,n,o,a=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,c={};this.options.values&&this.options.values.length?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),c["horizontal"===h.orientation?"left":"bottom"]=i+"%",t(this).stop(1,1)[l?"animate":"css"](c,r.animate),h.options.range===!0&&("horizontal"===h.orientation?(0===s&&h.range.stop(1,1)[l?"animate":"css"]({left:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({width:i-e+"%"},{queue:!1,duration:r.animate})):(0===s&&h.range.stop(1,1)[l?"animate":"css"]({bottom:i+"%"},r.animate),1===s&&h.range[l?"animate":"css"]({height:i-e+"%"},{queue:!1,duration:r.animate}))),e=i}):(s=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?100*((s-n)/(o-n)):0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[l?"animate":"css"](c,r.animate),"min"===a&&"horizontal"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({width:i+"%"},r.animate),"max"===a&&"horizontal"===this.orientation&&this.range[l?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:r.animate}),"min"===a&&"vertical"===this.orientation&&this.range.stop(1,1)[l?"animate":"css"]({height:i+"%"},r.animate),"max"===a&&"vertical"===this.orientation&&this.range[l?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(i){var s,n,o,a,r=t(i.target).data("ui-slider-handle-index");switch(i.keyCode){case t.ui.keyCode.HOME:case t.ui.keyCode.END:case t.ui.keyCode.PAGE_UP:case t.ui.keyCode.PAGE_DOWN:case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(i.preventDefault(),!this._keySliding&&(this._keySliding=!0,t(i.target).addClass("ui-state-active"),s=this._start(i,r),s===!1))return}switch(a=this.options.step,n=o=this.options.values&&this.options.values.length?this.values(r):this.value(),i.keyCode){case t.ui.keyCode.HOME:o=this._valueMin();break;case t.ui.keyCode.END:o=this._valueMax();break;case t.ui.keyCode.PAGE_UP:o=this._trimAlignValue(n+(this._valueMax()-this._valueMin())/e);break;case t.ui.keyCode.PAGE_DOWN:o=this._trimAlignValue(n-(this._valueMax()-this._valueMin())/e);break;case t.ui.keyCode.UP:case t.ui.keyCode.RIGHT:if(n===this._valueMax())return;o=this._trimAlignValue(n+a);break;case t.ui.keyCode.DOWN:case t.ui.keyCode.LEFT:if(n===this._valueMin())return;o=this._trimAlignValue(n-a)}this._slide(i,r,o)},click:function(t){t.preventDefault()},keyup:function(e){var i=t(e.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(e,i),this._change(e,i),t(e.target).removeClass("ui-state-active"))}}})}(jQuery),function(t){function e(t){return function(){var e=this.element.val();t.apply(this,arguments),this._refresh(),e!==this.element.val()&&this._trigger("change")}}t.widget("ui.spinner",{version:"1.10.3",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var e={},i=this.element;return t.each(["min","max","step"],function(t,s){var n=i.attr(s);void 0!==n&&n.length&&(e[s]=n)}),e},_events:{keydown:function(t){this._start(t)&&this._keydown(t)&&t.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(t){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",t),void 0)},mousewheel:function(t,e){if(e){if(!this.spinning&&!this._start(t))return!1;this._spin((e>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(t)},100),t.preventDefault()}},"mousedown .ui-spinner-button":function(e){function i(){var t=this.element[0]===this.document[0].activeElement;t||(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),e.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(e)!==!1&&this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(e){return t(e.currentTarget).hasClass("ui-state-active")?this._start(e)===!1?!1:(this._repeat(null,t(e.currentTarget).hasClass("ui-spinner-up")?1:-1,e),void 0):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var t=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=t.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*t.height())&&t.height()>0&&t.height(t.height()),this.options.disabled&&this.disable()},_keydown:function(e){var i=this.options,s=t.ui.keyCode;switch(e.keyCode){case s.UP:return this._repeat(null,1,e),!0;case s.DOWN:return this._repeat(null,-1,e),!0;case s.PAGE_UP:return this._repeat(null,i.page,e),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,e),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span>"+"</a>"+"<a class='ui-spinner-button ui-spinner-down ui-corner-br'>"+"<span class='ui-icon "+this.options.icons.down+"'>&#9660;</span>"+"</a>"},_start:function(t){return this.spinning||this._trigger("start",t)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(t,e,i){t=t||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,e,i)},t),this._spin(e*this.options.step,i)},_spin:function(t,e){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+t*this._increment(this.counter)),this.spinning&&this._trigger("spin",e,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(e){var i=this.options.incremental;return i?t.isFunction(i)?i(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var t=this._precisionOf(this.options.step);return null!==this.options.min&&(t=Math.max(t,this._precisionOf(this.options.min))),t},_precisionOf:function(t){var e=""+t,i=e.indexOf(".");return-1===i?0:e.length-i-1},_adjustValue:function(t){var e,i,s=this.options;return e=null!==s.min?s.min:0,i=t-e,i=Math.round(i/s.step)*s.step,t=e+i,t=parseFloat(t.toFixed(this._precision())),null!==s.max&&t>s.max?s.max:null!==s.min&&s.min>t?s.min:t},_stop:function(t){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",t))},_setOption:function(t,e){if("culture"===t||"numberFormat"===t){var i=this._parse(this.element.val());return this.options[t]=e,this.element.val(this._format(i)),void 0}("max"===t||"min"===t||"step"===t)&&"string"==typeof e&&(e=this._parse(e)),"icons"===t&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(e.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(e.down)),this._super(t,e),"disabled"===t&&(e?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:e(function(t){this._super(t),this._value(this.element.val())}),_parse:function(t){return"string"==typeof t&&""!==t&&(t=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(t,10,this.options.culture):+t),""===t||isNaN(t)?null:t},_format:function(t){return""===t?"":window.Globalize&&this.options.numberFormat?Globalize.format(t,this.options.numberFormat,this.options.culture):t},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(t,e){var i;""!==t&&(i=this._parse(t),null!==i&&(e||(i=this._adjustValue(i)),t=this._format(i))),this.element.val(t),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:e(function(t){this._stepUp(t)}),_stepUp:function(t){this._start()&&(this._spin((t||1)*this.options.step),this._stop())},stepDown:e(function(t){this._stepDown(t)}),_stepDown:function(t){this._start()&&(this._spin((t||1)*-this.options.step),this._stop())},pageUp:e(function(t){this._stepUp((t||1)*this.options.page)}),pageDown:e(function(t){this._stepDown((t||1)*this.options.page)}),value:function(t){return arguments.length?(e(this._value).call(this,t),void 0):this._parse(this.element.val())},widget:function(){return this.uiSpinner}})}(jQuery),function(t,e){function i(){return++n}function s(t){return t.hash.length>1&&decodeURIComponent(t.href.replace(o,""))===decodeURIComponent(location.href.replace(o,""))}var n=0,o=/#.*$/;t.widget("ui.tabs",{version:"1.10.3",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var e=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(e){t(this).is(".ui-state-disabled")&&e.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){t(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),i.active=this._initialActive(),t.isArray(i.disabled)&&(i.disabled=t.unique(i.disabled.concat(t.map(this.tabs.filter(".ui-state-disabled"),function(t){return e.tabs.index(t)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):t(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var i=this.options.active,s=this.options.collapsible,n=location.hash.substring(1);return null===i&&(n&&this.tabs.each(function(s,o){return t(o).attr("aria-controls")===n?(i=s,!1):e}),null===i&&(i=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===i||-1===i)&&(i=this.tabs.length?0:!1)),i!==!1&&(i=this.tabs.index(this.tabs.eq(i)),-1===i&&(i=s?!1:0)),!s&&i===!1&&this.anchors.length&&(i=0),i},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):t()}},_tabKeydown:function(i){var s=t(this.document[0].activeElement).closest("li"),n=this.tabs.index(s),o=!0;if(!this._handlePageNav(i)){switch(i.keyCode){case t.ui.keyCode.RIGHT:case t.ui.keyCode.DOWN:n++;break;case t.ui.keyCode.UP:case t.ui.keyCode.LEFT:o=!1,n--;break;case t.ui.keyCode.END:n=this.anchors.length-1;break;case t.ui.keyCode.HOME:n=0;break;case t.ui.keyCode.SPACE:return i.preventDefault(),clearTimeout(this.activating),this._activate(n),e;case t.ui.keyCode.ENTER:return i.preventDefault(),clearTimeout(this.activating),this._activate(n===this.options.active?!1:n),e;default:return}i.preventDefault(),clearTimeout(this.activating),n=this._focusNextTab(n,o),i.ctrlKey||(s.attr("aria-selected","false"),this.tabs.eq(n).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",n)},this.delay))}},_panelKeydown:function(e){this._handlePageNav(e)||e.ctrlKey&&e.keyCode===t.ui.keyCode.UP&&(e.preventDefault(),this.active.focus())},_handlePageNav:function(i){return i.altKey&&i.keyCode===t.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):i.altKey&&i.keyCode===t.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):e},_findNextTab:function(e,i){function s(){return e>n&&(e=0),0>e&&(e=n),e}for(var n=this.tabs.length-1;-1!==t.inArray(s(),this.options.disabled);)e=i?e+1:e-1;return e},_focusNextTab:function(t,e){return t=this._findNextTab(t,e),this.tabs.eq(t).focus(),t},_setOption:function(t,i){return"active"===t?(this._activate(i),e):"disabled"===t?(this._setupDisabled(i),e):(this._super(t,i),"collapsible"===t&&(this.element.toggleClass("ui-tabs-collapsible",i),i||this.options.active!==!1||this._activate(0)),"event"===t&&this._setupEvents(i),"heightStyle"===t&&this._setupHeightStyle(i),e)},_tabId:function(t){return t.attr("aria-controls")||"ui-tabs-"+i()},_sanitizeSelector:function(t){return t?t.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var e=this.options,i=this.tablist.children(":has(a[href])");e.disabled=t.map(i.filter(".ui-state-disabled"),function(t){return i.index(t)}),this._processTabs(),e.active!==!1&&this.anchors.length?this.active.length&&!t.contains(this.tablist[0],this.active[0])?this.tabs.length===e.disabled.length?(e.active=!1,this.active=t()):this._activate(this._findNextTab(Math.max(0,e.active-1),!1)):e.active=this.tabs.index(this.active):(e.active=!1,this.active=t()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var e=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return t("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=t(),this.anchors.each(function(i,n){var o,a,r,h=t(n).uniqueId().attr("id"),l=t(n).closest("li"),c=l.attr("aria-controls");s(n)?(o=n.hash,a=e.element.find(e._sanitizeSelector(o))):(r=e._tabId(l),o="#"+r,a=e.element.find(o),a.length||(a=e._createPanel(r),a.insertAfter(e.panels[i-1]||e.tablist)),a.attr("aria-live","polite")),a.length&&(e.panels=e.panels.add(a)),c&&l.data("ui-tabs-aria-controls",c),l.attr({"aria-controls":o.substring(1),"aria-labelledby":h}),a.attr("aria-labelledby",h)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(e){return t("<div>").attr("id",e).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(e){t.isArray(e)&&(e.length?e.length===this.anchors.length&&(e=!0):e=!1);for(var i,s=0;i=this.tabs[s];s++)e===!0||-1!==t.inArray(s,e)?t(i).addClass("ui-state-disabled").attr("aria-disabled","true"):t(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=e},_setupEvents:function(e){var i={click:function(t){t.preventDefault()}};e&&t.each(e.split(" "),function(t,e){i[e]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(e){var i,s=this.element.parent();"fill"===e?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var e=t(this),s=e.css("position");"absolute"!==s&&"fixed"!==s&&(i-=e.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=t(this).outerHeight(!0)}),this.panels.each(function(){t(this).height(Math.max(0,i-t(this).innerHeight()+t(this).height()))}).css("overflow","auto")):"auto"===e&&(i=0,this.panels.each(function(){i=Math.max(i,t(this).height("").height())}).height(i))},_eventHandler:function(e){var i=this.options,s=this.active,n=t(e.currentTarget),o=n.closest("li"),a=o[0]===s[0],r=a&&i.collapsible,h=r?t():this._getPanelForTab(o),l=s.length?this._getPanelForTab(s):t(),c={oldTab:s,oldPanel:l,newTab:r?t():o,newPanel:h};e.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||a&&!i.collapsible||this._trigger("beforeActivate",e,c)===!1||(i.active=r?!1:this.tabs.index(o),this.active=a?t():o,this.xhr&&this.xhr.abort(),l.length||h.length||t.error("jQuery UI Tabs: Mismatching fragment identifier."),h.length&&this.load(this.tabs.index(o),e),this._toggle(e,c))},_toggle:function(e,i){function s(){o.running=!1,o._trigger("activate",e,i)}function n(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),a.length&&o.options.show?o._show(a,o.options.show,s):(a.show(),s())}var o=this,a=i.newPanel,r=i.oldPanel;this.running=!0,r.length&&this.options.hide?this._hide(r,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),n()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r.hide(),n()),r.attr({"aria-expanded":"false","aria-hidden":"true"}),i.oldTab.attr("aria-selected","false"),a.length&&r.length?i.oldTab.attr("tabIndex",-1):a.length&&this.tabs.filter(function(){return 0===t(this).attr("tabIndex")}).attr("tabIndex",-1),a.attr({"aria-expanded":"true","aria-hidden":"false"}),i.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(e){var i,s=this._findActive(e);s[0]!==this.active[0]&&(s.length||(s=this.active),i=s.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:t.noop}))},_findActive:function(e){return e===!1?t():this.tabs.eq(e)},_getIndex:function(t){return"string"==typeof t&&(t=this.anchors.index(this.anchors.filter("[href$='"+t+"']"))),t},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){t.data(this,"ui-tabs-destroy")?t(this).remove():t(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role");
}),this.tabs.each(function(){var e=t(this),i=e.data("ui-tabs-aria-controls");i?e.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):e.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(i){var s=this.options.disabled;s!==!1&&(i===e?s=!1:(i=this._getIndex(i),s=t.isArray(s)?t.map(s,function(t){return t!==i?t:null}):t.map(this.tabs,function(t,e){return e!==i?e:null})),this._setupDisabled(s))},disable:function(i){var s=this.options.disabled;if(s!==!0){if(i===e)s=!0;else{if(i=this._getIndex(i),-1!==t.inArray(i,s))return;s=t.isArray(s)?t.merge([i],s).sort():[i]}this._setupDisabled(s)}},load:function(e,i){e=this._getIndex(e);var n=this,o=this.tabs.eq(e),a=o.find(".ui-tabs-anchor"),r=this._getPanelForTab(o),h={tab:o,panel:r};s(a[0])||(this.xhr=t.ajax(this._ajaxSettings(a,i,h)),this.xhr&&"canceled"!==this.xhr.statusText&&(o.addClass("ui-tabs-loading"),r.attr("aria-busy","true"),this.xhr.success(function(t){setTimeout(function(){r.html(t),n._trigger("load",i,h)},1)}).complete(function(t,e){setTimeout(function(){"abort"===e&&n.panels.stop(!1,!0),o.removeClass("ui-tabs-loading"),r.removeAttr("aria-busy"),t===n.xhr&&delete n.xhr},1)})))},_ajaxSettings:function(e,i,s){var n=this;return{url:e.attr("href"),beforeSend:function(e,o){return n._trigger("beforeLoad",i,t.extend({jqXHR:e,ajaxSettings:o},s))}}},_getPanelForTab:function(e){var i=t(e).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}})}(jQuery),function(t){function e(e,i){var s=(e.attr("aria-describedby")||"").split(/\s+/);s.push(i),e.data("ui-tooltip-id",i).attr("aria-describedby",t.trim(s.join(" ")))}function i(e){var i=e.data("ui-tooltip-id"),s=(e.attr("aria-describedby")||"").split(/\s+/),n=t.inArray(i,s);-1!==n&&s.splice(n,1),e.removeData("ui-tooltip-id"),s=t.trim(s.join(" ")),s?e.attr("aria-describedby",s):e.removeAttr("aria-describedby")}var s=0;t.widget("ui.tooltip",{version:"1.10.3",options:{content:function(){var e=t(this).attr("title")||"";return t("<a>").text(e).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(e,i){var s=this;return"disabled"===e?(this[i?"_disable":"_enable"](),this.options[e]=i,void 0):(this._super(e,i),"content"===e&&t.each(this.tooltips,function(t,e){s._updateContent(e)}),void 0)},_disable:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s[0],e.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.is("[title]")&&e.data("ui-tooltip-title",e.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var e=t(this);e.data("ui-tooltip-title")&&e.attr("title",e.data("ui-tooltip-title"))})},open:function(e){var i=this,s=t(e?e.target:this.element).closest(this.options.items);s.length&&!s.data("ui-tooltip-id")&&(s.attr("title")&&s.data("ui-tooltip-title",s.attr("title")),s.data("ui-tooltip-open",!0),e&&"mouseover"===e.type&&s.parents().each(function(){var e,s=t(this);s.data("ui-tooltip-open")&&(e=t.Event("blur"),e.target=e.currentTarget=this,i.close(e,!0)),s.attr("title")&&(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr("title")},s.attr("title",""))}),this._updateContent(s,e))},_updateContent:function(t,e){var i,s=this.options.content,n=this,o=e?e.type:null;return"string"==typeof s?this._open(e,t,s):(i=s.call(t[0],function(i){t.data("ui-tooltip-open")&&n._delay(function(){e&&(e.type=o),this._open(e,t,i)})}),i&&this._open(e,t,i),void 0)},_open:function(i,s,n){function o(t){l.of=t,a.is(":hidden")||a.position(l)}var a,r,h,l=t.extend({},this.options.position);if(n){if(a=this._find(s),a.length)return a.find(".ui-tooltip-content").html(n),void 0;s.is("[title]")&&(i&&"mouseover"===i.type?s.attr("title",""):s.removeAttr("title")),a=this._tooltip(s),e(s,a.attr("id")),a.find(".ui-tooltip-content").html(n),this.options.track&&i&&/^mouse/.test(i.type)?(this._on(this.document,{mousemove:o}),o(i)):a.position(t.extend({of:s},this.options.position)),a.hide(),this._show(a,this.options.show),this.options.show&&this.options.show.delay&&(h=this.delayedShow=setInterval(function(){a.is(":visible")&&(o(l.of),clearInterval(h))},t.fx.interval)),this._trigger("open",i,{tooltip:a}),r={keyup:function(e){if(e.keyCode===t.ui.keyCode.ESCAPE){var i=t.Event(e);i.currentTarget=s[0],this.close(i,!0)}},remove:function(){this._removeTooltip(a)}},i&&"mouseover"!==i.type||(r.mouseleave="close"),i&&"focusin"!==i.type||(r.focusout="close"),this._on(!0,s,r)}},close:function(e){var s=this,n=t(e?e.currentTarget:this.element),o=this._find(n);this.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&n.attr("title",n.data("ui-tooltip-title")),i(n),o.stop(!0),this._hide(o,this.options.hide,function(){s._removeTooltip(t(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),e&&"mouseleave"===e.type&&t.each(this.parents,function(e,i){t(i.element).attr("title",i.title),delete s.parents[e]}),this.closing=!0,this._trigger("close",e,{tooltip:o}),this.closing=!1)},_tooltip:function(e){var i="ui-tooltip-"+s++,n=t("<div>").attr({id:i,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return t("<div>").addClass("ui-tooltip-content").appendTo(n),n.appendTo(this.document[0].body),this.tooltips[i]=e,n},_find:function(e){var i=e.data("ui-tooltip-id");return i?t("#"+i):t()},_removeTooltip:function(t){t.remove(),delete this.tooltips[t.attr("id")]},_destroy:function(){var e=this;t.each(this.tooltips,function(i,s){var n=t.Event("blur");n.target=n.currentTarget=s[0],e.close(n,!0),t("#"+i).remove(),s.data("ui-tooltip-title")&&(s.attr("title",s.data("ui-tooltip-title")),s.removeData("ui-tooltip-title"))})}})}(jQuery);(function(root,factory){if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(_,$,exports){root.Backbone=factory(root,exports,_,$)})}else if(typeof exports!=="undefined"){var _=require("underscore"),$;try{$=require("jquery")}catch(e){}factory(root,exports,_,$)}else{root.Backbone=factory(root,{},root._,root.jQuery||root.Zepto||root.ender||root.$)}})(this,function(root,Backbone,_,$){var previousBackbone=root.Backbone;var array=[];var push=array.push;var slice=array.slice;var splice=array.splice;Backbone.VERSION="1.1.0";Backbone.$=$;Backbone.noConflict=function(){root.Backbone=previousBackbone;return this};Backbone.emulateHTTP=false;Backbone.emulateJSON=false;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);events.push({callback:callback,context:context,ctx:context||this});return this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this;var once=_.once(function(){self.off(name,once);callback.apply(this,arguments)});once._callback=callback;return this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context){this._events=void 0;return this}names=name?[name]:_.keys(this._events);for(i=0,l=names.length;i<l;i++){name=names[i];if(events=this._events[name]){this._events[name]=retain=[];if(callback||context){for(j=0,k=events.length;j<k;j++){ev=events[j];if(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context){retain.push(ev)}}}if(!retain.length)delete this._events[name]}}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name];var allEvents=this._events.all;if(events)triggerEvents(events,args);if(allEvents)triggerEvents(allEvents,arguments);return this},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;if(!callback&&typeof name==="object")callback=this;if(obj)(listeningTo={})[obj._listenId]=obj;for(var id in listeningTo){obj=listeningTo[id];obj.off(name,callback,this);if(remove||_.isEmpty(obj._events))delete this._listeningTo[id]}return this}};var eventSplitter=/\s+/;var eventsApi=function(obj,action,name,rest){if(!name)return true;if(typeof name==="object"){for(var key in name){obj[action].apply(obj,[key,name[key]].concat(rest))}return false}if(eventSplitter.test(name)){var names=name.split(eventSplitter);for(var i=0,l=names.length;i<l;i++){obj[action].apply(obj,[names[i]].concat(rest))}return false}return true};var triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:while(++i<l)(ev=events[i]).callback.call(ev.ctx);return;case 1:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:while(++i<l)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:while(++i<l)(ev=events[i]).callback.apply(ev.ctx,args);return}};var listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={});var id=obj._listenId||(obj._listenId=_.uniqueId("l"));listeningTo[id]=obj;if(!callback&&typeof name==="object")callback=this;obj[implementation](name,callback,this);return this}});Events.bind=Events.on;Events.unbind=Events.off;_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={});this.cid=_.uniqueId("c");this.attributes={};if(options.collection)this.collection=options.collection;if(options.parse)attrs=this.parse(attrs,options)||{};attrs=_.defaults({},attrs,_.result(this,"defaults"));this.set(attrs,options);this.changed={};this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return this.get(attr)!=null},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(key==null)return this;if(typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options||(options={});if(!this._validate(attrs,options))return false;unset=options.unset;silent=options.silent;changes=[];changing=this._changing;this._changing=true;if(!changing){this._previousAttributes=_.clone(this.attributes);this.changed={}}current=this.attributes,prev=this._previousAttributes;if(this.idAttribute in attrs)this.id=attrs[this.idAttribute];for(attr in attrs){val=attrs[attr];if(!_.isEqual(current[attr],val))changes.push(attr);if(!_.isEqual(prev[attr],val)){this.changed[attr]=val}else{delete this.changed[attr]}unset?delete current[attr]:current[attr]=val}if(!silent){if(changes.length)this._pending=options;for(var i=0,l=changes.length;i<l;i++){this.trigger("change:"+changes[i],this,current[changes[i]],options)}}if(changing)return this;if(!silent){while(this._pending){options=this._pending;this._pending=false;this.trigger("change",this,options)}}this._pending=false;this._changing=false;return this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:true}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:true}))},hasChanged:function(attr){if(attr==null)return!_.isEmpty(this.changed);return _.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):false;var val,changed=false;var old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff){if(_.isEqual(old[attr],val=diff[attr]))continue;(changed||(changed={}))[attr]=val}return changed},previous:function(attr){if(attr==null||!this._previousAttributes)return null;return this._previousAttributes[attr]},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){if(!model.set(model.parse(resp,options),options))return false;if(success)success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);return this.sync("read",this,options)},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(key==null||typeof key==="object"){attrs=key;options=val}else{(attrs={})[key]=val}options=_.extend({validate:true},options);if(attrs&&!options.wait){if(!this.set(attrs,options))return false}else{if(!this._validate(attrs,options))return false}if(attrs&&options.wait){this.attributes=_.extend({},attributes,attrs)}if(options.parse===void 0)options.parse=true;var model=this;var success=options.success;options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);if(options.wait)serverAttrs=_.extend(attrs||{},serverAttrs);if(_.isObject(serverAttrs)&&!model.set(serverAttrs,options)){return false}if(success)success(model,resp,options);model.trigger("sync",model,resp,options)};wrapError(this,options);method=this.isNew()?"create":options.patch?"patch":"update";if(method==="patch")options.attrs=attrs;xhr=this.sync(method,this,options);if(attrs&&options.wait)this.attributes=attributes;return xhr},destroy:function(options){options=options?_.clone(options):{};var model=this;var success=options.success;var destroy=function(){model.trigger("destroy",model,model.collection,options)};options.success=function(resp){if(options.wait||model.isNew())destroy();if(success)success(model,resp,options);if(!model.isNew())model.trigger("sync",model,resp,options)};if(this.isNew()){options.success();return false}wrapError(this,options);var xhr=this.sync("delete",this,options);if(!options.wait)destroy();return xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(this.isNew())return base;return base.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(options){return this._validate({},_.extend(options||{},{validate:true}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return true;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;if(!error)return true;this.trigger("invalid",this,error,_.extend(options,{validationError:error}));return false}});var modelMethods=["keys","values","pairs","invert","pick","omit"];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.attributes);return _[method].apply(_,args)}});var Collection=Backbone.Collection=function(models,options){options||(options={});if(options.model)this.model=options.model;if(options.comparator!==void 0)this.comparator=options.comparator;this._reset();this.initialize.apply(this,arguments);if(models)this.reset(models,_.extend({silent:true},options))};var setOptions={add:true,remove:true,merge:true};var addOptions={add:true,remove:false};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:false},options,addOptions))},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models);options||(options={});var i,l,index,model;for(i=0,l=models.length;i<l;i++){model=models[i]=this.get(models[i]);if(!model)continue;delete this._byId[model.id];delete this._byId[model.cid];index=this.indexOf(model);this.models.splice(index,1);this.length--;if(!options.silent){options.index=index;model.trigger("remove",model,this,options)}this._removeReference(model,options)}return singular?models[0]:models},set:function(models,options){options=_.defaults({},options,setOptions);if(options.parse)models=this.parse(models,options);var singular=!_.isArray(models);models=singular?models?[models]:[]:_.clone(models);var i,l,id,model,attrs,existing,sort;var at=options.at;var targetModel=this.model;var sortable=this.comparator&&at==null&&options.sort!==false;var sortAttr=_.isString(this.comparator)?this.comparator:null;var toAdd=[],toRemove=[],modelMap={};var add=options.add,merge=options.merge,remove=options.remove;var order=!sortable&&add&&remove?[]:false;for(i=0,l=models.length;i<l;i++){attrs=models[i]||{};if(attrs instanceof Model){id=model=attrs}else{id=attrs[targetModel.prototype.idAttribute||"id"]}if(existing=this.get(id)){if(remove)modelMap[existing.cid]=true;if(merge){attrs=attrs===model?model.attributes:attrs;if(options.parse)attrs=existing.parse(attrs,options);existing.set(attrs,options);if(sortable&&!sort&&existing.hasChanged(sortAttr))sort=true}models[i]=existing}else if(add){model=models[i]=this._prepareModel(attrs,options);if(!model)continue;toAdd.push(model);this._addReference(model,options)}if(order)order.push(existing||model)}if(remove){for(i=0,l=this.length;i<l;++i){if(!modelMap[(model=this.models[i]).cid])toRemove.push(model)}if(toRemove.length)this.remove(toRemove,options)}if(toAdd.length||order&&order.length){if(sortable)sort=true;this.length+=toAdd.length;if(at!=null){for(i=0,l=toAdd.length;i<l;i++){this.models.splice(at+i,0,toAdd[i])}}else{if(order)this.models.length=0;var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;i<l;i++){this.models.push(orderedModels[i])}}}if(sort)this.sort({silent:true});if(!options.silent){for(i=0,l=toAdd.length;i<l;i++){(model=toAdd[i]).trigger("add",model,this,options)}if(sort||order&&order.length)this.trigger("sort",this,options)}return singular?models[0]:models},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;i<l;i++){this._removeReference(this.models[i],options)}options.previousModels=this.models;this._reset();models=this.add(models,_.extend({silent:true},options));if(!options.silent)this.trigger("reset",this,options);return models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);this.remove(model,options);return model},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);this.remove(model,options);return model},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){if(obj==null)return void 0;return this._byId[obj]||this._byId[obj.id]||this._byId[obj.cid]},at:function(index){return this.models[index]},where:function(attrs,first){if(_.isEmpty(attrs))return first?void 0:[];return this[first?"find":"filter"](function(model){for(var key in attrs){if(attrs[key]!==model.get(key))return false}return true})},findWhere:function(attrs){return this.where(attrs,true)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");options||(options={});if(_.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(_.bind(this.comparator,this))}if(!options.silent)this.trigger("sort",this,options);return this},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=options?_.clone(options):{};if(options.parse===void 0)options.parse=true;var success=options.success;var collection=this;options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options);if(success)success(collection,resp,options);collection.trigger("sync",collection,resp,options)};wrapError(this,options);return this.sync("read",this,options)},create:function(model,options){options=options?_.clone(options):{};if(!(model=this._prepareModel(model,options)))return false;if(!options.wait)this.add(model,options);var collection=this;var success=options.success;options.success=function(model,resp){if(options.wait)collection.add(model,options);if(success)success(model,resp,options)};model.save(null,options);return model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model)return attrs;options=options?_.clone(options):{};options.collection=this;var model=new this.model(attrs,options);if(!model.validationError)return model;this.trigger("invalid",this,model.validationError,options);return false},_addReference:function(model,options){this._byId[model.cid]=model;if(model.id!=null)this._byId[model.id]=model;if(!model.collection)model.collection=this;model.on("all",this._onModelEvent,this)},_removeReference:function(model,options){if(this===model.collection)delete model.collection;model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){if((event==="add"||event==="remove")&&collection!==this)return;if(event==="destroy")this.remove(model,options);if(model&&event==="change:"+model.idAttribute){delete this._byId[model.previous(model.idAttribute)];if(model.id!=null)this._byId[model.id]=model}this.trigger.apply(this,arguments)}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);args.unshift(this.models);return _[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy","indexBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view");options||(options={});_.extend(this,_.pick(options,viewOptions));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var delegateEventSplitter=/^(\S+)\s*(.*)$/;var viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(element,delegate){if(this.$el)this.undelegateEvents();this.$el=element instanceof Backbone.$?element:Backbone.$(element);this.el=this.$el[0];if(delegate!==false)this.delegateEvents();return this},delegateEvents:function(events){if(!(events||(events=_.result(this,"events"))))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(!_.isFunction(method))method=this[events[key]];if(!method)continue;var match=key.match(delegateEventSplitter);var eventName=match[1],selector=match[2];method=_.bind(method,this);eventName+=".delegateEvents"+this.cid;if(selector===""){this.$el.on(eventName,method)}else{this.$el.on(eventName,selector,method)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(!this.el){var attrs=_.extend({},_.result(this,"attributes"));if(this.id)attrs.id=_.result(this,"id");if(this.className)attrs["class"]=_.result(this,"className");var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,false)}else{this.setElement(_.result(this,"el"),false)}}});Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(!options.url){params.url=_.result(model,"url")||urlError()}if(options.data==null&&model&&(method==="create"||method==="update"||method==="patch")){params.contentType="application/json";params.data=JSON.stringify(options.attrs||model.toJSON(options))}if(options.emulateJSON){params.contentType="application/x-www-form-urlencoded";params.data=params.data?{model:params.data}:{}}if(options.emulateHTTP&&(type==="PUT"||type==="DELETE"||type==="PATCH")){params.type="POST";if(options.emulateJSON)params.data._method=type;var beforeSend=options.beforeSend;options.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override",type);if(beforeSend)return beforeSend.apply(this,arguments)}}if(params.type!=="GET"&&!options.emulateJSON){params.processData=false}if(params.type==="PATCH"&&noXhrPatch){params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var xhr=options.xhr=Backbone.ajax(_.extend(params,options));model.trigger("request",model,xhr,options);return xhr};var noXhrPatch=typeof window!=="undefined"&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var methodMap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={});if(options.routes)this.routes=options.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var optionalParam=/\((.*?)\)/g;var namedParam=/(\(\?)?:\w+/g;var splatParam=/\*\w+/g;var escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){if(!_.isRegExp(route))route=this._routeToRegExp(route);if(_.isFunction(name)){callback=name;name=""}if(!callback)callback=this[name];var router=this;Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);router.execute(callback,args);router.trigger.apply(router,["route:"+name].concat(args));router.trigger("route",name,args);Backbone.history.trigger("route",router,name,args)});return this},execute:function(callback,args){if(callback)callback.apply(this,args)},navigate:function(fragment,options){Backbone.history.navigate(fragment,options);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=_.result(this,"routes");var route,routes=_.keys(this.routes);while((route=routes.pop())!=null){this.route(route,this.routes[route])}},_routeToRegExp:function(route){route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/?]+)"}).replace(splatParam,"([^?]*?)");return new RegExp("^"+route+"(?:\\?(.*))?$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param,i){if(i===params.length-1)return param||null;return param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[];_.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var routeStripper=/^[#\/]|\s+$/g;var rootStripper=/^\/+|\/+$/g;var isExplorer=/msie [\w.]+/;var trailingSlash=/\/$/;var pathStripper=/#.*$/;History.started=false;_.extend(History.prototype,Events,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(fragment==null){if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=decodeURI(this.location.pathname+this.location.search);var root=this.root.replace(trailingSlash,"");if(!fragment.indexOf(root))fragment=fragment.slice(root.length)}else{fragment=this.getHash()}}return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=true;this.options=_.extend({root:"/"},this.options,options);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment();var docMode=document.documentMode;var oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||docMode<=7);this.root=("/"+this.root+"/").replace(rootStripper,"/");if(oldIE&&this._wantsHashChange){var frame=Backbone.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=frame.hide().appendTo("body")[0].contentWindow;this.navigate(fragment)}if(this._hasPushState){Backbone.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!oldIE){Backbone.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=fragment;var loc=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){this.fragment=this.getFragment(null,true);this.location.replace(this.root+"#"+this.fragment);return true}else if(this._hasPushState&&this.atRoot()&&loc.hash){this.fragment=this.getHash().replace(routeStripper,"");this.history.replaceState({},document.title,this.root+this.fragment)}}if(!this.options.silent)return this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);History.started=false},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();if(current===this.fragment&&this.iframe){current=this.getFragment(this.getHash(this.iframe))}if(current===this.fragment)return false;if(this.iframe)this.navigate(current);this.loadUrl()},loadUrl:function(fragment){fragment=this.fragment=this.getFragment(fragment);return _.any(this.handlers,function(handler){if(handler.route.test(fragment)){handler.callback(fragment);return true}})},navigate:function(fragment,options){if(!History.started)return false;if(!options||options===true)options={trigger:!!options};var url=this.root+(fragment=this.getFragment(fragment||""));fragment=fragment.replace(pathStripper,"");if(this.fragment===fragment)return;this.fragment=fragment;if(fragment===""&&url!=="/")url=url.slice(0,-1);if(this._hasPushState){this.history[options.replace?"replaceState":"pushState"]({},document.title,url)}else if(this._wantsHashChange){this._updateHash(this.location,fragment,options.replace);if(this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))){if(!options.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,fragment,options.replace)}}else{return this.location.assign(url)}if(options.trigger)return this.loadUrl(fragment)},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else{location.hash="#"+fragment}}});Backbone.history=new History;var extend=function(protoProps,staticProps){
var parent=this;var child;if(protoProps&&_.has(protoProps,"constructor")){child=protoProps.constructor}else{child=function(){return parent.apply(this,arguments)}}_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};Surrogate.prototype=parent.prototype;child.prototype=new Surrogate;if(protoProps)_.extend(child.prototype,protoProps);child.__super__=parent.prototype;return child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')};var wrapError=function(model,options){var error=options.error;options.error=function(resp){if(error)error(model,resp,options);model.trigger("error",model,resp,options)}};return Backbone});function ord(string){var str=string+"",code=str.charCodeAt(0);if(55296<=code&&code<=56319){var hi=code;if(str.length===1){return code}var low=str.charCodeAt(1);return(hi-55296)*1024+(low-56320)+65536}if(56320<=code&&code<=57343){return code}return code}function hexToRgb(hex,alpha){if(isNaN(alpha)||alpha=="NaN"||alpha==NaN)alpha=.8;if(/^#([0-9a-f]{3}|[0-9a-f]{6})$/gi.test(hex)){var hex=hex.substr(1);hex=hex.length==3?hex.replace(/(.)/g,"$1$1"):hex;var rgb=parseInt(hex,16);return"rgba("+[rgb>>16&255,rgb>>8&255,rgb&255].join(", ")+", "+alpha+")"}return false}function rgbToHex(rgba){if(typeof rgba=="undefined")return false;var rgb=rgba.replace(/^rgba?\(|\s+|\)$/g,"").split(",");var hex=rgb&&rgb.length===4?"#"+("0"+parseInt(rgb[0],10).toString(16)).slice(-2)+("0"+parseInt(rgb[1],10).toString(16)).slice(-2)+("0"+parseInt(rgb[2],10).toString(16)).slice(-2):"#FFFFFF";if(isNaN(rgb[3])||rgb[3]=="NaN"||rgb[3]==NaN)rgb[3]=.8;return{hex:hex,alpha:rgb[3]}}function getQueryParams(){var queryString=Backbone.history.location.search.slice(1);if(queryString===""){queryString=Backbone.history.location.hash.split("?").slice(1).join("?")}if(queryString==="")return{};queryString=queryString.split("&");var queryParams={};for(index in queryString){var params=queryString[index].split("=");var key=params[0];var value=params[1];queryParams[key]=value}return queryParams}function setQueryParams(params){var currentParams=getQueryParams();for(index in params){var key=index;var value=params[index];currentParams[key]=value}var uri=Backbone.history.location.pathname+generateQueryString(currentParams);Backbone.history.navigate(uri,{trigger:false})}function generateQueryString(params){var queryString="?";for(index in params){var key=index;var value=params[index];queryString=queryString+key+"="+value+"&"}if(queryString.endsWith("&"))queryString=queryString.slice(0,-1);return queryString}function UrlExists(url){var http=new XMLHttpRequest;http.open("HEAD",url,false);http.send();return http.status!=404}function showBlockMessage(blockElement){$.blockUI({message:$("#"+blockElement)})}function commaSeparateNumber(val){while(/(\d+)(\d{3})/.test(val.toString())){val=val.toString().replace(/(\d+)(\d{3})/,"$1"+","+"$2")}return val}function startPrototyping(){if(typeof MARVELAPP.models.current_user.get("username")!=="undefined"){Backbone.history.navigate("/",{trigger:true})}else{$("#signup").addClass("activated");$(".white-overlay").addClass("activated");ga("send","pageview","/signup-popup/")}}function getProjectPropertyForName(selectedProjectObject,name){for(id in selectedProjectObject.properties){var property=selectedProjectObject.properties[id];if(name==property.name){return property.value}}}function iPadCheck(){return navigator.userAgent.match(/iPad/i)!=null}function androidCheck(){var ua=navigator.userAgent.toLowerCase();return ua.indexOf("android")>-1}function mobileCheck(){return navigator.userAgent.match(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i)!=null}function iPhoneCheck(){return navigator.userAgent.match(/iPhone/i)!=null||navigator.userAgent.match(/iPod/i)!=null}function checkEmail(email){var regex=/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;return regex.test(email)}var STRENGTH_TOO_SHORT=1;var STRENGTH_WEAK=2;var STRENGTH_GOOD=3;var STRENGTH_STRONG=4;function checkStrength(password){var strength=0;if(password.length<6){return STRENGTH_TOO_SHORT}if(password.length>7)strength+=1;if(password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/))strength+=1;if(password.match(/([a-zA-Z])/)&&password.match(/([0-9])/))strength+=1;if(password.match(/([!,%,&,@,#,$,^,*,?,_,~])/))strength+=1;if(password.match(/(.*[!,%,&,@,#,$,^,*,?,_,~].*[!,",%,&,@,#,$,^,*,?,_,~])/))strength+=1;if(strength<2){$("#result").removeClass();$("#result").addClass("weak");return STRENGTH_WEAK}else if(strength==2){$("#result").removeClass();$("#result").addClass("good");return STRENGTH_GOOD}else{$("#result").removeClass();$("#result").addClass("strong");return STRENGTH_STRONG}}function showErrorMessage(message){$(".error-message").html(message);$(".error-message").fadeIn(10)}function hideErrorMessage(){}function hideNotificationMessage(){$(".notification").addClass("hidden")}function showNotificationMessage(notify_type,message){try{noty({text:message,layout:"topCenter",type:notify_type,killer:true,animation:{open:{opacity:"toggle"},close:{opacity:"toggle"},easing:"swing",speed:500},timeout:2e4,closeWith:["click"],template:'<div class="noty_message"><span class="noty_text"></span><div class="notyClose"></div></div>'})}catch(e){}}function showMessage(type,message,animate){if(type==null){var notificationClass="default"}else{var notificationClass=type}var notificationCount=$(".message-notification").length+1;if(animate){var animateClass=""}else{var animateClass="static active"}$("body").prepend('<div id="message-'+notificationCount+'" class="message-notification '+notificationClass+" "+animateClass+'">'+message+'<div class="close"></div></div>');if(animate){setTimeout(function(){$("#message-"+notificationCount).addClass("active")},5e3)}}Object.size=function(obj){var size=0,key;for(key in obj){if(obj.hasOwnProperty(key))size++}return size};function md5cycle(x,k){var a=x[0],b=x[1],c=x[2],d=x[3];a=ff(a,b,c,d,k[0],7,-680876936);d=ff(d,a,b,c,k[1],12,-389564586);c=ff(c,d,a,b,k[2],17,606105819);b=ff(b,c,d,a,k[3],22,-1044525330);a=ff(a,b,c,d,k[4],7,-176418897);d=ff(d,a,b,c,k[5],12,1200080426);c=ff(c,d,a,b,k[6],17,-1473231341);b=ff(b,c,d,a,k[7],22,-45705983);a=ff(a,b,c,d,k[8],7,1770035416);d=ff(d,a,b,c,k[9],12,-1958414417);c=ff(c,d,a,b,k[10],17,-42063);b=ff(b,c,d,a,k[11],22,-1990404162);a=ff(a,b,c,d,k[12],7,1804603682);d=ff(d,a,b,c,k[13],12,-40341101);c=ff(c,d,a,b,k[14],17,-1502002290);b=ff(b,c,d,a,k[15],22,1236535329);a=gg(a,b,c,d,k[1],5,-165796510);d=gg(d,a,b,c,k[6],9,-1069501632);c=gg(c,d,a,b,k[11],14,643717713);b=gg(b,c,d,a,k[0],20,-373897302);a=gg(a,b,c,d,k[5],5,-701558691);d=gg(d,a,b,c,k[10],9,38016083);c=gg(c,d,a,b,k[15],14,-660478335);b=gg(b,c,d,a,k[4],20,-405537848);a=gg(a,b,c,d,k[9],5,568446438);d=gg(d,a,b,c,k[14],9,-1019803690);c=gg(c,d,a,b,k[3],14,-187363961);b=gg(b,c,d,a,k[8],20,1163531501);a=gg(a,b,c,d,k[13],5,-1444681467);d=gg(d,a,b,c,k[2],9,-51403784);c=gg(c,d,a,b,k[7],14,1735328473);b=gg(b,c,d,a,k[12],20,-1926607734);a=hh(a,b,c,d,k[5],4,-378558);d=hh(d,a,b,c,k[8],11,-2022574463);c=hh(c,d,a,b,k[11],16,1839030562);b=hh(b,c,d,a,k[14],23,-35309556);a=hh(a,b,c,d,k[1],4,-1530992060);d=hh(d,a,b,c,k[4],11,1272893353);c=hh(c,d,a,b,k[7],16,-155497632);b=hh(b,c,d,a,k[10],23,-1094730640);a=hh(a,b,c,d,k[13],4,681279174);d=hh(d,a,b,c,k[0],11,-358537222);c=hh(c,d,a,b,k[3],16,-722521979);b=hh(b,c,d,a,k[6],23,76029189);a=hh(a,b,c,d,k[9],4,-640364487);d=hh(d,a,b,c,k[12],11,-421815835);c=hh(c,d,a,b,k[15],16,530742520);b=hh(b,c,d,a,k[2],23,-995338651);a=ii(a,b,c,d,k[0],6,-198630844);d=ii(d,a,b,c,k[7],10,1126891415);c=ii(c,d,a,b,k[14],15,-1416354905);b=ii(b,c,d,a,k[5],21,-57434055);a=ii(a,b,c,d,k[12],6,1700485571);d=ii(d,a,b,c,k[3],10,-1894986606);c=ii(c,d,a,b,k[10],15,-1051523);b=ii(b,c,d,a,k[1],21,-2054922799);a=ii(a,b,c,d,k[8],6,1873313359);d=ii(d,a,b,c,k[15],10,-30611744);c=ii(c,d,a,b,k[6],15,-1560198380);b=ii(b,c,d,a,k[13],21,1309151649);a=ii(a,b,c,d,k[4],6,-145523070);d=ii(d,a,b,c,k[11],10,-1120210379);c=ii(c,d,a,b,k[2],15,718787259);b=ii(b,c,d,a,k[9],21,-343485551);x[0]=add32(a,x[0]);x[1]=add32(b,x[1]);x[2]=add32(c,x[2]);x[3]=add32(d,x[3])}function cmn(q,a,b,x,s,t){a=add32(add32(a,q),add32(x,t));return add32(a<<s|a>>>32-s,b)}function ff(a,b,c,d,x,s,t){return cmn(b&c|~b&d,a,b,x,s,t)}function gg(a,b,c,d,x,s,t){return cmn(b&d|c&~d,a,b,x,s,t)}function hh(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t)}function ii(a,b,c,d,x,s,t){return cmn(c^(b|~d),a,b,x,s,t)}function md51(s){txt="";var n=s.length,state=[1732584193,-271733879,-1732584194,271733878],i;for(i=64;i<=s.length;i+=64){md5cycle(state,md5blk(s.substring(i-64,i)))}s=s.substring(i-64);var tail=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(i=0;i<s.length;i++)tail[i>>2]|=s.charCodeAt(i)<<(i%4<<3);tail[i>>2]|=128<<(i%4<<3);if(i>55){md5cycle(state,tail);for(i=0;i<16;i++)tail[i]=0}tail[14]=n*8;md5cycle(state,tail);return state}function md5blk(s){var md5blks=[],i;for(i=0;i<64;i+=4){md5blks[i>>2]=s.charCodeAt(i)+(s.charCodeAt(i+1)<<8)+(s.charCodeAt(i+2)<<16)+(s.charCodeAt(i+3)<<24)}return md5blks}var hex_chr="0123456789abcdef".split("");function rhex(n){var s="",j=0;for(;j<4;j++)s+=hex_chr[n>>j*8+4&15]+hex_chr[n>>j*8&15];return s}function hex(x){for(var i=0;i<x.length;i++)x[i]=rhex(x[i]);return x.join("")}function md5(s){return hex(md51(s))}function add32(a,b){return a+b&4294967295}if(md5("hello")!="5d41402abc4b2a76b9719d911017c592"){function add32(x,y){var lsw=(x&65535)+(y&65535),msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}}function getElementPosition(param){var x=0,y=0;var obj=typeof param=="string"?document.getElementById(param):param;if(obj){x=obj.offsetLeft;y=obj.offsetTop;var body=document.getElementsByTagName("body")[0];while(obj.offsetParent&&obj!=body){x+=obj.offsetParent.offsetLeft;y+=obj.offsetParent.offsetTop;obj=obj.offsetParent}}return[x,y]}function sleep(ms){var dt=new Date;dt.setTime(dt.getTime()+ms);while((new Date).getTime()<dt.getTime());}function getURLParameter(name){var pid=undefined;var pathArray=window.location.pathname.split("/");try{pid=pathArray[pathArray.length-2];if(pid=="project"){pid=pathArray[2]}}catch(ex){}if(pid==undefined||pid==""||pid=="project"){pid=decodeURI((RegExp(name+"="+"(.+?)(&|$)").exec(location.search)||[,null])[1])}return pid}function copyToClipBoard(s){if(window.clipboardData&&clipboardData.setData){clipboardData.setData("Text",s)}else{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");var clip=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(!clip)return;var trans=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!trans)return;trans.addDataFlavor("text/unicode");var str=new Object;var len=new Object;var str=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);str.data=s;trans.setTransferData("text/unicode",str,str.data.length*2);var clipid=Components.interfaces.nsIClipboard;if(!clip)return false;clip.setData(trans,null,clipid.kGlobalClipboard)}}function validateEmail(email){var email_test=/^([a-z0-9_\.-]+)@([\da-z\.-]+)\.([a-z\.]{2,6})$/;if(email==""||email==" "){$("input[name=email]").focus().before('<div class="error">Empty!</div>');$("input[name=email]").addClass("highlight");return false}else if(!email_test.test(email)){$("input[name=email]").select().before('<div class="error">Incorrect!</div>');$("input[name=email]").addClass("highlight");return false}else{return true}}function capitalise(string){if(string!=undefined){return string.charAt(0).toUpperCase()+string.slice(1).toLowerCase()}else{return""}}function strip(html){var tmp=document.createElement("DIV");tmp.innerHTML=html;return tmp.textContent||tmp.innerText||""}function replaceURLWithHTMLLinks(text){var exp=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi;if(text!=null){return text.replace(exp,'<a target="_blank" href="$1">$1</a>')}else{return""}}function encodeHTML(s){return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}Date.createFromMysql=function(mysql_string){if(typeof mysql_string==="string"){mysql_string=mysql_string.replace("T"," ");mysql_string=mysql_string.replace("Z"," ");var t=mysql_string.split(/[- :]/);return new Date(t[0],t[1]-1,t[2],t[3]||0,t[4]||0,t[5]||0)}return null};function get_display_date(date_obj,m_format,is_year){var tm_format="M";var year="";if(m_format!=undefined){tm_format=m_format;if(is_year==true){year="yy"}}date_obj=date_obj.replace("T"," ");date_obj=date_obj.replace("Z","");var d1=Date.createFromMysql(date_obj);var date_is=parseInt($.datepicker.formatDate("d",d1));var dayFormat="th";if(date_is==1||date_is==21||date_is==31){dayFormat="st"}if(date_is==2||date_is==22){dayFormat="nd"}else if(date_is==3||date_is==23){dayFormat="rd"}var date_is=$.datepicker.formatDate("d'"+dayFormat+"' "+tm_format+" "+year,d1);return date_is}function setEndOfContenteditable(contentEditableElement){var range,selection;if(document.createRange){range=document.createRange();range.selectNodeContents(contentEditableElement);range.collapse(false);selection=window.getSelection();selection.removeAllRanges();selection.addRange(range)}else if(document.selection){range=document.body.createTextRange();range.moveToElementText(contentEditableElement);range.collapse(false);range.select()}}function getGravatar(email,id){email=typeof email!=="undefined"?email:"murat@marvelapp.com";default_image=typeof default_image!=="undefined"?default_image:"https://secure.gravatar.com/avatar/a1e908deeac1ac1412168b63638be7e5?s=300";var gravatar="https://secure.gravatar.com/avatar/"+md5(email.toLowerCase().trim())+"?s=300&default=blank";var randomColour=ord(email+id)%8;var colour_list=["#f15b68","#f4784f","#fbae42","#69be61","#4ac1b9","#a8de49","#78afdf","#776fb3","#f179ab"];var colour=colour_list[ord(email.charAt(0))%colour_list.length];return{url:gravatar,colour:colour}}function getCookie(name){var cookieValue=null;try{if(document.cookie&&document.cookie!=""){var cookies=document.cookie.split(";");for(var i=0;i<cookies.length;i++){var cookie=jQuery.trim(cookies[i]);if(cookie.substring(0,name.length+1)==name+"="){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}}}catch(except){}return cookieValue}var csrftoken=getCookie("csrftoken");function csrfSafeMethod(method){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(method)}var AJAXLogger=Logger.get("AJAX");function handleAJAXError(jqXHR){if(jqXHR.status===403&&jqXHR.getResponseHeader("x-marvel")){console.log(jqXHR);var response=jqXHR.responseText;if(response=='{"detail": "Authentication credentials were not provided."}'||response=='{"detail": "CSRF Failed: CSRF token missing or incorrect."}'){if(MARVELAPP.Router.currentView){if(MARVELAPP.Router.currentView&&_.isFunction(MARVELAPP.Router.currentView.openSessionExpiredModal)){MARVELAPP.Router.currentView.openSessionExpiredModal()}}}}}$.ajaxSetup({crossDomain:false,beforeSend:function(xhr,settings){if(!csrfSafeMethod(settings.type)){xhr.setRequestHeader("X-CSRFToken",csrftoken)}},error:function(jqXHR){handleAJAXError(jqXHR)}});$(document).ajaxError(function(document,jqXHR){handleAJAXError(jqXHR)});function encode_utf8(s){return unescape(encodeURIComponent(s))}function convertDateTimeToUTC(datetime){return new Date(datetime.getUTCFullYear(),datetime.getUTCMonth(),datetime.getUTCDate(),datetime.getUTCHours(),datetime.getUTCMinutes(),datetime.getUTCSeconds(),datetime.getUTCMilliseconds())}function generateUUID(){var d=(new Date).getTime();var uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c=="x"?r:r&7|8).toString(16)});return uuid}(function($){$.fn.extend({limiter:function(limit,elem){$(this).on("keyup focus",function(){setCount(this,elem)});function setCount(src,elem){var chars=src.value.length;if(chars>limit){src.value=src.value.substr(0,limit);chars=limit}elem.html(limit-chars)}setCount($(this)[0],elem)}})})(jQuery);function getParameterByName(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return results===null?"":decodeURIComponent(results[1].replace(/\+/g," "))}!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();{var c=this,d=c.opts,f=c.el=e(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});d.radius+d.length+d.width}if(e(f,{left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h});var urlize=function(){var split;split=split||function(undef){var nativeSplit=String.prototype.split,compliantExecNpcg=/()??/.exec("")[1]===undef,self;self=function(str,separator,limit){if(Object.prototype.toString.call(separator)!=="[object RegExp]"){return nativeSplit.call(str,separator,limit)}var output=[],flags=(separator.ignoreCase?"i":"")+(separator.multiline?"m":"")+(separator.extended?"x":"")+(separator.sticky?"y":""),lastLastIndex=0,separator=new RegExp(separator.source,flags+"g"),separator2,match,lastIndex,lastLength;str+="";if(!compliantExecNpcg){separator2=new RegExp("^"+separator.source+"$(?!\\s)",flags)}limit=limit===undef?-1>>>0:limit>>>0;while(match=separator.exec(str)){lastIndex=match.index+match[0].length;if(lastIndex>lastLastIndex){output.push(str.slice(lastLastIndex,match.index));if(!compliantExecNpcg&&match.length>1){match[0].replace(separator2,function(){for(var i=1;i<arguments.length-2;i++){if(arguments[i]===undef){match[i]=undef}}})}if(match.length>1&&match.index<str.length){Array.prototype.push.apply(output,match.slice(1))}lastLength=match[0].length;lastLastIndex=lastIndex;if(output.length>=limit){break}}if(separator.lastIndex===match.index){separator.lastIndex++}}if(lastLastIndex===str.length){if(lastLength||!separator.test("")){output.push("")}}else{output.push(str.slice(lastLastIndex))}return output.length>limit?output.slice(0,limit):output};return self}();function startswith(string,prefix){return string.substr(0,prefix.length)==prefix}function endswith(string,suffix){return string.substr(string.length-suffix.length,suffix.length)==suffix}function occurrences(string,substring){var n=0;var pos=0;while(true){pos=string.indexOf(substring,pos);if(pos!=-1){n++;pos+=substring.length}else{break}}return n}var unquoted_percents_re=/%(?![0-9A-Fa-f]{2})/;function smart_urlquote(url){var colonIndex=url.indexOf(":");url=url.substring(0,colonIndex).toLowerCase()+url.substring(colonIndex);if(url.indexOf("%")==-1||url.match(unquoted_percents_re)){return encodeURI(url)}else{return url}}var trailing_punctuation_django=[".",",",":",";"];var trailing_punctuation_improved=[".",",",":",";",".)"];var wrapping_punctuation_django=[["(",")"],["<",">"],["&lt;","&gt;"]];var wrapping_punctuation_improved=[["(",")"],["<",">"],["&lt;","&gt;"],["“","”"],["‘","’"]];var word_split_re_django=/(\s+)/;var word_split_re_improved=/([\s<>"]+)/;var simple_url_re=/^https?:\/\/\w/i;var django_top_level_domains=["aero","biz","cat","com","coop","edu","gov","info","int","jobs","mil","mobi","museum","name","net","org","travel","ac","ad","ae","af","ag","ai","al","am","an","ao","aq","ar","as","at","au","aw","az","ba","bb","bd","be","bf","bg","bh","bi","bj","bm","bn","bo","br","bs","bt","bv","bw","by","bz","ca","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","cr","cs","cu","cv","cx","cy","cz","de","dj","dk","dm","do","dz","ec","ee","eg","eh","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","io","iq","ir","is","it","je","jm","jo","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","mg","mh","mk","ml","mm","mn","mo","mp","mq","mr","ms","mt","mu","mv","mw","mx","my","mz","na","nc","ne","nf","ng","ni","nl","no","np","nr","nu","nz","om","pa","pe","pf","pg","ph","pk","pl","pm","pn","pr","ps","pt","pw","py","qa","re","ro","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","sk","sl","sm","sn","so","sr","st","su","sv","sy","sz","tc","td","tf","tg","th","tj","tk","tm","tn","to","tp","tr","tt","tv","tw","tz","ua","ug","uk","um","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","ye","yt","yu","za","zm","zr","zw"];var simple_email_re=/^\S+@\S+\.\S+$/;function htmlescape(html,options){var escaped=html.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;");if(options&&!options.django_compatible){escaped=escaped.replace(/\//g,"&#47;")}return escaped}function urlescape(url){return url.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function convert_arguments(args){var options;if(args.length==2&&typeof args[1]=="object"){options=args[1]}else{options={nofollow:args[1],autoescape:args[2],trim_url_limit:args[3],target:args[4]}}if(!("django_compatible"in options))options.django_compatible=true;return options}function urlize(text,options){options=convert_arguments(arguments);function trim_url(x,limit){if(options.trim==="http"||options.trim==="www")x=x.replace(/^https?:\/\//i,"");if(options.trim==="www")x=x.replace(/^www\./i,"");if(limit===undefined)limit=options.trim_url_limit;if(limit&&x.length>limit)return x.substr(0,limit-3)+"...";return x}var safe_input=false;var word_split_re=options.django_compatible?word_split_re_django:word_split_re_improved;var trailing_punctuation=options.django_compatible?trailing_punctuation_django:trailing_punctuation_improved;var wrapping_punctuation=options.django_compatible?wrapping_punctuation_django:wrapping_punctuation_improved;var simple_url_2_re=new RegExp("^www\\.|^(?!http)\\w[^@]+\\.("+(options.top_level_domains||django_top_level_domains).join("|")+")$","i");var words=split(text,word_split_re);for(var i=0;i<words.length;i++){var word=words[i];var match=undefined;if(word.indexOf(".")!=-1||word.indexOf("@")!=-1||word.indexOf(":")!=-1){var lead="";var middle=word;var trail="";for(var j=0;j<trailing_punctuation.length;j++){var punctuation=trailing_punctuation[j];if(endswith(middle,punctuation)){middle=middle.substr(0,middle.length-punctuation.length);trail=punctuation+trail}}for(var j=0;j<wrapping_punctuation.length;j++){var opening=wrapping_punctuation[j][0];var closing=wrapping_punctuation[j][1];if(startswith(middle,opening)){middle=middle.substr(opening.length);lead=lead+opening}if(endswith(middle,closing)&&occurrences(middle,closing)==occurrences(middle,opening)+1){middle=middle.substr(0,middle.length-closing.length);trail=closing+trail}}var url=undefined;var nofollow_attr=options.nofollow?' rel="nofollow"':"";var target_attr=options.target?' target="'+options.target+'"':"";if(middle.match(simple_url_re))url=smart_urlquote(middle);else if(middle.match(simple_url_2_re))url=smart_urlquote("http://"+middle);else if(middle.indexOf(":")==-1&&middle.match(simple_email_re)){url="mailto:"+middle;nofollow_attr=""}if(url){var trimmed=trim_url(middle);if(options.autoescape){lead=htmlescape(lead,options);trail=htmlescape(trail,options);url=urlescape(url);trimmed=htmlescape(trimmed,options)}middle='<a href="'+url+'"'+nofollow_attr+target_attr+">"+trimmed+"</a>";words[i]=lead+middle+trail}else{if(safe_input){}else if(options.autoescape){words[i]=htmlescape(word,options)}}}else if(safe_input){}else if(options.autoescape){words[i]=htmlescape(word,options)}}return words.join("")}urlize.test={};urlize.test.split=split;urlize.test.convert_arguments=convert_arguments;return urlize}();var dateFormat=function(){var token=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,timezone=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,timezoneClip=/[^-+\dA-Z]/g,pad=function(val,len){val=String(val);len=len||2;while(val.length<len)val="0"+val;return val};return function(date,mask,utc){var dF=dateFormat;if(arguments.length==1&&Object.prototype.toString.call(date)=="[object String]"&&!/\d/.test(date)){mask=date;date=undefined}date=date?new Date(date):new Date;if(isNaN(date))throw SyntaxError("invalid date");mask=String(dF.masks[mask]||mask||dF.masks["default"]);if(mask.slice(0,4)=="UTC:"){mask=mask.slice(4);utc=true}var _=utc?"getUTC":"get",d=date[_+"Date"](),D=date[_+"Day"](),m=date[_+"Month"](),y=date[_+"FullYear"](),H=date[_+"Hours"](),M=date[_+"Minutes"](),s=date[_+"Seconds"](),L=date[_+"Milliseconds"](),o=utc?0:date.getTimezoneOffset(),flags={d:d,dd:pad(d),ddd:dF.i18n.dayNames[D],dddd:dF.i18n.dayNames[D+7],m:m+1,mm:pad(m+1),mmm:dF.i18n.monthNames[m],mmmm:dF.i18n.monthNames[m+12],yy:String(y).slice(2),yyyy:y,h:H%12||12,hh:pad(H%12||12),H:H,HH:pad(H),M:M,MM:pad(M),s:s,ss:pad(s),l:pad(L,3),L:pad(L>99?Math.round(L/10):L),t:H<12?"a":"p",tt:H<12?"am":"pm",T:H<12?"A":"P",TT:H<12?"AM":"PM",Z:utc?"UTC":(String(date).match(timezone)||[""]).pop().replace(timezoneClip,""),o:(o>0?"-":"+")+pad(Math.floor(Math.abs(o)/60)*100+Math.abs(o)%60,4),S:["th","st","nd","rd"][d%10>3?0:(d%100-d%10!=10)*d%10]};return mask.replace(token,function($0){return $0 in flags?flags[$0]:$0.slice(1,$0.length-1)})}}();dateFormat.masks={"default":"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"};dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]};Date.prototype.format=function(mask,utc){return dateFormat(this,mask,utc)};function addDefaultSchemeToUrl(url){if(url.toLowerCase().indexOf("http")!==0){url="http://"+url}return url}function updateObject(object1,object2){for(var attributeName in object2){object1[attributeName]=object2[attributeName]}return object1}function isSafeUrl(url){var parser=document.createElement("a");parser.href=url;return parser.hostname===window.location.hostname}(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory)}else{factory(jQuery)}})(function($){var pluses=/\+/g;function encode(s){return config.raw?s:encodeURIComponent(s)}function decode(s){return config.raw?s:decodeURIComponent(s)}function stringifyCookieValue(value){return encode(config.json?JSON.stringify(value):String(value))}function parseCookieValue(s){if(s.indexOf('"')===0){s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")}try{s=decodeURIComponent(s.replace(pluses," "));return config.json?JSON.parse(s):s}catch(e){}}function read(s,converter){var value=config.raw?s:parseCookieValue(s);return $.isFunction(converter)?converter(value):value}var config=$.cookie=function(key,value,options){if(value!==undefined&&!$.isFunction(value)){options=$.extend({},config.defaults,options);if(typeof options.expires==="number"){var days=options.expires,t=options.expires=new Date;t.setTime(+t+days*864e5)}return document.cookie=[encode(key),"=",stringifyCookieValue(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}var result=key?undefined:{};var cookies=document.cookie?document.cookie.split("; "):[];for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split("=");var name=decode(parts.shift());var cookie=parts.join("=");if(key&&key===name){result=read(cookie,value);break}if(!key&&(cookie=read(cookie))!==undefined){result[name]=cookie}}return result};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)===undefined){return false}$.cookie(key,"",$.extend({},options,{expires:-1}));return!$.cookie(key)}});(function($){var types=["DOMMouseScroll","mousewheel"];if($.event.fixHooks){
for(var i=types.length;i;){$.event.fixHooks[types[--i]]=$.event.mouseHooks}}$.event.special.mousewheel={setup:function(){if(this.addEventListener){for(var i=types.length;i;){this.addEventListener(types[--i],handler,false)}}else{this.onmousewheel=handler}},teardown:function(){if(this.removeEventListener){for(var i=types.length;i;){this.removeEventListener(types[--i],handler,false)}}else{this.onmousewheel=null}}};$.fn.extend({mousewheel:function(fn){return fn?this.bind("mousewheel",fn):this.trigger("mousewheel")},unmousewheel:function(fn){return this.unbind("mousewheel",fn)}});function handler(event){var orgEvent=event||window.event,args=[].slice.call(arguments,1),delta=0,returnValue=true,deltaX=0,deltaY=0;event=$.event.fix(orgEvent);event.type="mousewheel";if(orgEvent.wheelDelta){delta=orgEvent.wheelDelta/120}if(orgEvent.detail){delta=-orgEvent.detail/3}deltaY=delta;if(orgEvent.axis!==undefined&&orgEvent.axis===orgEvent.HORIZONTAL_AXIS){deltaY=0;deltaX=-1*delta}if(orgEvent.wheelDeltaY!==undefined){deltaY=orgEvent.wheelDeltaY/120}if(orgEvent.wheelDeltaX!==undefined){deltaX=-1*orgEvent.wheelDeltaX/120}args.unshift(event,delta,deltaX,deltaY);return($.event.dispatch||$.event.handle).apply(this,args)}})(jQuery);(function(C,r,g){function t(a,b,h){a.addEventListener?a.addEventListener(b,h,!1):a.attachEvent("on"+b,h)}function x(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);a.shiftKey||(b=b.toLowerCase());return b}return l[a.which]?l[a.which]:p[a.which]?p[a.which]:String.fromCharCode(a.which).toLowerCase()}function D(a){var b=[];a.shiftKey&&b.push("shift");a.altKey&&b.push("alt");a.ctrlKey&&b.push("ctrl");a.metaKey&&b.push("meta");return b}function u(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function y(a,b){var h,c,e,g=[];h=a;"+"===h?h=["+"]:(h=h.replace(/\+{2}/g,"+plus"),h=h.split("+"));for(e=0;e<h.length;++e)c=h[e],z[c]&&(c=z[c]),b&&"keypress"!=b&&A[c]&&(c=A[c],g.push("shift")),u(c)&&g.push(c);h=c;e=b;if(!e){if(!k){k={};for(var m in l)95<m&&112>m||l.hasOwnProperty(m)&&(k[l[m]]=m)}e=k[h]?"keydown":"keypress"}"keypress"==e&&g.length&&(e="keydown");return{key:c,modifiers:g,action:e}}function B(a,b){return a===r?!1:a===b?!0:B(a.parentNode,b)}function c(a){function b(a){a=a||{};var b=!1,n;for(n in q)a[n]?b=!0:q[n]=0;b||(v=!1)}function h(a,b,n,f,c,h){var g,e,l=[],m=n.type;if(!d._callbacks[a])return[];"keyup"==m&&u(a)&&(b=[a]);for(g=0;g<d._callbacks[a].length;++g)if(e=d._callbacks[a][g],(f||!e.seq||q[e.seq]==e.level)&&m==e.action){var k;(k="keypress"==m&&!n.metaKey&&!n.ctrlKey)||(k=e.modifiers,k=b.sort().join(",")===k.sort().join(","));k&&(k=f&&e.seq==f&&e.level==h,(!f&&e.combo==c||k)&&d._callbacks[a].splice(g,1),l.push(e))}return l}function g(a,b,n,f){d.stopCallback(b,b.target||b.srcElement,n,f)||!1!==a(b,n)||(b.preventDefault?b.preventDefault():b.returnValue=!1,b.stopPropagation?b.stopPropagation():b.cancelBubble=!0)}function e(a){"number"!==typeof a.which&&(a.which=a.keyCode);var b=x(a);b&&("keyup"==a.type&&w===b?w=!1:d.handleKey(b,D(a),a))}function l(a,c,n,f){function e(c){return function(){v=c;++q[a];clearTimeout(k);k=setTimeout(b,1e3)}}function h(c){g(n,c,a);"keyup"!==f&&(w=x(c));setTimeout(b,10)}for(var d=q[a]=0;d<c.length;++d){var p=d+1===c.length?h:e(f||y(c[d+1]).action);m(c[d],p,f,a,d)}}function m(a,b,c,f,e){d._directMap[a+":"+c]=b;a=a.replace(/\s+/g," ");var g=a.split(" ");1<g.length?l(a,g,b,c):(c=y(a,c),d._callbacks[c.key]=d._callbacks[c.key]||[],h(c.key,c.modifiers,{type:c.action},f,a,e),d._callbacks[c.key][f?"unshift":"push"]({callback:b,modifiers:c.modifiers,action:c.action,seq:f,level:e,combo:a}))}var d=this;a=a||r;if(!(d instanceof c))return new c(a);d.target=a;d._callbacks={};d._directMap={};var q={},k,w=!1,p=!1,v=!1;d._handleKey=function(a,c,e){var f=h(a,c,e),d;c={};var k=0,l=!1;for(d=0;d<f.length;++d)f[d].seq&&(k=Math.max(k,f[d].level));for(d=0;d<f.length;++d)f[d].seq?f[d].level==k&&(l=!0,c[f[d].seq]=1,g(f[d].callback,e,f[d].combo,f[d].seq)):l||g(f[d].callback,e,f[d].combo);f="keypress"==e.type&&p;e.type!=v||u(a)||f||b(c);p=l&&"keydown"==e.type};d._bindMultiple=function(a,b,c){for(var d=0;d<a.length;++d)m(a[d],b,c)};t(a,"keypress",e);t(a,"keydown",e);t(a,"keyup",e)}var l={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},p={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},A={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},z={option:"alt",command:"meta","return":"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},k;for(g=1;20>g;++g)l[111+g]="f"+g;for(g=0;9>=g;++g)l[g+96]=g;c.prototype.bind=function(a,b,c){a=a instanceof Array?a:[a];this._bindMultiple.call(this,a,b,c);return this};c.prototype.unbind=function(a,b){return this.bind.call(this,a,function(){},b)};c.prototype.trigger=function(a,b){if(this._directMap[a+":"+b])this._directMap[a+":"+b]({},a);return this};c.prototype.reset=function(){this._callbacks={};this._directMap={};return this};c.prototype.stopCallback=function(a,b){return-1<(" "+b.className+" ").indexOf(" mousetrap ")||B(b,this.target)?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.isContentEditable};c.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)};c.init=function(){var a=c(r),b;for(b in a)"_"!==b.charAt(0)&&(c[b]=function(b){return function(){return a[b].apply(a,arguments)}}(b))};c.init();C.Mousetrap=c;"undefined"!==typeof module&&module.exports&&(module.exports=c);"function"===typeof define&&define.amd&&define(function(){return c})})(window,document);function FastClick(layer){"use strict";var oldOnClick;this.trackingClick=false;this.trackingClickStart=0;this.targetElement=null;this.touchStartX=0;this.touchStartY=0;this.lastTouchIdentifier=0;this.touchBoundary=10;this.layer=layer;if(FastClick.notNeeded(layer)){return}function bind(method,context){return function(){return method.apply(context,arguments)}}if(deviceIsAndroid){layer.addEventListener("mouseover",bind(this.onMouse,this),true);layer.addEventListener("mousedown",bind(this.onMouse,this),true);layer.addEventListener("mouseup",bind(this.onMouse,this),true)}layer.addEventListener("click",bind(this.onClick,this),true);layer.addEventListener("touchstart",bind(this.onTouchStart,this),false);layer.addEventListener("touchmove",bind(this.onTouchMove,this),false);layer.addEventListener("touchend",bind(this.onTouchEnd,this),false);layer.addEventListener("touchcancel",bind(this.onTouchCancel,this),false);if(!Event.prototype.stopImmediatePropagation){layer.removeEventListener=function(type,callback,capture){var rmv=Node.prototype.removeEventListener;if(type==="click"){rmv.call(layer,type,callback.hijacked||callback,capture)}else{rmv.call(layer,type,callback,capture)}};layer.addEventListener=function(type,callback,capture){var adv=Node.prototype.addEventListener;if(type==="click"){adv.call(layer,type,callback.hijacked||(callback.hijacked=function(event){if(!event.propagationStopped){callback(event)}}),capture)}else{adv.call(layer,type,callback,capture)}}}if(typeof layer.onclick==="function"){oldOnClick=layer.onclick;layer.addEventListener("click",function(event){oldOnClick(event)},false);layer.onclick=null}}var deviceIsAndroid=navigator.userAgent.indexOf("Android")>0;var deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent);var deviceIsIOS4=deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent);var deviceIsIOSWithBadTarget=deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent);FastClick.prototype.needsClick=function(target){"use strict";switch(target.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(target.disabled){return true}break;case"input":if(deviceIsIOS&&target.type==="file"||target.disabled){return true}break;case"label":case"video":return true}return/\bneedsclick\b/.test(target.className)};FastClick.prototype.needsFocus=function(target){"use strict";switch(target.nodeName.toLowerCase()){case"textarea":return true;case"select":return!deviceIsAndroid;case"input":switch(target.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return false}return!target.disabled&&!target.readOnly;default:return/\bneedsfocus\b/.test(target.className)}};FastClick.prototype.sendClick=function(targetElement,event){"use strict";var clickEvent,touch;if(document.activeElement&&document.activeElement!==targetElement){document.activeElement.blur()}touch=event.changedTouches[0];clickEvent=document.createEvent("MouseEvents");clickEvent.initMouseEvent(this.determineEventType(targetElement),true,true,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,false,false,false,false,0,null);clickEvent.forwardedTouchEvent=true;targetElement.dispatchEvent(clickEvent)};FastClick.prototype.determineEventType=function(targetElement){"use strict";if(deviceIsAndroid&&targetElement.tagName.toLowerCase()==="select"){return"mousedown"}return"click"};FastClick.prototype.focus=function(targetElement){"use strict";var length;if(deviceIsIOS&&targetElement.setSelectionRange&&targetElement.type.indexOf("date")!==0&&targetElement.type!=="time"){length=targetElement.value.length;targetElement.setSelectionRange(length,length)}else{targetElement.focus()}};FastClick.prototype.updateScrollParent=function(targetElement){"use strict";var scrollParent,parentElement;scrollParent=targetElement.fastClickScrollParent;if(!scrollParent||!scrollParent.contains(targetElement)){parentElement=targetElement;do{if(parentElement.scrollHeight>parentElement.offsetHeight){scrollParent=parentElement;targetElement.fastClickScrollParent=parentElement;break}parentElement=parentElement.parentElement}while(parentElement)}if(scrollParent){scrollParent.fastClickLastScrollTop=scrollParent.scrollTop}};FastClick.prototype.getTargetElementFromEventTarget=function(eventTarget){"use strict";if(eventTarget.nodeType===Node.TEXT_NODE){return eventTarget.parentNode}return eventTarget};FastClick.prototype.onTouchStart=function(event){"use strict";var targetElement,touch,selection;if(event.targetTouches.length>1){return true}targetElement=this.getTargetElementFromEventTarget(event.target);touch=event.targetTouches[0];if(deviceIsIOS){selection=window.getSelection();if(selection.rangeCount&&!selection.isCollapsed){return true}if(!deviceIsIOS4){if(touch.identifier===this.lastTouchIdentifier){event.preventDefault();return false}this.lastTouchIdentifier=touch.identifier;this.updateScrollParent(targetElement)}}this.trackingClick=true;this.trackingClickStart=event.timeStamp;this.targetElement=targetElement;this.touchStartX=touch.pageX;this.touchStartY=touch.pageY;if(event.timeStamp-this.lastClickTime<200){event.preventDefault()}return true};FastClick.prototype.touchHasMoved=function(event){"use strict";var touch=event.changedTouches[0],boundary=this.touchBoundary;if(Math.abs(touch.pageX-this.touchStartX)>boundary||Math.abs(touch.pageY-this.touchStartY)>boundary){return true}return false};FastClick.prototype.onTouchMove=function(event){"use strict";if(!this.trackingClick){return true}if(this.targetElement!==this.getTargetElementFromEventTarget(event.target)||this.touchHasMoved(event)){this.trackingClick=false;this.targetElement=null}return true};FastClick.prototype.findControl=function(labelElement){"use strict";if(labelElement.control!==undefined){return labelElement.control}if(labelElement.htmlFor){return document.getElementById(labelElement.htmlFor)}return labelElement.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")};FastClick.prototype.onTouchEnd=function(event){"use strict";var forElement,trackingClickStart,targetTagName,scrollParent,touch,targetElement=this.targetElement;if(!this.trackingClick){return true}if(event.timeStamp-this.lastClickTime<200){this.cancelNextClick=true;return true}this.cancelNextClick=false;this.lastClickTime=event.timeStamp;trackingClickStart=this.trackingClickStart;this.trackingClick=false;this.trackingClickStart=0;if(deviceIsIOSWithBadTarget){touch=event.changedTouches[0];targetElement=document.elementFromPoint(touch.pageX-window.pageXOffset,touch.pageY-window.pageYOffset)||targetElement;targetElement.fastClickScrollParent=this.targetElement.fastClickScrollParent}targetTagName=targetElement.tagName.toLowerCase();if(targetTagName==="label"){forElement=this.findControl(targetElement);if(forElement){this.focus(targetElement);if(deviceIsAndroid){return false}targetElement=forElement}}else if(this.needsFocus(targetElement)){if(event.timeStamp-trackingClickStart>100||deviceIsIOS&&window.top!==window&&targetTagName==="input"){this.targetElement=null;return false}this.focus(targetElement);this.sendClick(targetElement,event);if(!deviceIsIOS4||targetTagName!=="select"){this.targetElement=null;event.preventDefault()}return false}if(deviceIsIOS&&!deviceIsIOS4){scrollParent=targetElement.fastClickScrollParent;if(scrollParent&&scrollParent.fastClickLastScrollTop!==scrollParent.scrollTop){return true}}if(!this.needsClick(targetElement)){event.preventDefault();this.sendClick(targetElement,event)}return false};FastClick.prototype.onTouchCancel=function(){"use strict";this.trackingClick=false;this.targetElement=null};FastClick.prototype.onMouse=function(event){"use strict";if(!this.targetElement){return true}if(event.forwardedTouchEvent){return true}if(!event.cancelable){return true}if(!this.needsClick(this.targetElement)||this.cancelNextClick){if(event.stopImmediatePropagation){event.stopImmediatePropagation()}else{event.propagationStopped=true}event.stopPropagation();event.preventDefault();return false}return true};FastClick.prototype.onClick=function(event){"use strict";var permitted;if(this.trackingClick){this.targetElement=null;this.trackingClick=false;return true}if(event.target.type==="submit"&&event.detail===0){return true}permitted=this.onMouse(event);if(!permitted){this.targetElement=null}return permitted};FastClick.prototype.destroy=function(){"use strict";var layer=this.layer;if(deviceIsAndroid){layer.removeEventListener("mouseover",this.onMouse,true);layer.removeEventListener("mousedown",this.onMouse,true);layer.removeEventListener("mouseup",this.onMouse,true)}layer.removeEventListener("click",this.onClick,true);layer.removeEventListener("touchstart",this.onTouchStart,false);layer.removeEventListener("touchmove",this.onTouchMove,false);layer.removeEventListener("touchend",this.onTouchEnd,false);layer.removeEventListener("touchcancel",this.onTouchCancel,false)};FastClick.notNeeded=function(layer){"use strict";var metaViewport;var chromeVersion;if(typeof window.ontouchstart==="undefined"){return true}chromeVersion=+(/Chrome\/([0-9]+)/.exec(navigator.userAgent)||[,0])[1];if(chromeVersion){if(deviceIsAndroid){metaViewport=document.querySelector("meta[name=viewport]");if(metaViewport){if(metaViewport.content.indexOf("user-scalable=no")!==-1){return true}if(chromeVersion>31&&window.innerWidth<=window.screen.width){return true}}}else{return true}}if(layer.style.msTouchAction==="none"){return true}return false};FastClick.attach=function(layer){"use strict";return new FastClick(layer)};if(typeof define!=="undefined"&&define.amd){define(function(){"use strict";return FastClick})}else if(typeof module!=="undefined"&&module.exports){module.exports=FastClick.attach;module.exports.FastClick=FastClick}else{window.FastClick=FastClick}if(!Function("/*@cc_on return document.documentMode===10@*/")()){(function(){var e;e=function(){var e,t,n;t=[];e=function(t,r){var i;if(!t){return n()}else if(e.toType(t)==="function"){return e(document).ready(t)}else{i=e.getDOMObject(t,r);return n(i,t)}};n=function(e,r){e=e||t;e.__proto__=n.prototype;e.selector=r||"";return e};e.extend=function(e){Array.prototype.slice.call(arguments,1).forEach(function(t){var n,r;r=[];for(n in t){r.push(e[n]=t[n])}return r});return e};n.prototype=e.fn={};return e}();window.Quo=e;"$$"in window||(window.$$=e)}).call(this);(function(){(function(e){var t,n,r,i,u,a,o,s,c,f,l;t={TYPE:"GET",MIME:"json"};r={script:"text/javascript, application/javascript",json:"application/json",xml:"application/xml, text/xml",html:"text/html",text:"text/plain"};n=0;e.ajaxSettings={type:t.TYPE,async:true,success:{},error:{},context:null,dataType:t.MIME,headers:{},xhr:function(){return new window.XMLHttpRequest},crossDomain:false,timeout:0};e.ajax=function(n){var r,o,f,h;f=e.mix(e.ajaxSettings,n);if(f.type===t.TYPE){f.url+=e.serializeParameters(f.data,"?")}else{f.data=e.serializeParameters(f.data)}if(i(f.url)){return e.jsonp(f)}h=f.xhr();h.onreadystatechange=function(){if(h.readyState===4){clearTimeout(r);return c(h,f)}};h.open(f.type,f.url,f.async);s(h,f);if(f.timeout>0){r=setTimeout(function(){return l(h,f)},f.timeout)}try{h.send(f.data)}catch(d){o=d;h=o;a("Resource not found",h,f)}if(f.async){return h}else{return u(h,f)}};e.jsonp=function(t){var r,i,u,a;if(t.async){i="jsonp"+ ++n;u=document.createElement("script");a={abort:function(){e(u).remove();if(i in window){return window[i]={}}}};r=void 0;window[i]=function(n){clearTimeout(r);e(u).remove();delete window[i];return f(n,a,t)};u.src=t.url.replace(RegExp("=\\?"),"="+i);e("head").append(u);if(t.timeout>0){r=setTimeout(function(){return l(a,t)},t.timeout)}return a}else{return console.error("QuoJS.ajax: Unable to make jsonp synchronous call.")}};e.get=function(t,n,r,i){return e.ajax({url:t,data:n,success:r,dataType:i})};e.post=function(e,t,n,r){return o("POST",e,t,n,r)};e.put=function(e,t,n,r){return o("PUT",e,t,n,r)};e["delete"]=function(e,t,n,r){return o("DELETE",e,t,n,r)};e.json=function(n,r,i){return e.ajax({url:n,data:r,success:i,dataType:t.MIME})};e.serializeParameters=function(e,t){var n,r;if(t==null){t=""}r=t;for(n in e){if(e.hasOwnProperty(n)){if(r!==t){r+="&"}r+=""+encodeURIComponent(n)+"="+encodeURIComponent(e[n])}}if(r===t){return""}else{return r}};c=function(e,t){if(e.status>=200&&e.status<300||e.status===0){if(t.async){f(u(e,t),e,t)}}else{a("QuoJS.ajax: Unsuccesful request",e,t)}};f=function(e,t,n){n.success.call(n.context,e,t)};a=function(e,t,n){n.error.call(n.context,e,t,n)};s=function(e,t){var n;if(t.contentType){t.headers["Content-Type"]=t.contentType}if(t.dataType){t.headers["Accept"]=r[t.dataType]}for(n in t.headers){e.setRequestHeader(n,t.headers[n])}};l=function(e,t){e.onreadystatechange={};e.abort();a("QuoJS.ajax: Timeout exceeded",e,t)};o=function(t,n,r,i,u){return e.ajax({type:t,url:n,data:r,success:i,dataType:u,contentType:"application/x-www-form-urlencoded"})};u=function(e,n){var r,i;i=e.responseText;if(i){if(n.dataType===t.MIME){try{i=JSON.parse(i)}catch(u){r=u;i=r;a("QuoJS.ajax: Parse Error",e,n)}}else{if(n.dataType==="xml"){i=e.responseXML}}}return i};return i=function(e){return RegExp("=\\?").test(e)}})(Quo)}).call(this);(function(){(function(e){var t,n,r,i,u,a,o,s;t=[];i=Object.prototype;r=/^\s*<(\w+|!)[^>]*>/;u=document.createElement("table");a=document.createElement("tr");n={tr:document.createElement("tbody"),tbody:u,thead:u,tfoot:u,td:a,th:a,"*":document.createElement("div")};e.toType=function(e){return i.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()};e.isOwnProperty=function(e,t){return i.hasOwnProperty.call(e,t)};e.getDOMObject=function(t,n){var i,u,a;i=null;u=[1,9,11];a=e.toType(t);if(a==="array"){i=o(t)}else if(a==="string"&&r.test(t)){i=e.fragment(t.trim(),RegExp.$1);t=null}else if(a==="string"){i=e.query(document,t);if(n){if(i.length===1){i=e.query(i[0],n)}else{i=e.map(function(){return e.query(i,n)})}}}else if(u.indexOf(t.nodeType)>=0||t===window){i=[t];t=null}return i};e.map=function(t,n){var r,i,u,a;a=[];r=void 0;i=void 0;if(e.toType(t)==="array"){r=0;while(r<t.length){u=n(t[r],r);if(u!=null){a.push(u)}r++}}else{for(i in t){u=n(t[i],i);if(u!=null){a.push(u)}}}return s(a)};e.each=function(t,n){var r,i;r=void 0;i=void 0;if(e.toType(t)==="array"){r=0;while(r<t.length){if(n.call(t[r],r,t[r])===false){return t}r++}}else{for(i in t){if(n.call(t[i],i,t[i])===false){return t}}}return t};e.mix=function(){var t,n,r,i,u;r={};t=0;i=arguments.length;while(t<i){n=arguments[t];for(u in n){if(e.isOwnProperty(n,u)&&n[u]!==undefined){r[u]=n[u]}}t++}return r};e.fragment=function(t,r){var i;if(r==null){r="*"}if(!(r in n)){r="*"}i=n[r];i.innerHTML=""+t;return e.each(Array.prototype.slice.call(i.childNodes),function(){return i.removeChild(this)})};e.fn.map=function(t){return e.map(this,function(e,n){return t.call(e,n,e)})};e.fn.instance=function(e){return this.map(function(){return this[e]})};e.fn.filter=function(t){return e([].filter.call(this,function(n){return n.parentNode&&e.query(n.parentNode,t).indexOf(n)>=0}))};e.fn.forEach=t.forEach;e.fn.indexOf=t.indexOf;o=function(e){return e.filter(function(e){return e!==void 0&&e!==null})};return s=function(e){if(e.length>0){return[].concat.apply([],e)}else{return e}}})(Quo)}).call(this);(function(){(function(e){e.fn.attr=function(t,n){if(this.length===0){null}if(e.toType(t)==="string"&&n===void 0){return this[0].getAttribute(t)}else{return this.each(function(){return this.setAttribute(t,n)})}};e.fn.removeAttr=function(e){return this.each(function(){return this.removeAttribute(e)})};e.fn.data=function(e,t){return this.attr("data-"+e,t)};e.fn.removeData=function(e){return this.removeAttr("data-"+e)};e.fn.val=function(t){if(e.toType(t)==="string"){return this.each(function(){return this.value=t})}else{if(this.length>0){return this[0].value}else{return null}}};e.fn.show=function(){return this.style("display","block")};e.fn.hide=function(){return this.style("display","none")};e.fn.height=function(){var e;e=this.offset();return e.height};e.fn.width=function(){var e;e=this.offset();return e.width};e.fn.offset=function(){var e;e=this[0].getBoundingClientRect();return{left:e.left+window.pageXOffset,top:e.top+window.pageYOffset,width:e.width,height:e.height}};return e.fn.remove=function(){return this.each(function(){if(this.parentNode!=null){return this.parentNode.removeChild(this)}})}})(Quo)}).call(this);(function(){(function(e){var t,n,r,i,u,a,o;r=null;t=/WebKit\/([\d.]+)/;n={Android:/(Android)\s+([\d.]+)/,ipad:/(iPad).*OS\s([\d_]+)/,iphone:/(iPhone\sOS)\s([\d_]+)/,Blackberry:/(BlackBerry|BB10|Playbook).*Version\/([\d.]+)/,FirefoxOS:/(Mozilla).*Mobile[^\/]*\/([\d\.]*)/,webOS:/(webOS|hpwOS)[\s\/]([\d.]+)/};e.isMobile=function(){r=r||u();return r.isMobile&&r.os.name!=="firefoxOS"};e.environment=function(){r=r||u();return r};e.isOnline=function(){return navigator.onLine};u=function(){var e,t;t=navigator.userAgent;e={};e.browser=i(t);e.os=a(t);e.isMobile=!!e.os;e.screen=o();return e};i=function(e){var n;n=e.match(t);if(n){return n[0]}else{return e}};a=function(e){var t,r,i;t=null;for(r in n){i=e.match(n[r]);if(i){t={name:r==="iphone"||r==="ipad"?"ios":r,version:i[2].replace("_",".")};break}}return t};return o=function(){return{width:window.innerWidth,height:window.innerHeight}}})(Quo)}).call(this);(function(){(function(e){var t,n,r,i,u,a,o,s,c,f,l,h;t=1;i={};r={preventDefault:"isDefaultPrevented",stopImmediatePropagation:"isImmediatePropagationStopped",stopPropagation:"isPropagationStopped"};n={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",touch:"click",doubletap:"dblclick",orientationchange:"resize"};u=/complete|loaded|interactive/;e.fn.on=function(t,n,r){if(n==="undefined"||e.toType(n)==="function"){return this.bind(t,n)}else{return this.delegate(n,t,r)}};e.fn.off=function(t,n,r){if(n==="undefined"||e.toType(n)==="function"){return this.unbind(t,n)}else{return this.undelegate(n,t,r)}};e.fn.ready=function(t){if(u.test(document.readyState)){return t(e)}else{return e.fn.addEvent(document,"DOMContentLoaded",function(){return t(e)})}};e.Event=function(e,t){var n,r;n=document.createEvent("Events");n.initEvent(e,true,true,null,null,null,null,null,null,null,null,null,null,null,null);if(t){for(r in t){n[r]=t[r]}}return n};e.fn.bind=function(e,t){return this.each(function(){l(this,e,t)})};e.fn.unbind=function(e,t){return this.each(function(){h(this,e,t)})};e.fn.delegate=function(t,n,r){return this.each(function(i,u){l(u,n,r,t,function(n){return function(r){var i,o;o=e(r.target).closest(t,u).get(0);if(o){i=e.extend(a(r),{currentTarget:o,liveFired:u});return n.apply(o,[i].concat([].slice.call(arguments,1)))}}})})};e.fn.undelegate=function(e,t,n){return this.each(function(){h(this,t,n,e)})};e.fn.trigger=function(t,n,r){if(e.toType(t)==="string"){t=e.Event(t,n)}if(r!=null){t.originalEvent=r}return this.each(function(){this.dispatchEvent(t)})};e.fn.addEvent=function(e,t,n){if(e.addEventListener){return e.addEventListener(t,n,false)}else if(e.attachEvent){return e.attachEvent("on"+t,n)}else{return e["on"+t]=n}};e.fn.removeEvent=function(e,t,n){if(e.removeEventListener){return e.removeEventListener(t,n,false)}else if(e.detachEvent){return e.detachEvent("on"+t,n)}else{return e["on"+t]=null}};l=function(t,n,r,u,a){var c,l,h,d;n=s(n);h=f(t);l=i[h]||(i[h]=[]);c=a&&a(r,n);d={event:n,callback:r,selector:u,proxy:o(c,r,t),delegate:c,index:l.length};l.push(d);return e.fn.addEvent(t,d.event,d.proxy)};h=function(t,n,r,u){var a;n=s(n);a=f(t);return c(a,n,r,u).forEach(function(n){delete i[a][n.index];return e.fn.removeEvent(t,n.event,n.proxy)})};f=function(e){return e._id||(e._id=t++)};s=function(t){var r;r=e.isMobile()?t:n[t];return r||t};o=function(e,t,n){var r;t=e||t;r=function(e){var r;r=t.apply(n,[e].concat(e.data));if(r===false){e.preventDefault()}return r};return r};c=function(e,t,n,r){return(i[e]||[]).filter(function(e){return e&&(!t||e.event===t)&&(!n||e.callback===n)&&(!r||e.selector===r)})};return a=function(t){var n;n=e.extend({originalEvent:t},t);e.each(r,function(e,r){n[e]=function(){this[r]=function(){return true};return t[e].apply(t,arguments)};return n[r]=function(){return false}});return n}})(Quo)}).call(this);(function(){(function($$){var CURRENT_TOUCH,EVENT,FIRST_TOUCH,GESTURE,GESTURES,HOLD_DELAY,TAPS,TOUCH_TIMEOUT,_angle,_capturePinch,_captureRotation,_cleanGesture,_distance,_fingersPosition,_getTouches,_hold,_isSwipe,_listenTouches,_onTouchEnd,_onTouchMove,_onTouchStart,_parentIfText,_swipeDirection,_trigger;TAPS=null;EVENT=void 0;GESTURE={};FIRST_TOUCH=[];CURRENT_TOUCH=[];TOUCH_TIMEOUT=void 0;HOLD_DELAY=650;GESTURES=["touch","tap","singleTap","doubleTap","hold","swipe","swiping","swipeLeft","swipeRight","swipeUp","swipeDown","rotate","rotating","rotateLeft","rotateRight","pinch","pinching","pinchIn","pinchOut","drag","dragLeft","dragRight","dragUp","dragDown"];GESTURES.forEach(function(e){$$.fn[e]=function(t){var n;n=e==="touch"?"touchend":e;return $$(document.body).delegate(this.selector,n,t)};return this});document.addEventListener("DOMContentLoaded",function(event){return _listenTouches()});_listenTouches=function(){var e;e=$$(document.body);e.bind("touchstart",_onTouchStart);e.bind("touchmove",_onTouchMove);e.bind("touchend",_onTouchEnd);return e.bind("touchcancel",_cleanGesture)};_onTouchStart=function(e){var t,n,r,i;EVENT=e;r=Date.now();t=r-(GESTURE.last||r);TOUCH_TIMEOUT&&clearTimeout(TOUCH_TIMEOUT);i=_getTouches(e);n=i.length;FIRST_TOUCH=_fingersPosition(i,n);GESTURE.el=$$(_parentIfText(i[0].target));GESTURE.fingers=n;GESTURE.last=r;if(!GESTURE.taps){GESTURE.taps=0}GESTURE.taps++;if(n===1){if(n>=1){GESTURE.gap=t>0&&t<=250}return setTimeout(_hold,HOLD_DELAY)}else if(n===2){GESTURE.initial_angle=parseInt(_angle(FIRST_TOUCH),10);GESTURE.initial_distance=parseInt(_distance(FIRST_TOUCH),10);GESTURE.angle_difference=0;return GESTURE.distance_difference=0}};_onTouchMove=function(e){var t,n,r;EVENT=e;if(GESTURE.el){r=_getTouches(e);t=r.length;if(t===GESTURE.fingers){CURRENT_TOUCH=_fingersPosition(r,t);n=_isSwipe(e);if(n){GESTURE.prevSwipe=true}if(n||GESTURE.prevSwipe===true){_trigger("swiping")}if(t===2){_captureRotation();_capturePinch();e.preventDefault()}}else{_cleanGesture()}}return true};_isSwipe=function(e){var t,n,r;t=false;if(CURRENT_TOUCH[0]){n=Math.abs(FIRST_TOUCH[0].x-CURRENT_TOUCH[0].x)>30;r=Math.abs(FIRST_TOUCH[0].y-CURRENT_TOUCH[0].y)>30;t=GESTURE.el&&(n||r)}return t};_onTouchEnd=function(e){var t,n,r,i,u;EVENT=e;_trigger("touch");if(GESTURE.fingers===1){if(GESTURE.taps===2&&GESTURE.gap){_trigger("doubleTap");_cleanGesture()}else if(_isSwipe()||GESTURE.prevSwipe){_trigger("swipe");u=_swipeDirection(FIRST_TOUCH[0].x,CURRENT_TOUCH[0].x,FIRST_TOUCH[0].y,CURRENT_TOUCH[0].y);_trigger("swipe"+u);_cleanGesture()}else{_trigger("tap");if(GESTURE.taps===1){TOUCH_TIMEOUT=setTimeout(function(){_trigger("singleTap");return _cleanGesture()},100)}}}else{t=false;if(GESTURE.angle_difference!==0){_trigger("rotate",{angle:GESTURE.angle_difference});i=GESTURE.angle_difference>0?"rotateRight":"rotateLeft";_trigger(i,{angle:GESTURE.angle_difference});t=true}if(GESTURE.distance_difference!==0){_trigger("pinch",{angle:GESTURE.distance_difference});r=GESTURE.distance_difference>0?"pinchOut":"pinchIn";_trigger(r,{distance:GESTURE.distance_difference});t=true}if(!t&&CURRENT_TOUCH[0]){if(Math.abs(FIRST_TOUCH[0].x-CURRENT_TOUCH[0].x)>10||Math.abs(FIRST_TOUCH[0].y-CURRENT_TOUCH[0].y)>10){_trigger("drag");n=_swipeDirection(FIRST_TOUCH[0].x,CURRENT_TOUCH[0].x,FIRST_TOUCH[0].y,CURRENT_TOUCH[0].y);_trigger("drag"+n)}}_cleanGesture()}return EVENT=void 0};_fingersPosition=function(e,t){var n,r;r=[];n=0;e=e[0].targetTouches?e[0].targetTouches:e;while(n<t){r.push({x:e[n].pageX,y:e[n].pageY});n++}return r};_captureRotation=function(){var angle,diff,i,symbol;angle=parseInt(_angle(CURRENT_TOUCH),10);diff=parseInt(GESTURE.initial_angle-angle,10);if(Math.abs(diff)>20||GESTURE.angle_difference!==0){i=0;symbol=GESTURE.angle_difference<0?"-":"+";while(Math.abs(diff-GESTURE.angle_difference)>90&&i++<10){eval("diff "+symbol+"= 180;")}GESTURE.angle_difference=parseInt(diff,10);return _trigger("rotating",{angle:GESTURE.angle_difference})}};_capturePinch=function(){var e,t;t=parseInt(_distance(CURRENT_TOUCH),10);e=GESTURE.initial_distance-t;if(Math.abs(e)>10){GESTURE.distance_difference=e;return _trigger("pinching",{distance:e})}};_trigger=function(e,t){if(GESTURE.el){t=t||{};if(CURRENT_TOUCH[0]){t.iniTouch=GESTURE.fingers>1?FIRST_TOUCH:FIRST_TOUCH[0];t.currentTouch=GESTURE.fingers>1?CURRENT_TOUCH:CURRENT_TOUCH[0]}return GESTURE.el.trigger(e,t,EVENT)}};_cleanGesture=function(e){FIRST_TOUCH=[];CURRENT_TOUCH=[];GESTURE={};return clearTimeout(TOUCH_TIMEOUT)};_angle=function(e){var t,n,r;t=e[0];n=e[1];r=Math.atan((n.y-t.y)*-1/(n.x-t.x))*(180/Math.PI);if(r<0){return r+180}else{return r}};_distance=function(e){var t,n;t=e[0];n=e[1];return Math.sqrt((n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y))*-1};_getTouches=function(e){if($$.isMobile()){return e.touches}else{return[e]}};_parentIfText=function(e){if("tagName"in e){return e}else{return e.parentNode}};_swipeDirection=function(e,t,n,r){var i,u;i=Math.abs(e-t);u=Math.abs(n-r);if(i>=u){if(e-t>0){return"Left"}else{return"Right"}}else{if(n-r>0){return"Up"}else{return"Down"}}};return _hold=function(){if(GESTURE.last&&Date.now()-GESTURE.last>=HOLD_DELAY){_trigger("hold");return GESTURE.taps=0}}})(Quo)}).call(this);(function(){(function(e){e.fn.text=function(t){if(t||e.toType(t)==="number"){return this.each(function(){return this.textContent=t})}else{return this[0].textContent}};e.fn.html=function(t){var n;n=e.toType(t);if(t||n==="number"||n==="string"){return this.each(function(){var e,r,i,u;if(n==="string"||n==="number"){return this.innerHTML=t}else{this.innerHTML=null;if(n==="array"){u=[];for(r=0,i=t.length;r<i;r++){e=t[r];u.push(this.appendChild(e))}return u}else{return this.appendChild(t)}}})}else{return this[0].innerHTML}};e.fn.append=function(t){var n;n=e.toType(t);return this.each(function(){var e=this;if(n==="string"){return this.insertAdjacentHTML("beforeend",t)}else if(n==="array"){return t.each(function(t,n){return e.appendChild(n)})}else{return this.appendChild(t)}})};e.fn.prepend=function(t){var n;n=e.toType(t);return this.each(function(){
var e=this;if(n==="string"){return this.insertAdjacentHTML("afterbegin",t)}else if(n==="array"){return t.each(function(t,n){return e.insertBefore(n,e.firstChild)})}else{return this.insertBefore(t,this.firstChild)}})};e.fn.replaceWith=function(t){var n;n=e.toType(t);this.each(function(){var e=this;if(this.parentNode){if(n==="string"){return this.insertAdjacentHTML("beforeBegin",t)}else if(n==="array"){return t.each(function(t,n){return e.parentNode.insertBefore(n,e)})}else{return this.parentNode.insertBefore(t,this)}}});return this.remove()};return e.fn.empty=function(){return this.each(function(){return this.innerHTML=null})}})(Quo)}).call(this);(function(){(function(e){var t,n,r,i,u,a;r="parentNode";t=/^\.([\w-]+)$/;n=/^#[\w\d-]+$/;i=/^[\w-]+$/;e.query=function(e,r){var u;r=r.trim();if(t.test(r)){u=e.getElementsByClassName(r.replace(".",""))}else if(i.test(r)){u=e.getElementsByTagName(r)}else if(n.test(r)&&e===document){u=e.getElementById(r.replace("#",""));if(!u){u=[]}}else{u=e.querySelectorAll(r)}if(u.nodeType){return[u]}else{return Array.prototype.slice.call(u)}};e.fn.find=function(t){var n;if(this.length===1){n=Quo.query(this[0],t)}else{n=this.map(function(){return Quo.query(this,t)})}return e(n)};e.fn.parent=function(e){var t;t=e?a(this):this.instance(r);return u(t,e)};e.fn.siblings=function(e){var t;t=this.map(function(e,t){return Array.prototype.slice.call(t.parentNode.children).filter(function(e){return e!==t})});return u(t,e)};e.fn.children=function(e){var t;t=this.map(function(){return Array.prototype.slice.call(this.children)});return u(t,e)};e.fn.get=function(e){if(e===undefined){return this}else{return this[e]}};e.fn.first=function(){return e(this[0])};e.fn.last=function(){return e(this[this.length-1])};e.fn.closest=function(t,n){var r,i;i=this[0];r=e(t);if(!r.length){i=null}while(i&&r.indexOf(i)<0){i=i!==n&&i!==document&&i.parentNode}return e(i)};e.fn.each=function(e){this.forEach(function(t,n){return e.call(t,n,t)});return this};a=function(t){var n;n=[];while(t.length>0){t=e.map(t,function(e){if((e=e.parentNode)&&e!==document&&n.indexOf(e)<0){n.push(e);return e}})}return n};return u=function(t,n){if(n===undefined){return e(t)}else{return e(t).filter(n)}}})(Quo)}).call(this);(function(){(function(e){var t,n,r;t=["-webkit-","-moz-","-ms-","-o-",""];e.fn.addClass=function(e){return this.each(function(){if(!r(e,this.className)){this.className+=" "+e;return this.className=this.className.trim()}})};e.fn.removeClass=function(e){return this.each(function(){if(!e){return this.className=""}else{if(r(e,this.className)){return this.className=this.className.replace(e," ").replace(/\s+/g," ").trim()}}})};e.fn.toggleClass=function(e){return this.each(function(){if(r(e,this.className)){return this.className=this.className.replace(e," ")}else{this.className+=" "+e;return this.className=this.className.trim()}})};e.fn.hasClass=function(e){return r(e,this[0].className)};e.fn.style=function(e,t){if(t){return this.each(function(){return this.style[e]=t})}else{return this[0].style[e]||n(this[0],e)}};e.fn.css=function(e,t){return this.style(e,t)};e.fn.vendor=function(e,n){var r,i,u,a;a=[];for(i=0,u=t.length;i<u;i++){r=t[i];a.push(this.style(""+r+e,n))}return a};r=function(e,t){var n;n=t.split(/\s+/g);return n.indexOf(e)>=0};return n=function(e,t){return document.defaultView.getComputedStyle(e,"")[t]}})(Quo)}).call(this)}(function($){$.fn.antiscroll=function(options){return this.each(function(){if($(this).data("antiscroll")){$(this).data("antiscroll").destroy()}$(this).data("antiscroll",new $.Antiscroll(this,options))})};$.Antiscroll=Antiscroll;function Antiscroll(el,opts){this.el=$(el);this.options=opts||{};this.x=false!==this.options.x||this.options.forceHorizontal;this.y=false!==this.options.y||this.options.forceVertical;this.autoHide=false!==this.options.autoHide;this.padding=undefined==this.options.padding?2:this.options.padding;this.topOffset=undefined==this.options.topOffset?this.el.parent().find(".fixed-header").height():this.options.topOffset;this.bottomOffset=undefined==this.options.bottomOffset?this.el.parent().find(".fixed-footer").height():this.options.bottomOffset;this.inner=this.el.find(".antiscroll-inner");this.inner.css({width:"+="+(this.y?scrollbarSize():0),height:"+="+(this.x?scrollbarSize():0)});this.refresh()}Antiscroll.prototype.refresh=function(){var needHScroll=this.inner.get(0).scrollWidth>this.el.width()+(this.y?scrollbarSize():0),needVScroll=this.inner.get(0).scrollHeight>this.el.height()+(this.x?scrollbarSize():0);if(this.x){if(!this.horizontal&&needHScroll){this.horizontal=new Scrollbar.Horizontal(this)}else if(this.horizontal&&!needHScroll){this.horizontal.destroy();this.horizontal=null}else if(this.horizontal){this.horizontal.update()}}if(this.y){if(!this.vertical&&needVScroll){this.vertical=new Scrollbar.Vertical(this)}else if(this.vertical&&!needVScroll){this.vertical.destroy();this.vertical=null}else if(this.vertical){this.vertical.update()}}};Antiscroll.prototype.destroy=function(){if(this.horizontal){this.horizontal.destroy();this.horizontal=null}if(this.vertical){this.vertical.destroy();this.vertical=null}return this};Antiscroll.prototype.rebuild=function(){this.destroy();this.inner.attr("style","");Antiscroll.call(this,this.el,this.options);return this};function Scrollbar(pane){this.pane=pane;this.pane.el.append(this.el);this.innerEl=this.pane.inner.get(0);this.dragging=false;this.enter=false;this.shown=false;this.pane.el.mouseenter($.proxy(this,"mouseenter"));this.pane.el.mouseleave($.proxy(this,"mouseleave"));this.el.mousedown($.proxy(this,"mousedown"));this.innerPaneScrollListener=$.proxy(this,"scroll");this.pane.inner.scroll(this.innerPaneScrollListener);this.innerPaneMouseWheelListener=$.proxy(this,"mousewheel");this.pane.inner.bind("mousewheel",this.innerPaneMouseWheelListener);var initialDisplay=this.pane.options.initialDisplay;if(initialDisplay!==false){this.show();if(this.pane.autoHide){this.hiding=setTimeout($.proxy(this,"hide"),parseInt(initialDisplay,10)||3e3)}}}Scrollbar.prototype.destroy=function(){this.el.remove();this.pane.inner.unbind("scroll",this.innerPaneScrollListener);this.pane.inner.unbind("mousewheel",this.innerPaneMouseWheelListener);return this};Scrollbar.prototype.mouseenter=function(){this.enter=true;this.show()};Scrollbar.prototype.mouseleave=function(){this.enter=false;if(!this.dragging){if(this.pane.autoHide){this.hide()}}};Scrollbar.prototype.scroll=function(){if(!this.shown){this.show();if(!this.enter&&!this.dragging){if(this.pane.autoHide){this.hiding=setTimeout($.proxy(this,"hide"),1500)}}}this.update()};Scrollbar.prototype.mousedown=function(ev){ev.preventDefault();this.dragging=true;this.startPageY=ev.pageY-parseInt(this.el.css("top"),10);this.startPageX=ev.pageX-parseInt(this.el.css("left"),10);this.el[0].ownerDocument.onselectstart=function(){return false};var pane=this.pane,move=$.proxy(this,"mousemove"),self=this;$(this.el[0].ownerDocument).mousemove(move).mouseup(function(){self.dragging=false;this.onselectstart=null;$(this).unbind("mousemove",move);if(!self.enter){self.hide()}})};Scrollbar.prototype.show=function(duration){if(!this.shown&&this.update()){this.el.addClass("antiscroll-scrollbar-shown");if(this.hiding){clearTimeout(this.hiding);this.hiding=null}this.shown=true}};Scrollbar.prototype.hide=function(){if(this.pane.autoHide!==false&&this.shown){this.el.removeClass("antiscroll-scrollbar-shown");this.shown=false}};Scrollbar.Horizontal=function(pane){this.el=$('<div class="antiscroll-scrollbar antiscroll-scrollbar-horizontal"/>',pane.el);Scrollbar.call(this,pane)};inherits(Scrollbar.Horizontal,Scrollbar);Scrollbar.Horizontal.prototype.update=function(){var paneWidth=this.pane.el.width(),trackWidth=paneWidth-this.pane.padding*2,innerEl=this.pane.inner.get(0);this.el.css("width",trackWidth*paneWidth/innerEl.scrollWidth).css("left",trackWidth*innerEl.scrollLeft/innerEl.scrollWidth);return paneWidth<innerEl.scrollWidth};Scrollbar.Horizontal.prototype.mousemove=function(ev){var trackWidth=this.pane.el.width()-this.pane.padding*2,pos=ev.pageX-this.startPageX,barWidth=this.el.width(),innerEl=this.pane.inner.get(0);var y=Math.min(Math.max(pos,0),trackWidth-barWidth);innerEl.scrollLeft=(innerEl.scrollWidth-this.pane.el.width())*y/(trackWidth-barWidth)};Scrollbar.Horizontal.prototype.mousewheel=function(ev,delta,x,y){if(x<0&&0==this.pane.inner.get(0).scrollLeft||x>0&&this.innerEl.scrollLeft+Math.ceil(this.pane.el.width())==this.innerEl.scrollWidth){ev.preventDefault();return false}};Scrollbar.Vertical=function(pane){this.el=$('<div class="antiscroll-scrollbar antiscroll-scrollbar-vertical"/>',pane.el);Scrollbar.call(this,pane)};inherits(Scrollbar.Vertical,Scrollbar);Scrollbar.Vertical.prototype.update=function(){var paneHeight=this.pane.el.height()-this.pane.topOffset-this.pane.bottomOffset,trackHeight=paneHeight-2*this.pane.padding,innerEl=this.innerEl,scrollbarHeight=trackHeight*paneHeight/(innerEl.scrollHeight-this.pane.topOffset-this.pane.bottomOffset);scrollbarHeight=20>scrollbarHeight?20:scrollbarHeight;var topPos=trackHeight*innerEl.scrollTop/(innerEl.scrollHeight-this.pane.topOffset-this.pane.bottomOffset)+this.pane.topOffset;if(topPos+scrollbarHeight>this.pane.el.height()){var diff=topPos+scrollbarHeight-trackHeight;topPos=topPos-diff-3}this.el.css("height",scrollbarHeight).css("top",topPos);return this.el.css("height",scrollbarHeight).css("top",topPos),paneHeight<innerEl.scrollHeight};Scrollbar.Vertical.prototype.mousemove=function(ev){var paneHeight=this.pane.el.height(),trackHeight=paneHeight-this.pane.padding*2,pos=ev.pageY-this.startPageY,barHeight=this.el.height(),innerEl=this.innerEl;var y=Math.min(Math.max(pos,0),trackHeight-barHeight);innerEl.scrollTop=(innerEl.scrollHeight-paneHeight)*y/(trackHeight-barHeight)};Scrollbar.Vertical.prototype.mousewheel=function(ev,delta,x,y){if(y>0&&0==this.innerEl.scrollTop||y<0&&this.innerEl.scrollTop+Math.ceil(this.pane.el.height())==this.innerEl.scrollHeight){ev.preventDefault();return false}};function inherits(ctorA,ctorB){function f(){}f.prototype=ctorB.prototype;ctorA.prototype=new f}var size;function scrollbarSize(){if(size===undefined){var div=$('<div class="antiscroll-inner" style="width:50px;height:50px;overflow-y:scroll;'+'position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"/>'+"</div>");$("body").append(div);var w1=$(div).innerWidth();var w2=$("div",div).innerWidth();$(div).remove();size=w1-w2}return size}})(jQuery);(function(factory){if(typeof module==="function"){module.exports=factory(this.jQuery||require("jquery"))}else{this.NProgress=factory(this.jQuery)}})(function($){var NProgress={};NProgress.version="0.1.2";var Settings=NProgress.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:true,trickleRate:.02,trickleSpeed:800,showSpinner:true,template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};NProgress.configure=function(options){$.extend(Settings,options);return this};NProgress.status=null;NProgress.set=function(n){var started=NProgress.isStarted();n=clamp(n,Settings.minimum,1);NProgress.status=n===1?null:n;var $progress=NProgress.render(!started),$bar=$progress.find('[role="bar"]'),speed=Settings.speed,ease=Settings.easing;$progress[0].offsetWidth;$progress.queue(function(next){if(Settings.positionUsing==="")Settings.positionUsing=NProgress.getPositioningCSS();$bar.css(barPositionCSS(n,speed,ease));if(n===1){$progress.css({transition:"none",opacity:1});$progress[0].offsetWidth;setTimeout(function(){$progress.css({transition:"all "+speed+"ms linear",opacity:0});setTimeout(function(){NProgress.remove();next()},speed)},speed)}else{setTimeout(next,speed)}});return this};NProgress.isStarted=function(){return typeof NProgress.status==="number"};NProgress.start=function(){if(!NProgress.status)NProgress.set(0);var work=function(){setTimeout(function(){if(!NProgress.status)return;NProgress.trickle();work()},Settings.trickleSpeed)};if(Settings.trickle)work();return this};NProgress.done=function(force){if(!force&&!NProgress.status)return this;return NProgress.inc(.3+.5*Math.random()).set(1)};NProgress.inc=function(amount){var n=NProgress.status;if(!n){return NProgress.start()}else{if(typeof amount!=="number"){amount=(1-n)*clamp(Math.random()*n,.1,.95)}n=clamp(n+amount,0,.994);return NProgress.set(n)}};NProgress.trickle=function(){return NProgress.inc(Math.random()*Settings.trickleRate)};NProgress.render=function(fromStart){if(NProgress.isRendered())return $("#nprogress");$("html").addClass("nprogress-busy");var $el=$("<div id='nprogress'>").html(Settings.template);var perc=fromStart?"-100":toBarPerc(NProgress.status||0);$el.find('[role="bar"]').css({transition:"all 0 linear",transform:"translate3d("+perc+"%,0,0)"});if(!Settings.showSpinner)$el.find('[role="spinner"]').remove();$el.appendTo("#screens");return $el};NProgress.remove=function(){$("html").removeClass("nprogress-busy");$("#nprogress").remove()};NProgress.isRendered=function(){return $("#nprogress").length>0};NProgress.getPositioningCSS=function(){var bodyStyle=document.body.style;var vendorPrefix="WebkitTransform"in bodyStyle?"Webkit":"MozTransform"in bodyStyle?"Moz":"msTransform"in bodyStyle?"ms":"OTransform"in bodyStyle?"O":"";if(vendorPrefix+"Perspective"in bodyStyle){return"translate3d"}else if(vendorPrefix+"Transform"in bodyStyle){return"translate"}else{return"margin"}};function clamp(n,min,max){if(n<min)return min;if(n>max)return max;return n}function toBarPerc(n){return(-1+n)*100}function barPositionCSS(n,speed,ease){var barCSS;if(Settings.positionUsing==="translate3d"){barCSS={transform:"translate3d("+toBarPerc(n)+"%,0,0)"}}else if(Settings.positionUsing==="translate"){barCSS={transform:"translate("+toBarPerc(n)+"%,0)"}}else{barCSS={"margin-left":toBarPerc(n)+"%"}}barCSS.transition="all "+speed+"ms "+ease;return barCSS}return NProgress});(function(root,factory){if(typeof define==="function"&&define.amd){define([],function(){return root.returnExportsGlobal=factory()})}else if(typeof exports==="object"){module.exports=factory()}else{root["bouncefix"]=factory()}})(this,function(){var domEvent;domEvent=function(){function DOMEvent(el,eventName,handler,context){this.el=el;this.eventName=eventName;this.handler=handler;this.context=context;this.add()}DOMEvent.prototype._handler=function(e,context){var evt={};for(var k in e){evt[k]=e[k]}evt.stopPropagation=function(){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}};evt.preventDefault=function(){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}};this.handler.call(this.context||context,evt)};DOMEvent.prototype.add=function(){var self=this;self.cachedHandler=function(e){self._handler.call(self,e,this)};self.el.addEventListener(self.eventName,self.cachedHandler,false)};DOMEvent.prototype.remove=function(){this.el.removeEventListener(this.eventName,this.cachedHandler)};return DOMEvent}();var utils;utils=function(){var utils={};utils.getTargetedEl=function(el,className){while(true){if(el.classList.contains(className)){break}if(el=el.parentElement){continue}break}return el};utils.isScrollable=function(el){return el.scrollHeight>el.offsetHeight};utils.scrollToEnd=function(el){var curPos=el.scrollTop,height=el.offsetHeight,scroll=el.scrollHeight;if(curPos<=0){el.scrollTop=1}if(curPos+height>=scroll){el.scrollTop=scroll-height-1}};return utils}();var fix;fix=function(DOMEvent,utils){var Fix=function(className){if(!(this instanceof Fix)){return new Fix(className)}if(!className){throw new Error('"className" argument is required')}this.className=className;this.startListener=new DOMEvent(document,"touchstart",this.touchStart,this);this.endListener=new DOMEvent(document,"touchend",this.touchEnd,this)};Fix.prototype.touchStart=function(evt){var el=utils.getTargetedEl(evt.target,this.className);if(el&&utils.isScrollable(el)){return utils.scrollToEnd(el)}if(el&&!this.moveListener){this.moveListener=new DOMEvent(el,"touchmove",this.touchMove,this)}};Fix.prototype.touchMove=function(evt){evt.preventDefault()};Fix.prototype.touchEnd=function(evt){if(this.moveListener){this.moveListener.remove();delete this.moveListener}};Fix.prototype.remove=function(){this.startListener.remove();this.endListener.remove()};return Fix}(domEvent,utils);var bouncefix;bouncefix=function(Fix){var bouncefix={cache:{}};bouncefix.add=function(className){if(!this.cache[className]){this.cache[className]=new Fix(className)}};bouncefix.remove=function(className){if(this.cache[className]){this.cache[className].remove();delete this.cache[className]}};return bouncefix}(fix);return bouncefix});(function(){var _ref,_ref1,_ref2,_ref3,__hasProp={}.hasOwnProperty,__extends=function(child,parent){for(var key in parent){if(__hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};window.Tourist=window.Tourist||{};Tourist.Model=function(_super){__extends(Model,_super);function Model(){_ref=Model.__super__.constructor.apply(this,arguments);return _ref}Model.prototype._module="Tourist";return Model}(Backbone.Model);window.Tourist.Tip=window.Tourist.Tip||{};Tourist.Tip.Base=function(){Base.prototype._module="Tourist";_.extend(Base.prototype,Backbone.Events);Base.prototype.skipButtonTemplate='<button class="btn btn-default btn-sm pull-right tour-next">Skip this step →</button>';Base.prototype.nextButtonTemplate='<button class="btn btn-primary btn-sm pull-right tour-next">Next step →</button>';Base.prototype.finalButtonTemplate='<button class="btn btn-primary btn-sm pull-right tour-next">Finish up</button>';Base.prototype.closeButtonTemplate='<a class="btn btn-close tour-close" href="#"><i class="icon icon-remove"></i></a>';Base.prototype.okButtonTemplate='<button class="btn btn-sm tour-close btn-primary">Okay</button>';Base.prototype.actionLabelTemplate=_.template('<h4 class="action-label"><%= label %></h4>');Base.prototype.actionLabels=["Do this:","Then this:","Next this:"];Base.prototype.highlightClass="tour-highlight";Base.prototype.template=_.template('<div>\n  <div class="tour-container">\n    <%= close_button %>\n    <%= content %>\n    <p class="tour-counter <%= counter_class %>"><%= counter%></p>\n  </div>\n  <div class="tour-buttons">\n    <%= buttons %>\n  </div>\n</div>');function Base(options){this.options=options!=null?options:{};this.onClickNext=__bind(this.onClickNext,this);this.onClickClose=__bind(this.onClickClose,this);this.el=$("<div/>");this.initialize(options);this._bindClickEvents();Tourist.Tip.Base._cacheTip(this)}Base.prototype.destroy=function(){return this.el.remove()};Base.prototype.render=function(step){this.hide();if(step){this._setTarget(step.target||false,step);this._setZIndex("");this._renderContent(step,this._buildContentElement(step));if(step.target){this.show()}if(step.zIndex){this._setZIndex(step.zIndex,step)}}return this};Base.prototype.show=function(){};Base.prototype.hide=function(){};Base.prototype.setTarget=function(targetElement,step){return this._setTarget(targetElement,step)};Base.prototype.cleanupCurrentTarget=function(){if(this.target&&this.target.removeClass){this.target.removeClass(this.highlightClass)}return this.target=null};Base.prototype.onClickClose=function(event){this.trigger("click:close",this,event);return false};Base.prototype.onClickNext=function(event){this.trigger("click:next",this,event);return false};Base.prototype._getTipElement=function(){};Base.prototype._renderContent=function(step,contentElement){};Base.prototype._bindClickEvents=function(){var el;el=this._getTipElement();el.delegate(".tour-close","click",this.onClickClose);return el.delegate(".tour-next","click",this.onClickNext)};Base.prototype._setTarget=function(target,step){this.cleanupCurrentTarget();if(target&&step&&step.highlightTarget){target.addClass(this.highlightClass)}return this.target=target};Base.prototype._setZIndex=function(zIndex){var el;el=this._getTipElement();return el.css("z-index",zIndex||"")};Base.prototype._buildContentElement=function(step){var buttons,content;buttons=this._buildButtons(step);content=$($.parseHTML(this.template({content:step.content,buttons:buttons,close_button:this._buildCloseButton(step),counter:step.final?"":"step "+(step.index+1)+" of "+step.total,counter_class:step.final?"final":""})));if(!buttons){content.find(".tour-buttons").addClass("no-buttons")}this._renderActionLabels(content);return content};Base.prototype._buildButtons=function(step){var buttons;buttons="";if(step.okButton){buttons+=this.okButtonTemplate}if(step.skipButton){buttons+=this.skipButtonTemplate}if(step.nextButton){buttons+=step.final?this.finalButtonTemplate:this.nextButtonTemplate}return buttons};Base.prototype._buildCloseButton=function(step){if(step.closeButton){return this.closeButtonTemplate}else{return""}};Base.prototype._renderActionLabels=function(el){var action,actionIndex,actions,label,_i,_len,_results;actions=el.find(".action");actionIndex=0;_results=[];for(_i=0,_len=actions.length;_i<_len;_i++){action=actions[_i];label=$($.parseHTML(this.actionLabelTemplate({label:this.actionLabels[actionIndex]})));label.insertBefore(action);_results.push(actionIndex++)}return _results};Base._cacheTip=function(tip){if(!Tourist.Tip.Base._cachedTips){Tourist.Tip.Base._cachedTips=[]}return Tourist.Tip.Base._cachedTips.push(tip)};Base.destroy=function(){var tip,_i,_len,_ref1;if(!Tourist.Tip.Base._cachedTips){return}_ref1=Tourist.Tip.Base._cachedTips;for(_i=0,_len=_ref1.length;_i<_len;_i++){tip=_ref1[_i];tip.destroy()}return Tourist.Tip.Base._cachedTips=null};return Base}();Tourist.Tip.Bootstrap=function(_super){__extends(Bootstrap,_super);function Bootstrap(){_ref1=Bootstrap.__super__.constructor.apply(this,arguments);return _ref1}Bootstrap.prototype.initialize=function(options){var defs;defs={showEffect:null,hideEffect:null};this.options=_.extend(defs,options);return this.tip=new Tourist.Tip.BootstrapTip(this.options)};Bootstrap.prototype.destroy=function(){this.tip.destroy();return Bootstrap.__super__.destroy.call(this)};Bootstrap.prototype.show=function(){var fn;if(this.options.showEffect){fn=Tourist.Tip.Bootstrap.effects[this.options.showEffect];return fn.call(this,this.tip,this.tip.el)}else{return this.tip.show()}};Bootstrap.prototype.hide=function(){var fn;if(this.options.hideEffect){fn=Tourist.Tip.Bootstrap.effects[this.options.hideEffect];return fn.call(this,this.tip,this.tip.el)}else{return this.tip.hide()}};Bootstrap.prototype._getTipElement=function(){return this.tip.el};Bootstrap.prototype._setTarget=function(target,step){Bootstrap.__super__._setTarget.call(this,target,step);return this.tip.setTarget(target)};Bootstrap.prototype._renderContent=function(step,contentElement){var at,my;my=step.my||"left center";at=step.at||"right center";this.tip.setContainer(step.container||$("body"));this.tip.setContent(contentElement);return this.tip.setPosition(step.target||false,my,at)};return Bootstrap}(Tourist.Tip.Base);Tourist.Tip.Bootstrap.effects={slidein:function(tip,element){var OFFSETS,css,easing,easings,offset,side,value,_i,_len;OFFSETS={top:80,left:80,right:-80,bottom:-80};side=tip.my.split(" ")[0];side=side||"top";offset=OFFSETS[side];if(side==="bottom"){side="top"}if(side==="right"){side="left"}value=parseInt(element.css(side));element.stop();css={};css[side]=value+offset;element.css(css);element.show();css[side]=value;easings=["easeOutCubic","swing","linear"];for(_i=0,_len=easings.length;_i<_len;_i++){easing=easings[_i];if($.easing[easing]){break}}element.animate(css,300,easing);return null}};Tourist.Tip.BootstrapTip=function(){BootstrapTip.prototype.template='<div class="popover tourist-popover">\n  <div class="arrow"></div>\n  <div class="popover-content"></div>\n</div>';BootstrapTip.prototype.FLIP_POSITION={bottom:"top",top:"bottom",left:"right",right:"left"};function BootstrapTip(options){var defs;defs={offset:10,tipOffset:10};this.options=_.extend(defs,options);this.el=$($.parseHTML(this.template));this.hide()}BootstrapTip.prototype.destroy=function(){return this.el.remove()};BootstrapTip.prototype.show=function(){return this.el.show().addClass("visible")};BootstrapTip.prototype.hide=function(){return this.el.hide().removeClass("visible")};BootstrapTip.prototype.setTarget=function(target){this.target=target;return this._setPosition(this.target,this.my,this.at)};BootstrapTip.prototype.setPosition=function(target,my,at){this.target=target;this.my=my;this.at=at;return this._setPosition(this.target,this.my,this.at)};BootstrapTip.prototype.setContainer=function(container){return container.append(this.el)};BootstrapTip.prototype.setContent=function(content){return this._getContentElement().html(content)};BootstrapTip.prototype._getContentElement=function(){return this.el.find(".popover-content")};BootstrapTip.prototype._getTipElement=function(){return this.el.find(".arrow")};BootstrapTip.prototype._setPosition=function(target,my,at){var clas,css,originalDisplay,position,shift,targetPosition,tip,tipOffset,tipPosition,_ref2;if(my==null){my="left center"}if(at==null){at="right center"}if(!target){return}_ref2=my.split(" "),clas=_ref2[0],shift=_ref2[1];originalDisplay=this.el.css("display");this.el.css({top:0,left:0,margin:0,display:"block"}).removeClass("top").removeClass("bottom").removeClass("left").removeClass("right").addClass(this.FLIP_POSITION[clas]);if(!target){return}tip=this._getTipElement().css({left:"",right:"",top:"",bottom:""});if(shift!=="center"){tipOffset={left:tip[0].offsetWidth/2,right:0,top:tip[0].offsetHeight/2,bottom:0};css={};css[shift]=tipOffset[shift]+this.options.tipOffset;css[this.FLIP_POSITION[shift]]="auto";tip.css(css)}targetPosition=this._caculateTargetPosition(at,target);tipPosition=this._caculateTipPosition(my,targetPosition);position=this._adjustForArrow(my,tipPosition);this.el.css(position);return this.el.css({display:originalDisplay})};BootstrapTip.prototype._caculateTargetPosition=function(atPosition,target){var bounds,pos;if(Object.prototype.toString.call(target)==="[object Array]"){return{left:target[0],top:target[1]}}bounds=this._getTargetBounds(target);pos=this._lookupPosition(atPosition,bounds.width,bounds.height);return{left:bounds.left+pos[0],top:bounds.top+pos[1]}};BootstrapTip.prototype._caculateTipPosition=function(myPosition,targetPosition){var height,pos,width;width=this.el[0].offsetWidth;height=this.el[0].offsetHeight;pos=this._lookupPosition(myPosition,width,height);return{left:targetPosition.left-pos[0],top:targetPosition.top-pos[1]}};BootstrapTip.prototype._adjustForArrow=function(myPosition,tipPosition){var clas,height,position,shift,tip,width,_ref2;_ref2=myPosition.split(" "),clas=_ref2[0],shift=_ref2[1];tip=this._getTipElement();width=tip[0].offsetWidth;height=tip[0].offsetHeight;position={top:tipPosition.top,left:tipPosition.left};switch(clas){case"top":position.top+=height+this.options.offset;break;case"bottom":position.top-=height+this.options.offset;break;case"left":position.left+=width+this.options.offset;break;case"right":position.left-=width+this.options.offset}switch(shift){case"left":position.left-=width/2+this.options.tipOffset;break;case"right":position.left+=width/2+this.options.tipOffset;break;case"top":position.top-=height/2+this.options.tipOffset;break;case"bottom":position.top+=height/2+this.options.tipOffset}return position};BootstrapTip.prototype._lookupPosition=function(position,width,height){var height2,posLookup,width2;width2=width/2;height2=height/2;posLookup={"top left":[0,0],"left top":[0,0],"top right":[width,0],"right top":[width,0],"bottom left":[0,height],"left bottom":[0,height],"bottom right":[width,height],"right bottom":[width,height],"top center":[width2,0],"left center":[0,height2],"right center":[width,height2],"bottom center":[width2,height]};return posLookup[position]};BootstrapTip.prototype._getTargetBounds=function(target){var el,size;el=target[0];if(typeof el.getBoundingClientRect==="function"){size=el.getBoundingClientRect()}else{size={width:el.offsetWidth,height:el.offsetHeight}}return $.extend({},size,target.offset())};return BootstrapTip}();Tourist.Tip.QTip=function(_super){var ADJUST,OFFSETS,TIP_HEIGHT,TIP_WIDTH;__extends(QTip,_super);function QTip(){this._renderTipBackground=__bind(this._renderTipBackground,this);_ref2=QTip.__super__.constructor.apply(this,arguments);return _ref2}TIP_WIDTH=6;TIP_HEIGHT=14;ADJUST=10;OFFSETS={top:80,left:80,right:-80,bottom:-80};QTip.prototype.QTIP_DEFAULTS={content:{text:" "},show:{ready:false,delay:0,effect:function(qtip){var css,el,offset,side,value;el=$(this);side=qtip.options.position.my;if(side){side=side[side.precedance]}side=side||"top";offset=OFFSETS[side];if(side==="bottom"){side="top"}if(side==="right"){side="left"}value=parseInt(el.css(side));css={};css[side]=value+offset;el.css(css);el.show();css[side]=value;el.animate(css,300,"easeOutCubic");return null},autofocus:false},hide:{event:null,delay:0,effect:false},position:{adjust:{method:"shift shift",scroll:false}},style:{classes:"ui-tour-tip",tip:{height:TIP_WIDTH,width:TIP_HEIGHT}},events:{},zindex:2e3};QTip.prototype.initialize=function(options){options=$.extend(true,{},this.QTIP_DEFAULTS,options);this.el.qtip(options);this.qtip=this.el.qtip("api");return this.qtip.render()};QTip.prototype.destroy=function(){if(this.qtip){this.qtip.destroy()}return QTip.__super__.destroy.call(this)};QTip.prototype.show=function(){return this.qtip.show()};QTip.prototype.hide=function(){return this.qtip.hide()};QTip.prototype._getTipElement=function(){return $("#qtip-"+this.qtip.id)};QTip.prototype._setTarget=function(targetElement,step){QTip.__super__._setTarget.call(this,targetElement,step);return this.qtip.set("position.target",targetElement||false)};QTip.prototype._renderContent=function(step,contentElement){var at,my,_this=this;my=step.my||"left center";at=step.at||"right center";this._adjustPlacement(my,at);this.qtip.set("content.text",contentElement);this.qtip.set("position.container",step.container||$("body"));this.qtip.set("position.my",my);this.qtip.set("position.at",at);this.qtip.set("position.viewport",step.viewport||false);this.qtip.set("position.target",step.target||false);return setTimeout(function(){return _this._renderTipBackground(my.split(" ")[0])},10)};QTip.prototype._adjustPlacement=function(my,at){if(my.indexOf("top")===0){return this._adjust(0,ADJUST)}else if(my.indexOf("bottom")===0){return this._adjust(0,-ADJUST)}else if(my.indexOf("right")===0){return this._adjust(-ADJUST,0)}else{return this._adjust(ADJUST,0)}};QTip.prototype._adjust=function(adjustX,adjusty){this.qtip.set("position.adjust.x",adjustX);return this.qtip.set("position.adjust.y",adjusty)};QTip.prototype._renderTipBackground=function(direction){var bg,el;el=$("#qtip-"+this.qtip.id+" .qtip-tip");bg=el.find(".qtip-tip-bg");if(!bg.length){bg=$("<div/>",{"class":"icon icon-tip qtip-tip-bg"});el.append(bg)}bg.removeClass("top left right bottom");return bg.addClass(direction)};return QTip}(Tourist.Tip.Base);Tourist.Tip.Simple=function(_super){__extends(Simple,_super);function Simple(){_ref3=Simple.__super__.constructor.apply(this,arguments);return _ref3}Simple.prototype.initialize=function(options){return $("body").append(this.el)};Simple.prototype.show=function(){return this.el.show()};Simple.prototype.hide=function(){return this.el.hide()};Simple.prototype._getTipElement=function(){return this.el};Simple.prototype._renderContent=function(step,contentElement){return this.el.html(contentElement)};return Simple}(Tourist.Tip.Base);Tourist.Tour=function(){_.extend(Tour.prototype,Backbone.Events);function Tour(options){var defs,tipOptions;this.options=options!=null?options:{};this.onChangeCurrentStep=__bind(this.onChangeCurrentStep,this);this.next=__bind(this.next,this);defs={tipClass:"Bootstrap"};this.options=_.extend(defs,this.options);this.model=new Tourist.Model({
current_step:null});tipOptions=_.extend({model:this.model},this.options.tipOptions);this.view=new Tourist.Tip[this.options.tipClass](tipOptions);this.view.bind("click:close",_.bind(this.stop,this,true));this.view.bind("click:next",this.next);this.model.bind("change:current_step",this.onChangeCurrentStep)}Tour.prototype.start=function(){this.trigger("start",this);return this.next()};Tour.prototype.stop=function(doFinalStep){if(doFinalStep){return this._showCancelFinalStep()}else{return this._stop()}};Tour.prototype.next=function(){var currentStep,index;currentStep=this._teardownCurrentStep();index=0;if(currentStep){index=currentStep.index+1}if(index<this.options.steps.length){return this._showStep(this.options.steps[index],index)}else if(index===this.options.steps.length){return this._showSuccessFinalStep()}else{return this._stop()}};Tour.prototype.setStepOptions=function(stepOptions){return this.options.stepOptions=stepOptions};Tour.prototype.onChangeCurrentStep=function(model,step){return this.view.render(step)};Tour.prototype._showCancelFinalStep=function(){return this._showFinalStep(false)};Tour.prototype._showSuccessFinalStep=function(){return this._showFinalStep(true)};Tour.prototype._teardownCurrentStep=function(){var currentStep;currentStep=this.model.get("current_step");this._teardownStep(currentStep);return currentStep};Tour.prototype._stop=function(){this._teardownCurrentStep();this.model.set({current_step:null});return this.trigger("stop",this)};Tour.prototype._showFinalStep=function(success){var currentStep,finalStep;currentStep=this._teardownCurrentStep();finalStep=success?this.options.successStep:this.options.cancelStep;if(_.isFunction(finalStep)){finalStep.call(this,this,this.options.stepOptions);finalStep=null}if(!finalStep){return this._stop()}if(currentStep&&currentStep.final){return this._stop()}finalStep.final=true;return this._showStep(finalStep,this.options.steps.length)};Tour.prototype._showStep=function(step,index){if(!step){return}step=_.clone(step);step.index=index;step.total=this.options.steps.length;if(!step.final){step.final=this.options.steps.length===index+1&&!this.options.successStep}step=_.extend(step,this._setupStep(step));return this.model.set({current_step:step})};Tour.prototype._setupStep=function(step){var fn,_i,_len,_ref4;if(!(step&&step.setup)){return{}}if(step.bind){_ref4=step.bind;for(_i=0,_len=_ref4.length;_i<_len;_i++){fn=_ref4[_i];step[fn]=_.bind(step[fn],step,this,this.options.stepOptions)}}return step.setup.call(step,this,this.options.stepOptions)||{}};Tour.prototype._teardownStep=function(step){if(step&&step.teardown){step.teardown.call(step,this,this.options.stepOptions)}return this.view.cleanupCurrentTarget()};return Tour}()}).call(this);this["MARVELAPP"]=this["MARVELAPP"]||{};this["MARVELAPP"]["templates"]=this["MARVELAPP"]["templates"]||{};this["MARVELAPP"]["templates"]["ADD_TO_HOMESCREEN"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="addToHomescreen';if(iPad){__p+=" ipad"}if(showAndroid){__p+=" android"}__p+='">\n    <div class="popup">\n        ';if(!showAndroid){__p+='<div id="close_wrapper" class="close_wrapper"><div class="close"></div></div>'}__p+="\n        ";if(app_icon!=null){__p+='\n            <div id="app-icon-popover">\n                <div class="icon" style="background-image: url('+((__t=app_icon.url)==null?"":__t)+');"></div>\n            </div>\n        '}else{__p+='\n			<div id="app-icon-popover">\n                <div class="icon" style="background-image: url(/static/assets/images/icons/icon_120_'+((__t=random_number)==null?"":__t)+'.png);"></div>\n            </div>\n        '}__p+='\n        <h1>Install this prototype!</h1>\n        <p>You can install this prototype on your homescreen to make it look and feel like a real app. Give it a spin!</p>\n        <div class="bottom">\n            ';if(showAndroid){__p+="\n                Just tap <span class=\"up-icon android\"></span> then 'Add to home screen'\n            "}else{__p+="\n                Just tap <span class=\"up-icon\"></span> then 'Add to Home Screen'\n            "}__p+="\n        </div>\n        ";if(showAndroid){__p+='<div id="close_wrapper" class="close_wrapper"><div class="close">Close</div></div>'}__p+="\n    </div>\n</div>"}return __p};this["MARVELAPP"]["templates"]["HOTSPOT"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(type!=projectConstants.TYPE_EMBED){__p+='\n\n<div id="hotspot-'+__e(id)+'" class="hotspot';if(action!="click"){__p+=" gesture "+__e(action)}__p+='" style="width: '+__e(width)+"%; height: "+__e(height)+"%; top: "+__e(top)+"%; left: "+__e(left)+'%;"></div>\n\n'}else{__p+='\n\n<div id="hotspot-'+__e(id)+'" class="hotspot embed" style="width: '+__e(width)+"%; height: "+__e(height)+"%; top: "+__e(top)+"%; left: "+__e(left)+'%;" >\n	'+((__t=external_url)==null?"":__t)+"\n</div>\n\n"}}return __p};this["MARVELAPP"]["templates"]["IOS_PROTOTYPE_WRAPPER"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="screen';if(mobile){__p+=" mobile"}__p+='">\n	<div id="screens" style="background-color: #'+__e(prototype_background)+'">\n		<div class="screen-overlay-background"></div>\n	</div>\n</div>'}return __p};this["MARVELAPP"]["templates"]["PAGE_LOADER"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(is_pro){bgcolor="white";fillcolor="#39ce00"}else{bgcolor="#1fb6ff";fillcolor="white"}__p+='\n\n\n<div id="page-loader" class="prototype-modal" style="background-color: '+((__t=bgcolor)==null?"":__t)+';">\n    <div class="table">\n        <div class="cell">\n            ';if(team_icon!=""&&team_icon!=null){__p+='\n            <div class="team-logo" style="background-image: url('+((__t=team_icon)==null?"":__t)+');"></div>\n            '}else if(!is_pro){__p+='\n            <a href="https://marvelapp.com/" target="_blank">\n            <svg class="logo" style="fill: white !important; width: 122px; margin: 0px auto 24px auto" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="102px" height="32.279px" viewBox="0 0 102 32.279" enable-background="new 0 0 102 32.279" xml:space="preserve"><path d="M101.431 0.723C101.052 0.2 100.5 0 99.9 0c-0.723 0-1.506 0.25-2.35 0.7 c-0.844 0.499-1.816 1.3-2.918 2.401c-0.792 0.792-1.644 1.782-2.556 2.97c-0.913 1.188-1.817 2.479-2.712 3.9 c-0.895 1.394-1.756 2.823-2.582 4.287c-0.826 1.464-1.533 2.866-2.118 4.209c-0.438 0.967-0.805 1.846-1.108 2.6 c-0.061 0.064-0.122 0.122-0.183 0.198l-1.085 1.446c-0.93 1.239-2.023 2.272-3.28 3.099c-1.258 0.826-2.35 1.24-3.28 1.2 c-0.619 0-1.11-0.147-1.472-0.44c-0.362-0.292-0.543-0.731-0.543-1.317c0-0.206 0.026-0.387 0.077-0.542 c0.052-0.155 0.146-0.353 0.284-0.594c0.31 0.1 0.6 0.1 0.8 0.181c0.189 0.1 0.4 0.1 0.7 0.1 c0.999 0 1.98-0.232 2.944-0.697c0.964-0.465 1.816-1.076 2.556-1.833c0.741-0.757 1.343-1.618 1.808-2.583 c0.464-0.964 0.697-1.944 0.697-2.944c0-1.033-0.309-1.876-0.929-2.531c-0.62-0.654-1.429-0.981-2.428-0.981 c-1.206 0-2.437 0.405-3.693 1.214c-1.257 0.809-2.401 1.851-3.434 3.124c-0.705 0.87-1.315 1.808-1.844 2.8 c-0.415 0.216-0.817 0.337-1.205 0.337c-0.173 0-0.345-0.017-0.517-0.052c0.378-0.653 0.671-1.402 0.878-2.246 c0.207-0.843 0.31-1.643 0.31-2.401c0-0.688-0.138-1.257-0.413-1.705c-0.276-0.447-0.654-0.671-1.136-0.671 c-0.448 0-0.887 0.173-1.317 0.517c-0.431 0.345-0.818 0.784-1.162 1.317c-0.344 0.534-0.619 1.154-0.826 1.9 c-0.207 0.706-0.31 1.42-0.31 2.143c0 0.2 0 0.4 0 0.62c0 0.2 0 0.5 0.1 0.878c-0.173 0.413-0.413 0.852-0.723 1.3 c-0.31 0.465-0.706 1.007-1.188 1.627c-0.689 0.896-1.249 1.55-1.679 1.963c-0.431 0.413-0.818 0.62-1.162 0.6 c-0.173 0-0.319-0.077-0.439-0.232c-0.121-0.155-0.181-0.336-0.181-0.542c0-0.378 0.137-0.947 0.413-1.705 c0.276-0.757 0.62-1.515 1.033-2.272l1.343-2.634c0.378-0.688 0.679-1.411 0.903-2.169c0.223-0.757 0.336-1.377 0.336-1.859 c0-0.551-0.173-0.998-0.517-1.343c-0.344-0.344-0.757-0.517-1.239-0.517c-0.482 0-0.887 0.138-1.214 0.4 c-0.327 0.276-0.628 0.775-0.903 1.498c-0.207 0.482-0.413 0.973-0.62 1.472c-0.207 0.5-0.447 0.99-0.723 1.472l-0.402 0.8 c-0.107 0.03-0.214 0.075-0.321 0.137c-0.207 0.121-0.551 0.371-1.033 0.749c-0.586 0.483-1.11 0.861-1.575 1.1 c-0.465 0.276-0.818 0.413-1.059 0.413c-0.345 0-0.517-0.137-0.517-0.413c0-0.207 0.181-0.499 0.542-0.878 c0.361-0.379 0.834-0.792 1.42-1.24c0.62-0.413 1.05-0.783 1.291-1.111c0.241-0.327 0.362-0.697 0.362-1.111 c0-0.413-0.164-0.792-0.491-1.136c-0.327-0.344-0.697-0.517-1.11-0.517c-0.379 0-0.81 0.138-1.291 0.4 c-0.483 0.276-1.206 0.758-2.169 1.446c-1.033 0.793-1.962 1.55-2.789 2.273c-0.826 0.723-1.705 1.619-2.634 2.685l-0.362 0.4 c0.207-0.482 0.517-1.05 0.93-1.705c0.413-0.654 0.86-1.257 1.342-1.808c0.585-0.689 0.956-1.17 1.111-1.446 c0.155-0.275 0.232-0.585 0.232-0.93c0-0.413-0.173-0.775-0.517-1.085c-0.344-0.31-0.757-0.465-1.239-0.465 c-0.723 0-1.429 0.362-2.118 1.085c-0.413 0.413-0.887 1.007-1.42 1.782c-0.534 0.774-1.041 1.575-1.523 2.4 c-0.122 0.206-0.238 0.427-0.358 0.639c-0.285 0.206-0.578 0.509-0.88 0.911c-0.999 1.377-1.833 2.376-2.506 3 c-0.672 0.62-1.265 0.93-1.781 0.93c-0.586 0-0.879-0.276-0.879-0.827c0-0.379 0.155-0.878 0.466-1.498 c0.309-0.62 0.723-1.273 1.239-1.963c0.276-0.31 0.447-0.55 0.517-0.723c0.069-0.172 0.103-0.344 0.103-0.517 c0-0.207-0.052-0.395-0.154-0.568c-0.104-0.172-0.328-0.395-0.672-0.672c0.172-0.447 0.301-0.834 0.388-1.162 c0.085-0.327 0.129-0.697 0.129-1.111c0-1.17-0.344-2.099-1.033-2.789c-0.689-0.688-1.584-1.033-2.686-1.033 c-1.205 0-2.453 0.422-3.744 1.265c-1.291 0.844-2.539 2.075-3.744 3.693c-0.85 1.125-1.552 2.308-2.119 3.5 c-0.171 0.198-0.359 0.443-0.566 0.744c-0.379 0.551-0.818 1.154-1.317 1.808c-0.499 0.655-0.921 1.171-1.265 1.6 c-0.655 0.723-1.188 1.231-1.601 1.523c-0.413 0.293-0.793 0.44-1.136 0.44c-0.448 0-0.671-0.225-0.671-0.672 c0-1.033 1.343-3.306 4.028-6.818c0.585-0.757 0.989-1.35 1.214-1.781c0.224-0.43 0.336-0.852 0.336-1.265 c0-0.55-0.232-1.041-0.697-1.472c-0.464-0.43-0.99-0.646-1.575-0.646c-0.413 0-0.844 0.121-1.291 0.4 c-0.448 0.241-1.016 0.655-1.705 1.24c-0.31 0.276-0.62 0.542-0.93 0.801c-0.31 0.258-0.638 0.56-0.981 0.9 c-0.345 0.345-0.741 0.741-1.188 1.188c-0.448 0.448-0.981 0.999-1.601 1.653l-0.62 0.672l0.413-0.775l1.085-1.963 c0.447-0.792 0.74-1.377 0.878-1.756c0.137-0.378 0.207-0.723 0.207-1.033c0-0.481-0.173-0.886-0.517-1.213 c-0.345-0.327-0.758-0.491-1.24-0.491c-0.379 0-0.8 0.121-1.265 0.362c-0.465 0.241-0.99 0.62-1.575 1.1 c-0.586 0.516-1.265 1.205-2.04 2.066c-0.775 0.861-1.678 1.911-2.711 3.15l0.568-1.136c0.31-0.55 0.568-1.007 0.775-1.369 c0.207-0.362 0.362-0.628 0.465-0.801c0.585-0.929 0.956-1.583 1.111-1.962c0.155-0.378 0.232-0.74 0.232-1.085 c0-0.447-0.164-0.826-0.491-1.136c-0.328-0.31-0.715-0.465-1.162-0.465c-0.413 0-0.793 0.129-1.136 0.4 c-0.345 0.258-0.758 0.697-1.24 1.317c-0.826 1.102-1.661 2.427-2.505 3.977c-0.843 1.55-1.627 3.237-2.35 5.1 C0.637 26.5 0 28.8 0 30.058c0 0.7 0.2 1.2 0.5 1.602c0.345 0.4 0.8 0.6 1.3 0.6 c0.517 0 0.939-0.163 1.265-0.49c0.328-0.328 0.697-0.973 1.111-1.937c0.31-0.723 0.697-1.471 1.162-2.246 c0.465-0.775 0.998-1.541 1.601-2.298c0.602-0.757 1.23-1.489 1.885-2.195c0.654-0.705 1.325-1.334 2.014-1.885 c-0.138 0.276-0.241 0.448-0.31 0.517l-0.981 1.705c-0.207 0.309-0.448 0.748-0.723 1.317c-0.276 0.568-0.5 1.093-0.671 1.6 c-0.276 0.62-0.457 1.111-0.542 1.472c-0.086 0.362-0.129 0.732-0.129 1.111c0 0.6 0.2 1.1 0.5 1.5 c0.362 0.4 0.8 0.6 1.4 0.594c0.517 0 0.947-0.181 1.291-0.542c0.344-0.362 0.843-1.093 1.498-2.195 c0.895-1.653 1.781-3.004 2.66-4.055c0.878-1.05 1.764-1.919 2.66-2.608c-0.138 0.207-0.225 0.345-0.258 0.4 c-0.483 0.689-0.878 1.317-1.188 1.885c-0.31 0.568-0.551 1.102-0.723 1.601c-0.173 0.5-0.302 0.98-0.387 1.4 c-0.086 0.465-0.129 0.956-0.129 1.472c0 1 0.3 1.8 0.9 2.453c0.62 0.6 1.4 1 2.4 1 c1.033 0 2.177-0.396 3.434-1.188c1.123-0.708 2.226-1.679 3.308-2.91c0.159 0.5 0.4 0.9 0.7 1.3 c0.638 0.8 1.4 1.1 2.4 1.137c1.859 0 3.615-1.137 5.269-3.408v0.465c0 0.8 0.3 1.4 0.8 1.9 c0.517 0.5 1.2 0.8 1.9 0.801c1.258 0 2.555-0.451 3.892-1.348c-0.181 0.696-0.278 1.255-0.278 1.7 c0 0.6 0.2 1 0.5 1.317c0.345 0.3 0.8 0.5 1.3 0.49c0.483 0 0.878-0.112 1.188-0.336 c0.31-0.225 0.603-0.612 0.878-1.162l1.136-2.376c0.62-1.273 1.498-2.538 2.634-3.796c1.136-1.257 2.358-2.332 3.667-3.228 c-0.483 0.689-0.723 1.342-0.724 1.964c0 0.6 0.2 1.1 0.7 1.523c0.499 0.4 1.1 0.6 1.9 0.6 c1.028 0 2.118-0.301 3.267-0.893c-0.03 0.096-0.064 0.195-0.091 0.29c-0.292 1.016-0.439 1.92-0.439 2.7 c0 1.1 0.3 2 1 2.763c0.637 0.7 1.4 1.1 2.4 1.111c1.377 0 2.841-0.654 4.39-1.963 c1.55-1.308 3.013-3.116 4.39-5.423c0.378 0.1 0.7 0.2 1 0.285c0.275 0.1 0.6 0.1 0.9 0.1 c0.038 0 0.077-0.005 0.115-0.006c-0.108 0.613-0.165 1.22-0.165 1.822c0 1.6 0.5 2.8 1.4 3.8 c0.948 1 2.2 1.5 3.7 1.472c1.343 0 2.771-0.387 4.287-1.162c1.248-0.639 2.426-1.485 3.535-2.534 c0.149 1 0.5 1.8 1.1 2.456c0.793 0.9 1.8 1.3 3.1 1.291c2.169 0 4.527-1.325 7.076-3.977 c0.517-0.55 1.007-1.127 1.472-1.73c0.464-0.602 0.869-1.179 1.213-1.73c0.344-0.55 0.611-1.058 0.801-1.523 c0.189-0.465 0.284-0.852 0.284-1.162c0-0.379-0.103-0.688-0.31-0.93c-0.207-0.24-0.483-0.362-0.826-0.362 c-0.517 0-1.085 0.379-1.705 1.136l-0.879 1.033c-2.411 3.065-4.218 4.597-5.423 4.597c-0.379 0-0.715-0.155-1.007-0.465 c-0.293-0.31-0.439-0.654-0.439-1.033c0-0.069 0-0.137 0-0.207c0-0.103 0.017-0.189 0.052-0.258 c1.963-1.446 3.675-2.875 5.139-4.286c1.463-1.411 2.848-2.995 4.158-4.752c0.86-1.17 1.634-2.358 2.324-3.564 c0.689-1.205 1.282-2.376 1.782-3.512c0.499-1.136 0.886-2.221 1.162-3.254C101.862 4.3 102 3.4 102 2.6 C102 1.8 101.8 1.2 101.4 0.723z M77.494 18.128c0.705-0.689 1.247-1.033 1.627-1.033c0.344 0 0.5 0.2 0.5 0.6 c0 0.345-0.103 0.689-0.31 1.033c-0.207 0.344-0.473 0.663-0.8 0.955c-0.328 0.293-0.689 0.525-1.085 0.7 c-0.396 0.173-0.784 0.258-1.162 0.258c-0.139 0-0.25-0.008-0.336-0.026c-0.086-0.017-0.199-0.043-0.336-0.077 C76.159 19.6 76.8 18.8 77.5 18.128z M34.989 19.315c-0.328 0.62-0.697 1.136-1.111 1.55l-0.825 0.9 c-0.172 0.173-0.259 0.362-0.259 0.568c0 0.1 0.1 0.3 0.2 0.568c-0.173 0.173-0.276 0.293-0.309 0.4 c-0.586 0.723-1.068 1.223-1.446 1.498c-0.379 0.276-0.758 0.414-1.136 0.414c-0.517 0-0.775-0.293-0.775-0.879 c0-0.482 0.181-1.153 0.542-2.014c0.362-0.86 0.817-1.686 1.369-2.479c0.585-0.826 1.196-1.489 1.833-1.988 c0.636-0.499 1.179-0.749 1.627-0.749c0.55 0 0.8 0.3 0.8 0.826C35.48 18.2 35.3 18.7 35 19.315z M97.636 6.9 c-0.225 0.568-0.517 1.223-0.878 1.963c-0.362 0.741-0.784 1.516-1.265 2.324c-0.483 0.809-0.999 1.593-1.55 2.4 c-0.826 1.205-1.652 2.272-2.479 3.202c-0.826 0.929-1.79 1.911-2.892 2.944c0.137-0.344 0.275-0.688 0.413-1.033 c0.137-0.344 0.3-0.705 0.49-1.085c0.189-0.378 0.413-0.817 0.672-1.317c0.258-0.499 0.576-1.093 0.956-1.782 c0.619-1.17 1.102-2.066 1.446-2.685s0.705-1.222 1.085-1.808c0.93-1.55 1.738-2.745 2.428-3.589 c0.688-0.843 1.205-1.265 1.55-1.265c0.24 0 0.4 0.2 0.4 0.465C97.972 5.9 97.9 6.3 97.6 6.895z"/></svg>\n            </a>\n            <span style="color: white;">Free Prototyping For Everyone</span>\n            '}__p+='\n\n            <div class="loader">\n                <div class="inner" style="background-color: '+((__t=fillcolor)==null?"":__t)+';"></div>\n            </div>\n        </div>\n    </div>'}return __p};this["MARVELAPP"]["templates"]["PASSWORD_BOX"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div id="password-protected">\n    <div class="inner">\n        ';if(team_icon!=""&&team_icon!=null){__p+='\n            <div class="team-logo" style="background-image: url('+((__t=team_icon)==null?"":__t)+');"></div>\n        '}else if(!is_pro){__p+='\n            <a href="http://marvelapp.com/">\n        		<svg class="logo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="102px" height="32.279px" viewBox="0 0 102 32.279" enable-background="new 0 0 102 32.279" xml:space="preserve"><path d="M101.431 0.723C101.052 0.2 100.5 0 99.9 0c-0.723 0-1.506 0.25-2.35 0.7 c-0.844 0.499-1.816 1.3-2.918 2.401c-0.792 0.792-1.644 1.782-2.556 2.97c-0.913 1.188-1.817 2.479-2.712 3.9 c-0.895 1.394-1.756 2.823-2.582 4.287c-0.826 1.464-1.533 2.866-2.118 4.209c-0.438 0.967-0.805 1.846-1.108 2.6 c-0.061 0.064-0.122 0.122-0.183 0.198l-1.085 1.446c-0.93 1.239-2.023 2.272-3.28 3.099c-1.258 0.826-2.35 1.24-3.28 1.2 c-0.619 0-1.11-0.147-1.472-0.44c-0.362-0.292-0.543-0.731-0.543-1.317c0-0.206 0.026-0.387 0.077-0.542 c0.052-0.155 0.146-0.353 0.284-0.594c0.31 0.1 0.6 0.1 0.8 0.181c0.189 0.1 0.4 0.1 0.7 0.1 c0.999 0 1.98-0.232 2.944-0.697c0.964-0.465 1.816-1.076 2.556-1.833c0.741-0.757 1.343-1.618 1.808-2.583 c0.464-0.964 0.697-1.944 0.697-2.944c0-1.033-0.309-1.876-0.929-2.531c-0.62-0.654-1.429-0.981-2.428-0.981 c-1.206 0-2.437 0.405-3.693 1.214c-1.257 0.809-2.401 1.851-3.434 3.124c-0.705 0.87-1.315 1.808-1.844 2.8 c-0.415 0.216-0.817 0.337-1.205 0.337c-0.173 0-0.345-0.017-0.517-0.052c0.378-0.653 0.671-1.402 0.878-2.246 c0.207-0.843 0.31-1.643 0.31-2.401c0-0.688-0.138-1.257-0.413-1.705c-0.276-0.447-0.654-0.671-1.136-0.671 c-0.448 0-0.887 0.173-1.317 0.517c-0.431 0.345-0.818 0.784-1.162 1.317c-0.344 0.534-0.619 1.154-0.826 1.9 c-0.207 0.706-0.31 1.42-0.31 2.143c0 0.2 0 0.4 0 0.62c0 0.2 0 0.5 0.1 0.878c-0.173 0.413-0.413 0.852-0.723 1.3 c-0.31 0.465-0.706 1.007-1.188 1.627c-0.689 0.896-1.249 1.55-1.679 1.963c-0.431 0.413-0.818 0.62-1.162 0.6 c-0.173 0-0.319-0.077-0.439-0.232c-0.121-0.155-0.181-0.336-0.181-0.542c0-0.378 0.137-0.947 0.413-1.705 c0.276-0.757 0.62-1.515 1.033-2.272l1.343-2.634c0.378-0.688 0.679-1.411 0.903-2.169c0.223-0.757 0.336-1.377 0.336-1.859 c0-0.551-0.173-0.998-0.517-1.343c-0.344-0.344-0.757-0.517-1.239-0.517c-0.482 0-0.887 0.138-1.214 0.4 c-0.327 0.276-0.628 0.775-0.903 1.498c-0.207 0.482-0.413 0.973-0.62 1.472c-0.207 0.5-0.447 0.99-0.723 1.472l-0.402 0.8 c-0.107 0.03-0.214 0.075-0.321 0.137c-0.207 0.121-0.551 0.371-1.033 0.749c-0.586 0.483-1.11 0.861-1.575 1.1 c-0.465 0.276-0.818 0.413-1.059 0.413c-0.345 0-0.517-0.137-0.517-0.413c0-0.207 0.181-0.499 0.542-0.878 c0.361-0.379 0.834-0.792 1.42-1.24c0.62-0.413 1.05-0.783 1.291-1.111c0.241-0.327 0.362-0.697 0.362-1.111 c0-0.413-0.164-0.792-0.491-1.136c-0.327-0.344-0.697-0.517-1.11-0.517c-0.379 0-0.81 0.138-1.291 0.4 c-0.483 0.276-1.206 0.758-2.169 1.446c-1.033 0.793-1.962 1.55-2.789 2.273c-0.826 0.723-1.705 1.619-2.634 2.685l-0.362 0.4 c0.207-0.482 0.517-1.05 0.93-1.705c0.413-0.654 0.86-1.257 1.342-1.808c0.585-0.689 0.956-1.17 1.111-1.446 c0.155-0.275 0.232-0.585 0.232-0.93c0-0.413-0.173-0.775-0.517-1.085c-0.344-0.31-0.757-0.465-1.239-0.465 c-0.723 0-1.429 0.362-2.118 1.085c-0.413 0.413-0.887 1.007-1.42 1.782c-0.534 0.774-1.041 1.575-1.523 2.4 c-0.122 0.206-0.238 0.427-0.358 0.639c-0.285 0.206-0.578 0.509-0.88 0.911c-0.999 1.377-1.833 2.376-2.506 3 c-0.672 0.62-1.265 0.93-1.781 0.93c-0.586 0-0.879-0.276-0.879-0.827c0-0.379 0.155-0.878 0.466-1.498 c0.309-0.62 0.723-1.273 1.239-1.963c0.276-0.31 0.447-0.55 0.517-0.723c0.069-0.172 0.103-0.344 0.103-0.517 c0-0.207-0.052-0.395-0.154-0.568c-0.104-0.172-0.328-0.395-0.672-0.672c0.172-0.447 0.301-0.834 0.388-1.162 c0.085-0.327 0.129-0.697 0.129-1.111c0-1.17-0.344-2.099-1.033-2.789c-0.689-0.688-1.584-1.033-2.686-1.033 c-1.205 0-2.453 0.422-3.744 1.265c-1.291 0.844-2.539 2.075-3.744 3.693c-0.85 1.125-1.552 2.308-2.119 3.5 c-0.171 0.198-0.359 0.443-0.566 0.744c-0.379 0.551-0.818 1.154-1.317 1.808c-0.499 0.655-0.921 1.171-1.265 1.6 c-0.655 0.723-1.188 1.231-1.601 1.523c-0.413 0.293-0.793 0.44-1.136 0.44c-0.448 0-0.671-0.225-0.671-0.672 c0-1.033 1.343-3.306 4.028-6.818c0.585-0.757 0.989-1.35 1.214-1.781c0.224-0.43 0.336-0.852 0.336-1.265 c0-0.55-0.232-1.041-0.697-1.472c-0.464-0.43-0.99-0.646-1.575-0.646c-0.413 0-0.844 0.121-1.291 0.4 c-0.448 0.241-1.016 0.655-1.705 1.24c-0.31 0.276-0.62 0.542-0.93 0.801c-0.31 0.258-0.638 0.56-0.981 0.9 c-0.345 0.345-0.741 0.741-1.188 1.188c-0.448 0.448-0.981 0.999-1.601 1.653l-0.62 0.672l0.413-0.775l1.085-1.963 c0.447-0.792 0.74-1.377 0.878-1.756c0.137-0.378 0.207-0.723 0.207-1.033c0-0.481-0.173-0.886-0.517-1.213 c-0.345-0.327-0.758-0.491-1.24-0.491c-0.379 0-0.8 0.121-1.265 0.362c-0.465 0.241-0.99 0.62-1.575 1.1 c-0.586 0.516-1.265 1.205-2.04 2.066c-0.775 0.861-1.678 1.911-2.711 3.15l0.568-1.136c0.31-0.55 0.568-1.007 0.775-1.369 c0.207-0.362 0.362-0.628 0.465-0.801c0.585-0.929 0.956-1.583 1.111-1.962c0.155-0.378 0.232-0.74 0.232-1.085 c0-0.447-0.164-0.826-0.491-1.136c-0.328-0.31-0.715-0.465-1.162-0.465c-0.413 0-0.793 0.129-1.136 0.4 c-0.345 0.258-0.758 0.697-1.24 1.317c-0.826 1.102-1.661 2.427-2.505 3.977c-0.843 1.55-1.627 3.237-2.35 5.1 C0.637 26.5 0 28.8 0 30.058c0 0.7 0.2 1.2 0.5 1.602c0.345 0.4 0.8 0.6 1.3 0.6 c0.517 0 0.939-0.163 1.265-0.49c0.328-0.328 0.697-0.973 1.111-1.937c0.31-0.723 0.697-1.471 1.162-2.246 c0.465-0.775 0.998-1.541 1.601-2.298c0.602-0.757 1.23-1.489 1.885-2.195c0.654-0.705 1.325-1.334 2.014-1.885 c-0.138 0.276-0.241 0.448-0.31 0.517l-0.981 1.705c-0.207 0.309-0.448 0.748-0.723 1.317c-0.276 0.568-0.5 1.093-0.671 1.6 c-0.276 0.62-0.457 1.111-0.542 1.472c-0.086 0.362-0.129 0.732-0.129 1.111c0 0.6 0.2 1.1 0.5 1.5 c0.362 0.4 0.8 0.6 1.4 0.594c0.517 0 0.947-0.181 1.291-0.542c0.344-0.362 0.843-1.093 1.498-2.195 c0.895-1.653 1.781-3.004 2.66-4.055c0.878-1.05 1.764-1.919 2.66-2.608c-0.138 0.207-0.225 0.345-0.258 0.4 c-0.483 0.689-0.878 1.317-1.188 1.885c-0.31 0.568-0.551 1.102-0.723 1.601c-0.173 0.5-0.302 0.98-0.387 1.4 c-0.086 0.465-0.129 0.956-0.129 1.472c0 1 0.3 1.8 0.9 2.453c0.62 0.6 1.4 1 2.4 1 c1.033 0 2.177-0.396 3.434-1.188c1.123-0.708 2.226-1.679 3.308-2.91c0.159 0.5 0.4 0.9 0.7 1.3 c0.638 0.8 1.4 1.1 2.4 1.137c1.859 0 3.615-1.137 5.269-3.408v0.465c0 0.8 0.3 1.4 0.8 1.9 c0.517 0.5 1.2 0.8 1.9 0.801c1.258 0 2.555-0.451 3.892-1.348c-0.181 0.696-0.278 1.255-0.278 1.7 c0 0.6 0.2 1 0.5 1.317c0.345 0.3 0.8 0.5 1.3 0.49c0.483 0 0.878-0.112 1.188-0.336 c0.31-0.225 0.603-0.612 0.878-1.162l1.136-2.376c0.62-1.273 1.498-2.538 2.634-3.796c1.136-1.257 2.358-2.332 3.667-3.228 c-0.483 0.689-0.723 1.342-0.724 1.964c0 0.6 0.2 1.1 0.7 1.523c0.499 0.4 1.1 0.6 1.9 0.6 c1.028 0 2.118-0.301 3.267-0.893c-0.03 0.096-0.064 0.195-0.091 0.29c-0.292 1.016-0.439 1.92-0.439 2.7 c0 1.1 0.3 2 1 2.763c0.637 0.7 1.4 1.1 2.4 1.111c1.377 0 2.841-0.654 4.39-1.963 c1.55-1.308 3.013-3.116 4.39-5.423c0.378 0.1 0.7 0.2 1 0.285c0.275 0.1 0.6 0.1 0.9 0.1 c0.038 0 0.077-0.005 0.115-0.006c-0.108 0.613-0.165 1.22-0.165 1.822c0 1.6 0.5 2.8 1.4 3.8 c0.948 1 2.2 1.5 3.7 1.472c1.343 0 2.771-0.387 4.287-1.162c1.248-0.639 2.426-1.485 3.535-2.534 c0.149 1 0.5 1.8 1.1 2.456c0.793 0.9 1.8 1.3 3.1 1.291c2.169 0 4.527-1.325 7.076-3.977 c0.517-0.55 1.007-1.127 1.472-1.73c0.464-0.602 0.869-1.179 1.213-1.73c0.344-0.55 0.611-1.058 0.801-1.523 c0.189-0.465 0.284-0.852 0.284-1.162c0-0.379-0.103-0.688-0.31-0.93c-0.207-0.24-0.483-0.362-0.826-0.362 c-0.517 0-1.085 0.379-1.705 1.136l-0.879 1.033c-2.411 3.065-4.218 4.597-5.423 4.597c-0.379 0-0.715-0.155-1.007-0.465 c-0.293-0.31-0.439-0.654-0.439-1.033c0-0.069 0-0.137 0-0.207c0-0.103 0.017-0.189 0.052-0.258 c1.963-1.446 3.675-2.875 5.139-4.286c1.463-1.411 2.848-2.995 4.158-4.752c0.86-1.17 1.634-2.358 2.324-3.564 c0.689-1.205 1.282-2.376 1.782-3.512c0.499-1.136 0.886-2.221 1.162-3.254C101.862 4.3 102 3.4 102 2.6 C102 1.8 101.8 1.2 101.4 0.723z M77.494 18.128c0.705-0.689 1.247-1.033 1.627-1.033c0.344 0 0.5 0.2 0.5 0.6 c0 0.345-0.103 0.689-0.31 1.033c-0.207 0.344-0.473 0.663-0.8 0.955c-0.328 0.293-0.689 0.525-1.085 0.7 c-0.396 0.173-0.784 0.258-1.162 0.258c-0.139 0-0.25-0.008-0.336-0.026c-0.086-0.017-0.199-0.043-0.336-0.077 C76.159 19.6 76.8 18.8 77.5 18.128z M34.989 19.315c-0.328 0.62-0.697 1.136-1.111 1.55l-0.825 0.9 c-0.172 0.173-0.259 0.362-0.259 0.568c0 0.1 0.1 0.3 0.2 0.568c-0.173 0.173-0.276 0.293-0.309 0.4 c-0.586 0.723-1.068 1.223-1.446 1.498c-0.379 0.276-0.758 0.414-1.136 0.414c-0.517 0-0.775-0.293-0.775-0.879 c0-0.482 0.181-1.153 0.542-2.014c0.362-0.86 0.817-1.686 1.369-2.479c0.585-0.826 1.196-1.489 1.833-1.988 c0.636-0.499 1.179-0.749 1.627-0.749c0.55 0 0.8 0.3 0.8 0.826C35.48 18.2 35.3 18.7 35 19.315z M97.636 6.9 c-0.225 0.568-0.517 1.223-0.878 1.963c-0.362 0.741-0.784 1.516-1.265 2.324c-0.483 0.809-0.999 1.593-1.55 2.4 c-0.826 1.205-1.652 2.272-2.479 3.202c-0.826 0.929-1.79 1.911-2.892 2.944c0.137-0.344 0.275-0.688 0.413-1.033 c0.137-0.344 0.3-0.705 0.49-1.085c0.189-0.378 0.413-0.817 0.672-1.317c0.258-0.499 0.576-1.093 0.956-1.782 c0.619-1.17 1.102-2.066 1.446-2.685s0.705-1.222 1.085-1.808c0.93-1.55 1.738-2.745 2.428-3.589 c0.688-0.843 1.205-1.265 1.55-1.265c0.24 0 0.4 0.2 0.4 0.465C97.972 5.9 97.9 6.3 97.6 6.895z"/></svg>\n    	</a>\n        '}__p+='\n        <div id="password-box">\n            <h1>This prototype is password protected</h1>\n            Enter password to view\n            <div method="POST" id="password-form">\n                <div class="field">\n                    <div class="icon-lock"></div>\n                    <input class="" id="password" name="password" type="password" class="password-field" value="">\n                </div>\n                <button id="submit" type="submit">Submit</button>\n            </div>\n            <div id="success">\n                <div class="icon-checkmark"></div>\n            </div>\n        </div>\n    </div>\n</div>'}return __p};this["MARVELAPP"]["templates"]["PROTOTYPE_EMPTY"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="prototype-modal">\n    <div class="table">\n        <div class="cell">\n			<h3>This prototype is empty. Add some images first!</h3>\n        </div>\n    </div>\n</div>'}return __p};this["MARVELAPP"]["templates"]["PROTOTYPE_GRID_VIEW"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="prototype-overlay new-overlay grid-view-overlay">\n    <div class="modal-table">\n        <div class="cell">\n            <div class="close">\n                <div class="icon-cross"></div>\n            </div>\n            <div class="modal">\n                <div class="grid-view-header cf">\n                    <div class="float-left">\n                        <h2>'+__e(project.name)+"</h2>\n                        <span>"+__e(_.size(project.images))+' screens</span>\n                    </div>\n                </div>\n                <div class="grid-view-screens-wrapper">\n                    <ul class="cf"></ul>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'}return __p};this["MARVELAPP"]["templates"]["PROTOTYPE_GRID_VIEW_THUMBNAIL"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="thumbnail-wrap" data="'+__e(imageViewModel.id)+'">\n	<div class="thumbnail">\n		<div class="sync-indicator" style="display: none;"></div>\n	</div>\n</div>\n<span>'+((__t=imageViewModel.name)==null?"":__t)+"</span>"}return __p};this["MARVELAPP"]["templates"]["PROTOTYPE_IE_BAR"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="ie-bar">\n    <div class="ie-bar-inner">\n        <p>Sadly your browser is unable to play our awesome prototypes. For the best experience please update to a modern browser like <a href="http://www.google.com/chrome/">Google Chrome</a></p>\n        <a href="#" class="close">x</a>\n    </div>\n</div>'}return __p};this["MARVELAPP"]["templates"]["PROTOTYPE_MODALS"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="white-overlay"></div>\n\n<div class="overlay" id="resume-prototyping">\n	<div class="container">\n		<div class="inner">\n			<div class="modal">\n				<div class="close icon-cross"></div>\n				<h3>Welcome back.</h3>\n				<p>Log into your account here:</p>\n	            <form method=\'post\'>\n					<div class="field email">\n						<div class="field-wrap">\n							<input type="email" spellcheck="false" name="signin-email" placeholder="Email address">\n						</div>\n						<div class="error"></div>\n					</div>\n					<div class="field password">\n						<div class="field-wrap">\n							<input type="password" spellcheck="false" name="signin-password" placeholder="Password">\n						</div>\n						<div class="error"></div>\n					</div>\n					<div class="forgot-password">Forgot password?</div>\n					<div class="field submit">\n						<input id="login-button" type="submit" class="button thin clear" value="Log in"/>\n					</div>\n				</form>\n\n	            <p class="divider"><span>Or use your cloud storage</span></p>\n            	<a href="/auth/dropbox_auth_start/" id="connect-dropbox" class="button blue thin dropbox">Sign in with Dropbox</a>\n            	<a href="/auth/drive_auth_start/" id="connect-drive" class="button blue thin drive">Sign in with Google Drive</a>\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="overlay" id="comment-signup">\n	<div class="container">\n		<div class="inner">\n			<div class="modal">\n				<div class="close icon-cross"></div>\n				<h3>Enter your details to comment</h3>\n				<p>We’ll keep you in the loop when someone replies or adds new comments</p>\n	            <form method=\'post\'>\n					<div class="field name">\n						<div class="field-wrap">\n							<input id="signin-name" type="text" spellcheck="false" name="signin-name" placeholder="Name">\n						</div>\n						<div class="error"></div>\n					</div>\n					<div class="field email">\n						<div class="field-wrap">\n							<input id="signin-email" type="email" spellcheck="false" name="signin-email" placeholder="Email address">\n						</div>\n						<div class="error"></div>\n					</div>\n					<div class="field submit">\n						<a class="button thin clear" id="comment-button">Post comment</a>\n						<!-- <input id="comment-button" type="submit" class="button thin clear" value="Post comment"/> -->\n					</div>\n				</form>\n			</div>\n			<div class="sub">\n				Have an account? <a class="resume-prototyping switch">Sign in</a>\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="overlay" id="forgot-password-modal">\n	<div class="container">\n		<div class="inner">\n			<div class="modal">\n				<div class="close icon-cross"></div>\n				<div id="forgot-back" class="back">&larr; back</div>\n				<h3>Forgot your password?</h3>\n				<p>We\'ll email you instructions on how to reset it.</p>\n	            <form>\n					<div class="field email">\n						<div class="field-wrap">\n							<input type="email" spellcheck="false" name="forgot-email" placeholder="Email address">\n						</div>\n						<div class="error"></div>\n					</div>\n					<div class="field submit">\n						<input id="reset-password" type="submit" class="button thin clear" value="Reset password"/>\n					</div>\n				</form>\n				<div id="forgot-success">\n					<div class="table">\n						<div class="cell">\n							<div class="tick"></div>\n							<h3>Password reset sent!</h3>\n							<p>We\'ve just emailed you instructions on how to reset your password. </p>\n						</div>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n'}return __p};this["MARVELAPP"]["templates"]["PROTOTYPE_WRAPPER"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div id="content-wrapper" class="cf';if(collapsed){__p+=" collapsed"}__p+='">\n	<div id="content">\n        <div class="inner-content" id="device"';if(!embed){__p+=' style="background-color: #'+__e(background)+';"'}__p+='>\n			<div class="marvel-device '+__e(frame)+" "+__e(colour)+" "+__e(orientation)+'">\n				<div class="screen">\n					<div id="screens" style="background-color: #'+__e(prototype_background)+'">\n						<div class="screen-overlay-background"></div>\n					</div>\n				</div>\n			</div>\n			';if(!is_pro&&embed&&!published){__p+='\n			<a href="https://marvelapp.com/" target="_parent" id="powered-by">Powered by Marvel</a>\n			'}__p+="\n		</div>\n	</div>\n</div>\n\n";
if(app_icon!=null&&frame!="web-frame"&&frame!="desktop-view"&&!embed){__p+='\n    <div class="app-icon';if(frame=="apple-watch-38-frame"||frame=="apple-watch-42-frame"){__p+=" watch"}__p+='" style="background-image: url('+__e(app_icon.url)+');"></div>\n'}__p+="\n";if(!is_pro&&!embed){__p+='\n	<div class="powered-wrapper">\n		<a class="powered" target="_blank" title="Upgrade to pro to remove Marvel branding" href="https://marvelapp.com/">\n			Create Your Free Prototype\n		</a>\n		<div class="close-powered"></div>\n		<div class="powered-popover">\n			Upgrade your plan to remove this and add premium features. <a href="http://marvelapp.com/upgrade/" target="_blank">Click here</a>.\n		</div>\n	</div>\n'}__p+="\n\n";if(commentsEnabled){__p+='\n<h1 class="comments" id="screen-name">'+__e(images[1].name)+"</h1>\n"}else{__p+='\n<h1 id="screen-name">'+__e(images[1].name)+"</h1>\n"}__p+="\n\n";if(commentsEnabled&&!embed&&!mobile){__p+='\n<div id="annotation-notification">\n	<span id="comment-count" class="comment-count"></span>\n	<div class="loader">\n    	<span>&middot;&middot;&middot;</span>\n    </div>\n</div>\n\n<div id="annotations-sidebar"></div>\n\n<div class="close-annotation-mode"></div>\n'}__p+='\n\n<div id="grid-view"></div>'}return __p};this["MARVELAPP"]["templates"]["ROTATE_DEVICE"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="prototype-modal rotate-device hidden">\n	<div class="table">\n		<div class="cell">\n			<div class="inner">\n				<div class="icon"></div>\n				<h4>Rotate your device</h4>\n			</div>\n		</div>\n	</div>\n</div>'}return __p};this["MARVELAPP"]["templates"]["SCREEN"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div id="'+__e(id)+'" class="screen-wrap';if(isOverlay){__p+=" screen-overlay"}else if(firstImage){__p+=" active"}if(isScreenUnderOverlay){__p+=" active"}__p+='" style="background-color: #'+__e(background)+';">\n\n\n	<div class="loading';if(white){__p+=" white"}__p+='" style="background: #'+__e(background)+';">\n		<div class="modal">\n			<div class="modal-inner">\n				<div id="spinner_'+__e(id)+'"></div>		\n			</div>\n		</div>\n	</div>\n\n	';if(failed){__p+='\n	<div class="prototype-modal failed-upload">\n		<div class="table">\n			<div class="cell">\n				<div class="inner">\n					<div class="icon grey failed"></div>\n					<h4>This image failed to upload to the server and needs to be reuploaded</h4>\n				</div>\n			</div>\n		</div>\n	</div>\n	'}__p+="\n\n	";if(syncing){__p+='\n	<div class="prototype-modal still-syncing">\n		<div class="table">\n			<div class="cell">\n				<div class="inner">\n					<div class="icon grey syncing"></div>\n					<h4>This image is still uploading<br>to the server</h4>\n				</div>\n			</div>\n		</div>\n	</div>\n	'}__p+="\n\n	";if(trim_status=="1"&&mobile&&status_type!="0"&&homescreen){__p+='\n		<div class="status" style="background-color: rgba('+__e(status_pixel_colour)+');"></div>\n	'}__p+="\n\n	";if(disable_resizing=="1"&&center_overflow=="0"){__p+='<div class="disable-resize">'}__p+="\n\n	";if(fixedHeader!=""&&fixedHeaderURL!=""){__p+='\n	<div class="fixed-header';if(mobile&&trim_status=="1"){__p+=" trimmed"}__p+='" style="max-width: '+__e(width)+"px; background-image: url("+__e(fixedHeaderURLAlt)+");"+__e(disable_resizing_scale)+'"></div>\n	'}__p+="\n	";if(fixedFooter!=""&&fixedFooterURL!=""){__p+='\n	<div class="fixed-footer" style="max-width: '+__e(width)+"px; background-image: url("+__e(fixedFooterURLAlt)+");"+__e(disable_resizing_scale)+'"></div>\n	'}__p+='\n	<div class="box-wrap antiscroll-wrap">\n		<div class="box"';if(disable_resizing=="1"){__p+=' style="max-width: '+__e(width)+"px;";if(center_overflow=="1"){__p+=" margin: 0 auto;"}__p+='"'}__p+=">\n			";if(mobile){__p+="\n			";if(fixedHeader==""){__p+='\n			<div class="topBg" style="background-color: rgba('+__e(status_pixel_colour)+"); max-width: "+__e(width)+'px;"></div>	\n			'}else if(top_pixel_colour!=null){__p+='\n			<div class="topBg" style="background-color: rgba('+__e(top_pixel_colour)+"); max-width: "+__e(width)+'px;"></div>\n			'}__p+="\n			";if(bottom_pixel_colour!=null){__p+='\n			<div class="bottomBg" style="background-color: rgba('+__e(bottom_pixel_colour)+"); max-width: "+__e(width)+'px;"></div>\n			'}__p+="\n			"}__p+='\n			<div class="antiscroll-inner';if(!iOS7){__p+=" touch"}__p+='" style="width: 100%;">\n				<div class="box-inner"';if(center_overflow=="1"){__p+=' style="overflow: hidden;"'}__p+='>\n					<div class="image cf" style="max-width: '+__e(width)+"px;"+__e(disable_resizing_scale)+'">\n						<div class="image-wrap">\n							<img data="'+__e(id)+'" src="">\n						</div>\n					</div>\n				</div>\n			</div>\n		</div>\n	</div>\n\n	';if(disable_resizing=="1"&&center_overflow=="0"){__p+="</div>"}__p+="\n</div>\n"}return __p};this["MARVELAPP"]["templates"]["SIDEBAR"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(commentsEnabled){__p+='\n<h1 class="comments">'+((__t=name)==null?"":__t)+"</h1>\n"}else{__p+="\n<h1>"+((__t=name)==null?"":__t)+"</h1>\n"}__p+="\n\n";if(!initial){__p+='\n<div class="screen-info">\n    <div class="current">'+((__t=first_index)==null?"":__t)+'</div> / <div class="total">'+((__t=num_images)==null?"":__t)+"</div>\n</div>\n"}__p+='\n<div class="controls">\n    <div class="grid">Grid</div>\n	<div class="home">Home</div>\n	<div class="prev">Previous</div>\n	<div class="next">Next</div>\n	<!-- <div class="share">Share</div> -->\n</div>\n</a>\n<div class="close">Close</div>'}return __p};this["MARVELAPP"]["templates"]["ANNOTATION"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="<div class='annotation "+__e(commentUUID);if(!pulse){__p+=" active"}__p+="' data-comment-uuid=\""+__e(commentUUID)+"\" style='top: "+((__t=topPercent)==null?"":__t)+"%; left: "+((__t=leftPercent)==null?"":__t)+"%;'>"+((__t=reference)==null?"":__t)+"</div>\n"}return __p};this["MARVELAPP"]["templates"]["COMMENT"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<li class="comment-uuid '+__e(attributes.uuid)+'" data-uuid="'+__e(attributes.uuid)+'">\n	<div class="inner">		\n		<div class="avatar" style="background-color: '+((__t=attributes.gravatar_data.colour)==null?"":__t)+';">\n			<div class="background hidden" style="background-image: url('+((__t=attributes.gravatar_data.url)==null?"":__t)+');"></div>\n			<div class="letters">'+((__t=attributes.gravatar_data.letters)==null?"":__t)+'</div>\n		</div>\n\n		<div class="text">\n		';if(attributes.marvel_user_fk!=null&&typeof attributes.marvel_user_fk.username!=="undefined"){__p+='\n			<div class="name">'+__e(attributes.marvel_user_fk.username)+"</div>		\n		"}else{__p+='\n			<div class="name">'+__e(attributes.commenter_fk.username)+"</div>\n		"}__p+="\n			<div class=\"time\" title='test'>"+((__t=attributes.time_since_creation)==null?"":__t)+'</div>\n			<div class="comment message mousetrap" contenteditable="false" spellcheck="false">'+__e(attributes.message)+'</div>\n			<div class="edit-buttons hidden cf">\n				<a class="save-edit">Save</a>\n				<a class="cancel-edit">Cancel</a>\n			</div>\n		</div>\n\n		';if(hasAnnotation()){__p+='\n		<div class="annotation-reference">'+((__t=attributes.annotation_reference)==null?"":__t)+"</div>\n		"}__p+="\n\n		";if(attributes.show_delete||attributes.show_edit){__p+='\n		<div class="dropdown-container">\n			<div class="inner-icons">\n				<span></span>\n			</div>\n			<div class="dropdown">\n				';if(attributes.show_edit){__p+='\n				<a class="remove-btn edit-comment">Edit comment</a>\n				'}__p+="\n			    ";if(hasAnnotation()&&attributes.show_delete){__p+='\n				<a class="remove-btn remove-annotation">Remove annotation</a>\n			    '}__p+="\n				";if(attributes.show_delete){__p+='\n				<a class="remove-btn remove-comment">Delete comment</a>\n			    '}__p+="\n			</div>\n		</div>\n		"}__p+="\n\n    </div>\n</li>\n"}return __p};this["MARVELAPP"]["templates"]["EDITOR_ANNOTATIONS_SIDEBAR"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div id="no-comments" class="empty-state table">\n	<div class="cell">\n		<div class="icon"></div>\n		<p>No comments<br>on this screen</p>\n	</div>\n</div>\n<div id="enable-comments" class="empty-state table state-hidden">\n	<div class="cell">\n		<div class="icon"></div>\n		<h3>Start commenting on this project</h3>\n		<p>Enable comments on this project to add feedback and annotations on screens</p>\n		<div class="small-button enable-comments">Enable comments</div>\n	</div>\n</div>\n<div id="upgrade-pro" class="empty-state table state-hidden">\n	<div class="cell">\n		<div class="icon"></div>\n		<h3>Upgrade your plan to comment</h3>\n		<p>Get commenting on unlimited projects on all of our paid plans</p>\n		<a class="small-button href-pro-account" href="/upgrade/">Upgrade now</a>\n	</div>\n</div>\n<ul class="comments-list"></ul>\n<div class="wait"></div>\n<div class="comment-area">\n	<textarea id="comment-text" class="mousetrap" placeholder="Write your comment..." tabindex="1"></textarea>\n	<div class="buttons cf">\n		<button class="button" id="post-comment" tabindex="2">Post comment</button>\n	</div>\n	<div class="make-annotation">\n		<div class="icon"></div>\n	</div>\n	<div class="current-annotation">\n		<div class="icon"></div>\n		<div class="remove-annotation">Remove annotation</div>\n	</div>\n</div>\n<div class="close"></div>'}return __p};this["MARVELAPP"]["templates"]["EXPLORE_COMMENT"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="comment cf" data-uuid="'+__e(attributes.uuid)+'">\n\n	<div class="avatar" style="background-color: '+((__t=attributes.gravatar_data.colour)==null?"":__t)+';">\n        <div class="letters">'+((__t=attributes.gravatar_data.letters)==null?"":__t)+'</div>\n	    <div class="background hidden" style="background-image: url('+((__t=attributes.gravatar_data.url)==null?"":__t)+');"></div>\n	</div>\n\n	<div class="text">\n		<div class="name">\n			<a class="profile-redirect">'+__e(attributes.marvel_user_fk.username)+"</a>\n			<span title='"+((__t=attributes.created_at)==null?"":__t)+"'>"+((__t=attributes.time_since_creation)==null?"":__t)+'</span>\n		</div>\n		<p contenteditable="false" class="message mousetrap">'+__e(attributes.message)+'</p>\n		<div class="edit-buttons hidden cf">\n			<a class="save-edit">Save</a>\n			<a class="cancel-edit">Cancel</a>\n		</div>\n	</div>\n\n	<div class="buttons">\n		';if(attributes.show_delete){__p+='<a class="remove-btn remove-comment"></a>'}__p+="\n		";if(attributes.show_edit){__p+='<a class="remove-btn edit-comment"></a>'}__p+="\n	</div>\n</div>\n"}return __p};this["MARVELAPP"]["templates"]["EXPLORE_PROFILE"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<section class="global-explore-header explore-section explore-profile">\n	<div class="profile-avatar avatar" style="background-color: '+((__t=gravatar_data.colour)==null?"":__t)+'">\n		<div id="avatar-background" class="background hidden" style="background-image: url('+((__t=gravatar_data.url)==null?"":__t)+'); "></div>\n        <div class="letters">'+((__t=gravatar_data.letters)==null?"":__t)+"</div>\n	</div>\n	";if(is_self&&gravatar_data.is_uploaded){__p+='\n	<div id="remove-avatar" class="avatar-button">Remove avatar</div>\n	'}else if(is_self){__p+='\n	<div id="choose-avatar" class="avatar-button">Choose avatar</div>\n	'}__p+='\n	<div class="explore-wrapper">\n        <h1>'+__e(username)+"</h1>\n        ";if(bio!==""){__p+='<h2 class="explore-bio">'+__e(bio)+"</h2>"}__p+="\n        ";if(website!==""){__p+='<a href="'+__e(website)+'" target="_blank" rel=\'nofollow\'>'+__e(website)+"</a>"}__p+="\n    </div>\n</section>\n\n";if(published_projects.length){__p+='\n<section id="explore-projects" class="global-explore explore-wrapper explore-tiles explore-section hidden">\n	<div class="explore-tab active cf">\n		<ul class="tiles cf"></ul>\n	</div>\n</section>\n'}__p+='\n\n<section class="explore-empty-state" id="empty-state">\n	<div class="explore-wrapper">\n		';if(is_self){__p+="\n			<h2>You don't have any published projects yet!</h2>\n		"}else{__p+="\n			<h2>"+__e(username)+" doesn't have any published projects yet!</h2>\n		"}__p+="\n	</div>\n</section>\n"}return __p};this["MARVELAPP"]["templates"]["MODAL_SESSION_EXPIRED"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="modal-overlay error-overlay" id="session-modal">\n    <div class="modal-table">\n        <div class="cells">\n            <div class="modal center">\n                <div class="tab-content cf">\n                    <img width="110" src="/static/assets/images/session.png">\n                    <h2>Your session has expired</h2>\n                    <p>To keep things safe, we’ve logged you out of Marvel. Click the button below to log back in.</p>\n                    <a href=\'/\' class="tab-button green">Login</a>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>'}return __p};this["MARVELAPP"]["templates"]["NOT_FOUND"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="project-not-found">\n    <div class="table">\n        <div class="cell">\n            <div class="wrapper">\n                <h1>'+__e(header)+"</h1>\n                <p>"+__e(message)+"</p>\n            </div>\n        </div>\n    </div>\n</div>"}return __p};this["MARVELAPP"]["templates"]["SITE_EXPLORE"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<section class="explore-hero explore-section '+__e(orientation)+'" style="background-color: '+__e(embedColour)+'">\n	<a class="explore-back-holder">\n		<div class="explore-back-arrow">\n		</div>\n		<div class="explore-back-text">\n	  		Back to results\n		</div>\n	</a>\n	<div class="table">\n		<div class="cell wrapper">\n			<h1>'+((__t=name)==null?"":__t)+'</h1>\n			<h2>\n				<a class="profile-uri" href="'+__e(user.profile_uri)+'">\n					<div class="avatar" style="background-color: '+((__t=user.gravatar_data.colour)==null?"":__t)+'">\n						<div class="letters">'+((__t=user.letters)==null?"":__t)+'</div>\n						<div class="background hidden" style="background-image: url('+((__t=user.gravatar_data.url)==null?"":__t)+'); "></div>\n					</div>\n				</a>\n				<span>by <a class="profile-uri" href="'+__e(user.profile_uri)+'">'+((__t=user.username)==null?"":__t)+'</a></span>\n			</h2>\n			<div class="marvel-device '+__e(frame)+" "+__e(colour)+" "+__e(orientation)+'">\n				<div class="screen" style="background-image: url('+((__t=initial_image_url)==null?"":__t)+');">\n					<div class="explore-play"></div>\n				</div>\n			</div>\n		</div>\n	</div>\n	';if(!hide_make_own){__p+='<a class="make-own">Make your own</a>'}__p+='\n</section>\n\n<div class="explore-info">\n	<div class="explore-wrapper">\n		<div class="explore-stats">\n			<div class="like-wrapper">\n				<div class="likes';if(has_liked){__p+=" liked"}__p+='">\n					<div class="like"></div>\n					<span>'+((__t=commaSeparateNumber(like_count))==null?"":__t)+"</span>\n				</div>\n				";if(!hideLikePopup){__p+='\n				<div class="like-popover">\n					<h2>Show some <span class="love"></span></h2>\n					<p>Liking shows support and increases popularity!</p>\n				</div>\n				'}__p+='\n			</div>\n			<div class="views">\n				<div class="view"></div>\n				<span>'+((__t=commaSeparateNumber(views))==null?"":__t)+"</span>\n			</div>\n			";if(is_staff){__p+='\n			<a class="staff">Add as staff pick</a>\n	        '}__p+='\n	        <div class="shares">\n				<!-- <div class="share"></div>\n				<span>Share</span> -->\n\n				<!-- <div class="share-popover"> -->\n					<div class="fb-like" data-href="'+((__t=window.location.href)==null?"":__t)+'" data-layout="button_count" data-action="like" data-show-faces="false" data-share="false"></div>\n			\n					<a href="https://twitter.com/share" class="twitter-share-button" data-url="'+((__t=window.location.href)==null?"":__t)+'" data-text="Check out '+((__t=name)==null?"":__t)+" by "+((__t=user.username)==null?"":__t)+' on @marvelapp –">Tweet</a>\n				<!-- </div> -->\n			</div>\n		</div>\n	</div>\n</div>\n\n<div class="explore-comments explore-wrapper">\n	';if(description!==""){__p+='\n	<div class="description">\n		<h3>Description</h3>\n		<p class="mousetrap" contenteditable="false">'+__e(description)+"</p>\n\n		";if(show_edit){__p+='\n		<div class="buttons">\n			<a class="remove-btn edit-comment"></a>\n		</div>\n		<div class="edit-buttons hidden cf">\n			<a class="save-edit">Save</a>\n			<a class="cancel-edit">Cancel</a>\n		</div>\n		'}__p+="\n	</div>\n	"}__p+='\n	<h3>Comments <span class="comment-count">'+((__t=comment_count)==null?"":__t)+'</span></h3>\n	<div class="feed comments-list"></div>\n	<h3>Join the discussion</h3>\n	<textarea id="message" placeholder="Leave your comment here"></textarea>\n	<div class="explore-button post-comment">Post comment</div>\n</div>\n\n<div class="explore-prototype-modal">\n	<div class="close"></div>\n	<iframe src="'+((__t=vanity_url)==null?"":__t)+'?emb=1&amp;exp=1" allowTransparency="true" frameborder="0"></iframe>\n</div>\n'}return __p};this["MARVELAPP"]["templates"]["SITE_GLOBAL_EXPLORE"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<!-- <div class="spinner"></div> -->\n<div class="empty hidden">\n	<div class="table">\n		<div class="cell">\n			<img src="/static/assets/images/sad-face.png" width="100">\n			<h3>Oops! Something went wrong.</h3>\n			<p>Refresh the page and try again!</p>\n		</div>\n	</div>\n</div>\n\n<ul class="tiles cf"></ul>\n\n<div class="explore-nav-buttons">\n	<button class="explore-nav previous-page" style="';if(!hasPrevious){__p+="display:none"}__p+='"></button>\n	<button class="explore-nav next-page" style="';if(!hasNext){__p+="display:none"}__p+='"></button>\n</div>'}return __p};this["MARVELAPP"]["templates"]["SITE_GLOBAL_EXPLORE_TABS"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<section class="global-explore-header explore-section">\n    <div class="explore-wrapper">\n        <h1>Explore</h1>\n        <h2>Discover prototypes created by the community</h2>\n    </div>\n</section>\n\n<section class="global-explore explore-wrapper explore-tiles explore-section">\n	<ul class="explore-tabs">\n		<li id="explore-popular" class="active">Popular</li>\n		<li id="explore-staff_picks">Staff Picks</li>\n		<li id="explore-recent">Recent</li>\n	</ul>\n	<div class="explore-spinner"></div>\n</section>\n'}return __p};this["MARVELAPP"]["templates"]["SITE_GLOBAL_EXPLORE_TILE"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<li class="cf">\n	<a class="view-item" href="'+__e(slug)+'">\n		<div class="publish-preview" style="background-color: '+__e(colour)+';">\n			<div class="device-thumbnail explore-device-thumbnail device-thumbnail-'+((__t=frame)==null?"":__t)+" "+((__t=frameColour)==null?"":__t);if(landscape){__p+=" landscape"}__p+='">\n	            <div class="device-thumbnail-inner">\n	                 <div class="background hidden" style="background-image: url(\''+((__t=initial_image_url)==null?"":__t)+'\')"></div>\n	            </div>\n	        </div>\n	        <div class="cover"></div>\n		</div>\n	</a>\n	';if(showAvatar){__p+='\n	    <div class="avatar view-item" style="background-color: '+((__t=user.gravatar_data.colour)==null?"":__t)+';">\n	        <div class="letters">'+((__t=letters)==null?"":__t)+'</div>\n		    <div class="background hidden" style="background-image: url('+((__t=user.gravatar_data.url)==null?"":__t)+');"></div>\n		</div>\n	'}__p+='\n	<div class="info';if(!showAvatar){__p+=" full"}__p+='">\n		<h4><a class="view-item" href="'+__e(slug)+'">'+((__t=name)==null?"":__t)+'</a></h4>\n		<div class="explore-stats">\n			<div class="likes';if(has_liked){__p+=" liked "}__p+='">\n				<div class="like"></div>\n				<span>'+((__t=commaSeparateNumber(like_count))==null?"":__t)+'</span>\n			</div>\n			<div class="comments">\n				<div class="comment"></div>\n				<span>'+((__t=commaSeparateNumber(comment_count))==null?"":__t)+'</span>\n			</div>\n			<div class="views">\n				<div class="view"></div>\n				<span>'+((__t=commaSeparateNumber(views))==null?"":__t)+"</span>\n			</div>\n		</div>\n	</div>\n</li>\n"}return __p};this["MARVELAPP"]["templates"]["SITE_START_PROTOTYPING"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<section id="start">\n	<div class="wrapper">\n		<h3></h3>\n		<p>Get unlimited projects free. Get started.</p>\n		<a class="button green start-prototyping">Start prototyping</a>\n	</div>\n</section>'}return __p};MARVELAPP.ModalForView=function(viewName){return MARVELAPP[viewName].extend({events:_.extend(MARVELAPP[viewName].prototype.events||{},{"click .show":"showModal","click .close":"hideModal","click .close-button":"hideModal","click .cell":"closeFromBehind"}),showModal:function(){this.trigger("showing");if(MARVELAPP.tours.newProjectTour){MARVELAPP.tours.newProjectTour.stop()}setTimeout(_.bind(function(){this.$(".new-overlay, .modal-overlay").addClass("activated")},this),15)},hideModal:function(){this.trigger("hiding");this.$(".new-overlay, .modal-overlay").removeClass("activated");setTimeout(_.bind(function(){this.trigger("hidden")},this),15);$("body").removeClass("overlay-opened")},closeFromBehind:function(e){if(e.target===this.$(".cell")[0]){this.hideModal()}}})};function ProjectConstants(){this.QUEUE_IMG_STATUS_UPLOAD_FIRST=0;this.QUEUE_IMG_STATUS_UPLOAD_START=1;this.QUEUE_IMG_STATUS_UPLOAD_PROCESSING=2;this.QUEUE_IMG_STATUS_UPLOAD_EXT_PROCESSING=3;this.QUEUE_IMG_STATUS_PROCESSING_PSD=4;this.QUEUE_IMG_STATUS_UPLOAD_FINISHED=5;this.QUEUE_IMG_STATUS_HAS_CHANGED=6;this.QUEUE_IMG_STATUS_UPLOAD_PROCESSING_NEW=7;this.QUEUE_IMG_STATUS_UPLOAD_ERROR_FINAL=-2;this.QUEUE_IMG_STATUS_UPLOAD_ERROR_CMYK=-3;this.QUEUE_IMG_STATUS_UPLOAD_ERROR_CONNECTING=-4;this.QUEUE_IMG_STATUS_DELETED=-5;this.REGISTERED=1;this.NOT_REGISTERED=2;this.USER_STATE_INACTIVE=0;this.NOTIFY_TYPE_OK="success";this.NOTIFY_TYPE_ERROR="error";this.NOTIFY_TYPE_WARN="warning";this.NOTIFY_TYPE_NEWS="information";this.VERSION_NO=9914;this.DISPLAY_VERSION=false;this.SYNC_STATE_NOT_RUNNING=0;this.SYNC_STATE_RUNNING=1;this.SYNC_STATE_RUNNING_IN_QUEUE=2;this.SYNC_STATE_FINISHED_NOTIFY=3;this.SYNC_STATE_FINISHED=4;this.SYNC_STATE_ERROR_WARNING=-1;this.MSG_SYNCING_DROPBOX_ACCOUNT="We're syncing your account with Dropbox. This may take a few minutes.";this.MSG_SYNCING_FINISHED_DROPBOX_ACCOUNT="We have completed syncing your Dropbox account, you can now sync in real time!";this.MSG_INVALID_FILE_TYPES="We're currently syncing your files, however we've left out some (yet) unsupported file types.";this.MSG_INVALID_IMAGE_ICON="The icon file you have chosen is not a supported image. Please use a PSD or PNG";this.MSG_INVALID_IMAGE_ICON_SIZE="The icon file size is not valid, please choose a file 114x114 pixels in size";this.MSG_SELECT_DEST_IMAGE="You have not selected an image to link to. Please select an image and click save.";this.MSG_INVALID_PSD_TYPE="Sorry we're having problems with one or more of your PSDs please hit the mail icon above to contact support.";this.MSG_INVALID_FILENAME="You've selected an image with an unacceptable filename.";this.MSG_ALREADY_SYNCING="Sorry, but the file you're trying to replace is currently syncing. Wait for it to finish then try again.";this.MSG_CANNOT_DELETE_YET="Sorry, but this image is still being created, and can't be deleted yet. Wait a couple of seconds, then try again. It won't be long.";this.MSG_CANNOT_DELETE_SERVER_PROBLEM="Sorry, there was a problem contacting the server, so we can't delete the image. Try again in a couple of seconds or contact support.";this.MSG_INCOMPATIBLE_DROPBOX_FILE="You've selected an incompatible file type! We support PSDs, PNGs, JPGs or GIFs.";this.MSG_DROPBOX_REPLACEMENT_NAME_EXISTS="You've selected an image whose name is already taken by a different image in your project. Rename it, then try again.";this.MSG_PROPERTY_CHANGE_ALLOWANCE_DENIED="Upgrade your plan to enable this feature!";this.MSG_ERROR_USER_FEED="There was a problem retrieving the user feed.";this.HOTSPOT_DELETED=3;this.HOTSPOT_DETACHED=2;this.HOTSPOT_ACTIVE=1;this.PROJECT_PROP_DISABLE_FRAME="ui-prj-disable-frame";this.PROJECT_PROP_SHOW_HINTS="ui-prj-show-hints";this.PROJECT_PROP_DISABLE_SWIPE="ui-prj-disable-swipe";this.PROJECT_PROP_CENTER_IMAGE="ui-prj-center-image";this.PROJECT_PROP_STATUS_BAR="ui-prj-status-bar";this.PROJECT_PROP_FRAME="ui-prj-frame";this.PROJECT_PROP_FRAME_COLOUR="ui-prj-frame-colour";this.PROJECT_PROP_NON_RESPONSIVE="ui-prj-responsive";this.PROJECT_PROP_CENTER_OVERFLOW="ui-prj-center-overflow";this.PROJECT_PROP_RETINA_SCALE="ui-prj-retina-scale";this.PROJECT_PROP_REMOVE_STATUS="ui-prj-remove-status";this.PROJECT_PROP_ORIENTATION="ui-prj-orientation";this.PROJECT_PROP_THUMBNAIL_WIDTH="ui-prj-thumbnail-width";this.PROJECT_PROP_BACKGROUND_HEX="ui-prj-background-hex";this.PROJECT_PROP_PROTOTYPE_BACKGROUND_HEX="ui-prj-prototype-background-hex";this.PROJECT_PROP_COMMENTS_ENABLED="prj-comments-enabled";this.PROJECT_PROP_EXPLORE_BACKGROUND_HEX="ui-prj-explore-background-hex";this.PROP_STATUS_BLACK="0";this.PROP_STATUS_BLACK_CLEAR="1";this.PROP_STATUS_BLACK_WHITE_CLEAR="2";this.ORIENTATION_LANDSCAPE="landscape";this.ORIENTATION_PORTRAIT="portrait";this.FRAME_DESKTOP="web-frame";this.SUBSCRIPTION_ACTIVE=1;this.SUBSCRIPTION_INACTIVE=0;this.SUBSCRIPTION_CANCELLED=2;this.SUBSCRIPTION_IS_TRIAL=3;this.ARCHIVE_STATUS_READY=0;this.ARCHIVE_STATUS_WORKING=1;this.ARCHIVE_STATUS_FAILED=-1;this.SUB_TYPE_MONTHLY_EARLY=1;this.SUB_TYPE_MONTHLY_FULL=2;this.SUB_TYPE_YEARLY_EARLY=3;this.SUB_TYPE_YEARLY_MONTHLY_FULL=4;this.PRICE_SUB_EARLY_MONTH=500;this.PRICE_SUB_EARLY_YEARLY=4800;this.PAYMENT_TYPE_NONE=0;this.PAYMENT_TYPE_PROCESSING=1;this.PAYMENT_TYPE_INVALIDATED=2;this.TYPE_STANDARD=1;this.TYPE_FIXED_HORIZONTAL=2;this.TYPE_FIXED_VERTICAL=3;this.TYPE_BACK=4;this.TYPE_URL=5;this.TYPE_ANCHOR=6;this.TYPE_EMBED=7;this.DESTINATION_BACK="back";this.TRANSITION_TYPES={NONE:"none",FADE:"fade",PUSH_LEFT:"pushright",PUSH_RIGHT:"pushleft",SLIDE_LEFT:"slide",SLIDE_RIGHT:"slide-left",SLIDE_UP:"slideup",SLIDE_DOWN:"slidedown",POP:"pop",FLIP:"flip",FLOW:"flow",SLIDE_FADE:"slidefade"};this.ACTION_CLICK="click";this.ACTION_HOVER="hover";this.TYPE_POSITION_LEFT=1;this.TYPE_POSITION_RIGHT=2;this.TYPE_POSITION_TOP=3;this.TYPE_POSITION_BOTTOM=4;this.OVERLAY_CUSTOM=0;this.OVERLAY_CENTERED=1;this.OVERLAY_TOP_LEFT=2;this.OVERLAY_TOP_CENTER=3;this.OVERLAY_TOP_RIGHT=4;this.OVERLAY_BOTTOM_LEFT=5;this.OVERLAY_BOTTOM_CENTER=6;this.OVERLAY_BOTTOM_RIGHT=7;this.DEFAULT_OVERLAY_BACKGROUND="rgba(77, 92, 116, 0.8)";this.DEVICE_TYPES={IPADMINI:{stringValue:"ipad",width:768,height:1024},IPADAIR:{stringValue:"ipad",width:1536,height:2048},IPHONE3G:{stringValue:"iphone4s",width:320,height:480},IPHONE4S:{stringValue:"iphone4s",width:640,height:960},IPHONE5S:{stringValue:"iphone5",width:640,height:1136},IPHONE6:{stringValue:"iphone6",width:750,height:1334},IPHONE6PLUS:{stringValue:"iphone6plus",width:1080,height:1920},IPHONE6PLUSNATIVE:{stringValue:"iphone6plus",width:1242,height:2208}};this.DEFAULT_THUMBNAIL_HEIGHT_WIDTH_RATIO=.9445255474;this.IPHONE_THUMBNAIL_HEIGHT_WIDTH_RATIO=1.777777778;this.IPHONE_THUMBNAIL_HEIGHT_EXTRA=10;this.EMBED_COLOURS={0:{hex:"#7e3fff"},1:{hex:"#3f83ff"},2:{hex:"#3f3f3f"},3:{hex:"#ff3f5f"},4:{hex:"#ff7e3f"},5:{hex:"#45db68"}}}var ProjectControllerLogger=Logger.get("ProjCont");projectConstants=new ProjectConstants;function ProjectController(){this.getUser=function(callbackMethod){$.getJSON("/api/user/",{},function(data){callbackMethod(false,"",data)}).success(function(){}).error(function(e){callbackMethod(true,"",{});try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error retrieving user: there was a problem contacting the server.")}catch(ex){}}).complete(function(){console.log("Completed get user service call")})};this.numUsers=function(callbackMethod){$.getJSON("/api/users/count/",{},function(data){console.log(data);callbackMethod(false,"",data)}).success(function(){}).error(function(e){callbackMethod(true,"",{});try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error retrieving user: there was a problem contacting the server.")}catch(ex){}}).complete(function(){console.log("Completed get user service call")})};this.numActiveUsers=function(type,callbackMethod){$.getJSON("/api/users/count/active/"+type+"/",{},function(data){console.log(data);callbackMethod(false,"",data)}).success(function(){}).error(function(e){callbackMethod(true,"",{});try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error retrieving user: there was a problem contacting the server.")}catch(ex){}}).complete(function(){console.log("Completed get user service call")})};this.numContent=function(callbackMethod){$.getJSON("/api/content/count/",{},function(data){console.log(data);callbackMethod(false,"",data)}).success(function(){}).error(function(e){callbackMethod(true,"",{});try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error retrieving user: there was a problem contacting the server.")}catch(ex){}}).complete(function(){console.log("Completed get user service call")})};this.numProject=function(callbackMethod){$.getJSON("/api/project/count/",{},function(data){console.log(data);callbackMethod(false,"",data)}).success(function(){}).error(function(e){callbackMethod(true,"",{});try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error retrieving user: there was a problem contacting the server.")}catch(ex){}}).complete(function(){console.log("Completed get user service call")})};this.deleteUser=function(callbackMethod){$.ajax({url:"/api/user/",type:"DELETE",success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){callbackMethod(true,"",{},projectConstants.NOTIFY_TYPE_ERROR);showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error retrieving user: there was a problem contacting the server.")}})};this.editUser=function(userObj,callbackMethod){console.log("Editing user ");console.log(userObj);$.ajax({url:"/api/user/",type:"PUT",data:userObj,success:function(data,e){console.log("User returned is ");console.log(data);callbackMethod(false,"",data)},error:function(e,f){callbackMethod(true,"",{},projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error retrieving user: there was a problem contacting the server.")}catch(ex){}}})};this.getProject=function(projectId,callbackSetMethod){$.getJSON("/api/project/"+projectId+"/",{},function(data){callbackSetMethod(false,"",data)}).success(function(){}).error(function(e){console.log("Error could not retrieve project");console.log(e);callbackSetMethod(true,"Error could not retrieve project",{});Backbone.history.navigate("/project/"+projectId+"/not-found/",{trigger:true})}).complete(function(){})};this.getProjectSequence=function(projectId,callbackMethod){$.ajax({url:"/api/project/sequence/"+projectId+"/",type:"GET",success:function(data,e){callbackMethod(data)},error:function(e,f){callbackMethod(true,"",{},projectConstants.NOTIFY_TYPE_ERROR)}})};this.sendProjectSequence=function(project,options){$.ajax({url:"/api/project/sequence/uuid/"+project.id+"/",type:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify({images:project.sequencedImages()}),success:function(data,e){
if(options.success){options.success(data,e)}var sequence_delta=data.sequence_delta;var version=data.version;project.set("sequence_delta",sequence_delta);project.set("version",version);if(Object.size(project.get("images"))>=1){project.set("project_image",project.get("images")[1].thumbnail)}var images=_.map(data.images,function(image,seq){return{id:image[0],uuid:image[1],seq:seq}});try{_.each(images,function(image){project.setIdForImageByUUID(image.id,image.uuid)})}catch(e){ProjectControllerLogger.error("Had trouble setting id for an image using the UUID, probably because it was deleted.")}if(!project.get("is_archived")){MARVELAPP.models.projects.get("project_collection").set([project],{remove:false,useSuper:true})}if(typeof MARVELAPP.Router.currentView.projectThumbnailSortableListView!=="undefined"){MARVELAPP.Router.currentView.projectThumbnailSortableListView.enableSortable()}},error:function(e,f){if(options.error){options.error(e,f)}}})};this.getPrototypeProject=function(projectId,callbackSetMethod){function getParameterByName(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return results==null?"":decodeURIComponent(results[1].replace(/\+/g," "))}var xf=getParameterByName("xf");var xf_param="";if(typeof xf!=="undefined"){xf_param="?xf="+xf}$.getJSON("/api/prototype/"+projectId+"/"+xf_param,{},function(data){callbackSetMethod(false,"",data)}).success(function(){}).error(function(e){console.log("Error could not retrieve project");console.log(e);callbackSetMethod(true,"Error could not retrieve project",{});try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error retrieving user: there was a problem contacting the server.")}catch(ex){}}).complete(function(){})};this.getAllProjects=function(callbackMethod){console.log("Calling get project ");$.getJSON("/api/project/all/",{},function(data){try{callbackMethod(data)}catch(err){try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error retrieving projects: "+err)}catch(ex){}}}).success(function(){}).error(function(e){console.log("Error could not retrieve projects");console.log(e);callbackMethod(true,"Error could not retrieve projects",{},projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error retrieving projects: there was a problem contacting the server.")}catch(ex){}}).complete(function(){})};this.createProject=function(projectName,password,callbackMethod){$.ajax({url:"/api/project/create/"+projectName+"/",type:"POST",data:{password:password},success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){callbackMethod(true,"",{},projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error creating project: there was a problem contacting the server.")}catch(ex){}}})};this.deleteProject=function deleteProject(project_id,callbackMethod){$.ajax({url:"/api/project/"+project_id+"/",type:"DELETE",success:function(data,e){callbackMethod(false,"",project_id)},error:function(e,f){callbackMethod(true,"",{},projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error deleting project: there was a problem contacting the server.")}catch(ex){}}})};this.duplicateProject=function(project_id,callbackMethod){console.log("Duplicating project: "+project_id);$.ajax({url:"/api/project/clone/"+project_id+"/",type:"POST",dataType:"json",success:function(data,e){callbackMethod(false,"Project duplicated",data)}})};this.editProject=function(project,callback_method){console.log("Editing the project");console.log(project);$.ajax({url:"/api/project/"+project.id+"/",type:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify(project.attributes),success:function(data,e){if(callback_method!=undefined){callback_method(project)}},error:function(e,f){try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error editing the project: there was a problem contacting the server.")}catch(ex){}}})};this.getHotspots=function(imageId,project_id,callbackMethod){$.getJSON("/api/hotspot/all/"+project_id+"/"+imageId+"/",{},function(data){try{var dataRetrieved=data;var sorted_data={};$.each(dataRetrieved,function(key,value){sorted_data[value.id]=value});setHotspotsForImageId(imageId,sorted_data);try{callbackMethod()}catch(err2){}}catch(err){console.log(err);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error getting hotspot")}catch(ex){}}}).success(function(){}).error(function(e){try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error getting hotspot: there was a problem contacting the server.")}catch(ex){}}).complete(function(){})};function hotspotIsInvalid(hotspot){if(hotspotIsTimer(hotspot)||hotspotIsUrl(hotspot)||hotspotIsExternal(hotspot)){return false}return typeof hotspot.x==="undefined"||typeof hotspot.x2==="undefined"||typeof hotspot.y==="undefined"||typeof hotspot.y2==="undefined"||!hotspot.x&&hotspot.x!=0||!hotspot.x2&&hotspot.x2!=0||!hotspot.y&&hotspot.y!=0||!hotspot.y2&&hotspot.y2!=0}function hotspotIsTimer(hotspot){return hotspot.action===MARVELAPP.constants.hotspot.ACTION_TIMER}function hotspotIsUrl(hotspot){return hotspot.type==MARVELAPP.constants.hotspot.TYPE_URL}function hotspotIsExternal(hotspot){return hotspot.type==MARVELAPP.constants.hotspot.TYPE_EMBED}this.addHotspot=function(hotspot,image,projectId,successCallback){if(hotspotIsInvalid(hotspot)){Raven.captureException(new Error("Hotspot missing coordinates"),{extra:{content:{hotspot:hotspot},project_id:projectId}});showNotificationMessage(projectConstants.NOTIFY_TYPE_WARN,"Something went wrong saving your hotspot, but don’t worry - we’ve logged the error and are looking into it.");return}hotspot.img_owner_fk=image.id;setIsHotspotSaving(true,hotspot.id);$.ajax({url:"/api/hotspot/"+projectId+"/",type:"POST",data:JSON.stringify(hotspot),contentType:"application/json",dataType:"json",success:function(data,e,xhr){var projectModel=MARVELAPP.models.current_project;if(xhr.status!==204){var savedHotspot=data;if(_.isEqual(projectId,projectModel.get("id"))){projectModel.set("hotspots_delta",savedHotspot.project_hotspot_delta);projectModel.setHotspotById(image.id,savedHotspot.id,savedHotspot,{metaOnly:true});if(hotspotIsSelected(savedHotspot)){setSelectedHotspotPartial({id:savedHotspot.id,version:savedHotspot.version,delta_check:savedHotspot.delta_check})}successCallback(savedHotspot,projectId)}setIsHotspotSaving(false,savedHotspot.id)}if(hotspot&&hotspot.id){setIsHotspotSaving(false,hotspot.id)}_.each(_.keys(MARVELAPP.models.current_project.getAllHotspots()),function(imageId){_.each(_.keys(getHotspotsForImageId(imageId)),function(hotspotId){if(parseInt(imageId,10)!==parseInt(getHotspotById(imageId,hotspotId).img_owner_fk,10)&&!getHotspotById(imageId,hotspotId).owner_hotspot){deleteHotspotById(imageId,hotspotId)}})})},error:function(e,f){$(".duplicate-button").removeClass("wait-state");$("#duplicate-modal").removeClass("activated");setIsHotspotSaving(false,hotspot.id);try{if(e.responseText.indexOf("Hotspot with this Uuid already exists")==-1){showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error adding the hotspot: there was a problem contacting the server.")}}catch(ex){}if(typeof Raven==="undefined"){return console.log("Failed to save hotspot",hotspot,"with uuid",hotspot.uuid,"because of\n",e.message||e)}Raven.captureException(new Error("Hotspot Save Error"),{extra:{content:{hotspot:hotspot},project_id:projectId,error_message:e.message||e}})}})};this.addDuplicateHotspot=function(hotspot,image,projectId,successCallback){if(hotspotIsInvalid(hotspot)){Raven.captureException(new Error("Hotspot (duplicate) missing coordinates"),{extra:{content:{hotspot:hotspot},project_id:projectId}});showNotificationMessage(projectConstants.NOTIFY_TYPE_WARN,"Something went wrong saving your hotspot, but don’t worry - we’ve logged the error and are looking into it.");return}setIsHotspotSaving(true,hotspot.id);$.ajax({url:"/api/hotspot/duplicate/"+projectId+"/",type:"POST",data:JSON.stringify(hotspot),success:function(data,e){var projectModel=MARVELAPP.models.current_project;var savedHotspot=data;if(_.isEqual(projectId,projectModel.get("id"))){projectModel.set("hotspots_delta",savedHotspot.project_hotspot_delta);projectModel.setHotspotById(savedHotspot.img_owner_fk,savedHotspot.id,savedHotspot);if(hotspotIsSelected(savedHotspot)){setSelectedHotspot(savedHotspot)}successCallback(savedHotspot,projectId)}setIsHotspotSaving(false,savedHotspot.id)},error:function(e,f){$(".duplicate-button").removeClass("wait-state");$("#duplicate-modal").removeClass("activated");setIsHotspotSaving(false,hotspot.id);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error adding the hotspot: there was a problem contacting the server.")}catch(ex){}if(typeof Raven==="undefined"){return console.log("Failed to save duplicated hotspot",hotspot,"with uuid",hotspot.uuid,"because of\n",e.message||e)}Raven.captureException(new Error("Hotspot Save Error (duplicated)"),{extra:{content:{hotspot:hotspot},project_id:projectId,error_message:e.message||e}})}})};this.deleteHotspot=function(hotspot,projectId,image,callback){ProjectControllerLogger.debug("Deleting hotspot",hotspot.uuid);$.ajax({url:"/api/hotspot/"+projectId+"/"+hotspot.id+"/",type:"DELETE",data:hotspot,success:function(data,e){var currentProject=MARVELAPP.models.current_project;if(getHotspotsForImageId(hotspot.img_owner_fk)){deleteHotspotLocally(image,hotspot)}if(_.isFunction(callback)){callback(false)}},error:function(e,f){callback(false);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error deleting the hotspot: there was a problem contacting the server.")}catch(ex){}}})};this.deleteDuplicateHotspot=function(hotspotObj,projectId,options){options=_.defaults(options||{},{successCallback:function(){},doneCallback:function(){}});var url="/api/hotspot/duplicate/"+projectId+"/"+hotspotObj.id+"/";if(options.image){if(!options.image.id){options.doneCallback(false);throw new Error("Tried to delete a duplicate hotspot for a single image, but the image does not have an id yet.")}url+=options.image.id+"/"}$.ajax({url:url,type:"DELETE",data:hotspotObj,success:function(data,e){options.doneCallback(false);hotspot=data;if(options.image){deleteHotspotById(options.image.id,hotspot.id)}else{_.each(hotspot.images,function(imageId){deleteHotspotById(imageId,hotspot.id)})}options.successCallback(hotspot,options.image)},error:function(e,f){options.doneCallback(false);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error deleting the hotspot: there was a problem contacting the server.")}catch(ex){}}})};this.numUploadImagesInQueue=0;this.isNumUploadLocked=false;this.getUploadImagesInQueue=function(){return this.numUploadImagesInQueue};this.addUploadImageToQueue=function(){if(this.isNumUploadLocked==false){this.isNumUploadLocked=true;this.numUploadImagesInQueue=this.numUploadImagesInQueue+1;this.isNumUploadLocked=false}else{this.addUploadImageToQueue()}};this.removeUploadImageFromQueue=function(){if(this.isNumUploadLocked==false){this.isNumUploadLocked=true;this.numUploadImagesInQueue=this.numUploadImagesInQueue-1;if(this.numUploadImagesInQueue==0){}this.isNumUploadLocked=false}else{this.removeUploadImageFromQueue()}};this.numDeleteImagesInQueue=0;this.isDeleteImageQueueLocked=false;this.getDeleteImagesInQueue=function(){return this.numDeleteImagesInQueue};this.addDeleteImageToQueue=function(){if(this.isDeleteImageQueueLocked==false){this.isDeleteImageQueueLocked=true;this.numDeleteImagesInQueue=this.numDeleteImagesInQueue+1;this.isDeleteImageQueueLocked=false}else{this.addDeleteImageToQueue()}};this.removeDeleteImageFromQueue=function(){if(this.isDeleteImageQueueLocked==false){this.isDeleteImageQueueLocked=true;this.numDeleteImagesInQueue=this.numDeleteImagesInQueue-1;if(this.numDeleteImagesInQueue==0){}this.isDeleteImageQueueLocked=false}else{this.removeDeleteImageFromQueue()}};this.addImageObject=function(projectId,image,callback){var imageURL,method;if(!image.id){var urlBase;if(image.is_app_icon){urlBase="/api/content/upload/dropbox/icon/"}else{urlBase="/api/content/upload/dropbox/"}imageURL=urlBase+projectId+"/";method="POST";try{}catch(e){}}else{imageURL="/api/content/upload/dropbox/"+projectId+"/"+image.id+"/";method="PUT"}$.ajax({url:imageURL,type:method,data:image,success:function(data,e){if(parseInt(projectId,10)===parseInt(selectedProject,10)){callback(false,"",data)}},error:function(e,f){if(parseInt(projectId,10)===parseInt(selectedProject,10)){callback(true,"",{},projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error adding the image: there was a problem contacting the server.")}catch(ex){}}}})};this.getImageObject=function(projectId,theImage,callbackMethod){$.getJSON("/api/content/"+theImage.id+"/"+projectId+"/",{},function(data){try{if(data!=undefined){callbackMethod(false,"",data)}}catch(err){console.log(err);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error getting image info, (3) - "+err)}catch(ex){}callbackMethod(true,"",theImage)}}).success().error(function(err){try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error getting image info: there was a problem contacting the server, retrying.")}catch(ex){}callbackMethod(true,"",theImage)}).complete()};this.getImageComments=function(imageId,callback){var url="/api/comment/"+imageId+"/";$.ajax({url:url,type:"GET"}).done(function(data){callback(false,"",data)})};this.deleteProjectImage=function(projectId,image,callback){console.log("deleteProjectImage",projectId,image);if(!image.id){return callback(true,projectConstants.MSG_CANNOT_DELETE_YET,image,projectConstants.NOTIFY_TYPE_WARN)}this.addDeleteImageToQueue();if(image.uploadedFile){image.uploadedFile=null}$.ajax({url:"/api/content/"+image.id+"/"+projectId+"/",type:"DELETE",success:_.bind(function(data,e){console.log("deleteProjectImage ajax.success",data,e);this.removeDeleteImageFromQueue();callback(false,"",image)},this),error:_.bind(function(e,f){console.log("deleteProjectImage ajax.error",data,e);this.removeDeleteImageFromQueue();callback(true,projectConstants.MSG_CANNOT_DELETE_SERVER_PROBLEM,image,projectConstants.NOTIFY_TYPE_ERROR)},this)})};this.deleteProjectImages=function(projectId,images,callbackMethod){projectController=this;$.ajax({url:"/api/content/delete/all/"+projectId+"/",type:"DELETE",data:JSON.stringify(images),success:function(data,e){if(MARVELAPP.models.current_project.id==projectId){MARVELAPP.models.current_project.set("sequence_delta",data.sequence_delta)}callbackMethod(false,"",images)},error:function(e,f){callbackMethod(true,"",images,projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error deleting the images: "+"there was a problem contacting the server.")}catch(ex){}}})};this.sendProjectEmail=function(projectId,email,project_url,callbackMethod){console.log("Sending email for "+projectId+" with  "+email);$.ajax({url:"/api/project/email/"+projectId+"/?email="+email+"",type:"POST",success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){var responseJson=$.parseJSON(e.responseText);callbackMethod(true,responseJson.message,projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,responseJson.message+": there was a problem contacting the server.")}catch(ex){}}})};this.sendLookbackEmail=function(projectId,email,lookback_url,callbackMethod){console.log("Sending email for "+projectId+" with  "+email);$.ajax({url:"/api/project/ux-email/"+projectId+"/?email="+email+"",type:"POST",success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){var responseJson=$.parseJSON(e.responseText);callbackMethod(true,responseJson.message,projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,responseJson.message+": there was a problem contacting the server.")}catch(ex){}}})};this.sendProjectSms=function(projectId,msisdn,project_url,callbackMethod){console.log("Sending sms for "+projectId+" with  "+msisdn);msisdn=msisdn.replace("+","");$.ajax({url:"/api/project/sms/"+projectId+"/"+msisdn+"/",type:"POST",success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){var responseJson=$.parseJSON(e.responseText);callbackMethod(true,responseJson.message,projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,responseJson.message+": there was a problem contacting the server.")}catch(ex){}}})};this.sendLookbackSms=function(projectId,msisdn,lookback_url,callbackMethod){console.log("Sending sms for "+projectId+" with  "+msisdn);msisdn=msisdn.replace("+","");$.ajax({url:"/api/project/ux-sms/"+projectId+"/"+msisdn+"/",type:"POST",success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){var responseJson=$.parseJSON(e.responseText);callbackMethod(true,responseJson.message,projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,responseJson.message+": there was a problem contacting the server.")}catch(ex){}}})};this.sendDownloadEmail=function(archiveId,email,project_url,callbackMethod){console.log("Sending email for "+archiveId+" with  "+email);$.ajax({url:"/api/archive/email/"+archiveId+"/"+email+"/",type:"POST",success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){var responseJson=$.parseJSON(e.responseText);callbackMethod(true,responseJson.message,projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,responseJson.message+": there was a problem contacting the server.")}catch(ex){}}})};this.sendDownloadSms=function(archiveId,msisdn,project_url,callbackMethod){console.log("Sending sms for "+archiveId+" with  "+msisdn);msisdn=msisdn.replace("+","");$.ajax({url:"/api/prototype/send/sms/"+archiveId+"/"+msisdn+"/",type:"POST",success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){var responseJson=$.parseJSON(e.responseText);callbackMethod(true,responseJson.message,projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,responseJson.message+": there was a problem contacting the server.")}catch(ex){}}})};this.sendDownloadEmail=function(archiveId,msisdn,project_url,callbackMethod){msisdn=msisdn.replace("+","");$.ajax({url:"/api/prototype/send/email/"+archiveId+"/"+msisdn+"/",type:"POST",success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){var responseJson=$.parseJSON(e.responseText);callbackMethod(true,responseJson.message,projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,responseJson.message+": there was a problem contacting the server.")}catch(ex){}}})};this.editProperty=function(property,callbackMethod){$.ajax({url:"/api/properties/",type:"POST",data:property,success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){callbackMethod(true,"",{},projectConstants.NOTIFY_TYPE_ERROR)}})};this.editProjectProperty=function(project_id,property,callbackMethod,options){options=_.defaults(options||{},{changeImmediately:true});var originalPropertyData=_.clone(MARVELAPP.models.current_project.getPropertyForName(property.name));if(options.changeImmediately){MARVELAPP.models.current_project.setProperty(property)}console.log("Triggering","changing:properties:"+property.name);MARVELAPP.models.current_project.trigger("changing:properties:"+property.name,originalPropertyData,property);$.ajax({url:"/api/project/property/"+project_id+"/",type:"POST",data:property,success:function(data,e){if(_.isFunction(callbackMethod)){callbackMethod(false,"",data)}MARVELAPP.models.current_project.setProperty(data)},error:function(e,f){if(_.isFunction(callbackMethod)){callbackMethod(true,"",e,projectConstants.NOTIFY_TYPE_ERROR,e)}MARVELAPP.models.current_project.setProperty(originalPropertyData)}})};this.subscribeUser=function(token,plan_id,interval,quantity,callback){console.log("Adding subscription to plan",plan_id,interval,token);if(typeof quantity==="undefined"){quantity=1}$.ajax({url:"/api/stripe/subscribe/",type:"POST",data:{token:token,plan_id:plan_id,interval:interval,quantity:quantity},success:function(data,e){callback(false,"",data)},error:function(e,f){callback(true,"",e,projectConstants.NOTIFY_TYPE_ERROR)}})};this.verifyPassword=function(password,project_encoding,callbackMethod){$.ajax({url:"/api/project/verify/"+project_encoding+"/",type:"POST",beforeSend:function(xhr,settings){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},data:{password:password},success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){callbackMethod(true,"",{},projectConstants.NOTIFY_TYPE_ERROR)}})};this.unsubscribeUser=function(callbackMethod){$.ajax({url:"/api/stripe/subscribe/",type:"DELETE",success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){callbackMethod(true,"",{},projectConstants.NOTIFY_TYPE_ERROR);try{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error unsubscribing from Marvel. Please contact support help@marvelapp.com")}catch(ex){}}})};var is_polling=false;this.pollContent=function(project,callbackMethod){if(project!=undefined){if(project.id==undefined){callbackMethod(true,"",project);return}}else{callbackMethod(true,"",project);return}$.ajax({url:"/api/content/poll/"+project.id+"/",type:"POST",data:{cursor:project.cursor},success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){callbackMethod(true,"",{},projectConstants.NOTIFY_TYPE_ERROR)}})};this.generatePrototype=function(projectId,callbackMethod,type,description){var call_url="/api/prototype/build/"+projectId+"/";if(type===MARVELAPP.constants.prototype.ARCHIVE_TYPE_DOWNLOAD||type===MARVELAPP.constants.prototype.ARCHIVE_TYPE_APP_PDF){call_url="/api/prototype/zip/"+projectId+"/"}$.ajax({url:call_url,type:"POST",data:{type:type,description:description},success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){response_data={response:e.responseJSON,type:type,status:e.status};console.log(e,f);if(e.status==400&&e.responseJSON.message=="You are already building an app of this type"){callbackMethod(true,e.responseJSON.message,response_data,projectConstants.NOTIFY_TYPE_ERROR)}else if(e.status==423){callbackMethod(true,e.responseJSON.message,response_data,projectConstants.NOTIFY_TYPE_ERROR)}else{callbackMethod(true,"Uh oh! Problem generating file",{},projectConstants.NOTIFY_TYPE_ERROR)}}})},this.getDownload=function(projectId,archive_id,callbackMethod){$.ajax({url:"/api/prototype/archive/"+projectId+"/"+archive_id+"/",type:"GET",success:function(data,e){callbackMethod(false,"",data)},error:function(e,f){callbackMethod(true,"",{},projectConstants.NOTIFY_TYPE_ERROR)}})},this.pollProjectContent=function(updateCallback){var projectCursor=MARVELAPP.models.current_project.get("cursor");if(!projectCursor||!projectCursor.length){projectCursor="init"}var project_poll_data={id:MARVELAPP.models.current_project.id,cursor:projectCursor,hotspots_delta:MARVELAPP.models.current_project.get("hotspots_delta"),sequence_delta:MARVELAPP.models.current_project.get("sequence_delta"),backoff:"10",content:[],project_version:MARVELAPP.models.current_project.get("version")};MARVELAPP.models.poll_project=new MARVELAPP.ProjectDeltaModel;MARVELAPP.models.poll_project.set(project_poll_data);var dropbox_connected=MARVELAPP.models.current_user.get("dropbox_connected");var has_teams=MARVELAPP.models.current_user.get("teams").length>0;var delay=MARVELAPP.constants.projects.POLL_DELTA_TIMING;console.log("Polling with delay",delay);if(!dropbox_connected&&!has_teams){delay=MARVELAPP.constants.projects.POLL_DELTA_TIMING_SLOW}var options={delay:delay,delayed:true,continueOnError:true};if(typeof MARVELAPP.pollers.project_delta_poller!=="undefined"){MARVELAPP.pollers.project_delta_poller.stop()}MARVELAPP.pollers.project_delta_poller=Backbone.Poller.get(MARVELAPP.models.poll_project,options);MARVELAPP.pollers.project_delta_poller.on("success",_.bind(function(model,response){ProjectControllerLogger.debug("Incoming delta poll data:",response);ProjectControllerLogger.debug("Sequence delta old vs new: :",MARVELAPP.models.current_project.get("sequence_delta"),response.sequence_delta);ProjectControllerLogger.debug("Hotspots delta old vs new: :",MARVELAPP.models.current_project.get("hotspots_delta"),response.hotspots_delta);updateCallback(model,response)},this));MARVELAPP.pollers.project_delta_poller.on("complete",function(model){});MARVELAPP.pollers.project_delta_poller.on("error",function(model){});MARVELAPP.pollers.project_delta_poller.start();this.isPollingProjectContent=true};this.stopPollingProjectContent=function(){if(MARVELAPP.pollers.project_delta_poller){MARVELAPP.pollers.project_delta_poller.stop();this.isPollingProjectContent=false}};this.publishProject=function(options,callbackMethod){$.ajax({url:"/api/explore/publish/"+options.project.get("id")+"/",type:"PUT",data:{name:options.name,colour:options.colour,description:options.description},success:function(data,e){if(!MARVELAPP.models.current_user.get("has_published")){MARVELAPP.models.current_user.fetch()}if(_.isFunction(callbackMethod)){callbackMethod(false,data,e)}},error:function(e,f){if(_.isFunction(callbackMethod)){callbackMethod(true,e,f)}}})};this.putWithNoOptions=function(url,callbackMethod){return $.ajax({url:url,type:"PUT",success:function(data,e){if(_.isFunction(callbackMethod)){callbackMethod(false,data,e)}},error:function(e,f){if(_.isFunction(callbackMethod)){callbackMethod(true,e,f)}}})};this.likeProject=function(options,callbackMethod){return this.putWithNoOptions("/api/explore/publish/"+options.project.get("id")+"/like/")};this.unpublishProject=function(options,callbackMethod){return this.putWithNoOptions("/api/explore/unpublish/"+options.project.get("id")+"/")};this.setNotificationPreference=function(projectId,enabled,opts){opts=opts||{};$.extend(opts,{dataType:"json",method:"PUT",data:{presentation:enabled}});$.ajax("/api/comment/"+projectId+"/preferences/",opts)};this.getNotificationPreferences=function(projectId,opts){opts=opts||{};$.extend(opts,{dataType:"json",method:"GET"});$.ajax("/api/comment/"+projectId+"/preferences/",opts)}}function VPController(){this.getProject=function(projectId,callbackSetMethod){$.getJSON("/project/getproject",{pid:projectId},function(data){try{if(data["responseCode"]=="200"){projData=data["data"];callbackSetMethod(projData);console.log("Data returned is ");console.log(projData)}else if(data["responseCode"]=="401"){showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error retrieving project: "+data["message"])}else{showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error retrieving project: "+data["message"])}}catch(err){showNotificationMessage(projectConstants.NOTIFY_TYPE_ERROR,"Error retrieving project: "+err)}})}}MARVELAPP.PrototypeRouter=Backbone.Router.extend({url:null,routes:{"*screen":"screen"},initialize:function(){var root=window.location.pathname;this.startHistory(root);this.listenTo(Backbone,"page-transition",this.animate)},startHistory:function(_root){Backbone.history.start({silent:true,hashChange:true,root:_root})},screen:function(screenNavigatingTo){var backTransition="none";var navigatingBack=false;var navigatingForward=false;var reverse=true;var hotspotObject={};var currentCursor=transitionCursor;if(currentCursor!=0)currentCursor=currentCursor-1;var openGrid=false;if(screenNavigatingTo&&screenNavigatingTo.indexOf("/grid")>-1){openGrid=true;screenNavigatingTo=screenNavigatingTo.replace("/grid","")}console.log("openGrid",openGrid);if(!screenNavigatingTo){screenNavigatingTo=prototype.model.attributes.images[1].id}if(!_.findWhere(prototype.model.attributes.images,{id:parseInt(screenNavigatingTo)})){screenNavigatingTo=prototype.model.attributes.images[1].id}if(transitionHistory.length!=0){if(current_screen==transitionHistory[currentCursor].target&&screenNavigatingTo==transitionHistory[currentCursor].sourceId){navigatingBack=true;backTransition=transitionHistory[currentCursor].transition;hotspotObject=_.clone(transitionHistory[currentCursor].hotspotObject)}else if(transitionHistory[transitionCursor]&&current_screen==transitionHistory[transitionCursor].sourceId&&screenNavigatingTo==transitionHistory[transitionCursor].target){navigatingForward=true;reverse=false;backTransition=transitionHistory[transitionCursor].transition;hotspotObject=_.clone(transitionHistory[transitionCursor].hotspotObject)}}var fragment=Backbone.history.getFragment();var params=fragment.replace(/\//g," ").trim().split(" ");var initial_fragment=params[0];hotspotObject.maintain_scroll=globalMaintainScroll;if(navigatingBack){transitionCursor--;if(initial_fragment.includes("?overlay=")){var currentScreen=initial_fragment.substr(initial_fragment.indexOf("=")+1,initial_fragment.length);var image=_.findWhere(prototype.model.attributes.images,{id:parseInt(currentScreen)});var possibleHotspotForHistory=_.findWhere(image.hotspots,{dest_img_fk:parseInt(screenNavigatingTo),is_overlay:true});if(possibleHotspotForHistory){hotspotObject.backScreenUnderneathOverlay=currentScreen;hotspotObject.dest_img_fk=parseInt(screenNavigatingTo);hotspotObject.is_overlay=true;hotspotObject.overlay_background_colour=possibleHotspotForHistory.overlay_background_colour;hotspotObject.overlay_position=possibleHotspotForHistory.overlay_position;hotspotObject.overlay_x=possibleHotspotForHistory.overlay_x;hotspotObject.overlay_y=possibleHotspotForHistory.overlay_y;prototype.screenUnderneathOverlay=currentScreen}}}if(navigatingForward){transitionCursor++}if(transitionCursor<0)transitionCursor=0;if(typeof prototype.gridView!=="undefined"){if(openGrid){if(!prototype.gridView.isOpened()){prototype.openGrid();return}else{prototype.gridView.close()}}else{if(prototype.gridView.isOpened()){prototype.gridView.close();return}}}prototype.handleTransition(current_screen,screenNavigatingTo,backTransition,reverse,hotspotObject,true)},animate:function(currentScreen,targetScreen,transition,hotspotObject){if(!embed){var url=targetScreen;if(hotspotObject&&hotspotObject.is_overlay){url=url+"?overlay="+prototype.screenUnderneathOverlay}Backbone.history.navigate(url,{trigger:false})}if(typeof hotspotObject=="undefined"){var hotspotObject={};hotspotObject.id=null}var transitionToAdd={url:window.location.href,hotspotId:hotspotObject.id,sourceId:currentScreen,target:targetScreen,transition:transition,hotspotObject:hotspotObject};transitionHistory.splice(transitionCursor,transitionHistory.length);transitionHistory.push(transitionToAdd);transitionCursor++;ga("send","pageview","prototype-page-view")}});MARVELAPP.CommentCollection=Backbone.Collection.extend({getModelByCommentUuid:function(comment_uuid){return this.findWhere({uuid:comment_uuid})},comparators:{id:function(comment){return Number(comment.get("id"))},date:function(comment){return Date.createFromMysql(comment.get("created_at")).getTime()}},fetch:function(){if(this.existingFetch&&this.existingFetch.readyState>0&&this.existingFetch.readyState<4){this.existingFetch.abort()}this.existingFetch=Backbone.Collection.prototype.fetch.apply(this,arguments);return this.existingFetch}});MARVELAPP.ExploreCollection=Backbone.Collection.extend({url:function(){return this.meta.get("currentPageURL")},initialize:function(options){options=_.defaults(options,{filter:"popular",page:1});this.meta=new Backbone.Model;this.meta.set("currentPageURL","/api/explore?filter="+options.filter+"&page="+options.page);this.meta.set("previousPageURL",undefined);this.meta.set("nextPageURL",undefined);this.meta.set("filter",options.filter);this.meta.set("page",options.page)},setPage:function(page){if(typeof page==="undefined")page=1;this.meta.set("page",page);this.meta.set("currentPageURL","/api/explore?filter="+this.meta.get("filter")+"&page="+page);if(this.hasPreviousLink){
this.meta.set("previousPageURL","/api/explore?filter="+this.meta.get("filter")+"&page="+(page-1))}if(this.hasNextLink){this.meta.set("nextPageURL","/api/explore?filter="+this.meta.get("filter")+"&page="+(page+1))}},parse:function(response){this.meta.set("previousPageURL",response.previous);this.meta.set("nextPageURL",response.next);return response.results},hasPreviousLink:function(){return!!this.meta.get("previousPageURL")},hasNextLink:function(){return!!this.meta.get("nextPageURL")},fetchNextPageIfPossible:function(){if(this.hasNextLink()){this.meta.set("currentPageURL",this.meta.get("nextPageURL"));var page=parseInt(this.meta.get("page"));this.meta.set("page",page+1);setQueryParams({page:this.meta.get("page")});this.fetch()}},fetchPreviousPageIfPossible:function(){if(this.hasPreviousLink()){this.meta.set("currentPageURL",this.meta.get("previousPageURL"));var page=parseInt(this.meta.get("page"));this.meta.set("page",page-1);setQueryParams({page:this.meta.get("page")});this.fetch()}}});MARVELAPP.ActivityCollection=Backbone.Collection.extend({initialize:function(){this.listenTo(this,"add",_.bind(this.addingModel,this));this.listenTo(this,"reset",_.bind(this.resetModel,this))},resetModel:function(collection,response,options){},addingModel:function(collection,response,options){},getActivityByDays:function(num_days){return this.findWhere({days:num_days})}});MARVELAPP.CollaboratorsCollection=Backbone.Collection.extend({model:function(attrs,options){return new MARVELAPP.PersonModel(attrs,options)},url:function(){return"/api/v1/project/"+this.project.get("id")+"/collaborators/"},initialize:function(models,options){options=options||{};if(!options.project){throw new Error("Must pass project as option to CollaboratorsCollection")}this.project=options.project},parse:function(data){return data.results},sortForMenuView:function(team){return _.sortBy(this.models,_.bind(function(person){var personIsOwner=person.get("id")===this.project.get("owner_fk");var personOnTeam=false;if(typeof team!=="undefined"){personOnTeam=_.indexOf(team.get("member_ids"),person.id)>-1}var sort;if(personIsOwner){sort="2"}else if(personOnTeam){sort="1"}else{sort="0"}sort+=person.get("username");return sort},this))},comparators:{id:function(member){return Number(member.get("id"))},reverse_id:function(member){return-Number(member.get("id"))},name:function(member){return member.get("username")}}});MARVELAPP.HotspotsCollection=Backbone.Collection.extend({initialize:function(){this.listenTo(this,"add",_.bind(this.addingModel,this));this.listenTo(this,"reset",_.bind(this.resetModel,this))},resetModel:function(collection,response,options){},addingModel:function(collection,response,options){},getModelByContentOwner:function(project_id){return this.findWhere({id:project_id})},getModelById:function(project_name){return this.findWhere({id:project_name})},getModelByImageId:function(team_fk){return this.where({team_fk:team_fk})},getModelByOwner:function(owner_fk){return this.where({owner_fk:owner_fk})},comparators:{id:function(project){return Number(project.get("id"))},reverse_id:function(project){return-Number(project.get("id"))},name:function(project){return project.get("name")},date:function(project){return Date.createFromMysql(project.get("created_on")).getTime()}}});MARVELAPP.InvoiceCollection=Backbone.Collection.extend({url:"/api/user/invoices",model:Backbone.Model,initialize:function(){this.state=new Backbone.Model({initialFetch:false})},initialFetch:function(){if(!this.state.get("initialFetch")){this.state.set("initialFetch",true);this.fetch({reset:true})}}});MARVELAPP.MemberCollection=Backbone.Collection.extend({initialize:function(){this.listenTo(this,"add",_.bind(this.addingModel,this));this.listenTo(this,"reset",_.bind(this.resetModel,this))},resetModel:function(collection,response,options){},addingModel:function(collection,response,options){},getMemberById:function(user_id){return this.findWhere({id:user_id})},comparator:function(first,second){var firstRole=first.get("role");var secondRole=second.get("role");var firstInviteState=first.get("invite_state");var secondInviteState=second.get("invite_state");var firstUserInvited=firstInviteState===MARVELAPP.constants.invite.TEAM_MEMBER_STATE_INVITED;var secondUserInvited=secondInviteState===MARVELAPP.constants.invite.TEAM_MEMBER_STATE_INVITED;var alphabeticalSort=function(first,second){if(first.get("username").toUpperCase()>second.get("username").toUpperCase()){return 1}else{return-1}};if(firstUserInvited&&secondUserInvited){return alphabeticalSort(first,second)}else if(firstUserInvited){return 1}else if(secondUserInvited){return-1}if(firstRole===secondRole||firstUserInvited&&secondUserInvited){return alphabeticalSort(first,second)}if(firstRole===MARVELAPP.constants.role.ROLE_OWNER){return-1}else if(secondRole===MARVELAPP.constants.role.ROLE_OWNER){return 1}if(firstRole===MARVELAPP.constants.role.ROLE_ADMIN){return-1}else if(secondRole===MARVELAPP.constants.role.ROLE_ADMIN){return 1}if(firstRole===MARVELAPP.constants.role.ROLE_TEAM_MEMBER){return-1}else if(secondRole===MARVELAPP.constants.role.ROLE_TEAM_MEMBER){return 1}return 0},comparators:{id:function(member){return Number(member.get("id"))},reverse_id:function(member){return-Number(member.get("id"))},name:function(member){return member.get("username")}}});MARVELAPP.PeopleCollection=Backbone.Collection.extend({intercomCollaborators:0,initialize:function(){this.state=new Backbone.Model({initiallyFetched:false});this.listenTo(this,"add remove",_.bind(this.updateIntercom,this))},model:function(attrs,options){return new MARVELAPP.PersonModel(attrs,options)},url:function(){return"/api/v1/directory/"},parse:function(data){return data.results},initialFetch:function(){if(!this.state.get("initiallyFetched")){this.state.set("initiallyFetched",true);this.fetch({reset:true})}},search:function(query,attributes){query=query.toLowerCase();var users=this.filter(function(person){var attribute;for(var i=0;i<attributes.length;i++){attribute=person.get(attributes[i]).toLowerCase();if(attribute.indexOf(query)>-1){return true}}});return new MARVELAPP.PeopleCollection(users)},addDummyData:function(){var avatars=["https://res.cloudinary.com/marvel-content/image/fetch/s--a3P27oeH--/t_profile_image_200/https://marvelapp-live.storage.googleapis.com/serve/1437575185.47_7110300.jpg","https://pbs.twimg.com/profile_images/603632108855255040/fihMP2Tg.png","https://pbs.twimg.com/profile_images/2201172206/rm.jpg","https://pbs.twimg.com/profile_images/554515151575994369/MiDNqbJa.jpeg","https://pbs.twimg.com/profile_images/542004858744602624/qT_jO1YF.jpeg","https://pbs.twimg.com/profile_images/477338902068346881/89w7SbqD.png","https://pbs.twimg.com/profile_images/624207829365338112/ceWb9nFB.jpg","https://pbs.twimg.com/profile_images/639713664161878016/ywS5SU2i.jpg","https://pbs.twimg.com/profile_images/613099620286263296/1vjQNURy.jpg","https://pbs.twimg.com/profile_images/525031455437500416/1KmKkUyH.jpeg","https://tindddle.com/assets/images/dreke-1.png","https://tindddle.com/assets/images/dreke-2.png","https://tindddle.com/assets/images/dreke-3.png","https://tindddle.com/assets/images/dreke-4.png","https://tindddle.com/assets/images/dreke-5.png","https://tindddle.com/assets/images/dreke-6.png","https://tindddle.com/assets/images/dreke-7.png","https://tindddle.com/assets/images/dreke-8.png","https://tindddle.com/assets/images/dreke-9.png","https://tindddle.com/assets/images/dreke-10.png","https://tindddle.com/assets/images/dreke-11.png","","","","","","","","","","","","","","","","","","","",""];var usernames=["Maxime De Greve","Fabio Basile","Murat Mutlu","Brendan Moore","Joe Alcorn","Ryan Hoover","Cat Noone","Yavor Punchev","Davey Heuser","Swaggy Boi","Aubrey Graham","DJ Khaled"];for(index in _.range(100)){var username=usernames[Math.floor(Math.random()*usernames.length)];var person=new MARVELAPP.PersonModel({avatar:avatars[Math.floor(Math.random()*avatars.length)],email:username.toLowerCase().split(" ")[0]+index+"@marvelapp.com",id:index,username:username,selected:false});MARVELAPP.collections.PeopleCollection.add(person)}},withIncludedUsers:function(user){if(!user.subscribed){return this}var newCollection=this.clone();var includedUsers=user.get("subscription").included_users;var people=_.map(includedUsers,function(user){return new MARVELAPP.PersonModel({email:user.email,id:user.id,avatar:user.gravatar_data.url,username:user.username})});newCollection.add(people);return newCollection},updateIntercom:function(){var currentCollaborators=this.models.length;if(this.intercomCollaborators!=currentCollaborators){Intercom("update",{collaborators:currentCollaborators});this.intercomCollaborators=currentCollaborators}}});MARVELAPP.ProjectTeamsCollection=Backbone.Collection.extend({initialize:function(models,options){options=options||{};if(!options.project){throw new Error("Must pass project as option to ProjectTeamsCollection")}this.project=options.project},model:function(attrs,options){return new MARVELAPP.ProjectTeamModel(attrs,options)},url:function(){return"/api/v1/project/"+this.project.get("id")+"/teams/"},fetchIfCreated:function(){if(typeof this.project.get("id")!=="undefined"){this.fetch()}}});MARVELAPP.ProjectsCollection=Backbone.Collection.extend({initialize:function(){this.listenTo(this,"add",_.bind(this.addingModel,this));this.listenTo(this,"reset",_.bind(this.resetModel,this))},resetModel:function(collection,response,options){},addingModel:function(collection,response,options){},getModelByProjectId:function(project_id){return this.findWhere({id:project_id})},getModelByName:function(project_name){return this.findWhere({id:project_name})},getModelByTeamFk:function(team_fk){return this.where({team_fk:team_fk})},getModelByOwner:function(owner_fk){return this.where({owner_fk:owner_fk})},comparators:{id:function(project){return Number(project.get("id"))},reverse_id:function(project){return-Number(project.get("id"))},name:function(project){return project.get("name")},date:function(project){return Date.createFromMysql(project.get("created_on")).getTime()}}});MARVELAPP.TeamsCollection=Backbone.Collection.extend({initialize:function(){this.listenTo(this,"add",_.bind(this.addingModel,this));this.listenTo(this,"reset",_.bind(this.resetModel,this))},resetModel:function(collection,response,options){},addingModel:function(collection,response,options){},getModelByTeamId:function(teamId){teamId=parseInt(teamId,10);var team_model=this.findWhere({id:teamId});return team_model},getModelByInviteAcceptedOrOwner:function(){return this.filter(function(model){return model.attributes.invite_state===MARVELAPP.constants.invite.TEAM_MEMBER_STATE_ACCEPTED||model.attributes.role===MARVELAPP.constants.role.ROLE_OWNER})},excludeDeclined:function(){return this.filter(function(model){return model.attributes.invite_state!==MARVELAPP.constants.invite.TEAM_MEMBER_STATE_DECLINED})},getInvitesNotDeclined:function(){return this.where({invite_state:MARVELAPP.constants.invite.TEAM_MEMBER_STATE_INVITED})}});MARVELAPP.ActivityModel=Backbone.Model.extend({url:"/api/activity/",defaults:{event_type:"project",actor:null,verb:null,object:null,target:null,time:null,extra_context:{},is_read:false},fetchActivity:function(id){if(typeof id=="undefined"){id=this.get("id")}this.fetch({url:this.url+""+id+"/",success:_.bind(this.success,this),error:_.bind(this.error,this)})},markRead:function(){}});MARVELAPP.CanvasModel=Backbone.Model.extend({url:"/api/canvas/",defaults:{uuid:null,name:"Draft Canvas",data:null,project_fk:null,content_fk:null},exportCanvas:function(callback){var canvasName=Canvas.marvelData.canvasModel.get("name"),contentForeignKey=Canvas.marvelData.canvasModel.get("content_fk");Canvas.exportImage(function(imageData){var id,image,model;image=Canvas.marvelData.project.getImageForUUID(imageData.uuid);if(!image){console.log("No image found for specified UUID.");return}if(contentForeignKey===null){model=new MARVELAPP.CanvasModel({project_fk:this.get("project_fk"),content_fk:image.id,name:canvasName,uuid:generateUUID()});Canvas.marvelData.canvasModel=model}if(callback){callback()}}.bind(this),canvasName)},fetchCanvas:function(async,callback){if(typeof async==="undefined"){async=true}var content_str="";if(this.get("content_fk")){content_str=this.get("content_fk")+"/"}this.fetch({url:"/api/canvas/"+this.get("project_fk")+"/"+content_str,success:function(model,response,options){this.success.apply(this,arguments);callback()}.bind(this),error:_.bind(this.error,this),async:async})},saveCanvas:function(async,data){var content_fk=this.get("content_fk"),content_str="";if(typeof async==="undefined"){async=true}if(content_fk){content_str=content_fk+"/"}this.save({async:async,data:data,error:this.saveError.bind(this),success:this.saveSuccess.bind(this),url:"/api/canvas/"+this.get("project_fk")+"/"+content_str})},saveSuccess:function(){console.log("Success!")},saveError:function(){this.trigger("error saving")},success:function(model,response,options){this.set(response)},error:function(model,response,options){this.trigger("error fetching")},sync:function(method,model,options){options=options||{};options.url=options.url||model.get("url");return Backbone.sync.apply(this,arguments)},isNew:function(){return true}});MARVELAPP.HotspotModel=Backbone.Model.extend({url:"/api/hotspot/",defaults:{id:"",uuid:"",x:"",y:"",x2:"",y2:"",dest_img_fk:"",img_owner_fk:"",transition:"",action:"",owner_hotspot:"",status:"",images:"",type:"",location:"",url:"",external_url:"",delta_check:"",project_hotspot_delta:"",timer:null,is_overlay:false,overlay_position:1,overlay_background_colour:null},fetchHotspot:function(id){if(typeof id=="undefined"){id=this.get("id")}this.fetch({url:this.url+""+id+"/",success:_.bind(this.success,this),error:_.bind(this.error,this)})},error:function(model,response,options){showNotificationMessage(projectConstants.NOTIFY_TYPE_WARN,MARVELAPP.messages.PROJECT_NOT_FOUND)},success:function(model,response,options){this.set(response)},initialize:function(){this.listenTo(this,"sync",_.bind(this.runningSync,this))},isIncompleteHotspot:function(){if(!this.get("type")||this.get("type")===""){return true}if(this.get("type")===1&&this.get("img_owner_fk")&&this.get("dest_img_fk")){if(this.get("owner_hotspot")){return false}if(parseInt(this.get("img_owner_fk"),10)===parseInt(this.get("dest_img_fk"),10)){return true}}return false},parse:function(data){},runningSync:function(model,response){if(typeof model!=="undefined"&&typeof response.id!=="undefined"){if(model.id==response.id){this.set(response)}}}});MARVELAPP.InviteModel=Backbone.Model.extend({url:"/api/team/invite/",defaults:{team_id:undefined,invitee:undefined,inviter:undefined,state:MARVELAPP.constants.invite.TEAM_MEMBER_STATE_INVITED,email:undefined,is_gifted:false,is_coupon:false,is_allowance:false},initialize:function(){this.listenTo(this,"sync",_.bind(this.runningSync,this))},runningSync:function(){}});MARVELAPP.MemberModel=Backbone.Model.extend({url:function(){return this.get("url")},defaults:{id:"",username:"",email:"",created_on:"",role:"Team Member",invite_state:"Invited",gifted_owner:null,is_gifted:null,user_team_count:0,gravatar_data:{url:null}},updateRole:function(team,role,options){options=options||{};var url="/api/v0/team/"+team.get("id")+"/member/"+this.get("id")+"/";options.method="PUT";options.url=url;options.patch=true;this.set("role",role);this.save({role:role},options)}});MARVELAPP.ModalModel=Backbone.Model.extend({defaults:{topHeading:MARVELAPP.constants.modal.TOP_HEADER,contentHeading:MARVELAPP.constants.modal.CONTENT_HEADER,buttonText:MARVELAPP.constants.modal.BUTTON_TEXT,buttonColor:MARVELAPP.constants.modal.BUTTON_COLOR,secondaryLink:"",size:MARVELAPP.constants.modal.SIZE,modalClass:""}});MARVELAPP.PersonModel=Backbone.Model.extend({initialize:function(){this.set("initials",this.getInitials());this.set("colour",this.getColour());this.set("username",this.getUsername());this.listenTo(this,"change:username",function(person){if(!person.get("username")){person.set("username",person.getUsername())}})},url:function(){return"/api/v1/directory/"},defaults:{avatar:"",colour:"",email:"",id:null,initials:"",username:""},getColour:function(){var gravatar=getGravatar(this.get("email"),this.get("id"));return gravatar.colour},getInitials:function(){return MARVELAPP.UserModel.usernameInitials(this.get("username"),this.get("email"))},getUsername:function(){if(!this.get("username")||this.get("username")===""){var username=this.get("email").split("@")[0];username=username.charAt(0).toUpperCase()+username.slice(1).toLowerCase();return username}return this.get("username")},destroy:function(options){options=_.extend({url:this.url(),contentType:"application/json",method:"DELETE",data:JSON.stringify({ids:[this.get("id")]}),success:_.bind(function(){this.trigger("destroy")},this)},options);$.ajax(options)}},{fromMember:function(member){return new MARVELAPP.PersonModel({id:member.get("id"),email:member.get("email"),username:member.get("username"),avatar:member.get("gravatar_data").url,colour:member.get("gravatar_data").colour})}});MARVELAPP.ProjectDeltaModel=Backbone.Model.extend({url:function(){return"/api/content/poll/"+this.get("id")+"/"},defaults:{id:null,cursor:null,hotspots_delta:null,sequence_delta:null,backoff:"10",content:[],project_version:0},error:function(model,response,options){},success:function(model,response,options){this.set(response)},currentCursor:function(){var cursor=this.attributes.cursor;if(cursor==""||cursor==null||typeof cursor==="undefined"){cursor=null}return cursor},initialize:function(){this.listenTo(this,"sync",_.bind(this.runningSync,this))},parse:function(data){},runningSync:function(model,response){if(model.id==response.id){this.set(response)}}});var ProjectModelLogger=Logger.get("ProjectModel");var PModelEventLogger=Logger.get("PModelEvents");MARVELAPP.ProjectModel=Backbone.Model.extend({url:"/api/project/",defaults:{name:""},initialize:function(){this.locallyDeletedImages=[];this.allHotspots={};this.locallyDeletedHotspots={};this.listenTo(this,"change:images",function(){PModelEventLogger.debug("change:images event")});this.listenTo(this,"imageAdded",function(){PModelEventLogger.debug("imageAdded event")});this.listenTo(this,"imageUpdated",function(){PModelEventLogger.debug("imageUpdated event")});this.listenTo(this,"imageDeleted",function(){PModelEventLogger.debug("imageDeleted event")});this.collaborators=new MARVELAPP.CollaboratorsCollection([],{project:this});this.teams=new MARVELAPP.ProjectTeamsCollection([],{project:this});this.listenTo(this,"change:team_fk",function(){this.teams.fetchIfCreated()})},fetchProject:function(id){if(typeof id=="undefined"){id=this.get("id")}ProjectModelLogger.debug("fetching project");this.fetch({url:this.url+""+id+"/",success:_.bind(this.success,this),error:_.bind(this.error,this)})},fetchUnreadCommentStatuses:function(data){if(typeof data==="undefined"){data={}}if(!this.get("id")){return ProjectModelLogger.error("Cannot fetch comments with no project ID")}var commentURL="/api/comment/unread/"+this.get("id")+"/";$.getJSON(commentURL,data).done(_.bind(function(json){this.setUnreadComments(json)},this)).fail(_.bind(function(){this.trigger("commentError","The project comments could not be loaded")},this))},markCommentsRead:function(imageID,options){options=options||{};options.url="/api/comment/read/"+imageID+"/";options.type="POST";$.ajax(options).done(_.bind(function(){var unreadCommentsObject={};unreadCommentsObject[imageID]=false;this.setUnreadComments(unreadCommentsObject)},this))},error:function(model,response,options){showNotificationMessage(projectConstants.NOTIFY_TYPE_WARN,MARVELAPP.messages.PROJECT_NOT_FOUND)},imageSetIsSameButDifferentOrder:function(images){var sameLength=Object.size(images)===Object.size(this.attributes.images);var attributeImagesUUIDs=_.pluck(this.attributes.images,"uuid");var imagesUUIDs=_.pluck(images,"uuid");var differentUnsorted=!_.isEqual(attributeImagesUUIDs,imagesUUIDs);var allElementsAreShared=_.isEmpty(_.difference(attributeImagesUUIDs,imagesUUIDs));return sameLength&&differentUnsorted&&allElementsAreShared},set:function(attributes,options){var justImages;if(_.isObject(attributes)&&this.attributes.id&&attributes.id!==this.attributes.id){options=_.extend(options||{},{useSuper:true})}if(_.isObject(attributes)&&(!options||options&&!options.useSuper)){justImages=_.clone(attributes.images);if(this.attributes.images){this.setImages(justImages);attributes.images=_.clone(this.attributes.images)}}else if(_.isString(attributes)){if(attributes==="images"&&this.attributes.images){this.setImages(options);options=_.clone(this.attributes.images)}}if(_.isObject(attributes)&&attributes.images){_.each(attributes.images,_.bind(function(image){image.hasUnreadComments=this.getHasUnreadCommentsByImageUUID(image.uuid)},this))}return Backbone.Model.prototype.set.call(this,attributes,options)},parse:function(resp){if(resp.images){_.each(resp.images,_.bind(function(image){var existingImage=this.getImageForUUID(image.uuid);if(existingImage){image.is_new=existingImage.is_new||false;if(!_.isNumber(existingImage.seq)){existingImage.seq=+existingImage.seq}image.seq=+image.seq;if(!_.isNumber(existingImage.source_platform)){existingImage.source_platform=+existingImage.source_platform}image.source_platform=+image.source_platform}image.is_dropbox=!image.is_desktop;image.md5=md5(image.name)},this))}return resp},success:function(model,response,options){this.set(response);this.fetchUnreadCommentStatuses()},setImages:function(images){if(Object.size(images)===0){return Backbone.Model.prototype.set.call(this,"images",images)}if(this.imageSetIsSameButDifferentOrder(images)){throw new Error("If you want to re-order a set of images you should do it using #sortImagesByUUIDs or #sortImagesByIds, or pass in useSuper option")}_.each(images,_.bind(function(image,sequence){image.hasUnreadComments=this.getHasUnreadCommentsByImageUUID(image.uuid);if(this.hasImage(image)){this.replaceImage(image,sequence)}else{this.addImage(image,sequence)}},this))},setIdForImageByUUID:function(id,uuid){var image=this.getImageForUUID(uuid);if(!image){throw new Error("The UUID "+uuid+" does not match any images in the project.")}image.id=id;this.trigger("imageUpdated",image)},createImageObject:function(image,sequenceNumber){var existingImage;existingImage=this.getImageByName(image.name);if(!image.md5&&image.name){image.md5=md5(image.name)}if(!existingImage){image.is_new=true}else{image.is_new=false}if(image.is_new===false){sequenceNumber=this.getSequenceNumberOfImage(image)}if(!sequenceNumber){sequenceNumber=this.getNextSequenceNumber()}image.seq=parseInt(sequenceNumber,10);if(!image.url&&existingImage){image.url=existingImage.url}if(!image.thumbnail&&existingImage){image.thumbnail=existingImage.thumbnail}if(image.is_dropbox||!image.is_desktop){image.is_dropbox=true;image.is_desktop=false}else{image.is_dropbox=false;image.is_desktop=true}return image},setImageAtSequence:function(image,sequence){if(!sequence){throw new Error("Trying to add image "+image.uuid+" with no sequence number!")}image.seq=sequence;this.get("images")[sequence]=image;ProjectModelLogger.debug("Image",image.name,"has status",image.status);if(image.is_new){ProjectModelLogger.debug("Adding image",image.uuid);this.trigger("imageAdded",image,image.seq)}else{ProjectModelLogger.debug("Updating image",image.uuid);this.trigger("imageUpdated",image,image.seq)}if(parseInt(image.seq,10)===1){ProjectModelLogger.debug("First image has been updated",image.uuid);this.trigger("firstImageUpdated",image)}},addImage:function(image){var existingImage;existingImage=this.getImageByName(image.name);if(_.contains(this.locallyDeletedImages,image.uuid)){ProjectModelLogger.debug("Not adding the locally-deleted image",image.uuid);return}if(existingImage&&existingImage.version>image.version){ProjectModelLogger.debug("Prevented replacing an image with an older one");return}image=this.createImageObject(image);this.setImageAtSequence(image,image.seq);return image},replaceImage:function(image,sequenceNumber){var existingImage;if(!this.hasImage(image)){return this.addImage(image,sequenceNumber)}existingImage=this.get("images")[sequenceNumber];if(!existingImage||existingImage.uuid!==image.uuid){existingImage=this.getImageForUUID(image.uuid)||this.getImageForId(image.id)||this.getImageByName(image.name)}if(!existingImage){return this.addImage(image,sequenceNumber)}if(existingImage.version>image.version||_.isEqual(_.omit(existingImage,"is_new"),_.omit(image,"is_new"))){ProjectModelLogger.debug("Prevented replacing an image with an older one");return}if(image.uuid&&image.uuid!==existingImage.uuid){ProjectModelLogger.error("Replacing an image with one which has a different UUID, this should not happen!",existingImage.uuid,"to",image.uuid)}_.each(image,function(val,key){if(val===null){delete image[key]}});image=_.extend(_.clone(existingImage),_.clone(image));image.is_new=false;this.setImageAtSequence(image,sequenceNumber);return image},setUnreadComments:function(images){_.each(images,_.bind(function(hasUnreadComments,imageId){var image=this.getImageForId(imageId);if(image&&image.hasUnreadComments!==hasUnreadComments){image.hasUnreadComments=hasUnreadComments;this.trigger("imageUpdated:hasUnreadComments",image)}},this))},setCommentCount:function(imageId,commentCount){var image=_.clone(this.getImageForId(imageId));image.comment_count=commentCount;this.replaceImage(image,image.seq)},deleteImageFromProject:function(imageToDelete){if(_.isNumber(imageToDelete)){imageToDelete={id:imageToDelete}}var sequenceNumber=this.getSequenceNumberOfImage(imageToDelete);var imageObject=_.clone(this.get("images")[sequenceNumber]);if(!imageObject){return}var hotspots=this.getHotspotsForImageId(imageObject.id)||this.getHotspotsForImageUUID(imageObject.uuid);_.each(hotspots,function(hotspot){this.deleteHotspotLocally(imageObject,hotspot)},this);delete this.get("images")[sequenceNumber];this.deleteHotspotMapForImage(imageObject);_.each(this.allHotspots,function(hotspotMap,imageId){_.each(hotspotMap,function(hotspot){if(hotspot.dest_img_fk==imageObject.id||hotspot.dest_img_fk===imageObject.uuid){this.deleteHotspotLocally({id:imageId},hotspot)}},this)},this);_.each(this.get("images"),function(image,sequenceNumber){var hotspots=image.hotspots;for(var idx in hotspots){var hotspot=hotspots[idx];if(hotspot.images){var imageIdx=hotspot.images.indexOf(imageObject.id);if(imageIdx>-1){hotspot.images.splice(imageIdx,1);this.setHotspotById(hotspot.img_owner_fk,hotspot.id,hotspot)}}}},this);this.sortImagesByUUIDs(_.pluck(_.values(this.get("images")),"uuid"),{triggerChange:false,triggerUpdates:true});this.trigger("imageDeleted",imageObject);this.locallyDeletedImages.push(imageObject.uuid);if(this.numberOfImages()===0){this.unset("project_base_image");this.unset("project_image")}},addHotspotForImageIfNew:function(hotspotToAdd,imageId){var image=this.getImageForId(imageId);if(!image.hotspots){image.hotspots=[]}if(!_.find(image.hotspots,function(hotspot){return hotspotToAdd.uuid===hotspot.uuid})){image.hotspots.push(hotspotToAdd)}},removeHotspotForImage:function(hotspotToRemove,imageId){var image=this.getImageForId(imageId);image.hotspots=_.filter(image.hotspots,function(hotspot){return hotspotToRemove.uuid!==hotspot.uuid})},sortImagesByIds:function(imageIds,options){options=_.defaults(options||{},{triggerChange:true,triggerSequenceChanged:true});if(this.numberOfImages()!==_.size(imageIds)){throw new Error("This project has "+this.numberOfImages()+" images but the sorting input expects it to have "+_.size(imageIds)+" images. The first sequence number is "+this.firstSequenceNumber())}if(!_.isArray(imageIds)){imageIds=_.values(imageIds)}var firstImageId;var firstImageUpdated=false;if(this.get("images")[1]){firstImageId=this.get("images")[1].id}if(imageIds[0]!==firstImageId){firstImageUpdated=true}var newImagesObject={};_.each(imageIds,_.bind(function(id,index){var newSequenceNumber=parseInt(index,10)+1;var image=this.getImageForId(id);if(!image){throw new Error("No image with the id "+id+" could be found in the project model.")}newImagesObject[newSequenceNumber]=image;newImagesObject[newSequenceNumber].seq=newSequenceNumber},this));if(options.triggerChange){Backbone.Model.prototype.set.call(this,"images",newImagesObject)}else{this.attributes.images=newImagesObject}if(options.triggerSequenceChanged){this.trigger("imageSequenceChanged",this.get("images"))}if(firstImageUpdated){this.trigger("firstImageUpdated",this.get("images")[1])}},sortImagesByUUIDs:function(imageUUIDs,options){options=_.defaults(options||{},{triggerChange:true,triggerSequenceChanged:true});if(this.numberOfImages()!==_.size(imageUUIDs)){throw new Error("This project has "+this.numberOfImages()+" images but the sorting input expects it to have "+_.size(imageUUIDs)+" images. The first sequence number is "+this.firstSequenceNumber())}if(!_.isArray(imageUUIDs)){imageUUIDs=_.values(imageUUIDs)}var firstImageUUID;var firstImageUpdated=false;if(this.get("images")[1]){firstImageUUID=this.get("images")[1].uuid}if(imageUUIDs[0]!==firstImageUUID){firstImageUpdated=true}var newImagesObject={};_.each(imageUUIDs,_.bind(function(uuid,index){var newSequenceNumber=parseInt(index,10)+1;var image=this.getImageForUUID(uuid);if(!image){throw new Error("No image with the UUID "+uuid+" could be found in the project model.")}var oldSequenceNumber=image.seq;newImagesObject[newSequenceNumber]=image;newImagesObject[newSequenceNumber].seq=newSequenceNumber;if(options.triggerUpdates&&newSequenceNumber!==oldSequenceNumber){this.trigger("imageUpdated",newImagesObject[newSequenceNumber])}},this));if(options.triggerChange){Backbone.Model.prototype.set.call(this,"images",newImagesObject)}else{this.attributes.images=newImagesObject}if(options.triggerSequenceChanged){this.trigger("imageSequenceChanged",this.get("images"))}if(firstImageUpdated){this.trigger("firstImageUpdated",this.get("images")[1])}},allImagesHaveAnId:function(){return this.numberOfImages()===0||_.reduce(this.get("images")||{},function(othersHave,image){return othersHave&&!!image.id},true)},getHasUnreadCommentsByImageUUID:function(uuid){var image=this.getImageForUUID(uuid);if(!image){return false}return!!image.hasUnreadComments},hasImage:function(image){var imageFound=image.uuid&&!!this.getImageForUUID(image.uuid);if(!imageFound){imageFound=!!image.id&&this.getImageForId(image.id)}if(!imageFound){imageFound=this.getImageByName(image.name)}return!!imageFound},sequencedImages:function(){var sequencedImages={};_.each(this.get("images"),_.bind(function(image,index){index=parseInt(index,10);if(image.id){sequencedImages[index]=image.id}else{sequencedImages[index]={uuid:image.uuid,name:image.name}}},this));return sequencedImages},getSequenceNumberOfUuid:function(uuid){var uuids=_.pluck(this.get("images"),"uuid");var sequence=_.indexOf(uuids,uuid);if(sequence!=-1){return sequence+1}else{return sequence}},getSequenceNumberOfImage:function(imageToFind){var num;_.each(this.get("images"),function(image,sequenceNumber){if(image.uuid&&image.uuid===imageToFind.uuid||image.id&&parseInt(image.id,10)===parseInt(imageToFind.id,10)||image.name===imageToFind.name){num=sequenceNumber}});return num},getPropertyForName:function(name){var property=_.find(this.get("properties"),function(property){if(name===property.name){return property}});return property||{}},setPropertyByName:function(name,value){_.each(this.get("properties"),_.bind(function(property,idx){if(property.name===name){property.value=value;ProjectModelLogger.debug("Setting the property ",property);this.get("properties")[idx]=property;this.trigger("change:properties",this,property);this.trigger("change:properties:"+property.name,this,property)}},this))},setProperty:function(data){_.each(this.get("properties"),_.bind(function(property,idx){if(property.id==data.id){this.get("properties")[idx]=data;this.trigger("change:properties",this,data);this.trigger("change:properties:"+data.name,this,data)}},this))},numberOfImages:function(){
return Object.size(this.get("images"))},totalContentSize:function(){var totalSize=0;_.each(this.get("images"),_.bind(function(image,index){totalSize=totalSize+parseInt(image.size)},this));return totalSize},getNextSequenceNumber:function(isLocked){isLocked=isLocked||false;var sequenceNumber=0;if(isLocked===false){isLocked=true;sequenceNumber=Object.size(this.get("images"))+1;isLocked=false;return sequenceNumber}else{return this.getNextSequenceNumber(isLocked)}},getSequenceForImageId:function(imageId){var sequenceNumber;_.each(this.get("images"),_.bind(function(image,index){if(image.id==imageId){sequenceNumber=index}},this));return sequenceNumber},getImageForId:function(id){return _.find(this.get("images"),_.bind(function(image,index){if(parseInt(image.id,10)===parseInt(id,10)){return true}else if(md5(image.name||"")===id){return true}return false},this))},getImageForUUID:function(uuid){return _.find(this.get("images"),_.bind(function(image){if(image.uuid===uuid){return true}return false},this))},getImageByName:function(name){return _.find(this.get("images"),_.bind(function(image){if(image&&image.name){return image.name.toLowerCase()===name.toLowerCase()||md5(image.name.toLowerCase())===name.toLowerCase()}},this))},firstSequenceNumber:function(){return _.keys(this.get("images"))[0]},firstImageDimensions:function(overrideWidth,overrideHeight){var sequence;var dimensions={width:0,height:0};for(sequence in this.get("images")){if(!this.get("images")[sequence].is_app_icon&&this.get("images")[sequence].width){dimensions.width=this.get("images")[sequence].width;dimensions.height=this.get("images")[sequence].height;break}}if(!dimensions.width||!dimensions.height){if(_.isNumber(overrideWidth)||_.isNumber(overrideHeight)){dimensions.width=overrideWidth;dimensions.height=overrideHeight}}return dimensions},firstImageRatio:function(overrideWidth,overrideHeight){var firstImageDimensions=this.firstImageDimensions(overrideWidth,overrideHeight);return firstImageDimensions.width/firstImageDimensions.height},firstImageThumbnail:function(){if(this.numberOfImages()>0&&(this.get("images")[this.firstSequenceNumber()].thumbnail||this.get("images")[this.firstSequenceNumber()].url)){return this.get("images")[this.firstSequenceNumber()].thumbnail||this.get("images")[this.firstSequenceNumber()].url}return this.get("project_image")},firstImageURL:function(){if(this.numberOfImages()>0&&this.get("images")[this.firstSequenceNumber()].url){return this.get("images")[this.firstSequenceNumber()].url}return this.get("project_base_image")},isIPhoneSized:function(overrideWidth,overrideHeight){var firstImageDimensions=this.firstImageDimensions(overrideWidth,overrideHeight);var firstImageRatio=this.firstImageRatio(overrideWidth,overrideHeight);if(!firstImageDimensions.width||!firstImageDimensions.height){return false}if(firstImageDimensions.width===640||firstImageDimensions.width===320||firstImageDimensions.width===750||firstImageDimensions.width===1242){return true}else if(_.isNumber(firstImageRatio)&&(firstImageRatio<750/1334||firstImageRatio>2/3)){return false}return true},isSmartphoneSized:function(overrideWidth,overrideHeight){var firstImageDimensions=this.firstImageDimensions(overrideWidth,overrideHeight);var firstImageRatio=this.firstImageRatio(overrideWidth,overrideHeight);if(!firstImageDimensions.width||!firstImageDimensions.height){return false}if(_.isNumber(firstImageRatio)&&.5622<=firstImageRatio&&firstImageRatio<=.666666667){return true}return false},isAppleWatchSized:function(overrideWidth,overrideHeight){var firstImageDimensions=this.firstImageDimensions(overrideWidth,overrideHeight);if(!firstImageDimensions.width||!firstImageDimensions.height){return false}if(firstImageDimensions.width===272||firstImageDimensions.width===312){return true}return false},isFramePortraitSmartphone:function(){var frame=this.getPropertyForName(projectConstants.PROJECT_PROP_FRAME).value;var orientation=this.getPropertyForName(projectConstants.PROJECT_PROP_ORIENTATION).value;if(typeof frame!=="undefined"){return frame.match(/iphone|nexus|s5|lumia|htc/)&&(orientation===projectConstants.ORIENTATION_PORTRAIT||orientation.length===0)}return false},isFrameAppleWatch:function(){var frame=this.getPropertyForName(projectConstants.PROJECT_PROP_FRAME).value;if(typeof frame!=="undefined"){return frame.match(/apple-watch/)}return false},getThumbnailWidth:function(overrideWidth,overrideHeight){var projectConstants=new ProjectConstants;var thumbnailWidth=220;var savedWidth=this.getPropertyForName(projectConstants.PROJECT_PROP_THUMBNAIL_WIDTH);if(+savedWidth.value&&_.isNumber(+savedWidth.value)){return+savedWidth.value}var firstImageDimensions=this.firstImageDimensions(overrideWidth,overrideHeight);var firstImageRatio=this.firstImageRatio(overrideWidth,overrideHeight);if(firstImageDimensions.width===640||firstImageDimensions.width==320){thumbnailWidth=220}else if(_.isNumber(firstImageRatio)&&(firstImageRatio<750/1334||firstImageRatio>2/3)){thumbnailWidth=260}return thumbnailWidth},commentsEnabled:function(){return!!parseInt(this.getPropertyForName(projectConstants.PROJECT_PROP_COMMENTS_ENABLED).value,10)},pusherChannel:function(){return MARVELAPP.settings.PUSHER.PROJECT_CHANNEL_PREFIX+this.get("id")},getAllHotspots:function(){return this.allHotspots},ensureHotspotMapForImage:function(image){var imageId;if(_.isObject(image)){if(!image.id){throw new Error("Trying to create a hotspot map for an image with no id yet")}imageId=parseInt(image.id,10)}else if(_.isNaN(imageId=parseInt(image,10))){throw new Error("Trying to create a hotspot map with an ID that is clearly not an ID")}if(!this.allHotspots[imageId]){this.setHotspotsForImageId(imageId,{})}return this.allHotspots[imageId]},deleteHotspotMapForImage:function(image){var imageId,imageUUID;if(_.isObject(image)){imageId=parseInt(image.id,10);imageUUID=image.uuid;if(this.allHotspots[imageUUID]){delete this.allHotspots[imageUUID]}}else{imageId=parseInt(image,10)}if(this.allHotspots[imageId]){delete this.allHotspots[imageId]}},setHotspotsForImageId:function(imageId,hotspotsObject){this.allHotspots[imageId]=hotspotsObject},getHotspotsForImageId:function(imageId){return this.allHotspots[imageId]},getHotspotsForImageUUID:function(imageUUID){return this.allHotspots[imageUUID]},getTimerHotspotForImageId:function(imageId){var imageHotspots=this.getHotspotsForImageId(imageId);for(idx in imageHotspots){var hotspot=imageHotspots[idx];if(hotspot.action===MARVELAPP.constants.hotspot.ACTION_TIMER){return hotspot}}},setHotspotById:function(imageId,hotspotId,hotspot,options){if(this.hotspotHasBeenDeletedLocally(hotspot)){return}this.ensureHotspotMapForImage(imageId);options=_.defaults(options||{},{metaOnly:false});var fullHotspot=hotspot;var existingHotspot=this.allHotspots[imageId][hotspotId]||this.allHotspots[imageId][hotspot.uuid];if(options.metaOnly&&existingHotspot){hotspot=_.clone(existingHotspot);hotspot.version=fullHotspot.version;hotspot.id=fullHotspot.id;hotspot.uuid=fullHotspot.uuid;hotspot.delta_check=fullHotspot.delta_check}if(!hotspot.owner_hotspot||_.contains(hotspot.images,imageId)){this.allHotspots[imageId][hotspotId]=hotspot}this.deleteHotspotByUUID(imageId,hotspot.uuid);var image=this.getImageForId(imageId);if(!image&&hotspot.images.length>0){imageId=hotspot.images[0];image=this.getImageForId(imageId)}var newHotspot=true;var hasChanged=false;var imagesNotDuplicated=[];if(!image.hotspots){image.hotspots=[]}_.each(image.hotspots,function(imageHotspot){if(_.isEqual(imageHotspot.uuid,fullHotspot.uuid)){hasChanged=!_.isEqual(imageHotspot,fullHotspot);if(hasChanged){imagesNotDuplicated=_.difference(imageHotspot.images,fullHotspot.images);if(!imageHotspot.owner_hotspot&&fullHotspot.images&&fullHotspot.images.length&&!_.contains(fullHotspot.images,imageHotspot.img_owner_fk)){imagesNotDuplicated.push(imageHotspot.img_owner_fk)}hotspot=_.extend(imageHotspot,hotspot)}newHotspot=false}});if(newHotspot){image.hotspots.push(fullHotspot)}_.each(fullHotspot.images||[],function(otherImageId){this.ensureHotspotMapForImage(otherImageId);this.allHotspots[otherImageId][hotspotId]=hotspot;this.deleteHotspotByUUID(imageId,fullHotspot.uuid)},this);_.each(imagesNotDuplicated,function(duplicateImageId){var shouldRemoveFromImageModel=!fullHotspot||!fullHotspot.owner_hotspot||!fullHotspot.images.length;this.deleteHotspotById(duplicateImageId,hotspotId,{shouldRemoveFromImageModel:shouldRemoveFromImageModel})},this);if(hasChanged){ProjectModelLogger.debug("Hotspot changed:",this.allHotspots[imageId][hotspotId]);this.trigger("hotspotChanged",image,this.allHotspots[imageId][hotspotId])}if(newHotspot){ProjectModelLogger.debug("Hotspot added:",this.allHotspots[imageId][hotspotId]);this.trigger("hotspotAdded",image,this.allHotspots[imageId][hotspotId])}},setHotspotByUUID:function(imageId,hotspotUUID,hotspot,metaOnly){this.ensureHotspotMapForImage(imageId);this.allHotspots[imageId][hotspotUUID]=hotspot;var image=this.getImageForId(imageId);var newHotspot=true;var hasChanged=false;var imagesNotDuplicated=[];if(!image.hotspots){image.hotspots=[]}_.each(image.hotspots,function(existingHotspot){if(_.isEqual(existingHotspot.uuid,hotspot.uuid)){hasChanged=!_.isEqual(existingHotspot,hotspot);if(hasChanged){imagesNotDuplicated=_.difference(existingHotspot.images,hotspot.images);hotspot=_.extend(existingHotspot,hotspot)}newHotspot=false}});if(newHotspot){image.hotspots.push(hotspot)}_.each(hotspot.images||[],function(otherImageId){this.ensureHotspotMapForImage(otherImageId);this.allHotspots[otherImageId][hotspotUUID]=hotspot},this);_.each(imagesNotDuplicated,function(imageId){this.deleteHotspotByUUID(imageId,hotspotUUID)},this);if(hasChanged){ProjectModelLogger.debug("Hotspot changed:",this.allHotspots[imageId][hotspotUUID]);this.trigger("hotspotChanged",image,this.allHotspots[imageId][hotspotUUID])}if(newHotspot){ProjectModelLogger.debug("Hotspot added:",this.allHotspots[imageId][hotspotUUID]);this.trigger("hotspotAdded",image,this.allHotspots[imageId][hotspotUUID])}},getHotspotById:function(imageId,hotspotId){this.ensureHotspotMapForImage({id:imageId});return this.allHotspots[imageId][hotspotId]},getHotspotByUUID:function(imageId,hotspotUUID){this.ensureHotspotMapForImage({id:imageId});return this.allHotspots[imageId][hotspotUUID]},hotspotHasBeenDeletedLocally:function(hotspot){return this.locallyDeletedHotspots[hotspot.id]||this.locallyDeletedHotspots[hotspot.uuid]},deleteHotspotById:function(imageId,hotspotId,options){options=_.defaults(options||{},{shouldRemoveFromImageModel:true});var image=this.getImageForId(imageId);var hotspot=this.getHotspotById(imageId,hotspotId);if(!hotspot){hotspot=this.locallyDeletedHotspots[hotspotId]}if(!hotspot){return}if(options.shouldRemoveFromImageModel){image.hotspots=_.reject(image.hotspots,function(hotspot){return hotspot.id===hotspotId},this)}delete this.allHotspots[imageId][hotspotId];this.trigger("hotspotDeleted",image,hotspot)},deleteHotspotByUUID:function(imageId,hotspotUUID){if(this.allHotspots[imageId]&&this.allHotspots[imageId][hotspotUUID]){delete this.allHotspots[imageId][hotspotUUID]}},deleteHotspotLocally:function(image,hotspot){var existingHotspot;if(this.getHotspotsForImageId(image.id)){existingHotspot=this.getHotspotById(image.id,hotspot.id);if(existingHotspot){this.deleteHotspotById(image.id,hotspot.id);if(hotspot.images&&hotspot.images.length>0){return}this.locallyDeletedHotspots[hotspot.id]=existingHotspot;return}existingHotspot=this.getHotspotById(image.id,hotspot.uuid);if(existingHotspot){this.deleteHotspotByUUID(image.id,hotspot.uuid);if(hotspot.images&&hotspot.images.length>0){return}this.locallyDeletedHotspots[hotspot.uuid]=hotspot}}},getBrightPixelColour:function(){if(_.size(this.get("images"))>0){var first_image=this.get("images")[1];if(first_image.bright_pixel_colour){return first_image.bright_pixel_colour}else{return this.get("bright_pixel_colour")}}else{return this.get("bright_pixel_colour")}},getCanvasImages:function(){var images=this.get("images");var canvases=[];for(var idx in images){var image=images[idx];if(image.canvas_fk){canvases.push(image)}}return canvases},getNextCanvasNumber:function(){var index=this.getCanvasImages().length+1;return index},getNextCanvasName:function(canvasNumber){if(!canvasNumber){canvasNumber=this.getNextCanvasNumber()}var newName="Image "+canvasNumber;var existingImage=this.getImageByName(newName+".png");if(!existingImage){return newName}else{return this.getNextCanvasName(canvasNumber+1)}}});MARVELAPP.ProjectTeamModel=Backbone.Model.extend({getMemberIds:function(){return this.get("member_ids")}});MARVELAPP.ProjectsModel=Backbone.Model.extend({first_run:false,identifier:undefined,collection:undefined,url:"/api/project/all/",url_team:"/api/project/team/",defaults:{project_collection:new MARVELAPP.ProjectsCollection},fetch_projects_for_team:function(url,team_model){this.fetch({url:this[url]+""+team_model.id+"/",team_model:team_model,success:_.bind(this.success,this),error:_.bind(this.error,this)})},fetch_all_projects:function(){this.fetch({url:this.url,success:_.bind(this.success,this),error:_.bind(this.error,this)})},calculateCollectionChange:function(data,models){var response_calc=0;for(var idx in data){var data_model=data[idx];response_calc+=data_model.id}var current_calc=0;for(var idx2 in models){var model=models[idx2];current_calc+=model.get("id")}console.log("Calculation is "+current_calc+" "+response_calc);if(current_calc!=response_calc){return true}return false},getCountImages:function(project){var project_collection=this.get("project_collection").models;var num_images=0;for(var idx in project_collection){var project_model=project_collection[idx];if(project){if(project.get("id")!=project_model.get("id")){num_images+=project_model.get("num_images")}}else{num_images+=project_model.get("num_images")}}return num_images},error:function(model,response,options){},success:function(model,response,options){$(".marvel-loader").addClass("hidden");var update=this.calculateCollectionChange(response,MARVELAPP.models.projects.get("project_collection").models);if(!update)return;if(typeof MARVELAPP.models.projects!="undefined"){if(MARVELAPP.models.projects.get("project_collection").length>0){update=true;var remove_models=[];_.each(MARVELAPP.models.projects.get("project_collection").models,_.bind(function(existing_model){var model_found=false;_.each(response,_.bind(function(responseModel){var project_model=new MARVELAPP.ProjectModel(responseModel);if(project_model.id==existing_model.id){model_found=true}}));if(model_found==false){remove_models.push(existing_model)}}));for(var idx in remove_models){var existing_model=remove_models[idx];MARVELAPP.models.projects.get("project_collection").remove(existing_model)}}}var tmp_collection=[];_.each(response,_.bind(function(responseModel){var project_model=new MARVELAPP.ProjectModel(responseModel);if(update==true){var existing_model=MARVELAPP.models.projects.get("project_collection").getModelByProjectId(project_model.id);if(typeof existing_model!=="undefined"){var current_project_id=undefined;if(typeof MARVELAPP.models.current_project!=="undefined"){current_project_id=MARVELAPP.models.current_project.id}if((existing_model.get("version")!=project_model.get("version")||existing_model.get("sequence_delta")!=project_model.get("sequence_delta"))&&current_project_id!=project_model.id){tmp_collection.push(project_model)}if(existing_model.get("sequence_delta")==project_model.get("sequence_delta")){if(existing_model.get("images")){project_model.set("images",existing_model.get("images"))}}}else{tmp_collection.push(project_model)}}else{tmp_collection.push(project_model)}},this));if(typeof options.poll==="undefined"){options.poll=false}if(tmp_collection.length==0&&MARVELAPP.models.projects.get("project_collection").length==0){MARVELAPP.models.projects.get("project_collection").reset()}else{if(tmp_collection.length!=0){MARVELAPP.models.projects.get("project_collection").set(tmp_collection,{remove:false})}}this.callPoller();MARVELAPP.models.projects.get("project_collection").trigger("sync",MARVELAPP.models.projects.get("project_collection"))},callPoller:function(){if(this.first_run==false){console.log("Calling the poller");var options={delay:MARVELAPP.constants.projects.POLL_TIMING,delayed:true,continueOnError:true};if(typeof MARVELAPP.pollers.project_poller!=="undefined"){MARVELAPP.pollers.project_poller.stop()}MARVELAPP.pollers.project_poller=Backbone.Poller.get(MARVELAPP.models.projects,options);MARVELAPP.pollers.project_poller.on("success",_.bind(function(model,response){this.success(model,response,{poll:true})},this));MARVELAPP.pollers.project_poller.on("complete",function(model){});MARVELAPP.pollers.project_poller.on("error",function(model){});MARVELAPP.pollers.project_poller.start();this.first_run=true}}});MARVELAPP.SubscriptionModel=Backbone.Model.extend({url:"/api/stripe/subscribe/",defaults:{name:""},fetchSubscription:function(id){this.fetch({url:this.url+""+id+"/",success:_.bind(this.success,this),error:_.bind(this.error,this)})},error:function(model,response,options){showNotificationMessage(projectConstants.NOTIFY_TYPE_WARN,MARVELAPP.messages.PROJECT_NOT_FOUND)},success:function(model,response,options){this.set(response)},initialize:function(){this.listenTo(this,"sync",_.bind(this.runningSync,this))},parse:function(data){},runningSync:function(){console.log("RUNNING: subscription sync")}});MARVELAPP.TeamModel=Backbone.Model.extend({url:"/api/team/",defaults:{name:MARVELAPP.constants.team.DEFAULT_TEAM_NAME,icon_url:MARVELAPP.constants.team.DEFAULT_TEAM_ICON_URL,users:[],owner_fk:null},fetchTeam:function(id){this.fetch({url:this.url+""+id+"/",async:false,success:_.bind(this.success,this),error:_.bind(this.error,this)})},error:function(model,response,options){showNotificationMessage(projectConstants.NOTIFY_TYPE_WARN,MARVELAPP.messages.TEAM_NOT_FOUND)},success:function(model,response,options){this.set(response)},initialize:function(){},get_owner:function(){var return_owner={};_.each(this.get("users"),function(member){if(typeof member!=="undefined"){if(typeof member.attributes!=="undefined"){member=member.attributes}if(member.role==MARVELAPP.constants.role.ROLE_OWNER){this.owner=member;return_owner=member;return member}}});return return_owner},get_owner_name:function(){var owner=this.get_owner();if(typeof owner!=="undefined"){if(typeof owner.attributes!=="undefined"){return owner.attributes.username}else{return owner.username}}else{""}},get_member:function(member_id){var models=this.get("users").models;if(typeof models==="undefined"){models=this.get("users")}var return_member=undefined;for(var i in models){var member=models[i];if(typeof member!=="undefined"){if(typeof member.attributes!=="undefined"){member=member.attributes}if(member.id==member_id){return_member=member;break}}}return return_member},getMemberIds:function(){return this.get("users").pluck("id")},parse:function(data){var collection=new MARVELAPP.MemberCollection;if(data.users&&data.users.length>0){_.each(data.users,_.bind(function(user){collection.add(new MARVELAPP.MemberModel(user))},this))}if(data.icon_url==null){if(typeof this.get("icon_url")==="undefined"||this.get("icon_url")==null){data.icon_url=MARVELAPP.constants.team.DEFAULT_TEAM_ICON_URL}else{data.icon_url=this.get("icon_url")}}data.users=collection;return data},userIsOwner:function(user){var member=this.get_member(user.get("id"));if(MARVELAPP.models.current_user.get("id")===user.get("id")){return this.get("role")===MARVELAPP.constants.role.ROLE_OWNER}else if(typeof member==="undefined"){return false}else{return member.role===MARVELAPP.constants.role.ROLE_OWNER}},userIsAdmin:function(user){var member=this.get_member(user.get("id"));if(MARVELAPP.models.current_user.get("id")===user.get("id")){return this.get("role")===MARVELAPP.constants.role.ROLE_ADMIN}else if(typeof member==="undefined"){return false}else{return member.role===MARVELAPP.constants.role.ROLE_ADMIN}},userHasAccepted:function(user){var member=this.get_member(user.get("id"));if(typeof member==="undefined")return false;return member.invite_state===MARVELAPP.constants.invite.TEAM_MEMBER_STATE_ACCEPTED},addMember:function(email,opts){opts=opts||{};var url="/api/v0/team/"+this.get("id")+"/invite";opts.contentType="application/json";opts.method="POST";opts.url=url;opts.data=JSON.stringify({email:email});return $.ajax(opts)},removeMember:function(member,opts){opts=opts||{};var url="/api/v0/team/"+this.get("id")+"/member/"+member.get("id");opts.url=url;opts.method="DELETE";return $.ajax(opts)}});MARVELAPP.TeamsModel=Backbone.Model.extend({first_run:false,url:"/api/teams/all/",defaults:{categoryAll:new MARVELAPP.TeamsCollection},error:function(model,response,options){console.log("Error retrieving team details")},success:function(model,response,options){this.get("categoryAll").set(response,{remove:false});this.runTeamPoller()},teamsForUser:function(user_id){var teams=this.get("categoryAll").where({role:MARVELAPP.constants.role.ROLE_OWNER});return teams},teamsInvited:function(){var teams=this.get("categoryAll").where({invite_state:MARVELAPP.constants.invite.TEAM_MEMBER_STATE_INVITED});return teams},teamsAccepted:function(){var teams=this.get("categoryAll").where({invite_state:MARVELAPP.constants.invite.TEAM_MEMBER_STATE_ACCEPTED});return teams},runTeamPoller:function(){if(window.presentation_mode){return}if(MARVELAPP.pollers.team_first_run===false){var delay=MARVELAPP.constants.team.POLL_TIMING;var options={delay:delay,continueOnError:true};try{MARVELAPP.pollers.team_poller.stop()}catch(ex){}MARVELAPP.pollers.team_poller=undefined;MARVELAPP.pollers.team_poller=Backbone.Poller.get(MARVELAPP.models.teams,options);MARVELAPP.pollers.team_poller.on("success",_.bind(function(model,response){this.success(model,response,{poll:true})},this));MARVELAPP.pollers.team_poller.on("complete",function(model){});MARVELAPP.pollers.team_poller.on("error",function(model){});MARVELAPP.pollers.team_poller.start();MARVELAPP.pollers.team_first_run=true}if(MARVELAPP.models.teams.get("categoryAll").length<1){setTimeout(function(){if(MARVELAPP.pollers.team_poller){MARVELAPP.pollers.team_poller.stop()}},1e3)}}});MARVELAPP.UserModel=Backbone.Model.extend({url:"/api/user/",defaults:{name:"",subscription:{plan:{}},intercom:{}},is_fetching:false,intercomSegments:{PLEXI_ALPHA:"Plexi Alpha Candidates"},intercomTags:{PLEXI_ALPHA:"Plexi Alpha"},initialize:function(){this.invoices=new MARVELAPP.InvoiceCollection},fetch_user:function(async){if(this.is_fetching==false){this.is_fetching=true;if(typeof async==="undefined"){async=false}this.fetch({async:async,success:_.bind(this.success,this),error:_.bind(this.error,this)})}},error:function(){this.is_fetching=false},success:function(model,response){this.set(response);this.subscribed=this.is_subscribed();this.is_fetching=false},is_subscribed:function(){var subscription=this.get("subscription");if(subscription!=null||subscription!=undefined){if(subscription.is_subscribed){return true}}return false},isEnterprise:function(){var subscription=this.get("subscription");return subscription.plan.is_enterprise},isAdmin:function(){var subscription=this.get("subscription");if(!subscription.is_subscribed){return false}if(this.isEnterprise()){if(subscription.gifted_subscription){if(subscription.gifted_subscription.is_admin==true){return true}else{return false}}}if(!this.is_subscribed()){return false}return true},isEnterpriseAdmin:function(){var sub=this.get("subscription");return sub&&this.isEnterprise()&&sub.gifted_subscription&&sub.gifted_subscription.is_admin},memberOfTeams:function(){var teams=this.get("teams");var num_teams=0;if(teams){for(var idx in teams.models){var team=teams.models[idx];if(team){var member=team.get_member(this.get("id"));if(member){num_teams+=1}}}}return num_teams},get_paid_included_user:function(){var all_users=this.get("subscription").included_users;var returned_users=[];_.each(all_users,_.bind(function(user){if(user.is_coupon==false){returned_users.push(user)}},this));return returned_users},countTeamInvites:function(){var num_invites=0;var teams=this.attributes.teams;if(teams&&teams.length>0){_.each(teams.models,_.bind(function(team){if(team.get("invite_state")==MARVELAPP.constants.invite.TEAM_MEMBER_STATE_INVITED){num_invites=num_invites+1}},this))}return num_invites},parse:function(data){MARVELAPP.models.teams=new MARVELAPP.TeamsModel;var collection=new MARVELAPP.TeamsCollection;if(data.teams&&data.teams.length>0){_.each(data.teams,_.bind(function(team){var team_model=new MARVELAPP.TeamModel(team);team_model.set(team_model.parse(team));collection.add(team_model)},this))}data.teams=collection;MARVELAPP.models.teams.set("categoryAll",collection);return data},isUpgrade:function(plan){var current_price=this.attributes.subscription.plan.price_yearly;var upgrade_price=plan.price_yearly;if(this.attributes.subscription.billing_cycle=="monthly"){current_price=this.attributes.subscription.plan.price_monthly;upgrade_price=plan.price_monthly}if(plan.team_members>1){upgrade_price=upgrade_price*plan.team_members}if(this.attributes.subscription.plan.team_members>1){current_price=current_price*this.attributes.subscription.plan.team_members}else if(this.attributes.subscription.included_users){current_price=current_price*(this.attributes.subscription.included_users.length+1)}return upgrade_price>current_price},getAllowance:function(name){if(!this.get("subscription")){return false}return _.findWhere(this.get("subscription").allowances,{name:name})},setAllowance:function(allowance){if(!this.get("subscription")){return false}var index=_.findIndex(this.get("subscription").allowances,{name:allowance.name});this.attributes.subscription.allowances[index]=allowance},usernameInitials:function(){var initials,emailSplit,firstLetter,secondLetter;var username=(this.attributes.username||"").trim();if(username){try{initials=username.match(/\b(\w)/g).join("").substr(0,2)}catch(e){}}if(!initials){if(typeof this.attributes.email==="undefined"||this.attributes.email===undefined){return""}emailSplit=this.attributes.email.split("@");if(emailSplit.length>0){firstLetter=emailSplit[0].charAt(0);secondLetter=emailSplit[1].charAt(0);initials=firstLetter+secondLetter}else{initials=this.attributes.email.charAt(0)}}return initials},hasAllowance:function(name){var allowance=this.getAllowance(name);if(allowance===undefined){return false}else if(allowance.is_unlimited){return true}else{return allowance.quantity>allowance.quantity_used}},hasUnlimitedAllowance:function(name){var allowance=this.getAllowance(name);if(allowance&&allowance.is_unlimited){return true}return false},hasSeenTour:function(){var property=this.getPropertyForName(MARVELAPP.constants.user.ALL_USER_PROPS.ui_tour_seen);if(property&&property.value==1){return true}else{return false}},getPublicProfileURL:function(){if(!this.get("handle")){return}return MARVELAPP.settings.BASE_URL+"/profile/"+this.get("handle").toLowerCase()},getPropertyForName:function(name){var property=_.find(this.get("properties"),function(property){if(name===property.name){return property}});return property||{}},setPropertyValueByName:function(name,value){var hasBeenSet=false,propertyToReturn;_.each(this.get("properties"),_.bind(function(property,idx){if(property.name===name){property.value=value;this.get("properties")[idx]=property;propertyToReturn=property;hasBeenSet=true}},this));if(!hasBeenSet){propertyToReturn={name:name,value:value};this.get("properties").push(propertyToReturn)}return propertyToReturn},setPropertyByName:function(property){var hasBeenSet=false,propertyToReturn;_.each(this.get("properties"),_.bind(function(existingProperty,index){if(existingProperty.name===property.name){this.get("properties")[index]=property;propertyToReturn=property;hasBeenSet=true}},this));if(!hasBeenSet){this.get("properties").push(property)}return propertyToReturn},getIntegration:function(integration_name){var integrations=this.get("integrations");for(var idx in integrations){var integration=integrations[idx];if(integration.name==integration_name){return integration}}},fetchIntercomUser:function(){$.ajax({url:"/api/v1/user/intercom/",type:"GET",async:true,success:_.bind(function(data,e){this.set("intercom",data);var marvelUpdateInfo={comment_count:data["comment_count"],comment_projects:data["comment_projects"]};Intercom("update",marvelUpdateInfo)},this),error:function(e,f){console.error("Problem fetching intercom user")}})},getSegmentAccess:function(segmentName){var segments=this.get("intercom").segments;if(segments){for(var idx in segments){var segment=segments[idx];if(segment==segmentName){return true}}}return false},getTagAccess:function(tagName){var tags=this.get("intercom").tags;if(tags){for(var idx in tags){var tag=tags[idx];if(tag==tagName){return true}}}return false}});MARVELAPP.UserModel.usernameInitials=function(username,email){var model={attributes:{username:username,email:email}};return _.bind(MARVELAPP.UserModel.prototype.usernameInitials,model)()};MARVELAPP.AnnotationModel=Backbone.Model.extend({idAttribute:"commentUUID",defaults:{x:undefined,y:undefined,topPercent:undefined,leftPercent:undefined,commentUUID:undefined,reference:undefined},initialize:function(options){},setModels:function(models){models=models||{};if(this.comment){this.stopListening(this.comment)}this.comment=models.comment||new MARVELAPP.CommentModel}});MARVELAPP.CommentModel=Backbone.Model.extend({idAttribute:"uuid",url:function(){if(this.isExplore()){return"/api/project/"+this.get("project_fk")+"/comments/"}else{var obj_fk=this.get("content_fk");return"/api/comment/"+obj_fk+"/"}},defaults:{id:undefined,uuid:undefined,message:undefined,marvel_user_fk:{username:undefined,id:undefined,profile_uri:undefined},access_code:undefined,commenter_fk:{username:undefined,email:undefined,id:undefined},type:undefined,project_uuid:undefined,annotation_x:undefined,annotation_y:undefined,annotation_reference:undefined,gravatar_data:{url:undefined,colour:undefined},time_since_creation:"Just now",content_fk:undefined,removal_uri:undefined,show_delete:false,unread:true},initialize:function(options){this.attributes.removal_uri="/api/comment/remove-comment/"+this.get("id")+"/";var current_user_id=-1;if(typeof MARVELAPP.models.current_user.attributes!="undefined"){current_user_id=MARVELAPP.models.current_user.get("id")}var comment_owner_id=-3;if(this.attributes.marvel_user_fk!=null){comment_owner_id=this.attributes.marvel_user_fk.id}var project_owner_id=-2;if(typeof MARVELAPP.models.current_project!="undefined"){project_owner_id=MARVELAPP.models.current_project.get("owner_fk")}if(current_user_id==comment_owner_id||current_user_id==project_owner_id){this.attributes.show_delete=true}},hasAnnotation:function(){return!!this.get("annotation_y")&&!!this.get("annotation_x")},isExplore:function(){return this.get("type").toLowerCase()===MARVELAPP.constants.comment_types.EXPLORE.toLowerCase()}});MARVELAPP.ExploreModel=Backbone.Model.extend({url:function(){return"/api/explore/"+this.get("id")+"/"},defaults:{id:undefined,name:undefined,uuid:undefined,date_created:undefined,description:undefined,embedColour:"#7e3fff",user:{username:undefined,handle:undefined,profile_uri:undefined,first_name:undefined,last_name:undefined,gravatar_data:{url:undefined,colour:undefined}},like_count:0,pending_like_count:undefined,has_liked:false,comment_count:0,views:0,initial_image_url:undefined,vanity_url:undefined,is_staff:undefined,hide_make_own:undefined},initialize:function(options){},addLike:function(successCB){if(this.existingLikeRequest){console.log("Canceling existing like request");this.existingLikeRequest.abort();this.set("pending_like_count",undefined);this.trigger("visibleLikeCountChanged",parseInt(this.get("like_count"),10));this.existingLikeRequest=undefined}this.set("has_liked",true);this.set("pending_like_count",parseInt(this.get("like_count"),10)+1);this.trigger("visibleLikeCountChanged",this.get("pending_like_count"));this.existingLikeRequest=$.ajax({url:"/api/explore/"+this.get("id")+"/like/",type:"POST",
beforeSend:function(xhr,settings){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},success:successCB,error:_.bind(function(){console.log("Error liking a thing");this.set("pending_like_count",undefined);this.trigger("visibleLikeCountChanged",parseInt(this.get("like_count"),10))},this),statusCode:{201:_.bind(function(){this.set("like_count",parseInt(this.get("like_count"),10)+1);this.set("pending_like_count",undefined);this.trigger("visibleLikeCountChanged",parseInt(this.get("like_count"),10))},this),204:_.bind(function(){this.set("pending_like_count",undefined);this.trigger("visibleLikeCountChanged",parseInt(this.get("like_count"),10))},this)}})},removeLike:function(){console.log("Canceling existing like request");if(this.existingLikeRequest){this.existingLikeRequest.abort();this.set("pending_like_count",undefined);this.trigger("visibleLikeCountChanged",parseInt(this.get("like_count"),10));this.existingLikeRequest=undefined}this.set("pending_like_count",parseInt(this.get("like_count"),10)-1);this.set("has_liked",false);this.trigger("visibleLikeCountChanged",this.get("pending_like_count"));this.existingLikeRequest=$.ajax({url:"/api/explore/"+this.get("id")+"/like/",type:"DELETE",success:_.bind(function(data){console.log("Success unliking this thing:",data)},this),error:_.bind(function(){console.log("Error unliking a thing");this.set("pending_like_count",undefined);this.trigger("visibleLikeCountChanged",parseInt(this.get("like_count"),10))},this),statusCode:{204:_.bind(function(){this.set("like_count",parseInt(this.get("like_count"),10)-1);this.set("pending_like_count",undefined)},this),400:_.bind(function(){this.set("pending_like_count",undefined)},this)}})},getPropertyForName:function(name){var property=_.find(this.get("properties"),function(property){if(name===property.name){return property}});return property||{}},addStaffPick:function(){$.ajax({url:"/api/explore/"+this.get("id")+"/staff/",type:"POST",success:_.bind(function(data){this.set("has_staff",true);this.trigger("staffPickChanged",this.get("has_staff"))},this),error:_.bind(function(){console.log("Error staffing a thing")},this)})},removeStaffPick:function(){$.ajax({url:"/api/explore/"+this.get("id")+"/staff/",type:"DELETE",success:_.bind(function(data){this.set("has_staff",false);this.trigger("staffPickChanged",this.get("has_staff"))},this),error:_.bind(function(){console.log("Error unstaffing a thing")},this)})}});MARVELAPP.ExploreProfileModel=Backbone.Model.extend({url:function(){return"/api/profile/"+this.get("handle")+"/"},defaults:{id:"",handle:"",bio:"",avatar_data:{url:"",colour:"",is_uploaded:false},published_projects:[]},initialize:function(options){}});MARVELAPP.ProjectDuplicateThumbnailView=Backbone.View.extend({tmpl:MARVELAPP.templates.MODAL_DUPLICATE_THUMBNAIL,tagName:"li",events:{click:"toggleSelect"},initialize:function(){this.viewState=new Backbone.Model;this.listenTo(this.viewState,"change:loadedImage",this.setBackgroundImage);this.listenTo(this.model.project,"firstImageUpdated",this.updateDimensions)},setImageModel:function(image){this.model.image.set(image);this.determineAndSetImageURL(image)},visibleInViewport:function(){var hasParent=!!this.$el.parent().length;return this.$el.visible(true,false,undefined,1e3)&&hasParent},determineAndSetImageURL:function(){var image=this.model.image.toJSON();var urlToUse=image.thumbnail||image.url;if(this.model.project.isAppleWatchSized()){urlToUse=image.url}if(urlToUse&&urlToUse!==this.viewState.get("loadedImage")){preloadImage(urlToUse,_.bind(function(imageElement){this.viewState.set("loadedImage",imageElement.src)},this))}},setBackgroundImage:function(){var url=this.viewState.get("loadedImage");this.$(".thumbnail").css("background-image","url("+url+")");this.updateDimensions()},updateDimensions:function(){var ratio;if(this.model.project.isAppleWatchSized()){this.$el.addClass("apple-watch")}else if(this.model.project.isIPhoneSized()||this.model.project.isSmartphoneSized()){this.$el.addClass("iphone")}},loadLocalImage:function(){var image=this.model.image.toJSON();if(!image.url&&!image.thumbnail&&image.uploadedFile&&!this.viewState.get("loadedImage")){readLocalImage(image.uploadedFile,_.bind(function(result){image=_.extend(image,result);image.is_new=false;image.uploadedFile=null;this.model.project.setImageAtSequence(image,image.seq)},this))}},viewCount:0,getImageViewModel:function(){var imageViewModel=this.model.image.toJSON();var idOrUUID=this.model.image.get("id")||this.model.image.get("uuid");imageViewModel.name=imageViewModel.name.replace(/%(..)/g,"&#x$1;");imageViewModel.fullImageName=imageViewModel.name.replace(/%(..)/g,"&#x$1;");imageViewModel.links={editWeb:"/project/"+this.model.project.get("id")+"/screen/"+idOrUUID};if(this.model.project.commentsEnabled()&&!$.isEmptyObject(MARVELAPP.models.current_user)&&MARVELAPP.models.current_user.getAllowance(MARVELAPP.constants.allowance.ALLOWANCE_COMMENT)){imageViewModel.links.commentsWeb="/project/"+this.model.project.get("id")+"/screen/"+idOrUUID+"/comments"}return imageViewModel},render:function(){var imageViewModel=this.getImageViewModel();this.$el.html(this.tmpl({imageViewModel:imageViewModel}));this.$el.attr("id","duplicate_img_"+imageViewModel.id).attr("data",imageViewModel.id).attr("data-uuid",imageViewModel.uuid);this.determineAndSetImageURL();this.updateDimensions();return this},toggleSelect:function(e){var options={multipleSelect:e.shiftKey};if(this.selected()){this.deselect(options)}else{this.select(options)}},deselect:function(options){options=_.defaults(options||{},{multipleSelect:false,trigger:true});this.$el.removeClass("selected");this.$(".select").removeClass("selected");if(options.trigger){this.trigger("deselected",this.model.image.toJSON(),options.multipleSelect)}},select:function(options){options=_.defaults(options||{},{multipleSelect:false,trigger:true});this.$el.addClass("selected");this.$(".select").addClass("selected");if(options.trigger){this.trigger("selected",this.model.image.toJSON(),options.multipleSelect)}},selected:function(){return this.$el.hasClass("selected")},getImageUUID:function(){return this.model.image.get("uuid")}});MARVELAPP.ProjectThumbnailListView=Backbone.View.extend({tmpl:MARVELAPP.templates.THUMBNAIL_LIST,initialize:function(){if(!this.model){this.model={}}this.thumbnailViews={};this.viewState=new Backbone.Model;this.viewState.set("lastSelected",{});this.viewState.set("selectedImageUUIDs",[]);this.viewState.set("thumbMargin",14);this.viewState.set("thumbWidth",180);this.viewState.set("thumbWidthHeightRatio",projectConstants.DEFAULT_THUMBNAIL_HEIGHT_WIDTH_RATIO);this.listenTo(this.viewState,"change:thumbMargin",this.updateMargin);this.listenTo(this.viewState,"change:thumbWidth",this.updateEdge);this.pollThumbnailVisibility()},pollThumbnailVisibility:function(){var pollTime=250;if(_.size(this.thumbnailViews)===0){return setTimeout(_.bind(this.pollThumbnailVisibility,this),pollTime)}_.each(this.thumbnailViews,function(thumbnailView){if(thumbnailView){thumbnailView.updateVisibility()}},this);setTimeout(_.bind(this.pollThumbnailVisibility,this),pollTime)},setProjectModel:function(projectModel){if(this.model.project){this.stopListening(this.model.project)}this.model.project=projectModel||new MARVELAPP.ProjectModel;this.listenTo(this.model.project,"change:images",function(){var existingThumbnailViews=!!_.size(this.thumbnailViews);this.resetThumbnailViews();this.renderThumbnailViews({fadeImagesIn:!existingThumbnailViews});this.bindToThumbnailViews();this.updateWidthHeightRatio();if(this.model.project.numberOfImages()===0){this.$(".empty-state").removeClass("state-hidden")}});this.listenTo(this.model.project,"firstImageUpdated",this.updateWidthHeightRatio);this.listenTo(this.model.project,"change:properties:"+projectConstants.PROJECT_PROP_FRAME,this.updateWidthHeightRatio);this.listenTo(this.model.project,"change:properties:"+projectConstants.PROJECT_PROP_ORIENTATION,this.updateWidthHeightRatio);this.listenTo(this.model.project,"imageAdded",function(imageObject,sequenceNumber){var thumbnailView=this.insertSingleThumbnailView(imageObject,sequenceNumber);this.$(".thumbnail-list").show();this.bindToSingleThumbnailView(thumbnailView,sequenceNumber);this.$(".empty-state").addClass("state-hidden")});this.listenTo(this.model.project,"imageDeleted",function(image){var remainingThumbnailViews=[];_.each(this.thumbnailViews,_.bind(function(thumbnailView){if(thumbnailView){if(thumbnailView.getImageUUID()===image.uuid){thumbnailView.remove()}else{remainingThumbnailViews.push(thumbnailView)}}},this));this.thumbnailViews=remainingThumbnailViews});this.listenTo(this.model.project,"imageUpdated imageUpdated:hasUnreadComments",function(image){_.each(this.thumbnailViews,_.bind(function(thumbnailView){if(thumbnailView){if(thumbnailView.getImageUUID()===image.uuid){thumbnailView.setImageModel(image)}}},this));this.updateWidthHeightRatio()})},setModels:function(models){this.setProjectModel(models.project);this.resetThumbnailViews();this.renderThumbnailViews();this.bindToThumbnailViews();this.updateWidthHeightRatio()},render:function(){this.$el.html(this.tmpl());return this},updateWidthHeightRatio:function(){var thumbWidthHeightRatio;var frame=this.model.project.getPropertyForName(projectConstants.PROJECT_PROP_FRAME).value;if(typeof frame==="undefined"){var firstImageDimensions=this.model.project.firstImageDimensions();var firstImageWidth=firstImageDimensions.width;var firstImageHeight=firstImageDimensions.height;if(firstImageWidth===0||firstImageHeight===0){thumbWidthHeightRatio=projectConstants.DEFAULT_THUMBNAIL_HEIGHT_WIDTH_RATIO}else if(this.model.project.isIPhoneSized()||this.model.project.isSmartphoneSized()){thumbWidthHeightRatio=projectConstants.IPHONE_THUMBNAIL_HEIGHT_WIDTH_RATIO}else{thumbWidthHeightRatio=projectConstants.DEFAULT_THUMBNAIL_HEIGHT_WIDTH_RATIO}}else{if(this.model.project.isFramePortraitSmartphone()){thumbWidthHeightRatio=projectConstants.IPHONE_THUMBNAIL_HEIGHT_WIDTH_RATIO}else{thumbWidthHeightRatio=projectConstants.DEFAULT_THUMBNAIL_HEIGHT_WIDTH_RATIO}}this.setThumbWidthHeightRatio(thumbWidthHeightRatio)},updateMargin:function(){var thumbMargin=this.viewState.get("thumbMargin");if(thumbMargin>40){this.$(".thumbnail-list").css({marginRight:-thumbMargin})}else{this.$(".thumbnail-list").css({marginRight:0})}},updateEdge:function(){var thumbWidth=this.viewState.get("thumbWidth");var projectWidth=$(window).width()-80;var boxWidth=projectWidth/thumbWidth;var boxCount=Math.floor(boxWidth);_.each(this.thumbnailViews,function(thumbnailView,sequenceNumber){if(thumbnailView){thumbnailView.setEdgeOfList(parseInt(sequenceNumber,10)===parseInt(boxCount,10))}})},resetThumbnailViews:function(){_.each(this.thumbnailViews,_.bind(function(thumbnailView){this.stopListening(thumbnailView);if(thumbnailView){thumbnailView.remove()}},this));this.thumbnailViews={}},renderThumbnailViews:function(options){options=_.defaults(options||{},{fadeImagesIn:true});this.$(".thumbnail-list").html("");_.each(this.model.project.get("images"),_.bind(function(imageObject,sequenceNumber){this.insertSingleThumbnailView(imageObject,sequenceNumber,_.clone(options))},this));Backbone.trigger("projectThumbnailsRendered")},createSingleThumbnailView:function(imageObject,sequenceNumber,options){options=_.defaults(options||{},{fadeImagesIn:true,image:imageObject,project:this.model.project});var thumbnailView=new MARVELAPP.ProjectThumbnailView(options);thumbnailView.render();if(_.contains(this.viewState.get("selectedImageUUIDs"),imageObject.uuid)){thumbnailView.select()}thumbnailView.setWidth(this.viewState.get("thumbWidth"));thumbnailView.setWidthHeightRatio(this.viewState.get("thumbWidthHeightRatio"));thumbnailView.setMargin(this.viewState.get("thumbMargin"));this.thumbnailViews[sequenceNumber]=thumbnailView;return thumbnailView},insertSingleThumbnailView:function(imageObject,sequenceNumber,options){var thumbnailView=this.createSingleThumbnailView(imageObject,sequenceNumber,options);this.$(".thumbnail-list").append(thumbnailView.$el);return thumbnailView},bindToThumbnailViews:function(){_.each(this.thumbnailViews,_.bind(this.bindToSingleThumbnailView,this))},bindToSingleThumbnailView:function(thumbnailView,sequenceNumber){this.listenTo(thumbnailView,"selected",function(image,multipleSelect){if(this.viewState.get("lastSelected").sequenceNumber&&this.viewState.get("lastSelected").sequenceNumber!==sequenceNumber&&multipleSelect){this.selectThumbnailsBetween(this.viewState.get("lastSelected").sequenceNumber,sequenceNumber)}this.viewState.set("lastSelected",{sequenceNumber:sequenceNumber,image:image,multipleSelect:multipleSelect});this.trigger("thumbnailSelected",image,multipleSelect);this.updateSelectedThumbnails()});this.listenTo(thumbnailView,"deselected",function(image,multipleSelect){this.viewState.set("lastSelected",{sequenceNumber:sequenceNumber,image:image,multipleSelect:multipleSelect});this.trigger("thumbnailDeselected",image,multipleSelect);this.updateSelectedThumbnails()});this.listenTo(thumbnailView,"deleteSelected",function(image){this.trigger("deleteThumbnail",image)});this.listenTo(thumbnailView,"replaceFailedUpload",function(image){this.trigger("replaceFailedUpload",image)})},setThumbMargin:function(margin){this.viewState.set("thumbMargin",margin);_.each(this.thumbnailViews,_.bind(function(thumbnailView){if(thumbnailView){if(_.isFunction(thumbnailView.setMargin)){thumbnailView.setMargin(margin)}}},this))},setThumbWidth:function(width){this.viewState.set("thumbWidth",width);_.each(this.thumbnailViews,_.bind(function(thumbnailView){if(thumbnailView){if(_.isFunction(thumbnailView.setWidth)){thumbnailView.setWidth(width)}}},this))},setThumbWidthHeightRatio:function(ratio){this.viewState.set("thumbWidthHeightRatio",ratio);_.each(this.thumbnailViews,_.bind(function(thumbnailView){if(thumbnailView){if(_.isFunction(thumbnailView.setWidthHeightRatio)){thumbnailView.setWidthHeightRatio(ratio)}}},this))},selectThumbnailsBetween:function(startSequenceNumber,endSequenceNumber){startSequenceNumber=parseInt(startSequenceNumber,10);endSequenceNumber=parseInt(endSequenceNumber,10);var sequenceNumber=startSequenceNumber;if(!_.isNumber(sequenceNumber)||!_.isNumber(startSequenceNumber)||!_.isNumber(endSequenceNumber)){return}while(sequenceNumber!==endSequenceNumber){this.thumbnailViews[""+sequenceNumber+""].select({trigger:false});if(sequenceNumber<endSequenceNumber){sequenceNumber+=1}else{sequenceNumber-=1}}},selectAll:function(){_.each(this.thumbnailViews,function(thumbnailView){if(thumbnailView){thumbnailView.select()}})},deselectAll:function(){_.each(this.thumbnailViews,function(thumbnailView){if(thumbnailView){thumbnailView.deselect()}})},updateSelectedThumbnails:function(){this.viewState.set("selectedImageUUIDs",this.getSelectedImageUUIDs())},allSelected:function(){var selected=true;_.each(this.thumbnailViews,function(thumbnailView){if(thumbnailView){if(!thumbnailView.selected()){selected=false}}});if(Object.size(this.thumbnailViews)===0){selected=false}return selected},someSelected:function(){var someSelected=false;if(this.allSelected()){return someSelected}_.each(this.thumbnailViews,function(thumbnailView){if(thumbnailView){if(thumbnailView.selected()){someSelected=true}}});return someSelected},getSelectedImageUUIDs:function(){var selectedImageIds=[];_.each(this.thumbnailViews,function(thumbnailView){if(thumbnailView){if(thumbnailView.selected()){selectedImageIds.push(thumbnailView.getImageUUID())}}});return selectedImageIds},getSelectedImageIds:function(){var selectedImageIds=[];_.each(this.thumbnailViews,function(thumbnailView){if(thumbnailView){if(thumbnailView.selected()){selectedImageIds.push(thumbnailView.getImageId())}}});return selectedImageIds},getSelectedImages:function(){var selectedImages=[];_.each(this.thumbnailViews,function(thumbnailView){if(thumbnailView){if(thumbnailView.selected()){selectedImages.push(thumbnailView.getImage())}}});return selectedImages}});MARVELAPP.ProjectThumbnailListView=MARVELAPP.ProjectThumbnailListView.extend(MARVELAPP.IntelligentThumbnailReorderPartialView);MARVELAPP.AnnotationView=Backbone.View.extend({tmpl:MARVELAPP.templates.ANNOTATION,events:{"mouseover .annotation":"toggleCommentHighlight","mouseout .annotation":"toggleCommentHighlight","click .annotation":"clickAnnotation"},initialize:function(options){options=options||{};this.model=options;this.model.comment=options.comment||new MARVELAPP.CommentModel;this.listenTo(this.model.comment,"commentRemoved",this.removeView)},render:function(){if(this.model.attributes.pulse==undefined){this.model.attributes.pulse=true}this.$el.html(this.tmpl(this.model.attributes));return this},setModels:function(models){models=models||{};if(this.model){this.stopListening(this.model.comment)}this.model={comment:models.comment||new MARVELAPP.CommentModel};this.listenTo(this.model.comment,"commentRemoved",this.removeView)},removeView:function(){this.$(".annotation").removeClass("active");setTimeout(_.bind(function(){this.remove()},this),300)},hide:function(){},show:function(){},pulse:function(event){var $circle=$('<div class="annotation-notification"></div>');$circle.animate({width:"300px",height:"300px","margin-top":"-150px","margin-left":"-150px",opacity:"0"},{duration:500,easing:"easeInOutQuad"});$(".annotation."+this.model.attributes.commentUUID).append($circle);setTimeout(function __remove(){$circle.remove()},1e3)},toggleCommentHighlight:function(event){var uuid=event.currentTarget.dataset.commentUuid;var annotation=this.$(".annotation");if(!annotation.hasClass("highlighted")){annotation.addClass("highlighted");this.trigger("highlightComment",uuid)}else{annotation.removeClass("highlighted");this.trigger("unhighlightComment",uuid)}},clickAnnotation:function(event){var uuid=event.currentTarget.dataset.commentUuid;this.trigger("clickAnnotation",uuid)}});MARVELAPP.CommentView=Backbone.View.extend({events:{"click .remove-comment":"removeComment","click .remove-annotation":"removeAnnotationHandler","click .edit-comment":"toggleEditMode","click .cancel-edit":"toggleEditMode","click .save-edit":"saveEdit","mouseover .dropdown-container":"mouseoverDropdown","mouseout .dropdown-container":"mouseoutDropdown","click .annotation-reference":"triggerScrollToAnnotation","click .profile-redirect":"profileRedirect"},profileRedirect:function(event){if(this.model.get("marvel_user_fk")&&typeof this.model.get("marvel_user_fk").profile_uri==="undefined")return;Backbone.history.navigate(this.model.get("marvel_user_fk").profile_uri,{trigger:true})},initialize:function(options){options=options||{};this.model=options;this.commenter=null},mouseoverDropdown:function(){this.$(".dropdown-container").addClass("hovered")},mouseoutDropdown:function(){this.$(".dropdown-container").removeClass("hovered")},triggerScrollToAnnotation:function(){this.trigger("scrollToAnnotation",this.model.get("uuid"))},render:function(){this.tmpl=MARVELAPP.templates.COMMENT;if(this.model.isExplore()){this.tmpl=MARVELAPP.templates.EXPLORE_COMMENT}if(this.model.get("marvel_user_fk")&&this.model.get("marvel_user_fk").id==MARVELAPP.models.current_user.id){this.model.set("show_edit",true)}else if(this.model.get("commenter_fk")&&this.commenter&&this.model.get("commenter_fk").email==this.commenter.email){this.model.set("show_edit",true)}else{this.model.set("show_edit",false)}try{if(this.model.get("marvel_user_fk")&&this.model.get("marvel_user_fk").username){this.model.attributes.gravatar_data.letters=MARVELAPP.UserModel.usernameInitials(this.model.attributes.marvel_user_fk.username)}else{this.model.attributes.gravatar_data.letters=MARVELAPP.UserModel.usernameInitials(this.model.get("commenter_fk").username)}}catch(ex){this.model.attributes.gravatar_data.letters=""}this.$el.html(this.tmpl(this.model));var img=new Image;img.src=this.model.attributes.gravatar_data.url;img.onload=_.bind(function(){this.$(".background").removeClass("hidden")},this);this.makeURLs();return this},makeURLs:function(){var text=this.$(".message").text();var cleanHTML=MARVELAPP.utils.stylizeText(text);this.$(".message").html(cleanHTML)},removeComment:function(event){console.log("CommentView.removeComment");this.mouseoutDropdown();this.model.destroy({url:this.model.get("removal_uri"),success:_.bind(function(response){console.log("removeComment success:",response,this);this.$("li").addClass("destroy");this.$("li").css("margin-top",-this.$("li").outerHeight()/2);this.$("li").css("margin-bottom",-this.$("li").outerHeight()/2);setTimeout(_.bind(function(){this.removeView()},this),150)},this),error:function(response){console.log("removeComment error",response,this)}})},removeAnnotationHandler:function(event){this.mouseoutDropdown();this.model.set({annotation_x:null,annotation_y:null});$.ajax({url:"/api/comment/remove-annotation/"+this.model.get("id")+"/",method:"PUT",dataType:"json",success:_.bind(function(){this.model.trigger("removeAnnotation",this.model)},this),error:function(){}})},removeView:function(){this.$el.remove()},toggleEditMode:function(){this.mouseoutDropdown();var editable=this.$(".message").attr("contenteditable");var commentField=this.$(".message").get(0);var commentMouseTrap=new Mousetrap(commentField);this.$(".message").text(this.model.get("message"));this.$(".message").attr("contenteditable",!(editable=="true"));this.$(".message").toggleClass("editing-comment");setEndOfContenteditable(this.$(".message").get(0));this.$(".edit-buttons").toggleClass("hidden");if(editable=="false"){if(!this.model.isExplore()){if(this.$(".edit-buttons").offset().top>$(".comment-area").offset().top){$(".comments-list").scrollTop($(".comments-list").scrollTop()+$(".comment-uuid."+this.model.get("uuid")).height()+20)}}commentMouseTrap.bind(["ctrl+enter","command+enter"],_.bind(function(e){this.saveEdit()},this))}else{commentMouseTrap.unbind(["ctrl+enter","command+enter"]);this.makeURLs()}},saveEdit:function(){this.$(".save-edit").addClass("wait-state");this.$(".message").removeClass("error");var message=this.$(".message").text();if(message==""){this.$(".message").addClass("error");return}var access_code=null;if(this.commenter){access_code=this.commenter.access_code}this.model.set("message",message);this.model.save({message:message,access_code:access_code},{success:_.bind(function(model,response){this.$(".save-edit").removeClass("wait-state");this.toggleEditMode()},this),error:_.bind(function(model,response){this.$(".save-edit").removeClass("wait-state");this.$(".message").addClass("error")},this)})}});MARVELAPP.ExploreProfileView=Backbone.View.extend({tmpl:MARVELAPP.templates.EXPLORE_PROFILE,events:{"click #remove-avatar":"removeAvatar"},avatar_uri:"/api/content/upload/avatar/",dropzone_configured:false,initialize:function(options){options=options||{};this.model=options.model;this.listenTo(this.model,"change",this.render)},render:function(){if(typeof MARVELAPP.models.current_user.attributes!=="undefined"){this.model.attributes.is_self=MARVELAPP.models.current_user.get("id")===this.model.get("id")}else{this.model.attributes.is_self=false}var grav_data=this.model.get("gravatar_data");if(!grav_data.is_uploaded){var letters=MARVELAPP.UserModel.usernameInitials(this.model.get("username"));if(!letters){letters=this.model.get("handle").charAt(0)}this.model.attributes.gravatar_data.letters=letters}this.$el.html(this.tmpl(this.model.attributes));if(MARVELAPP.models.current_user.id){this.$("#avatar-background").removeClass("logged-out-avatar")}else{this.$("#avatar-background").addClass("logged-out-avatar");this.$el.append(MARVELAPP.templates.SITE_START_PROTOTYPING())}if(this.model.get("published_projects").length>0){this.renderTiles()}setTimeout(_.bind(function(){if(this.model.get("is_self")){try{this.configure_dropzone()}catch(exception){console.log(exception)}this.$("#remove-avatar").removeClass("hidden")}},this),0);var avatarImage=new Image;avatarImage.src=this.model.attributes.gravatar_data.url;avatarImage.onload=_.bind(function(){this.$(".avatar .background").removeClass("hidden")},this);return this},renderTiles:function(){var projects=this.model.get("published_projects");_.each(projects,_.bind(function(project){var view=new MARVELAPP.ExploreTileView({model:new MARVELAPP.ExploreModel(project)});this.$(".tiles").append(view.render(false).$el)},this));this.showProjects()},showProjects:function(){this.$("#empty-state").addClass("hidden");this.$("#explore-projects").removeClass("hidden")},configure_dropzone:function(){var userController=new MARVELAPP.UserController;this.file_upload=userController.avatarUpload("#choose-avatar",{success:_.bind(function(file,response){this.model.fetch();MARVELAPP.models.current_user.fetch()},this)});this.dropzone_configured=true},removeAvatar:function(){var userController=new MARVELAPP.UserController;userController.removeAvatar({success:_.bind(function(){this.model.fetch();MARVELAPP.models.current_user.fetch();this.$("#remove-avatar").addClass("hidden")},this)})}});MARVELAPP.ExploreTileView=Backbone.View.extend({events:{"click .like":"likeButtonClicked","click .view-item":"gotoExploreView"},initialize:function(){this.listenTo(this.model,"visibleLikeCountChanged",function(count){this.$(".likes span").html(count)});this.listenTo(this.model,"change:comment_count",function(){console.log("comment count changed");this.$(".comments span").html(this.model.get("comment_count"))});this.listenTo(this.model,"change:has_liked",function(){if(this.model.get("has_liked")){this.$(".likes").addClass("liked liking")}else{this.$(".likes").removeClass("liked liking")}})},render:function(showAvatar){if(showAvatar==undefined)showAvatar=true;var attributes=this.model.toJSON();attributes.showAvatar=showAvatar;attributes.frame=this.model.getPropertyForName(projectConstants.PROJECT_PROP_FRAME).value;attributes.colour=this.model.getPropertyForName(projectConstants.PROJECT_PROP_EXPLORE_BACKGROUND_HEX).value;attributes.frameColour=this.model.getPropertyForName(projectConstants.PROJECT_PROP_FRAME_COLOUR).value;attributes.landscape=this.model.getPropertyForName(projectConstants.PROJECT_PROP_ORIENTATION).value;if(attributes.landscape=="landscape"){attributes.landscape=true}else{attributes.landscape=false}if(this.model.get("user").username.indexOf("@")>-1){var letters=this.model.get("user").username.split("@");var firstLetter=letters[0].charAt(0);var secondLetter=letters[1].charAt(0);attributes.letters=firstLetter+secondLetter}else{attributes.letters=MARVELAPP.UserModel.usernameInitials(this.model.get("user").username)}this.$el=$(MARVELAPP.templates.SITE_GLOBAL_EXPLORE_TILE(attributes));this.delegateEvents();var img=new Image;img.src=attributes.initial_image_url;img.onload=_.bind(function(){this.$el.find(".publish-preview .background").removeClass("hidden")},this);var avatarImage=new Image;avatarImage.src=attributes.user.gravatar_data.url;avatarImage.onload=_.bind(function(){this.$el.find(".avatar .background").removeClass("hidden")},this);return this},likeButtonClicked:function(){if(typeof MARVELAPP.models.current_user.get("username")==="undefined"){MARVELAPP.GlobalFooterView._doNotRedirectOnAuth=true;MARVELAPP.GlobalFooterView.once("authenticated",_.bind(function(){this.model.addLike(function(){window.location.reload()})},this));startPrototyping()}else{if(this.model.get("has_liked")){this.model.removeLike()}else{this.model.addLike()}}},gotoExploreView:function(event){Backbone.history.navigate(this.model.get("slug"),{trigger:true});event.preventDefault()}});(function(Tourist){if(!Tourist){return}var hasProp={}.hasOwnProperty;var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child};Tourist.Tour.MarvelTour=function(_super){extend(MarvelTour,_super);function MarvelTour(){return MarvelTour.__super__.constructor.apply(this,arguments)}MarvelTour.prototype.showStep=function(stepIndex){return this._showStep(this.options.steps[stepIndex],stepIndex)};MarvelTour.prototype.showFurthestStepReached=function(steps){if(!_.isArray(steps)){steps=[steps]}for(var i=0;i<steps.length;i+=1){if(this.options.furthestStep===steps[i]){return MarvelTour.__super__._showStep.call(this,this.options.steps[this.options.furthestStep],this.options.furthestStep)}}return};MarvelTour.prototype._showStep=function(step,index){if(!this.options){this.options={}}if(!this.options.furthestStep||index>this.options.furthestStep){this.options.furthestStep=index}return MarvelTour.__super__._showStep.call(this,step,index)};return MarvelTour}(Tourist.Tour);Tourist.Tip.MarvelTourTip=function(_super){extend(MarvelTourTip,_super);function MarvelTourTip(){return MarvelTourTip.__super__.constructor.apply(this,arguments)}MarvelTourTip.prototype.template=MARVELAPP.templates.TOURIST_CONTAINER;MarvelTourTip.prototype.skipButtonTemplate='<button class="btn pull-right tour-next">Skip</button>';MarvelTourTip.prototype.nextButtonTemplate='<button class="btn pull-right tour-next">Next</button>';MarvelTourTip.prototype.okButtonTemplate='<button class="btn btn-sm pull-right tour-hide btn-primary">OK</button>';MarvelTourTip.prototype.finalButtonTemplate='<button class="btn pull-right tour-next">Finish up</button>';MarvelTourTip.prototype.closeButtonTemplate='<a class="btn pull-left tour-close" href="#">Exit tour</a>';MarvelTourTip.prototype.initialize=function(options){var defs;defs={showEffect:null,hideEffect:null};this.options=_.extend(defs,options);return this.tip=new Tourist.Tip.MarvelTourTipView(this.options)};MarvelTourTip.prototype.destroy=function(){this.tip.destroy();return MarvelTourTip.__super__.destroy.call(this)};MarvelTourTip.prototype.show=function(){var fn;if(this.options.showEffect){fn=Tourist.Tip.MarvelTourTip.effects[this.options.showEffect];return fn.call(this,this.tip,this.tip.el)}else{return this.tip.show()}};MarvelTourTip.prototype.hide=function(){var fn;if(this.options.hideEffect){fn=Tourist.Tip.MarvelTourTip.effects[this.options.hideEffect];return fn.call(this,this.tip,this.tip.el)}else{return this.tip.hide()}};MarvelTourTip.prototype._buildContentElement=function(step){var buttons,content;buttons=this._buildButtons(step);content=$($.parseHTML(this.template({content:step.content,buttons:buttons,close_button:this._buildCloseButton(step),counter:step.final?"":step.index+1+"/"+step.total,counter_class:step.final?"final":""})));if(!buttons){content.find(".tour-buttons").addClass("no-buttons")}this._renderActionLabels(content);return content};MarvelTourTip.prototype._bindClickEvents=function(){var el=MarvelTourTip.__super__._bindClickEvents.call(this);return el.delegate(".tour-hide","click",_.bind(this.hide,this))};MarvelTourTip.prototype._getTipElement=function(){return this.tip.el};MarvelTourTip.prototype._setTarget=function(target,step){MarvelTourTip.__super__._setTarget.call(this,target,step);return this.tip.setTarget(target)};MarvelTourTip.prototype._renderContent=function(step,contentElement){var attachPosition,arrowPosition;arrowPosition=step.arrowPosition||"center left";attachPosition=step.attachPosition||"center right";this.tip.setContainer(step.container||$("body"));this.tip.setContent(contentElement);return this.tip.setPosition(step.target||false,arrowPosition,attachPosition)};return MarvelTourTip}(Tourist.Tip.Base);Tourist.Tip.MarvelTourTip.effects={slidein:function(tip,element){var OFFSETS,css,easing,easings,offset,side,value,_i,_len;OFFSETS={top:80,left:80,right:-80,bottom:-80};side=tip.arrowPosition.split(" ")[0];side=side||"top";offset=OFFSETS[side];if(side==="bottom"){side="top"}if(side==="right"){side="left"}value=parseInt(element.css(side));element.stop();css={};css[side]=value+offset;element.css(css);element.show();css[side]=value;easings=["easeOutCubic","swing","linear"];for(_i=0,_len=easings.length;_i<_len;_i++){easing=easings[_i];if($.easing[easing]){break}}element.animate(css,300,easing);return null}};Tourist.Tip.MarvelTourTipView=function(){MarvelTourTipView.prototype.template='<div class="tourist-popover">\n  <div class="arrow"></div>\n  <div class="popover-content"></div>\n</div>';
MarvelTourTipView.prototype.FLIP_POSITION={bottom:"top",top:"bottom",left:"right",right:"left"};function MarvelTourTipView(options){var defs;defs={offset:10,tipOffset:10};this.options=_.extend(defs,options);this.el=$($.parseHTML(this.template));this.hide()}MarvelTourTipView.prototype.destroy=function(){return this.el.remove()};MarvelTourTipView.prototype.show=function(){return this.el.show().addClass("visible")};MarvelTourTipView.prototype.hide=function(){return this.el.hide().removeClass("visible")};MarvelTourTipView.prototype.setTarget=function(target){this.target=target;return this._setPosition(this.target,this.arrowPosition,this.attachPosition)};MarvelTourTipView.prototype.setPosition=function(target,arrowPosition,attachPosition){this.target=target;this.arrowPosition=arrowPosition;this.attachPosition=attachPosition;return this._setPosition(this.target,this.arrowPosition,this.attachPosition)};MarvelTourTipView.prototype.setContainer=function(container){return container.append(this.el)};MarvelTourTipView.prototype.setContent=function(content){return this._getContentElement().html(content)};MarvelTourTipView.prototype._getContentElement=function(){return this.el.find(".popover-content")};MarvelTourTipView.prototype._getTipElement=function(){return this.el.find(".arrow")};MarvelTourTipView.prototype._setPosition=function(target,arrowPosition,attachPosition){var clas,css,originalDisplay,position,shift,targetPosition,tip,tipOffset,tipPosition,arrowPositionClasses;if(arrowPosition==null){arrowPosition="left center"}if(attachPosition==null){attachPosition="right center"}if(!target){return}arrowPositionClasses=arrowPosition.split(" "),clas=arrowPositionClasses[0],shift=arrowPositionClasses[1];originalDisplay=this.el.css("display");this.el.css({top:0,left:0,margin:0,display:"block"});this.el.removeClass("top").removeClass("bottom").removeClass("left").removeClass("right").removeClass("center").removeClass("middle").addClass(arrowPositionClasses[0]).addClass(arrowPositionClasses[1]);if(!target){return}tip=this._getTipElement().css({left:"",right:"",top:"",bottom:""});if(shift!=="center"){tipOffset={left:tip[0].offsetWidth/2,right:0,top:tip[0].offsetHeight/2,bottom:0};css={};css[shift]=tipOffset[shift]+this.options.tipOffset;css[this.FLIP_POSITION[shift]]="auto";tip.css(css)}targetPosition=this._caculateTargetPosition(attachPosition,target);tipPosition=this._caculateTipPosition(arrowPosition,targetPosition);this.el.css(tipPosition);return this.el.css({display:originalDisplay})};MarvelTourTipView.prototype._caculateTargetPosition=function(atPosition,target){var bounds,pos;if(Object.prototype.toString.call(target)==="[object Array]"){return{left:target[0],top:target[1]}}bounds=this._getTargetBounds(target);pos=this._lookupPosition(atPosition,bounds.width,bounds.height);return{left:bounds.left+pos[0],top:bounds.top+pos[1]}};MarvelTourTipView.prototype._caculateTipPosition=function(myPosition,targetPosition){var height,pos,width;width=this.el[0].offsetWidth;height=this.el[0].offsetHeight;pos=this._lookupPosition(myPosition,width,height);return{left:targetPosition.left-pos[0],top:targetPosition.top-pos[1]}};MarvelTourTipView.prototype._adjustForArrow=function(myPosition,tipPosition){var clas,height,position,shift,tip,width,_ref2;_ref2=myPosition.split(" "),clas=_ref2[0],shift=_ref2[1];tip=this._getTipElement();width=tip[0].offsetWidth;height=tip[0].offsetHeight;position={top:tipPosition.top,left:tipPosition.left};switch(clas){case"top":position.top+=height+this.options.offset;break;case"bottom":position.top-=height+this.options.offset;break;case"left":position.left+=width+this.options.offset;break;case"right":position.left-=width+this.options.offset}switch(shift){case"left":position.left-=width/2+this.options.tipOffset;break;case"right":position.left+=width/2+this.options.tipOffset;break;case"top":position.top-=height/2+this.options.tipOffset;break;case"bottom":position.top+=height/2+this.options.tipOffset}return position};MarvelTourTipView.prototype._lookupDimension=function(dimension,width,height){var halfHeight,halfWidth;halfWidth=width/2;halfHeight=height/2;var pixelSplit=dimension.split("px");var percentageSplit=dimension.split("%");var dimLookup={top:0,left:0,right:width,bottom:height,center:halfWidth,middle:halfHeight};if(pixelSplit.length>1){return parseFloat(pixelSplit[0])}else if(percentageSplit.length>1){return parseFloat(percentageSplit[0])}return dimLookup[dimension]};MarvelTourTipView.prototype._lookupPosition=function(position,width,height){var halfHeight,posLookup,halfWidth,dims,lookedUpPosition;halfWidth=width/2;halfHeight=height/2;posLookup={"top left":[0,0],"left top":[0,0],"top right":[width,0],"right top":[width,0],"bottom left":[0,height],"left bottom":[0,height],"bottom right":[width,height],"right bottom":[width,height],"top center":[halfWidth,0],"left center":[0,halfHeight],"right center":[width,halfHeight],"center right":[width,halfHeight],"bottom center":[halfWidth,height]};dims=position.split(" ");lookedUpPosition=posLookup[position];if(!lookedUpPosition){lookedUpPosition=[this._lookupDimension(dims[0],width,height),this._lookupDimension(dims[1],width,height)]}return lookedUpPosition};MarvelTourTipView.prototype._getTargetBounds=function(target){var el,size;el=target[0];if(typeof el.getBoundingClientRect==="function"){size=el.getBoundingClientRect()}else{size={width:el.offsetWidth,height:el.offsetHeight}}return $.extend({},size,target.offset())};return MarvelTourTipView}()})(window.Tourist);var ProjectViewLogger=Logger.get("ProjectNotFoundView");MARVELAPP.NotFoundView=Backbone.View.extend({tmpl:MARVELAPP.templates.NOT_FOUND,events:{},initialize:function(options){this.attributes=options||{}},render:function(){this.$el.html(this.tmpl(this.attributes));return this}});var ProjectEditorAnnotationsViewLogger=Logger.get("PEditorAnnotationsView");MARVELAPP.ProjectEditorAnnotationsView=Backbone.View.extend({tmpl:MARVELAPP.templates.EDITOR_ANNOTATIONS_SIDEBAR,className:"annotations-inner",events:{"keydown textarea":"keydownTextarea","focus #comment-text":"openComment","click .cancel":"closeComment","click .make-annotation":"makeAnnotationHandler","click .enable-comments":"handleEnableCommentsButtonClick","click #post-comment":"postComment","click .current-annotation .remove-annotation":"removeCurrentAnnotation","mouseover li":"handleCommentHover","mouseout li":"handleCommentHover","click .close":"triggerClose"},initialize:function(options){this.viewState=new Backbone.Model;this.annotationViews={};this.viewState.set("shown",false);this.viewState.set("creatingAnnotation",false);this.viewState.set("showUpgradeRequired",false);this.listenTo(this.collection.comments,"add",this.renderSingleComment,this);this.listenTo(this.collection.comments,"remove",this.removeSingleComment,this);this.listenTo(this.viewState,"change:highlightedComment",this.highlightComment);this.listenTo(this.viewState,"change:showUpgradeRequired",this.showUpgradeRequired);this.listenTo(this.viewState,"change:selectedImage",this.clearAnnotations);this.listenTo(this.collection.comments,"request",this.updateLoadingState);this.listenTo(this.collection.comments,"sync",this.updateCommentListState);this.listenTo(this.collection.comments,"reset",this.emptyCommentsList);this.listenTo(this.collection.comments,"add remove sync reset",this.updateCommentEnabledVisibility);this.listenTo(this.collection.comments,"add remove sync reset",this.markReadCommentsIfOpen);this.commentType=options.commentType;this.functionMap={};this.functionMap[MARVELAPP.constants.comment_types.PLAY]={renderAnnotation:_.bind(this.renderScreenAnnotation,this),makeAnnotation:_.bind(this.makeScreenAnnotation,this),scrollToAnnotation:_.bind(this.scrollToScreenAnnotation,this)};this.functionMap[MARVELAPP.constants.comment_types.EDIT]={renderAnnotation:_.bind(this.renderAnnotation,this),makeAnnotation:_.bind(this.makeAnnotation,this),scrollToAnnotation:_.bind(this.scrollToAnnotation,this)};this.canComment=true;this.annotationX=0;this.annotationY=0;this.newCommentModel=new MARVELAPP.CommentModel;this.currentAnnotationView=undefined;this.commenter=undefined},delegateEvents:function(){Mousetrap.unbind(["ctrl+enter","command+enter"]);Mousetrap.bind(["ctrl+enter","command+enter"],_.bind(function(e){if(e.target===this.$("#comment-text")[0]){e.preventDefault();this.$("#comment-text").attr("disabled","disabled");this.postComment()}},this));return Backbone.View.prototype.delegateEvents.apply(this,arguments)},undelegateEvents:function(){return Backbone.View.prototype.undelegateEvents.apply(this,arguments)},render:function(){this.$el.html(this.tmpl());var opts={lines:11,length:8,width:2,radius:8,corners:1,rotate:0,direction:1,color:"#000",speed:1,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2e9,top:"50%",left:"50%"};new Spinner(opts).spin(this.$(".wait")[0]);return this},setModels:function(models){ProjectEditorAnnotationsViewLogger.debug("setModels ProjectEditorAnnotationsView");models=models||{};if(this.model){if(this.model.project instanceof MARVELAPP.ProjectModel){this.stopListening(this.model.project)}if(this.model.user instanceof MARVELAPP.UserModel){this.stopListening(this.model.user)}}this.model={project:models.project||new MARVELAPP.ProjectModel,user:models.user||new MARVELAPP.UserModel};this.updateCommentEnabledVisibility();this.listenTo(this.model.project,"readComments",this.markReadComments);this.listenTo(this.model.project,"changing:properties:"+projectConstants.PROJECT_PROP_COMMENTS_ENABLED,this.showCommentEnabledWaitState);this.listenTo(this.model.project,"change:properties:"+projectConstants.PROJECT_PROP_COMMENTS_ENABLED,this.updateCommentEnabledVisibility);this.viewState.set("highlightedComment",undefined)},setUserAsAuthed:function(success_cb){var user=new MARVELAPP.UserModel;user.fetch_user(false);MARVELAPP.models.current_user=user;this.setModels({project:this.model.project,user:user});success_cb()},highlightComment:function(){var highlightedCommentUUID=this.collection.comments.findWhere({id:parseInt(this.viewState.get("highlightedComment"))});if(!highlightedCommentUUID)return;highlightedCommentUUID=highlightedCommentUUID.get("uuid");if(highlightedCommentUUID){this.$("[data-uuid="+highlightedCommentUUID+"]").addClass("highlighted");setTimeout(_.bind(function(){this.scrollToComment(highlightedCommentUUID)},this),100)}else{this.$(".highlighted").removeClass("highlighted")}},emptyCommentsList:function(){this.$(".comments-list").empty()},markReadCommentsIfOpen:function(){if(this.viewState.get("shown")){this.markReadComments()}},markReadComments:function(){var image=this.viewState.get("selectedImage");var projectImage=this.model.project.getImageForId(image.id);if(this.viewState.get("shown")&&projectImage&&projectImage.hasUnreadComments){this.model.project.markCommentsRead(image.id)}},handleEnableCommentsButtonClick:function(){this.trigger("commentsEnabled");Intercom("trackEvent","enabled-comment")},showWithImage:function(image){this.setSelectedImage(image)},updateCommentListState:function(){if(this.collection.comments.length===0){this.$("#no-comments").removeClass("hidden state-hidden")}else{this.$("#no-comments").addClass("hidden")}var elements=this.$(".comment-uuid");_.each(elements,_.bind(function(element){var uuid=element.dataset.uuid;var model=_.findWhere(this.collection.comments.models,{id:uuid});if(typeof model==="undefined"){ProjectEditorAnnotationsViewLogger.debug("Remove comment for uuid:",uuid);element.remove()}},this));this.highlightComment();setTimeout(_.bind(function(){if(this.$(".comments-list")[0]){if(this.$(".comments-list").scrollTop()!==Math.abs(this.$(".comments-list").innerHeight()-this.$(".comments-list")[0].scrollHeight)){return}}this.scrollToLatestComment()},this),100)},renderSingleComment:function(model,collection,options){ProjectEditorAnnotationsViewLogger.debug("renderSingleComment",model,collection);if(model.hasAnnotation()){this.listenToOnce(model,"removeAnnotation",_.bind(this.removeAnnotation,this));if(model.attributes.annotation_reference<1||typeof model.attributes.annotation_reference==="undefined"){model.attributes.annotation_reference=this.getAnnotationReference()}var annotationModel=new MARVELAPP.AnnotationModel({x:model.attributes.annotation_x,y:model.attributes.annotation_y,commentUUID:model.attributes.uuid,reference:model.attributes.annotation_reference});annotationModel.setModels({comment:model});this.functionMap[this.commentType].renderAnnotation(annotationModel);this.trigger("commentPosted")}var commentView=new MARVELAPP.CommentView(model);commentView.commenter=this.commenter;this.listenTo(commentView,"scrollToAnnotation",_.bind(this.scrollToAnnotationHandler,this));if(!this.$("#no-comments").hasClass("hidden")){this.$("#no-comments").addClass("hidden")}this.$(".comments-list").append(commentView.render().$el);this.trigger("commentRendered")},scrollToAnnotationHandler:function(uuid){this.functionMap[this.commentType].scrollToAnnotation(uuid)},scrollToAnnotation:function(uuid){var scrollPos=$(".annotation."+uuid).position().top+$("#screen-container").offset().top;scrollPos=scrollPos+$(".editor-inner").scrollTop()-$(window).height()/2;var annotationView=this.getAnnotationView(uuid);annotationView.pulse();$(".editor-inner").scrollTop(scrollPos)},scrollToScreenAnnotation:function(uuid){prototype.currentScreenView.scrollToAnnotation(uuid)},getAnnotationReference:function(){var max_ref=_.max(this.collection.comments.models,function(comment){return comment.get("annotation_reference")});if(max_ref<1){return 1}return max_ref.get("annotation_reference")+1},updateCommentEnabledVisibility:function(){ProjectEditorAnnotationsViewLogger.debug("updateCommentEnabledVisibility");this.$(".enable-comments").removeClass("wait-state").removeAttr("disabled");this.$(".wait").addClass("hidden");if(!this.model){return this}if(this.model.project.commentsEnabled()){this.$("#enable-comments").addClass("state-hidden");this.$(".comments-list, .comment-area").removeClass("state-hidden").removeClass("hidden");if(this.collection.comments.length===0){this.$("#no-comments").removeClass("state-hidden").removeClass("hidden")}}else if(this.viewState.get("showUpgradeRequired")===true){this.showUpgradeRequired()}else{this.$("#enable-comments").removeClass("state-hidden").removeClass("hidden");this.$("#no-comments, .comments-list, .comment-area").addClass("state-hidden")}return this},showUpgradeRequired:function(){ProjectEditorAnnotationsViewLogger.debug("showUpgradeRequired");this.$("#enable-comments").addClass("state-hidden");this.$("#upgrade-pro").removeClass("state-hidden");this.$("#no-comments, .comments-list, .comment-area").addClass("state-hidden")},updateLoadingState:function(){if(this.collection.comments.length>0){return}this.$("#no-comments, .comments-list, .comment-area").addClass("state-hidden");this.$(".wait").removeClass("hidden")},showCommentEnabledWaitState:function(){this.$(".enable-comments").addClass("wait-state").attr("disabled",true);return this},setSelectedImage:function(image){this.viewState.set("selectedImage",image);return this},setImageFromSequenceNumber:function(sequenceNumber){var image=this.model.project.get("images")[sequenceNumber];this.setSelectedImage(image)},add_comment:function(comment_data){ProjectEditorAnnotationsViewLogger.debug("add_comment:",comment_data,this.newCommentModel);if(!this.canComment){return}this.canComment=false;var commentModel=this.newCommentModel.set(comment_data);this.collection.comments.create(commentModel,{success:_.bind(function(comment,response,responseJSON){var annotationView,ref;ProjectEditorAnnotationsViewLogger.debug("add_comment.success:",response);this.$(".current-annotation").attr("data-uuid","");if(comment.hasAnnotation()){ref=responseJSON.annotation_reference;if(this.currentAnnotationView){this.currentAnnotationView.model.set("reference",ref);this.currentAnnotationView.$(".annotation").text(ref)}else{annotationView=this.getAnnotationView(comment.get("uuid"));annotationView.model.set("reference",ref);annotationView.$(".annotation").text(ref);annotationView.render();annotationView.$(".annotation").addClass("active")}comment.set("reference",ref);this.$("."+comment.get("uuid")+" .annotation-reference").html(ref)}this.$("#post-comment").removeClass("wait-state");this.$("#comment-text").val("").blur();this.canComment=true;this.closeComment();this.$(".make-annotation").removeClass("hidden");this.$(".current-annotation").removeClass().addClass("current-annotation");this.currentAnnotationView=undefined;this.$("#comment-text").prop("disabled",false)},this,commentModel),error:_.bind(function(comment,response){ProjectEditorAnnotationsViewLogger.debug("add_comment.error:",response);this.$("#post-comment").removeClass("wait-state");this.$(".comment-area").addClass("error");this.canComment=true;this.collection.comments.remove(comment);this.$("li[data-uuid="+comment.get("uuid")+"]").remove();this.$("#comment-text").prop("disabled",false)},this,commentModel)});this.newCommentModel=new MARVELAPP.CommentModel},postComment:function(){"use strict";var project_uuid=MARVELAPP.models.current_project.attributes.uuid;var commenter_data=$.cookie("commenterData");if(commenter_data)this.commenter=JSON.parse(commenter_data);var isAuthed=typeof this.model.user.attributes!=="undefined"||typeof this.commenter!=="undefined";if(!isAuthed){ProjectEditorAnnotationsViewLogger.debug("User not signed in");this.toggleCommenterSignupModal();$("#comment-button").off();$("#comment-button").on("click",_.bind(function(event){var data={email:$("#signin-email").val(),name:$("#signin-name").val(),project_uuid:project_uuid};$.ajax({data:JSON.stringify(data),headers:{"X-CSRFToken":csrftoken},type:"POST",contentType:"application/json",url:"api/commenter/",success:_.bind(function(response){this.toggleCommenterSignupModal();this.commenter=response;prototype.access_code=response.access_code;$.cookie("commenterData",JSON.stringify(response),{expires:7});this.postComment()},this),error:_.bind(function(response){ProjectEditorAnnotationsViewLogger.debug("error",response);$(".email").addClass("error");$(".name").addClass("error");if(response.status==403){$(".email .error").html("<span>This email belongs to a existing Marvel User. Please sign in.</span>")}else if(response.status==400){var message=response.responseJSON["result"];$(".email .error").html("<span>"+message+"</span>")}},this)})},this));$("#login-button").off();$("#login-button").on("click",_.bind(function(event){event.preventDefault();$("#login-button").parent().addClass("wait-state");var data={email:$("input[name=signin-email]").val(),password:$("input[name=signin-password]").val()};$.ajax({data:data,headers:{"X-CSRFToken":csrftoken},type:"POST",dataType:"json",url:"api/login/",success:_.bind(function(){window.csrftoken=$.cookie("csrftoken");$("#login-button").parent().removeClass("wait-state");this.toggleCommenterSigninModal();this.setUserAsAuthed(_.bind(this.postComment,this))},this),error:_.bind(function(xhr,status,error){if(xhr.status>=500){var msg="Server on the fritz, please try again in a little bit. Sorry!";$("#resume-prototyping .password .error").html("<span>"+msg+"</span>");return}$("#login-button").parent().removeClass("wait-state");$(".field.email").addClass("error");$(".field.password").addClass("error");$(".field.password input").focus();$(".field.password .error").html("<span>Invalid combination. Have another go.</span>")},this)})},this));return false}var image=this.viewState.get("selectedImage");$(".comment-area").removeClass("error");$("#post-comment").addClass("wait-state");var message=$("#comment-text").val();if(typeof message==="undefined"||message.trim()===""){$(".comment-area").addClass("error");$("#post-comment").removeClass("wait-state");return}var comment_data={message:message,project_uuid:project_uuid,content_fk:image.id,type:this.commentType,uuid:this.newCommentModel.get("uuid")||generateUUID(),unread:false,show_delete:true};if(typeof this.model.user.attributes!=="undefined"){comment_data.marvel_user_fk={username:this.model.user.get("username"),id:this.model.user.get("id")};comment_data.gravatar_data=this.model.user.attributes.gravatar_data}else if(typeof this.commenter!=="undefined"){comment_data.access_code=this.commenter.access_code;comment_data.commenter_fk={username:this.commenter.username,email:this.commenter.email,id:this.commenter.id};comment_data.gravatar_data=getGravatar(this.commenter.email,this.commenter.id);comment_data.show_delete=false}else{Raven.captureMessage("A user has managed to post a comment when not authed as a User or a Commenter. Oh dear.",{extra:{user:this.model.user,cookie_data:commenterData}})}this.add_comment(comment_data);var scrollHeight=$("#annotations-sidebar ul")[0].scrollHeight;$("#annotations-sidebar ul").scrollTop(scrollHeight)},toggleCommenterSignupModal:function(){var modal=$("#comment-signup");var overlay=$(".white-overlay");if(modal.hasClass("activated")){modal.removeClass("activated");overlay.removeClass("activated")}else{modal.addClass("activated");overlay.addClass("activated")}},toggleCommenterSigninModal:function(){var modal=$("#resume-prototyping");var overlay=$(".white-overlay");if(modal.hasClass("activated")){modal.removeClass("activated");overlay.removeClass("activated")}else{modal.addClass("activated");overlay.addClass("activated")}},removeSingleComment:function(model,collection,options){model.trigger("commentRemoved");if(this.collection.comments.length===0){this.$("#no-comments").removeClass("hidden").removeClass("state-hidden")}},openComment:function(event){var scrollHeight=$("#annotations-sidebar ul")[0].scrollHeight;$("#annotations-sidebar").addClass("focused");$("#annotations-sidebar ul").scrollTop(scrollHeight)},closeComment:function(event){$("#annotations-sidebar").removeClass("focused")},showAnnotations:function(){if(this.model.project.commentsEnabled()){$(".annotation").addClass("active")}},hideAnnotations:function(){$(".annotation").removeClass("active")},makeAnnotationHandler:function(e){this.trigger("annotationPickerOpening");e.preventDefault();this.currentAnnotationView=undefined;this.functionMap[this.commentType].makeAnnotation()},handleMouseMove:function(e){var left=0;if(e.clientX>$("#screen-holder").offset().left&&e.clientX<$("#screen-holder").offset().left+$("#screen-holder").width()){left=e.clientX-$("#screen-holder").offset().left}else{if(e.clientX<$("#screen-holder").offset().left)left=0;if(e.clientX>$("#screen-holder").offset().left+$("#screen-holder").width())left=$("#screen-holder").width()}var top=e.clientY-Math.abs($(".editor-inner").scrollTop()-Math.abs($("#screen-holder").offset().top))+$(".editor-inner").scrollTop();if(top<0)top=0;if(top>$("#screen-holder").height())top=$("#screen-holder").height();this.annotationX=Math.round(left/getActualZoom());this.annotationY=Math.round(top/getActualZoom())},makeAnnotation:function(){$("#annotations-sidebar").removeClass("activated");$(".draggable, .draggable2").hide();$(".hotspot-selector, .jcrop-tracker, .hotspot_selector").hide();pauseJCrop();$("#top").addClass("annotationMode top-hidden dark");$("#editor").addClass("editor-anchor");$("#screen-holder").addClass("annotation-mode");$(".screen-hint").addClass("hint-bold");$(".screen-hint").html("Click anywhere on the image to add your annotation");$("#editor").on("mousemove.annotationPlacement",_.bind(this.handleMouseMove,this));$("#screen-holder").bind("click",_.bind(function(e){this.trigger("annotationPickerClosing");this.newCommentModel=new MARVELAPP.CommentModel({annotation_x:this.annotationX,annotation_y:this.annotationY,uuid:generateUUID(),reference:this.getAnnotationReference()});this.handleAnnotation(this.newCommentModel);this.annotationX=0;this.annotationY=0;this.trigger("annotationPickerClosed")},this));this.viewState.set("creatingAnnotation",true)},getAnnotationActive:function(){return this.viewState.get("creatingAnnotation")},makeScreenAnnotation:function(){var next_reference=this.getAnnotationReference();prototype.currentScreenView.addAnnotationMode(next_reference)},stopMakingAnnotation:function(){$("#annotations-sidebar").addClass("activated");$("#screen-holder").removeClass("annotation-mode");$("#editor").removeClass("editor-anchor");$("#editor").off("mousemove.annotationPlacement");$("#screen-holder").unbind("click");$("#top").removeClass("annotationMode top-hidden dark");$(".draggable, .draggable2").show();$(".hotspot-selector, .jcrop-tracker, .hotspot_selector").show();resumeJCrop();$(".screen-hint").removeClass("hint-bold");$(".screen-hint").html("Keyboard shortcuts: <span>&larr;</span> and <span>&rarr;</span> to navigate, <span>ESC</span> to close, <span>–</span> and <span>+</span> to zoom, <span>A</span> to annotate.");this.viewState.set("creatingAnnotation",false)},handleAnnotation:function(commentModel){this.stopMakingAnnotation();$(".make-annotation").addClass("hidden");$(".current-annotation").addClass("active");$(".current-annotation").attr("data-uuid",commentModel.get("uuid"));$(".current-annotation .icon").html(commentModel.get("reference"));$("#comment-text").focus();var annotationModel=new MARVELAPP.AnnotationModel({x:commentModel.get("annotation_x"),y:commentModel.get("annotation_y"),commentUUID:commentModel.get("uuid"),reference:commentModel.get("reference")});annotationModel.setModels({comment:commentModel});this.functionMap[this.commentType].renderAnnotation(annotationModel)},getAnnotationView:function(commentUUID){return this.annotationViews[commentUUID]},removeAnnotationView:function(commentUUID){delete this.annotationViews[commentUUID]},clearAnnotations:function(){var previousImage=this.viewState.previous("selectedImage");var currentImage=this.viewState.get("selectedImage");if(previousImage&&previousImage.uuid!==currentImage.uuid||!currentImage){_.each(this.annotationViews,function(annotationView){annotationView.remove()});this.annotationViews={}}},renderAnnotation:function(annotationModel,pulse){if(pulse==undefined)pulse=true;if(!$("#annotations-sidebar").hasClass("activated"))pulse=true;annotationModel.attributes.topPercent=annotationModel.get("y")/($("#screen-holder").height()/getActualZoom())*100;annotationModel.attributes.leftPercent=annotationModel.get("x")/($("#screen-holder").width()/getActualZoom())*100;var annotationView=this.getAnnotationView(annotationModel.attributes.commentUUID);if(!annotationView){annotationView=new MARVELAPP.AnnotationView(annotationModel);this.annotationViews[annotationModel.attributes.commentUUID]=annotationView;this.listenTo(annotationView,"highlightComment",this.highlightCorrespondingComment);this.listenTo(annotationView,"unhighlightComment",this.unhighlightCorrespondingComment);this.listenTo(annotationView,"clickAnnotation",this.scrollToComment)}annotationView.model.attributes.pulse=pulse;if($("#screen-holder #"+annotationModel.get("commentUUID")).length&&this.currentAnnotationView===annotationView){this.currentAnnotationView.$(".annotation").addClass("active")}else if($("#screen-holder #"+annotationModel.get("commentUUID")).length){annotationView.render()}else{$("#screen-holder").append(annotationView.render().$el)}if(annotationModel.comment.attributes.show_delete){this.handleEditAnnotation(annotationModel)}if($("#annotations-sidebar").hasClass("activated")){setTimeout(function(){$("#screen-holder .annotation").addClass("active")},0)}this.currentAnnotationView=annotationView;return annotationView},handleEditAnnotation:function(annotationModel){$(".annotation."+annotationModel.attributes.commentUUID).draggable({cursor:"move",cursorAt:{top:17,left:17},start:_.bind(function(e,ui){$("#editor").on("mousemove.annotationPlacement",_.bind(this.handleMouseMove,this))},this),drag:_.bind(function(e,ui){if(e.clientX>$("#screen-holder").offset().left&&e.clientX<$("#screen-holder").offset().left+$("#screen-holder").width()){left=e.clientX-$("#screen-holder").offset().left}else{if(e.clientX<$("#screen-holder").offset().left)ui.position.left=0;if(e.clientX>$("#screen-holder").offset().left+$("#screen-holder").width())ui.position.left=$("#screen-holder").width()}var top=e.clientY-Math.abs($(".editor-inner").scrollTop()-Math.abs($("#screen-holder").offset().top))+$(".editor-inner").scrollTop();if(top<0)ui.position.top=0;if(top>$("#screen-holder").height())ui.position.top=$("#screen-holder").height()},this),stop:_.bind(function(e,ui){$("#editor").off("mousemove.annotationPlacement");$(".annotation."+annotationModel.attributes.commentUUID).css("left",parseInt($(".annotation."+annotationModel.attributes.commentUUID).css("left"))/($("#screen-holder").width()/100)+"%");$(".annotation."+annotationModel.attributes.commentUUID).css("top",parseInt($(".annotation."+annotationModel.attributes.commentUUID).css("top"))/($("#screen-holder").height()/100)+"%");var newCoordinates={comment_uuid:annotationModel.attributes.commentUUID,annotation_x:this.annotationX,annotation_y:this.annotationY};this.editAnnotation(annotationModel,newCoordinates)},this)})},editAnnotation:function(annotationModel,newCoordinates){if($(".current-annotation").attr("data-uuid")==annotationModel.attributes.commentUUID){this.annotationViews[annotationModel.attributes.commentUUID].attributes.x=newCoordinates.annotation_x;this.annotationViews[annotationModel.attributes.commentUUID].attributes.y=newCoordinates.annotation_y;if(this.currentAnnotationView){this.currentAnnotationView.attributes.x=newCoordinates.annotation_x;this.currentAnnotationView.attributes.y=newCoordinates.annotation_y}this.newCommentModel.attributes.annotation_x=newCoordinates.annotation_x;this.newCommentModel.attributes.annotation_y=newCoordinates.annotation_y}else{$.ajax({url:"/api/comment/update-annotation/"+annotationModel.comment.attributes.id+"/",method:"PUT",dataType:"json",data:newCoordinates,success:_.bind(function(data){console.log("Success Editing Annotation: ",data)},this),error:function(data){console.log("Error Editing Annotation: ",data)}})}},updateAnnotation:function(data){var existingAnnotationView=this.getAnnotationView(data.content.uuid);var annotationModel=existingAnnotationView.model;this.currentAnnotationView=undefined;$(".annotation."+data.content.uuid).remove();annotationModel.attributes.x=data.content.annotation.x;annotationModel.attributes.y=data.content.annotation.y;this.renderAnnotation(annotationModel,false)},renderScreenAnnotation:function(annotationModel){prototype.currentScreenView.renderAnnotation(annotationModel)},removeCurrentAnnotation:function(event){var uuid=this.newCommentModel.get("uuid");if(!this.currentAnnotationView){this.currentAnnotationView=this.annotationViews[uuid]}if(this.currentAnnotationView){this.currentAnnotationView.remove()}else{$(".annotation."+uuid).remove()}this.$(".make-annotation").removeClass("hidden");this.$(".current-annotation").removeClass().addClass("current-annotation");this.$(".current-annotation").attr("data-uuid","");this.currentAnnotationView=undefined},removeAnnotation:function(comment){var annotationView=this.getAnnotationView(comment.get("uuid"));var $el=this.$("li[data-uuid="+comment.get("uuid")+"]");$el.find(".annotation-reference").addClass("zoom-out");setTimeout(function(){$el.find(".annotation-reference").remove()},300);if(annotationView){annotationView.removeView();this.removeAnnotationView(comment.get("uuid"));$(".annotation").removeClass("faded")}},handleCommentHover:function(event){var uuid=event.currentTarget.dataset.uuid;var annotationView=this.getAnnotationView(uuid);if(event.type==="mouseover"){$(event.currentTarget).addClass("highlighted");if(annotationView){$(".annotation."+uuid).addClass("highlighted");$('.annotation:not(".annotation.'+uuid+'")').addClass("faded")}}else if(event.type==="mouseout"){$(event.currentTarget).removeClass("highlighted");if(annotationView){$(".annotation."+uuid).removeClass("highlighted");$(".annotation").removeClass("faded")}}},highlightCorrespondingComment:function(commentUUID){if(commentUUID!==""){this.$(".comment-uuid").removeClass("highlighted");this.$(".comment-uuid."+commentUUID).addClass("highlighted");
}},unhighlightCorrespondingComment:function(commentUUID){if(commentUUID!==""){this.$(".comment-uuid."+commentUUID).removeClass("highlighted")}},scrollToComment:function(commentUUID){if(commentUUID!==""){if(commentUUID!==$(".current-annotation").attr("data-uuid")){this.$(".comments-list").scrollTop(this.$(".comment-uuid."+commentUUID).position().top+this.$(".comments-list").scrollTop()-10)}}},keydownTextarea:function(e){if($("#comment-text").val().trim()!==""){$(".comment-area").removeClass("error")}},scrollToLatestComment:function(){if(this.$(".comments-list").length){this.$(".comments-list").scrollTop(this.$(".comments-list")[0].scrollHeight)}},isVisible:function(){return!!this.viewState.get("shown")},triggerClose:function(){this.trigger("closeClicked")}});MARVELAPP.SessionExpiredView=Backbone.View.extend({tmpl:MARVELAPP.templates.MODAL_SESSION_EXPIRED,render:function(){this.$el.html(this.tmpl());return this}});MARVELAPP.SessionExpiredViewModal=MARVELAPP.ModalForView("SessionExpiredView");MARVELAPP.SiteExploreView=Backbone.View.extend({events:{"click .explore-play":"toggleLightbox","click .explore-prototype-modal .close":"toggleLightbox","click .likes":"like","click .staff":"staffPick","click .post-comment":"postComment","click .make-own":"makeOwn","click .profile-uri":"navigateToProfile","click .description .edit-comment":"toggleDescriptionEdit","click .description .save-edit":"saveDescription","click .description .cancel-edit":"toggleDescriptionEdit","click .explore-back-holder":"backToList"},navigateToProfile:function(event){if(typeof this.attributes.user.profile_uri==="undefined")return;Backbone.history.navigate(this.attributes.user.profile_uri,{trigger:true});event.preventDefault()},initialize:function(options){$("head").append('<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">');options=options||{};setTimeout(_.bind(this.updateHeroHeight,this),100);$(document).bind("keyup",_.bind(this.keydownHandler,this));this.attributes=options.model.attributes;this.setupPusher();this.commentCollection=new MARVELAPP.CommentCollection;this.commentCollection.url="/api/project/"+this.model.get("id")+"/comments/";this.commentCollection.model=MARVELAPP.CommentModel;this.commentCollection.fetch({success:_.bind(function(response){console.log("commentCollection.fetch success:",response)},this),error:function(response){console.log("commentCollection.fetch error:",response)}});$.ajax({url:"/api/explore/new-view/"+this.attributes.id+"/",method:"POST",headers:{"X-CSRFToken":$.cookie("csrftoken")}});this.listenTo(this.model,"sync",_.bind(this.fetch_success,this));this.listenTo(this.commentCollection,"add",_.bind(this.render_comment,this));this.listenTo(this.commentCollection,"remove",_.bind(this.remove_comment,this));this.listenTo(this.model,"change:like_count",function(){this.$(".likes span").html(parseInt(this.model.get("like_count"),10))});this.listenTo(this.model,"visibleLikeCountChanged",function(count){this.$(".likes span").html(count)});this.listenTo(this.model,"staffPickChanged",function(count){this.renderStaffButton()});this.listenTo(this.model,"change:has_liked",function(){if(this.model.get("has_liked")){this.$(".likes").addClass("liked liking")}else{this.$(".likes").removeClass("liked liking")}})},render:function(){var _this=this;try{this.attributes.frame=getProjectPropertyForName(this.attributes,projectConstants.PROJECT_PROP_FRAME);this.attributes.colour=getProjectPropertyForName(this.attributes,projectConstants.PROJECT_PROP_FRAME_COLOUR);this.attributes.orientation=getProjectPropertyForName(this.attributes,projectConstants.PROJECT_PROP_ORIENTATION)}catch(ex){console.log(ex)}this.attributes.hideLikePopup=false;var likeCookie=$.cookie("marvelExploreLikePopupDeactivated");if(likeCookie=="false"||typeof likeCookie==="undefined"){$.cookie("marvelExploreLikePopupDeactivated",false)}else if(likeCookie=="true"){this.attributes.hideLikePopup=true}this.attributes.is_staff=false;this.attributes.staff_text="Add as staff pick";this.attributes.hide_make_own=false;this.attributes.show_edit=false;if(MARVELAPP.models.current_user.id){if(MARVELAPP.models.current_user.get("is_super")){this.attributes.is_staff=true}this.$el.removeClass("logged-out");this.attributes.hide_make_own=true;if(this.model.get("user").id==MARVELAPP.models.current_user.id){this.attributes.show_edit=true}}else{this.$el.addClass("logged-out")}if(this.model.get("user").username.indexOf("@")>-1){var letters=this.model.get("user").username.split("@");var firstLetter=letters[0].charAt(0);var secondLetter=letters[1].charAt(0);this.attributes.user.letters=firstLetter+secondLetter}else{this.attributes.user.letters=MARVELAPP.UserModel.usernameInitials(this.model.get("user").username)}this.$el.html(MARVELAPP.templates.SITE_EXPLORE(this.attributes));if(!MARVELAPP.models.current_user.id){this.$el.append(MARVELAPP.templates.SITE_START_PROTOTYPING())}this.commentCollection.each(_.bind(this.render_comment,this));_.defer(function(){twttr.ready(function(twttr){twttr.widgets.load()});try{FB.XFBML.parse()}catch(e){}});try{var embedColour=getProjectPropertyForName(this.attributes,projectConstants.PROJECT_PROP_EXPLORE_BACKGROUND_HEX);this.$(".explore-hero").css("background-color",embedColour)}catch(ex){}var avatarImage=new Image;avatarImage.src=this.attributes.user.gravatar_data.url;avatarImage.onload=_.bind(function(){this.$el.find(".avatar .background").removeClass("hidden")},this);this.renderStaffButton();this.makeURLs();return this},makeURLs:function(){var text=this.$(".description p").text();var cleanHTML=MARVELAPP.utils.stylizeText(text);this.$(".description p").html(cleanHTML)},renderStaffButton:function(){if(this.model.get("has_staff")==true){this.$(".staff").html("Staff pick");this.$(".staff").css("background","green")}else{this.$(".staff").html("Add as staff pick");this.$(".staff").css("background","#f1c40f")}},setupPusher:function(){try{this.pusher=new Pusher("70744d379f87a37df68a",{encrypted:true,authEndpoint:"/api/pusher/auth/",auth:{params:{CSRFToken:window.csrftoken},headers:{"X-CSRFToken":window.csrftoken}}})}catch(ex){console.log("Exception initiating Pusher");console.log(ex)}if(typeof this.pusher==="undefined"||this.pusher==null){console.log("Pusher not setup");return}var channel_name=MARVELAPP.settings.PUSHER.EXPLORE_CHANNEL_PREFIX+this.model.get("id");this.pusher_channel=this.pusher.subscribe(channel_name);this.pusher_channel.bind(MARVELAPP.constants.pusher.EVENT_COMMENT_EXPLORE,_.bind(function(data){console.log("EVENT_COMMENT_EXPLORE",data);if(typeof MARVELAPP.models.current_user.attributes!=="undefined"){if(data.content.ignore_for_user_id==MARVELAPP.models.current_user.get("id")){return}}if(data.content.fetch_comments){this.commentCollection.fetch({success:_.bind(this.fetch_success,this)})}},this))},render_comment:function(model,collection,options){var commentView=new MARVELAPP.CommentView(model);this.$(".comments-list").append(commentView.render().$el);this.update_comment_count()},remove_comment:function(model,response,options){if(this.commentCollection.length==0){}this.update_comment_count()},fetch_success:function(model,collection,options){this.attributes=model.attributes;var elements=this.$(".comment.cf");_.each(elements,_.bind(function(element){var uuid=element.dataset.uuid;var model=_.findWhere(this.commentCollection.models,{id:uuid});if(typeof model==="undefined"){console.log("Remove comment for uuid:",uuid);element.remove()}},this));this.render()},update_comment_count:function(){var comment_count=this.commentCollection.length;this.$(".comment-count").text(comment_count);this.model.set("comment_count",comment_count)},add_comment:function(comment_data){var commentModel=new MARVELAPP.CommentModel(comment_data);commentModel.url=this.commentCollection.url;this.commentCollection.create(commentModel,{type:"POST",beforeSend:function(xhr){xhr.setRequestHeader("X-CSRFToken",$.cookie("csrftoken"))},success:_.bind(function(response){console.log("add_comment.success:",response);this.$("#message").val("");this.update_comment_count()},this),error:function(response){console.log("add_comment.error:",response);this.$("#message").addClass("error")}})},postComment:function(event){var message=$("#message").val();var project_uuid=this.model.get("uuid");var comment_data={message:message,project_uuid:project_uuid,uuid:generateUUID(),marvel_user_fk:{username:MARVELAPP.models.current_user.get("username"),id:MARVELAPP.models.current_user.get("id")},gravatar_data:MARVELAPP.models.current_user.attributes.gravatar_data,type:MARVELAPP.constants.comment_types.EXPLORE};if(typeof MARVELAPP.models.current_user.id==="undefined"){console.log("user not signed in");MARVELAPP.GlobalFooterView._doNotRedirectOnAuth=true;MARVELAPP.GlobalFooterView.once("authenticated",_.bind(function(comment_data){this.add_comment(comment_data);window.location.reload()},this,comment_data));startPrototyping();return}this.add_comment(comment_data)},updateHeroHeight:function(){var screenHeight=this.$(".screen").height();var topMarginOfPlayButton=-50;var minHeroHeight=parseInt(this.$(".explore-hero").css("minHeight"),10);var playButtonPositionFactor=.3;var bottomOfScreenRelativeToHeroTop=parseInt(this.$(".screen").offset().top,10)-this.$(".explore-hero").offset().top+screenHeight;var orientation=getProjectPropertyForName(this.model.attributes,projectConstants.PROJECT_PROP_ORIENTATION).value;if(_.isEqual(orientation,projectConstants.ORIENTATION_LANDSCAPE)){minHeroHeight=340;playButtonPositionFactor=.5}var heroOuterHeight=$(".explore-hero").outerHeight();if(bottomOfScreenRelativeToHeroTop>heroOuterHeight){topMarginOfPlayButton=topMarginOfPlayButton-(bottomOfScreenRelativeToHeroTop-heroOuterHeight)*.5}this.$(".explore-play").css("margin-top",topMarginOfPlayButton+"px");setTimeout(_.bind(this.updateHeroHeight,this),100)},toggleLightbox:function(e){$(".explore-prototype-modal").toggleClass("activated");this.toggleOverflow()},like:function(e){if(MARVELAPP.models.current_user.id){if(this.model.get("has_liked")){this.model.removeLike()}else{this.model.addLike();$.cookie("marvelExploreLikePopupDeactivated",true);this.$(".like-popover").addClass("hidden")}}else{MARVELAPP.GlobalFooterView._doNotRedirectOnAuth=true;MARVELAPP.GlobalFooterView.once("authenticated",_.bind(function(){this.model.addLike(function(){window.location.reload();$.cookie("marvelExploreLikePopupDeactivated",true);this.$(".like-popover").addClass("hidden")})},this));startPrototyping()}},staffPick:function(e){console.log("The staff pick is ",this.model);if(MARVELAPP.models.current_user.id){if(this.model.get("has_staff")){this.model.removeStaffPick()}else{this.model.addStaffPick()}}else{startPrototyping()}},toggleOverflow:function(){if($(".explore-prototype-modal").hasClass("activated")){$("body").css("overflow","hidden")}else{$("body").css("overflow","auto")}},keydownHandler:function(e){switch(e.which){case 27:this.closePrototypeModal();break}},closePrototypeModal:function(){$(".explore-prototype-modal").removeClass("activated");this.toggleOverflow()},makeOwn:function(event){if(typeof MARVELAPP.models.current_user.get("username")==="undefined"){startPrototyping()}else{Backbone.history.navigate("/",{trigger:true})}},toggleDescriptionEdit:function(){var editable=this.$(".description p").attr("contenteditable");var commentField=this.$(".description p").get(0);var descriptionMousetrap=new Mousetrap(commentField);this.$(".description p").text(this.model.get("description"));this.$(".description p").attr("contenteditable",!(editable=="true"));this.$(".description p").toggleClass("editing-comment");setEndOfContenteditable(this.$(".description p").get(0));this.$(".description .edit-buttons").toggleClass("hidden");if(editable=="false"){descriptionMousetrap.bind(["ctrl+enter","command+enter"],_.bind(function(e){this.saveDescription()},this))}else{descriptionMousetrap.unbind(["ctrl+enter","command+enter"]);this.makeURLs()}},saveDescription:function(){this.$(".description .save-edit").addClass("wait-state");this.$(".description p").removeClass("error");var newDescription=this.$(".description p").text();var oldDescription=this.model.get("description");var project=new MARVELAPP.ProjectModel({id:this.model.get("id"),description:this.model.get("description")});project.set("description",newDescription);project.save({description:newDescription,id:project.id},{patch:true,success:_.bind(function(model,response){console.log("Success",model,response);this.model.set("description",response.description);this.$(".description .save-edit").removeClass("wait-state");this.toggleDescriptionEdit()},this),error:_.bind(function(model,response){console.log("Error",model,response);this.$(".description .save-edit").removeClass("wait-state");this.$(".description p").addClass("error")},this)})},backToList:function(){Backbone.history.navigate("/explore/",{trigger:true})}});var SiteGlobalExploreView=Backbone.View.extend({events:{"click .next-page":"goToNextPage","click .previous-page":"goToPreviousPage"},initialize:function(options){options=options||{};this.listenTo(this.collection,"request",this.renderLoadingState);this.listenTo(this.collection,"sync",this.renderTiles);this.listenTo(this.collection,"error",this.renderError)},renderLoadingState:function(){$(".explore-spinner").removeClass("hidden");this.disablePageButtons();$(".tiles").addClass("hidden")},render:function(){var _this=this;this.$(".explore-link").addClass("active");_.defer(_.bind(function(){},this));setTimeout(function(){if(MARVELAPP.models.subViews.popular.collection.length>0){$(".explore-spinner").addClass("hidden")}},10);return this},renderTiles:function(){this.$el.html(MARVELAPP.templates.SITE_GLOBAL_EXPLORE({projects:this.collection.toJSON(),hasNext:this.collection.hasNextLink(),hasPrevious:this.collection.hasPreviousLink()}));var projects=this.collection.toJSON();if(projects.length>0){$(".explore-spinner").addClass("hidden")}else{$(".explore-spinner").removeClass("hidden")}_.each(projects,_.bind(function(project){var view=new MARVELAPP.ExploreTileView({model:new MARVELAPP.ExploreModel(project)});this.$(".tiles").append(view.render().$el)},this))},renderError:function(){$(".explore-spinner").addClass("hidden");this.$(".empty").removeClass("hidden")},disablePageButtons:function(){this.$(".next-page, .prev-page").attr("disabled","disabled")},enablePageButtons:function(){this.$(".next-page, .prev-page").removeAttr("disabled")},goToNextPage:function(){this.collection.fetchNextPageIfPossible();window.scrollTo(0,0)},goToPreviousPage:function(){this.collection.fetchPreviousPageIfPossible();window.scrollTo(0,0)}});MARVELAPP.SiteGlobalExploreTabView=Backbone.View.extend({events:{"click .explore-tabs li":"switchTabs"},initialize:function(){this.subViews={};this.queryParams=getQueryParams();if(!MARVELAPP.models.subViews){MARVELAPP.models.subViews={}}if(!MARVELAPP.models.subViews.popular){var popularCollection=new MARVELAPP.ExploreCollection({filter:"popular"});MARVELAPP.models.subViews.popular=new SiteGlobalExploreView({collection:popularCollection});if(typeof this.queryParams.filter==="undefined"||this.queryParams.filter==="popular"){popularCollection.setPage(this.queryParams.page);popularCollection.fetch()}}this.subViews=MARVELAPP.models.subViews;if(!MARVELAPP.models.subViews.staffPicks){var staffPicksCollection=new MARVELAPP.ExploreCollection({filter:"staff_picks"});MARVELAPP.models.subViews.staffPicks=new SiteGlobalExploreView({collection:staffPicksCollection});if(this.queryParams.filter==="staff_picks"){staffPicksCollection.setPage(this.queryParams.page);staffPicksCollection.fetch()}}if(!MARVELAPP.models.subViews.recent){var recentCollection=new MARVELAPP.ExploreCollection({filter:"recent"});MARVELAPP.models.subViews.recent=new SiteGlobalExploreView({collection:recentCollection});if(this.queryParams.filter==="recent"){recentCollection.setPage(this.queryParams.page);recentCollection.fetch()}}},render:function(){this.$el.html(MARVELAPP.templates.SITE_GLOBAL_EXPLORE_TABS());if(!MARVELAPP.models.current_user.id){this.$el.append(MARVELAPP.templates.SITE_START_PROTOTYPING())}var popular_active="";var recent_active="";var staff_active="";if(typeof this.queryParams.filter!=="undefined"){MARVELAPP.models.selected_explorer_tab="explore-"+this.queryParams.filter}if(typeof this.queryParams.page!=="undefined"){MARVELAPP.models.selected_explorer_page=this.queryParams.page}if(MARVELAPP.models.selected_explorer_tab==="explore-popular"){popular_active="active"}else if(MARVELAPP.models.selected_explorer_tab==="explore-recent"){recent_active="active"}else if(MARVELAPP.models.selected_explorer_tab==="explore-staff_picks"){staff_active="active"}else{MARVELAPP.models.selected_explorer_tab="explore-popular";popular_active="active"}this.$(".explore-tabs li").removeClass("active");this.$(".explore-tab").removeClass("active");this.$("#"+MARVELAPP.models.selected_explorer_tab+"-tab").addClass("active");this.$("#"+MARVELAPP.models.selected_explorer_tab).addClass("active");this.subViews.popular.render().$el.attr("class","explore-tab "+popular_active+" cf").attr("id","explore-popular-tab");this.$(".global-explore").append(this.subViews.popular.$el);this.subViews.staffPicks.render().$el.attr("class","explore-tab "+staff_active+" cf").attr("id","explore-staff_picks-tab");this.$(".global-explore").append(this.subViews.staffPicks.$el);this.subViews.recent.render().$el.attr("class","explore-tab "+recent_active+" cf").attr("id","explore-recent-tab");this.$(".global-explore").append(this.subViews.recent.$el);return this},switchTabs:function(e){this.$(".explore-tabs li").removeClass("active");this.$(e.currentTarget).addClass("active");var id=$(e.currentTarget).attr("id");this.$(".explore-tab").removeClass("active");this.$("#"+id+"-tab").addClass("active");var page=1;if(id=="explore-popular"){this.subViews.popular.collection.setPage(1);this.subViews.popular.collection.fetch()}else if(id=="explore-staff_picks"){this.subViews.staffPicks.collection.setPage(1);this.subViews.staffPicks.collection.fetch()}else if(id=="explore-recent"){this.subViews.recent.collection.setPage(1);this.subViews.recent.collection.fetch()}MARVELAPP.models.selected_explorer_tab=id;var filter=id.split("-")[1];if(filter==="staff")filter="staff_picks";setQueryParams({filter:filter,page:1})}});MARVELAPP.PrototypeGridThumbnailView=MARVELAPP.ProjectDuplicateThumbnailView.extend({tmpl:MARVELAPP.templates.PROTOTYPE_GRID_VIEW_THUMBNAIL,events:{click:"openImage"},initialize:function(){this.viewState=new Backbone.Model;this.listenTo(this.viewState,"change:loadedImage",this.setBackgroundImage);this.listenTo(this.model.project,"firstImageUpdated",this.updateDimensions)},render:function(){var imageViewModel=this.getImageViewModel();this.$el.html(this.tmpl({imageViewModel:imageViewModel}));this.$el.attr("id","duplicate_img_"+imageViewModel.id).attr("data",imageViewModel.id).attr("data-uuid",imageViewModel.uuid);this.determineAndSetImageURL();this.updateDimensions();return this},determineAndSetImageURL:function(){var image=this.model.image.toJSON();var urlToUse=image.thumbnail||image.url;if(this.model.project.isFrameAppleWatch()){urlToUse=$.cloudinary.fetch_image(image.url,{quality:70,width:375}).attr("src")}if(urlToUse&&urlToUse!==this.viewState.get("loadedImage")){preloadImage(urlToUse,_.bind(function(imageElement){this.viewState.set("loadedImage",imageElement.src)},this))}},openImage:function(e){this.trigger("imageClicked",$(e.target).attr("data"))}});MARVELAPP.PrototypeGridView=MARVELAPP.ProjectThumbnailListView.extend({tmpl:MARVELAPP.templates.PROTOTYPE_GRID_VIEW,events:{"click .close":"close"},initialize:function(){if(!this.model){this.model={}}this.thumbnailViews={};this.viewState=new Backbone.Model;$(window).on("resize",this.resizeGrid)},render:function(){var viewModel={project:this.model.project.toJSON()};this.$el.html(this.tmpl(viewModel));this.resizeGrid();return this},resizeGrid:function(){var height=$(window).height();this.$(".modal").css("height",height)},setProjectModel:function(){MARVELAPP.ProjectThumbnailListView.prototype.setProjectModel.apply(this,arguments);this.listenTo(this.model.project,"change:images",this.renderThumbnailListIntelligently);this.listenTo(this.model.project,"imageSequenceChanged",this.renderThumbnailListIntelligently)},insertSingleThumbnailView:function(imageObject,sequenceNumber,options){options=_.defaults(options||{},{fadeImagesIn:true});var thumbnailView=new MARVELAPP.PrototypeGridThumbnailView({fadeImagesIn:options.fadeImagesIn,model:{image:new Backbone.Model(imageObject),project:this.model.project}});thumbnailView.render();this.$(".grid-view-screens-wrapper ul").append(thumbnailView.$el);this.thumbnailViews[sequenceNumber]=thumbnailView;this.listenTo(thumbnailView,"imageClicked",_.bind(function(id){this.highlightThumbnail(id)},this));return thumbnailView},bindToSingleThumbnailView:function(thumbnailView,sequenceNumber){this.listenTo(thumbnailView,"imageClicked",function(id){this.trigger("transitionTo",id);this.hideModal()})},highlightThumbnail:function(id){console.log("highlightThumbnail",id);this.$("li").removeClass("selected");this.$("li[data="+id+"]").addClass("selected")},isOpened:function(){return this.$(".new-overlay, .modal-overlay").hasClass("activated")},open:function(){this.showModal();$("body").addClass("overlay-opened")},close:function(){this.hideModal();$("body").removeClass("overlay-opened")}});MARVELAPP.PrototypeGridViewModal=MARVELAPP.ModalForView("PrototypeGridView");MARVELAPP.PrototypeView=Backbone.View.extend({el:"#prototype",pusher:null,batches:[],hovers:[],annotationMode:false,events:{"click .hotspot":"clickHotspot","click #screens":"flashHotspots","touchstart .gesture":"blockScrolling","touchend .gesture":"unblockScrolling","click .addToHomescreen .close":"hideHomescreen","click #annotation-notification":"toggleAnnotationsSidebar","click #annotations-sidebar .close":"toggleAnnotationsSidebar","click .close-annotation-mode":"closeAnnotationMode","click .forgot-password":"forgotPassword","click #forgot-back":"forgotPasswordBack","click .switch":"switchModals","click .resume-prototyping":"resumePrototyping","click .overlay .close":"closeModal","click .screen-overlay":"closeOverlay"},initialize:function(options,id){options=options||{};var accessCode=getParameterByName("access_token");if(accessCode){this.access_code=accessCode}this.model=new MARVELAPP.ProjectModel(options);MARVELAPP.models.current_project=this.model;for(i in this.model.attributes.images){this.batches.push(this.model.attributes.images[i])}this.screenViews={};this.currentScreenView;this.collection={comments:new MARVELAPP.CommentCollection};this.flashTimeout;this.hoverState=false;this.activeHoverScreen=undefined;this.activeOverlayScreen;this.screenUnderneathOverlay;this.hasActiveOverlay=false;this.possibleHotspotForInitialOverlay=undefined;this.overlayTransition="none";this.listenTo(this.collection.comments,"add remove reset sync",this.updateCommentCount);this.listenTo(this.collection.comments,"request",this.updateCommentCountEmptyState);this.listenTo(this.model,"change",this.render);this.listenTo(this.model,"imageUpdated:hasUnreadComments",this.updateUnreadIndicator);this.listenTo(this.model,"imageUpdated:hasUnreadComments",this.markReadIfVisible);this.gridView=new MARVELAPP.PrototypeGridViewModal({model:{project:this.model}});this.listenTo(this.gridView,"transitionTo",function(next_screen){var go_transition="none";this.handleTransition(current_screen,next_screen,go_transition,false)});this.listenTo(this.gridView,"hiding",function(){this.closeGrid()});this.$("#grid-view").html(this.gridView.render().$el);this.render();Mousetrap.bind("a",_.bind(function(){if(this.annotationsView&&this.annotationsView.isVisible()){if(this.annotationMode){this.currentScreenView.closeAddAnnotationMode()}else if(this.keyboardControlsEnabled()){if(this.annotationsView.$(".make-annotation").hasClass("hidden")){this.annotationsView.$(".remove-annotation").click()}else{this.annotationsView.$(".make-annotation").click()}}}},this));Mousetrap.bind("h",_.bind(function(){if(this.keyboardControlsEnabled()){this.goHome()}},this));Mousetrap.bind("left",_.bind(function(){if(this.keyboardControlsEnabled()){this.goBack()}},this));Mousetrap.bind("right",_.bind(function(){if(this.keyboardControlsEnabled()){this.goForward()}},this));Mousetrap.bind("esc",_.bind(function(){if($(".white-overlay").hasClass("activated")){$(".overlay").removeClass("activated");$(".white-overlay").removeClass("activated")}else if(this.gridView.isOpened()){this.gridView.close()}else if(this.annotationMode){this.currentScreenView.closeAddAnnotationMode()}else if(this.annotationsView&&this.annotationsView.isVisible()){this.toggleAnnotationsSidebar()}else if(embed&&typeof top!=="undefined"&&top.window&&top.window.MARVELAPP){top.window.MARVELAPP.Router.currentView.closePrototypeModal()}},this));Mousetrap.bind("s",_.bind(function(){if(this.annotationsView&&this.annotationsView.isVisible())return;if(this.keyboardControlsEnabled()){var flashClass="hotspot-visible";if(this.hasActiveOverlay==true)flashClass="overlay-hotspot-visible";if(!$("#prototype").hasClass(flashClass)){$("#prototype").addClass(flashClass)}}},this),"keydown");Mousetrap.bind("s",_.bind(function(){if(this.annotationsView&&this.annotationsView.isVisible())return;if(this.keyboardControlsEnabled()){$("#prototype").removeClass("hotspot-visible overlay-hotspot-visible")}},this),"keyup");if(!offline){try{this.handlePusherCalls()}catch(ex){console.log("Issue with pusher connection",ex)}}},keyboardControlsEnabled:function(){var annotationMode=true;if(this.annotationsView){annotationMode=!this.annotationsView.viewState.get("creatingAnnotation")}if(this.gridView.isOpened()){return false}return annotationMode&&$("#comment-text")[0]!==document.activeElement&&$(".editing-comment").length!==1},updateUnreadIndicator:function(screen){var currentScreenView=this.currentScreenView;if(currentScreenView.image_object.uuid!==screen.uuid){return}var $indicator=$("#annotation-notification");var hasUnread=$indicator.hasClass("unread");if(hasUnread!==screen.hasUnreadComments){$indicator.toggleClass("unread")}},updateCommentCountEmptyState:function(){var commentCount=this.collection.comments.length;if(commentCount===0){$("#annotation-notification").addClass("loading")}else{$("#annotation-notification").removeClass("loading")}},isWebProject:function(){var frame=getProjectPropertyForName(prototype.model.attributes,projectConstants.PROJECT_PROP_FRAME);if(frame=="web-frame"||frame=="desktop-view"){return true}else{return false}},render:function(){var attributes=this.model.attributes;attributes.disable_sidebar=getProjectPropertyForName(attributes,projectConstants.PROJECT_PROP_DISABLE_FRAME);var duplicate_hotspots=[];for(image in attributes.images){for(hdx in attributes.images[image].hotspots){var hotspot=attributes.images[image].hotspots[hdx];if(typeof hotspot.images!=="undefined"){if(hotspot.images.length!=0){duplicate_hotspots.push(hotspot)}}}}if(duplicate_hotspots.length!=0){for(id in duplicate_hotspots){for(hid in duplicate_hotspots[id].images){for(image in attributes.images){if(attributes.images[image].id==duplicate_hotspots[id].images[hid]){if(attributes.images[image].id!=duplicate_hotspots[id].img_owner_fk){var length=attributes.images[image].hotspots.length;attributes.images[image].hotspots[length]=duplicate_hotspots[id]}}}}}}var fragment=Backbone.history.getFragment();var params=fragment.replace(/\//g," ").trim().split(" ");var initial_fragment=params[0];var activeScreen=initial_fragment;this.hasActiveOverlay=false;if(initial_fragment.includes("?overlay=")){activeScreen=initial_fragment.substr(0,initial_fragment.indexOf("?"));this.hasActiveOverlay=true;this.screenUnderneathOverlay=initial_fragment.substr(initial_fragment.indexOf("=")+1,initial_fragment.length)}var initial_fragment=params[0];attributes.first_image=attributes.images[1].id;var found=false;attributes.showComments=false;attributes.highlightCommentId=undefined;if(activeScreen!=""){for(id in attributes.images){if(attributes.images[id].id==activeScreen){this.$("#screen-name").text(attributes.images[id].name);found=true;break}}if(found){attributes.first_image=activeScreen;if(this.hasActiveOverlay){this.activeOverlayScreen=activeScreen}if(typeof params[1]!=="undefined"){if(params[1]==="comments"){attributes.showComments=true;if(typeof params[2]!=="undefined"){attributes.highlightCommentId=params[2]}}}}else{activeScreen=attributes.images[1].id;attributes.first_image=activeScreen;this.hasActiveOverlay=false;history.pushState("",document.title,window.location.pathname)}}console.log(params,this.hasActiveOverlay,this.activeOverlayScreen,this.screenUnderneathOverlay);attributes.commentsEnabled=getProjectPropertyForName(attributes,projectConstants.PROJECT_PROP_COMMENTS_ENABLED);if(attributes.commentsEnabled=="1"){attributes.commentsEnabled=true}else{attributes.commentsEnabled=false}attributes.access_code=this.access_code;if(embed||offline==true)attributes.commentsEnabled=false;this.commentsEnabled=attributes.commentsEnabled;if(!mobile&&attributes.disable_sidebar!=1&&!embed){attributes.initial=false;this.sidebar=new MARVELAPP.SidebarView({model:{project:this.model},collection:this.collection})}NProgress.start();NProgress.configure({showSpinner:false,parent:"#screens"});NProgress.inc(.1);var play=MARVELAPP.constants.comment_types.PLAY;if(attributes.commentsEnabled){this.annotationsView=new MARVELAPP.ProjectEditorAnnotationsView({collection:this.collection,commentType:play});this.annotationsView.collection.comments.model=MARVELAPP.CommentModel;this.annotationsView.collection.comments.url="/api/comment/"+attributes.first_image+"/";this.annotationsView.collection.comments.fetch({success:_.bind(function(){var data={};if(typeof this.access_code!=="undefined"){data={access_code:this.access_code}}this.model.fetchUnreadCommentStatuses(data)},this)});this.listenTo(this.annotationsView,"commentRendered",function(){this.annotationsView.newCommentModel=new MARVELAPP.CommentModel});if(typeof attributes.access_code!=="undefined"){$.ajax({type:"GET",url:"api/commenter/"+attributes.access_code+"/",success:_.bind(function(response){this.annotationsView.commenter=response},this),error:function(response){}})}}attributes.disable_resizing=getProjectPropertyForName(project_object,projectConstants.PROJECT_PROP_NON_RESPONSIVE);if(explore)attributes.disable_resizing="0";var currentSequence=1;for(id in attributes.images){var imageObject=attributes.images[id];var isOverlay=false;var isScreenUnderOverlay=false;var firstImage=false;if(this.hasActiveOverlay){if(imageObject.id==this.activeOverlayScreen){isOverlay=true;firstImage=true;currentSequence=id;current_screen=this.activeOverlayScreen}if(imageObject.id==this.screenUnderneathOverlay){isScreenUnderOverlay=true;this.possibleHotspotForInitialOverlay=_.findWhere(imageObject.hotspots,{dest_img_fk:parseInt(this.activeOverlayScreen),is_overlay:true});if(this.possibleHotspotForInitialOverlay){$(".screen-overlay-background").css("background",this.possibleHotspotForInitialOverlay.overlay_background_colour);$(".screen-overlay-background").addClass("active");this.overlayBackgroundColour=this.possibleHotspotForInitialOverlay.overlay_background_colour}}}else{if(imageObject.id==attributes.first_image){firstImage=true;currentSequence=id;current_screen=attributes.first_image}else{firstImage=false}}var screenView=new MARVELAPP.ScreenView({image_object:imageObject,firstImage:firstImage,isOverlay:isOverlay,isScreenUnderOverlay:isScreenUnderOverlay});this.addScreen(screenView,imageObject.id);screenView.bindEvents()}var hidden_sidebar=$.cookie("homescreen");if(mobile&&!homescreen&&!explore&&hidden_sidebar!="1"&&offline==false&&iosapp==0&&!embed){attributes.showAndroid=android;if(chromeiOS)attributes.showAndroid=true;if($(window).width()<$(window).height()){$(".screen").append(MARVELAPP.templates.ADD_TO_HOMESCREEN(attributes))}}if(mobileMode){$(".screen").append(MARVELAPP.templates.ROTATE_DEVICE());attributes.orientation=getProjectPropertyForName(attributes,projectConstants.PROJECT_PROP_ORIENTATION);
this.checkOrientation(attributes.orientation);$(window).on("orientationchange",_.bind(function(event){this.triggerCalculations(current_screen);this.checkOrientation(attributes.orientation)},this))}this.callAntiscroll();this.handleGestures();prototype=this;if(!mobile&&attributes.commentsEnabled){$("#prototype").append(MARVELAPP.templates.PROTOTYPE_MODALS());this.annotationsEnabled=true;var annotationModels={};annotationModels.project=this.model;annotationModels.user=MARVELAPP.models.current_user||new MARVELAPP.UserModel;this.$("#annotations-sidebar").html(this.annotationsView.render().$el);this.annotationsView.setModels(annotationModels);this.annotationsView.setImageFromSequenceNumber(currentSequence);if(attributes.showComments){if(typeof attributes.highlightCommentId!=="undefined"){this.annotationsView.viewState.set("highlightedComment",attributes.highlightCommentId)}this.toggleAnnotationsSidebar();this.annotationsView.viewState.set("shown",true)}}else{this.annotationsEnabled=false}if(is_ie10){this.ieBar=new MARVELAPP.PrototypeViewIeBar;$("#content-wrapper").after(this.ieBar.render().$el)}if(params.indexOf("grid")>-1){this.openGrid()}return this},toggleAnnotationsSidebar:function(e){var sidebar=this.$("#annotations-sidebar");sidebar.toggleClass("activated");this.$el.toggleClass("comment-sidebar-open");if(sidebar.hasClass("activated")){scaleDevice(true);prototype.updateEverything();$(".annotation").addClass("active");this.annotationsView.viewState.set("shown",true);if(this.currentScreenView.image_object.hasUnreadComments){this.markCommentsRead()}}else{scaleDevice(false);prototype.updateEverything();$(".annotation").removeClass("active");this.annotationsView.viewState.set("shown",false)}this.triggerCalculations(current_screen,true)},checkOrientation:function(orientation){if(orientation=="")orientation="portrait";if(!window.orientation)window.orientation=0;if(orientation=="landscape"&&window.orientation==0){$(".rotate-device").removeClass("hidden")}else if(orientation=="portrait"&&window.orientation!=0){$(".rotate-device").removeClass("hidden");if(window.orientation>0){$(".rotate-device .icon").addClass("flip")}else{$(".rotate-device .icon").removeClass("flip")}}else{$(".rotate-device").addClass("hidden")}},addScreen:function(screenView,id){this.screenViews[id]=screenView;this.$("#screens").append(screenView.render());if(screenView.firstImage==true){this.setCurrentScreen(screenView)}},unbindCurrentScreen:function(){if(typeof this.currentScreenView!=="undefined"){this.currentScreenView.stopListening(this.annotationsView)}if(typeof this.annotationsView!=="undefined"){this.annotationsView.stopListening(this.currentScreenView)}},setCurrentScreen:function(screenView){this.currentScreenView=screenView;if(this.commentsEnabled){screenView.listenTo(this.annotationsView,"renderScreenAnnotation",function(annotationModel){this.renderAnnotation(annotationModel)});screenView.listenTo(this.annotationsView,"setAnnotationView",function(annotationView){this.setAnnotationView(annotationView)});screenView.listenTo(this.annotationsView,"commentPosted",function(){this.currentAnnotationView=undefined});this.annotationsView.listenTo(screenView,"addNewCommentModel",function(commentModel){this.newCommentModel=commentModel});this.annotationsView.listenTo(screenView,"addAnnotationView",function(annotationView){var uuid=annotationView.id;var existingView=this.getAnnotationView(uuid);if(typeof existingView!="undefined"){existingView=annotationView}else{this.annotationViews[uuid]=annotationView}this.trigger("setAnnotationView",annotationView)})}},runPreloader:function(){var batches=this.batches;var start=0;var num_batches=3;var maxIndex=batches.length;var amountDownloaded=0;var count=0;if(num_batches>batches.length){num_batches=batches.length}var current_batch_end=num_batches;function preload_image(image_object,fn){var tmp=new Image,self=this;if(fn)tmp.onload=function(e){fn.call(self,image_object.id,image_object.url,100,1)};if(fn)tmp.onerror=function(e){fn.call(self,image_object.id,image_object.url,100,1)};tmp.src=image_object.url}function loadBatch(batch_start,batch_end){for(var z=batch_start;z<=batch_end;z++){if(typeof batches[z]!=="undefined"){if(batches[z].url!=undefined){var id=batches[z].id;preload_image(batches[z],function(image_id,image_src,perc,done){if(done){count++;amountDownloaded++;var totalPercent=100;if(current_screen==image_id){NProgress.set(0);NProgress.set(totalPercent)}$("#"+image_id+" img").attr("src",image_src);$("#"+image_id+" .loading").one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(e){$("#"+image_id+" .loading").removeClass("fade-out in").hide()});$("#"+image_id+" .loading").addClass("fade-out in")}else if(done==-1){count++;amountDownloaded++}var done=false;if(count==0||batches.length==1){perc=40;if(parseInt($("#page-loader .inner").css("width"))<=45){$("#page-loader .inner").css("width","45%")}if(batches.length==1){done=true}}else if(count==1||batches.length==2){if(parseInt($("#page-loader .inner").css("width"))<=66){$("#page-loader .inner").css("width","66.66%")}if(batches.length==2){done=true}}else if(count>=2||batches.length==3){if(parseInt($("#page-loader .inner").css("width"))<=100){$("#page-loader .inner").css("width","100%")}done=true}if(done){if(firstAntiscrollRun==false||current_screen==image_id){prototype.callAntiscroll();setTimeout(function(){$(".active .antiscroll-inner").css("-webkit-overflow-scrolling","touch");$("#page-loader").fadeOut(100);prototype.handleTimer()},200);firstAntiscrollRun=true}}if(count>=current_batch_end&&count!=maxIndex){var next_batches=current_batch_end+num_batches;var start_batches=current_batch_end+1;if(next_batches>=maxIndex){next_batches=maxIndex}loadBatch(start_batches,next_batches);current_batch_end=next_batches}})}else{count++}}else{count++}}}loadBatch(start,current_batch_end)},updateScreen:function(imageObject,useImage){var screenView=this.screenViews[imageObject.id];if(typeof screenView=="undefined")return;var initialHotspots=_.clone(screenView.image_object.hotspots);screenView.image_object=imageObject;screenView.image_object.hotspots=initialHotspots;screenView.render(true,useImage);$("#"+imageObject.id+" img").attr("src",imageObject.url);$("#"+imageObject.id+" .loading").hide();this.callAntiscroll()},getScreenView:function(screenID){return this.screenViews[screenID]},updateCommentCount:function(){$("#annotation-notification").removeClass("loading");$("#comment-count").html(this.collection.comments.length)},markCommentsRead:function(){var imageID=this.currentScreenView.image_object.id;this.model.markCommentsRead(imageID)},markReadIfVisible:function(screen){var currentScreen=this.currentScreenView.image_object;if(screen.uuid!==currentScreen.uuid){return}if(screen.hasUnreadComments){this.annotationsView.markReadCommentsIfOpen()}},callAntiscroll:function(){if(!mobile){$(".antiscroll-wrap").antiscroll();$(".antiscroll-inner").width("100%")}},beenClicked:false,clickHotspot:function(e){this.beenClicked=true;var screenToLookup=current_screen;if(this.hoverState==true)screenToLookup=this.activeHoverScreen;var id=parseInt($(e.currentTarget).attr("id").split("-")[1]);var currentImage=_.findWhere(prototype.model.get("images"),{id:parseInt(screenToLookup)});if(!currentImage)return;var hotspotObject=_.findWhere(currentImage.hotspots,{id:id});if(!hotspotObject)return;if(hotspotObject.action!=projectConstants.ACTION_CLICK&&mobile)return;if(hotspotObject.type==projectConstants.TYPE_ANCHOR){this.handleAnchor(hotspotObject.anchor_y_pos,hotspotObject.smooth_scroll)}else if(hotspotObject.type==projectConstants.TYPE_URL){this.handleURL(hotspotObject.external_url,hotspotObject.new_window)}else if(touchStartID!=null){this.handleTransition(current_screen,hotspotObject.dest_img_fk,hotspotObject.transition,false,hotspotObject)}},whichAnimationEvent:function(){var t,el=document.createElement("fakeelement");var animations={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(t in animations){if(el.style[t]!==undefined){return animations[t]}}},resetHoversFromClick:function(){$("#prototype").removeClass("hover-state");$(document).unbind("mousemove");$(".screen-wrap").removeClass("hover-active");this.hovers=[];globalMaintainScroll=false;this.hoverState=false;transitioning=false},closeOverlay:function(e){if(prototype.annotationsView&&prototype.annotationsView.viewState.get("shown")==true)return;if(transitioning==true)return;console.log("closeOverlay",prototype.hasActiveOverlay,prototype.activeOverlayScreen,$(e.target).closest(".screen-wrap").attr("id"),$(e.target));if(prototype.hasActiveOverlay&&prototype.activeOverlayScreen==$(e.target).closest(".screen-wrap").attr("id")){if($(e.target).is(".box-inner")||$(e.target).is(".overlay-image-wrap")){if(transitionHistory.length!=0){if(embed){this.handleTransition(prototype.activeOverlayScreen,prototype.screenUnderneathOverlay,last_transition,true,undefined,true)}else{window.history.back()}}else{var transition=prototype.overlayTransition;if(!transition||transition=="none")transition=prototype.possibleHotspotForInitialOverlay.transition;if(!transition)transition=="fade";this.handleTransition(prototype.activeOverlayScreen,prototype.screenUnderneathOverlay,transition,true,undefined)}}}},handleTimer:function(){if(prototype.currentScreenView.hasTimerHotspot()){var timerHotspot=prototype.currentScreenView.getTimerHotspot();globalTimerTimeout=setTimeout(_.bind(function(){this.handleTransition(current_screen,timerHotspot.dest_img_fk.toString(),timerHotspot.transition,false)},this),timerHotspot.timer*1e3)}},handleTransition:function(currentScreen,targetScreen,transitionBase,reverse,hotspotObject,ignoreAddingToHistory){if(transitioning==true)return;console.log("####### Handle transition:","currentScreen: "+currentScreen,"targetScreen: "+targetScreen,"transition: "+transitionBase,"reverse: "+reverse,hotspotObject);currentScreen=currentScreen.toString();targetScreen=targetScreen.toString();var maintainScroll=false;var transition=transitionBase;clearTimeout(globalTimerTimeout);var navigatingToOverlay=false;var navigatingFromOverlay=$("#"+currentScreen).hasClass("screen-overlay");if(hotspotObject!=undefined){maintainScroll=hotspotObject.maintain_scroll;navigatingToOverlay=hotspotObject.is_overlay}if(navigatingFromOverlay==true){navigatingToOverlay=false;maintainScroll=false}console.log("navigatingToOverlay: "+navigatingToOverlay,"navigatingFromOverlay: "+navigatingFromOverlay,"reverse: "+reverse);if(transition=="none")transition="zero";if(typeof ignoreAddingToHistory=="undefined")ignoreAddingToHistory=false;if(transition==projectConstants.DESTINATION_BACK){if(transitionHistory.length!=0){if(typeof Ti!=="undefined"&&android==true||embed){targetScreen=last_screen;transition=last_transition;reverse=true}else{globalMaintainScroll=true;last_screen=currentScreen;last_transition=transition;transitioning=false;window.history.back();return}}}this.resetHoversFromClick();if(currentScreen==targetScreen)return;last_screen=currentScreen;last_transition=transition;if(navigatingToOverlay){if(!hotspotObject.backScreenUnderneathOverlay){this.screenUnderneathOverlay=currentScreen}this.triggerOverlayCalculations(targetScreen,hotspotObject);this.overlayTransition=transition}else{this.triggerCalculations(targetScreen,false,true)}transitioning=true;setTimeout(_.bind(function(){var image_url=$("#"+targetScreen+" img").attr("src");if(typeof image_url==="undefined"){console.log("No destination image found");transitioning=false;return}if(reverse)transition=transition+" reverse";if(transition=="zero")$(".screen-overlay-background").addClass("zero");var targetScreenView=prototype.getScreenView(targetScreen);if(targetScreenView){targetScreenView.renderHotspots(navigatingToOverlay?true:false)}if(navigatingFromOverlay){if(this.hasActiveOverlay){if(targetScreen==this.screenUnderneathOverlay){$("#"+currentScreen).addClass(transition+" out");$(".screen-overlay-background").addClass("fade out")}else{$(".screen-wrap.active").addClass(transition+" out");$(".screen-overlay-background").addClass(transition+" out");$("#"+currentScreen).addClass(transition+" out normal");$("#"+targetScreen).addClass(transition+" in active");prototype.screenUnderneathOverlay=null}}}else{if(navigatingToOverlay){if(hotspotObject.backScreenUnderneathOverlay){$(".screen-overlay-background").addClass(transition+" in active");$("#"+currentScreen).addClass(transition+" out");$("#"+hotspotObject.backScreenUnderneathOverlay).addClass(transition+" in active");$("#"+targetScreen).addClass(transition+" in normal screen-overlay")}else{$(".screen-overlay-background").css("background",hotspotObject.overlay_background_colour);$(".screen-overlay-background").addClass("fade in active");$("#"+targetScreen).addClass(transition+" in screen-overlay")}}else{$("#"+targetScreen).addClass(transition+" in active");$("#"+currentScreen).addClass(transition+" out")}}if(transition=="flip")$("#screens").addClass("viewport-flip");if(transition=="turn")$("#screens").addClass("viewport-turn");if(!mobile){$("#"+currentScreen).find(".antiscroll-wrap").antiscroll();$("#"+targetScreen).find(".antiscroll-wrap").antiscroll()}try{var image_type=image_url.indexOf(".gif")>-1;var image_url2=$("#"+currentScreen+" img").attr("src");var image_type2=image_url2.indexOf(".gif")>-1;if(maintainScroll==true){var scroll=$("#"+currentScreen+" .antiscroll-inner").scrollTop();$("#"+targetScreen+" .antiscroll-inner").scrollTop(scroll)}var listenScreen=targetScreen;if(navigatingFromOverlay&&targetScreen==this.screenUnderneathOverlay){listenScreen=current_screen;if(transition=="flow"){listenScreen=targetScreen}}var startTime=new Date;console.log("Listening to: "+listenScreen);var resetHappened=false;var failsafeTimeout=3e3;var problematicTransitionForOverlays=transitionBase=="fade"||transitionBase=="pop";if(problematicTransitionForOverlays){if(navigatingToOverlay||navigatingToOverlay){failsafeTimeout=500}}setTimeout(_.bind(function(){if(!resetHappened){$("#"+listenScreen).trigger(this.whichAnimationEvent());console.log("###");if(!problematicTransitionForOverlays){var error="Animation took very long to reset navigating "+currentScreen+" to "+targetScreen;console.error(error);if(navigatingToOverlay||navigatingToOverlay){Raven.captureException(error)}}}},this),failsafeTimeout);$("#"+listenScreen).one(this.whichAnimationEvent(),_.bind(function(event){event.stopPropagation();resetHappened=true;if(navigatingToOverlay){this.hasActiveOverlay=true;this.activeOverlayScreen=targetScreen;if(!hotspotObject.backScreenUnderneathOverlay){this.screenUnderneathOverlay=currentScreen}this.overlayBackgroundColour=hotspotObject.overlay_background_colour}else if(navigatingFromOverlay){this.hasActiveOverlay=false}prototype.currentScreenView.removeHotspots();$(".screen-wrap").removeClass(transition+" active in out screen-overlay normal");$(".screen-overlay-background").removeClass("in out fade zero "+transition);if(navigatingFromOverlay){$(".screen-overlay-background").removeClass("active");$("#"+targetScreen).addClass("active");this.currentScreenView.resetOverlayPositions()}else{if(navigatingToOverlay){if(hotspotObject.backScreenUnderneathOverlay){$("#"+hotspotObject.backScreenUnderneathOverlay).addClass("active");$("#"+targetScreen).removeClass().addClass("screen-wrap screen-overlay")}else{$("#"+this.screenUnderneathOverlay).addClass("active");$("#"+targetScreen).removeClass().addClass("screen-wrap screen-overlay")}}else{$("#screens").removeClass("viewport-flip viewport-turn");$("#"+targetScreen).addClass("active")}}if(image_type2)$("#"+currentScreen+" img").attr("src",image_url2);transitioning=false;if(iOS7){$(".antiscroll-inner").css("-webkit-overflow-scrolling","auto");$(".active .antiscroll-inner").css("-webkit-overflow-scrolling","touch")}if(!ignoreAddingToHistory){Backbone.trigger("page-transition",currentScreen,targetScreen,transition,hotspotObject,{is_overlay:this.hasActiveOverlay,screen_underneath_overlay:this.screenUnderneathOverlay,overlay_background_colour:this.overlayBackgroundColour})}previous_screen=current_screen;current_screen=targetScreen;prototype.currentScreenView=prototype.getScreenView(current_screen);this.unbindCurrentScreen();currentScreenView=this.getScreenView(current_screen);this.setCurrentScreen(currentScreenView);this.handleTimer();var endTime=new Date;console.log("Transition reset happens – "+(endTime-startTime)+"ms");var newSequenceNumber=parseInt(_.findKey(prototype.model.attributes.images,function(image){if(image.id==parseInt(current_screen)){return id}}));if(this.annotationsEnabled){$(".annotation").remove();this.annotationsView.collection.comments.reset();this.annotationsView.collection.comments.url="/api/comment/"+current_screen+"/";this.annotationsView.collection.comments.fetch();this.annotationsView.setImageFromSequenceNumber(newSequenceNumber)}try{if(!mobile)this.sidebar.updateSequence(newSequenceNumber)}catch(ex){}},this))}catch(ex){Raven.captureException("Problem navigating screens",ex);console.error("Problem navigating screens",ex);transitioning=false}},this),50)},updateEverything:function(){prototype.triggerCalculations(current_screen,false);prototype.callAntiscroll()},renderHotspotsForScreen:function(id){var targetScreenView=prototype.getScreenView(id);if(targetScreenView){targetScreenView.renderHotspots()}else{console.error("renderHotspotsForScreen: missing targetScreenView");Raven.captureException("Tried navigating to a screen that hasn't been added to the prototype via Pusher")}},removeHotspotsForScreen:function(id){var targetScreenView=prototype.getScreenView(id);if(targetScreenView){targetScreenView.removeHotspots()}else{console.error("removeHotspotsForScreen: missing targetScreenView");Raven.captureException("Tried navigating to a screen that hasn't been added to the prototype via Pusher")}},triggerCalculations:function(screen,sidebarToggle,forceForOverlay){if(!sidebarToggle)sidebarToggle=false;if(!forceForOverlay)forceForOverlay=false;if(this.hasActiveOverlay==true&&forceForOverlay==false)return;var targetScreenView=prototype.getScreenView(screen);if(targetScreenView){targetScreenView.calculateFixedAreas(targetScreenView.settings.fixedHeader,targetScreenView.settings.fixedFooter,targetScreenView.settings.trim,sidebarToggle)}else{console.error("triggerCalculations: missing targetScreenView");Raven.captureException("Tried navigating to a screen that hasn't been added to the prototype via Pusher")}},triggerOverlayCalculations:function(screen,hotspotObject){var targetScreenView=prototype.getScreenView(screen);if(targetScreenView){targetScreenView.calculateOverlayPositions(hotspotObject)}else{console.error("triggerOverlayCalculations: missing targetScreenView");Raven.captureException("Tried navigating to a screen that hasn't been added to the prototype via Pusher")}},handleAnchor:function(y_pos,smooth_scroll){var width=prototype.currentScreenView.settings.width;if(prototype.currentScreenView.settings.retina_scale)width=width*2;var zoom=$("#"+current_screen+" img").width()/width;var b=(y_pos-prototype.currentScreenView.settings.fixedHeader)*zoom;var currentScrollTop=$("#"+current_screen+" .antiscroll-inner").scrollTop();if(smooth_scroll){$("#"+current_screen+" .antiscroll-inner").animate({scrollTop:b},Math.min(Math.abs(Math.floor(currentScrollTop-b)),1e3),"easeInOutQuad")}else{$("#"+current_screen+" .antiscroll-inner").scrollTop(b)}},handleURL:function(url,new_window){if(offline==true){if(typeof Ti!=="undefined"){Ti.App.fireEvent("openLink",{linkUrl:url})}else{if(new_window){window.open(url,"_blank")}else{window.location.href=url}}}else{if(new_window){window.open(url,"_blank")}else{window.location.href=url}}},goHome:function(){var homeScreen=prototype.model.attributes.images[1].id;prototype.handleTransition(current_screen,homeScreen,"none",false)},openGrid:function(silent){if(typeof silent=="undefined")silent=false;this.gridView.open();this.gridView.setModels({project:this.model});if(typeof current_screen!=="undefined"){var transition="none";this.gridView.highlightThumbnail(current_screen);if(!silent)Backbone.history.navigate(current_screen+"/grid",{trigger:false})}},closeGrid:function(){var destination="/";if(current_screen){try{destination=current_screen.replace("/grid","")}catch(ex){}}Backbone.history.navigate(destination,{trigger:false})},goBack:function(transition){var goTransition="none";if(transition!=undefined)goTransition=transition;var maxIndex=_.size(prototype.model.attributes.images);var currentIndex=parseInt(_.findKey(prototype.model.attributes.images,function(image){if(image.id==parseInt(current_screen)){return id}}));if(currentIndex-1==0){var nextScreen=prototype.model.attributes.images[maxIndex].id}else{var nextScreen=prototype.model.attributes.images[currentIndex-1].id}this.handleTransition(current_screen,nextScreen,goTransition,false)},goForward:function(transition){var goTransition="none";if(transition!=undefined)goTransition=transition;var maxIndex=_.size(prototype.model.attributes.images);var currentIndex=parseInt(_.findKey(prototype.model.attributes.images,function(image){if(image.id==parseInt(current_screen)){return id}}));if(currentIndex+1>maxIndex){var nextScreen=prototype.model.attributes.images[1].id}else{var nextScreen=prototype.model.attributes.images[currentIndex+1].id}this.handleTransition(current_screen,nextScreen,goTransition,false)},flashHotspots:function(e){var disable=getProjectPropertyForName(this.model.attributes,projectConstants.PROJECT_PROP_SHOW_HINTS);if(this.annotationsView&&this.annotationsView.viewState.get("shown"))disable=1;if(disable!=1){if(!$(e.target).is(".hotspot")&&!$(e.target).is(".annotation")&&!$(e.target).is(".box-inner")&&!$(e.target).is(".overlay-image-wrap")){var time=300;clearTimeout(this.flashTimeout);if(this.hasActiveOverlay==true){$("body").addClass("overlay-hotspot-visible")}else{$("body").addClass("hotspot-visible")}this.flashTimeout=_.delay(function(){$("body").removeClass("hotspot-visible overlay-hotspot-visible")},time)}}},handleGestures:function(){var that=this;var disable_swipe=getProjectPropertyForName(this.model.attributes,projectConstants.PROJECT_PROP_DISABLE_SWIPE);if(mobile){$$(".screen-wrap").swipeRight(function(e){if(disable_swipe!="1")that.goBack("slide-left")});$$(".screen-wrap").swipeLeft(function(e){if(disable_swipe!="1")that.goForward("slide")})}$("body").on({mouseenter:function(e){if(!transitioning){$(document).unbind("mousemove.hover");var parentScreen=$(e.currentTarget).closest(".screen-wrap").attr("id");var id=parseInt($(e.currentTarget).attr("id").split("-")[1]);var currentImage=_.findWhere(prototype.model.get("images"),{id:parseInt(parentScreen)});if(!currentImage)return;var hotspotObject=_.findWhere(currentImage.hotspots,{id:id});if(!hotspotObject)return;var hoverScreen=hotspotObject.dest_img_fk;if(hotspotObject.stay_on_page){prototype.handleTransition(current_screen,hoverScreen,"none",false,hotspotObject)}else{that.hoverState=true;that.activeHoverScreen=hoverScreen;$("#"+hoverScreen).addClass("hover-active");$("#prototype").addClass("hover-state");if(hotspotObject.maintain_scroll){var scroll=$("#"+parentScreen+" .antiscroll-inner").scrollTop();var scrollLeft=$("#"+parentScreen+" .antiscroll-inner").scrollLeft();$("#"+hoverScreen+" .antiscroll-inner").scrollTop(scroll);$("#"+hoverScreen+" .antiscroll-inner").scrollLeft(scrollLeft)}that.renderHotspotsForScreen(hoverScreen);that.triggerCalculations(hoverScreen);var boundaries=$(e.currentTarget).offset();boundaries.left=Math.round(boundaries.left-1);boundaries.top=Math.round(boundaries.top-1);boundaries.right=Math.round(boundaries.left+$(e.currentTarget).outerWidth()+1);boundaries.bottom=Math.round(boundaries.top+$(e.currentTarget).outerHeight()+1);boundaries.screen=hoverScreen;that.hovers.push(boundaries);$(document).bind("mousemove.hover",function(e){if(that.hovers.length==0){$("#prototype").removeClass("hover-state");that.hoverState=false;return}var boundaries=that.hovers[that.hovers.length-1];if(e.pageY>=boundaries.top&&e.pageY<=boundaries.bottom&&e.pageX>=boundaries.left&&e.pageX<=boundaries.right){}else{if(hotspotObject.maintain_scroll){var targetScroll=$("#"+boundaries.screen+" .antiscroll-inner").scrollTop();var targetScrollLeft=$("#"+boundaries.screen+" .antiscroll-inner").scrollLeft();$("#"+parentScreen+" .antiscroll-inner").scrollTop(targetScroll);$("#"+parentScreen+" .antiscroll-inner").scrollLeft(targetScrollLeft)}$("#"+boundaries.screen).removeClass("hover-active");that.hovers.pop();$(".antiscroll-inner").unbind("scroll.hover");that.removeHotspotsForScreen(boundaries.screen)}})}}}},".hover");if(is_ie10){return}$$(".swiperight").swipeRight(function(e){that.handleGesture(e)});$$(".swipeleft").swipeLeft(function(e){that.handleGesture(e)});$$(".swipeup").swipeUp(function(e){that.handleGesture(e)});$$(".swipedown").swipeDown(function(e){that.handleGesture(e)});$$(".pinch").pinchIn(function(e){that.handleGesture(e)});$$(".pinchout").pinchOut(function(e){that.handleGesture(e)});$$(".doubletap").doubleTap(function(e){that.handleGesture(e)})},handleGesture:function(e){var id=parseInt($(e.currentTarget).attr("id").split("-")[1]);var currentImage=_.findWhere(prototype.model.get("images"),{id:parseInt(current_screen)});if(!currentImage)return;var hotspotObject=_.findWhere(currentImage.hotspots,{id:id});if(!hotspotObject)return;if(hotspotObject.type==projectConstants.TYPE_ANCHOR){this.handleAnchor(hotspotObject.anchor_y_pos,hotspotObject.smooth_scroll)}else if(hotspotObject.type==projectConstants.TYPE_URL){this.handleURL(hotspotObject.external_url,hotspotObject.new_window)}else{this.handleTransition(current_screen,hotspotObject.dest_img_fk,hotspotObject.transition,false,hotspotObject)}},blockScrolling:function(){$(document).bind("touchmove",function(e){e.preventDefault()})},unblockScrolling:function(){$(document).unbind("touchmove")},hideHomescreen:function(){var cookie_path=window.location.pathname;$(".addToHomescreen").hide();$.cookie("homescreen","1",{path:""+cookie_path})},handlePusherCalls:function(){Pusher.log=function(message){};pusher=new Pusher("70744d379f87a37df68a",{encrypted:true});pusher.connection.bind("error",function(err){});var prototype_channel=pusher.subscribe(MARVELAPP.settings.PUSHER.PROTOTYPE_CHANNEL_PREFIX+project_object.id);prototype_channel.bind(MARVELAPP.constants.pusher.EVENT_COMMENT,_.bind(function(data){var event_type=data.content["event_type"];if(event_type&&event_type===MARVELAPP.constants.pusher.TYPE_ANNOTATION_DELETED){_.each(this.annotationsView.collection.comments.models,function(comment){if(comment.id===data.content["uuid"]){comment.trigger("removeAnnotation",comment)}})}else if(event_type&&event_type===MARVELAPP.constants.pusher.TYPE_ANNOTATION_UPDATED){this.currentScreenView.updateAnnotation(data)}else{this.annotationsView.collection.comments.fetch({success:_.bind(function(){data={};if(typeof this.access_code!=="undefined"){data={access_code:this.access_code}}this.model.fetchUnreadCommentStatuses(data)},this)})}},this));var contentEventHandler=_.bind(function(data){var content=data.content.object;var sequence=this.model.getSequenceForImageId(content.id);if(content.status==projectConstants.QUEUE_IMG_STATUS_UPLOAD_FINISHED){this.model.addImage(content,sequence);this.updateScreen(content,false)}},this);prototype_channel.bind(MARVELAPP.constants.pusher.EVENT_CONTENT_CREATED,contentEventHandler);prototype_channel.bind(MARVELAPP.constants.pusher.EVENT_CONTENT_UPDATED,contentEventHandler);prototype_channel.bind(MARVELAPP.constants.pusher.EVENT_HOTSPOT,_.bind(function(data){var hotspot=data.content.object;var parentScreen=this.getScreenView(hotspot.img_owner_fk);var image_object=this.model.getImageForId(hotspot.img_owner_fk);if(!image_object)return;var found=false;if(typeof image_object!=="undefined"){for(id in image_object.hotspots){if(image_object.hotspots[id].id==hotspot.id){found=true;break}}}if(hotspot.status==projectConstants.HOTSPOT_DELETED){$("#hotspot-"+hotspot.id).remove();for(id in this.model.attributes.images){if(this.model.attributes.images[id].id==hotspot.img_owner_fk){for(hid in this.model.attributes.images[id].hotspots){if(this.model.attributes.images[id].hotspots[hid].id==hotspot.id){this.model.attributes.images[id].hotspots.remove(hid);break}}}}}else{if(parentScreen){if(found){for(id in this.model.attributes.images){if(this.model.attributes.images[id].id==hotspot.img_owner_fk){for(hid in this.model.attributes.images[id].hotspots){if(this.model.attributes.images[id].hotspots[hid].id==hotspot.id){this.model.attributes.images[id].hotspots[hid]=hotspot;break}}}}if(hotspot.type==2||hotspot.type==3){if(parentScreen.image_object!==undefined){for(id in parentScreen.image_object.hotspots){if(parentScreen.image_object.hotspots[id].id==hotspot.id){parentScreen.image_object.hotspots[id]=hotspot;this.updateScreen(parentScreen.image_object,true);break}}}}else{$("#hotspot-"+hotspot.id).remove();parentScreen.renderHotspot(hotspot);if(hotspot.is_overlay){var overlayScreen=this.getScreenView(hotspot.dest_img_fk);if($("#"+hotspot.dest_img_fk).hasClass("screen-overlay")){$(".screen-overlay-background").css("background",hotspot.overlay_background_colour);this.overlayBackgroundColour=hotspot.overlay_background_colour;if(overlayScreen){overlayScreen.calculateOverlayPositions(hotspot)}}}}}else{parentScreen.renderHotspot(hotspot);for(id in this.model.attributes.images){if(this.model.attributes.images[id].id==hotspot.img_owner_fk){this.model.attributes.images[id].hotspots.push(hotspot);break}}}}}},this))},forgotPassword:function(){$(".overlay").removeClass("activated");$("#forgot-password-modal").addClass("activated");$("#forgot-password-modal input[name=forgot-email]").val($("#resume-prototyping input[name=signin-email]").val());setTimeout(function(){if(!iOS)$("#forgot-password-modal input[name=forgot-email]").focus()},400)},forgotPasswordBack:function(){$(".overlay").removeClass("activated");$("#resume-prototyping").addClass("activated");setTimeout(function(){if(!iOS)$("#resume-prototyping input[name=signin-email]").focus()},400)},switchModals:function(){$(".overlay").removeClass("activated")},resumePrototyping:function(){$("#resume-prototyping").addClass("activated");$(".white-overlay").addClass("activated")},closeModal:function(){$(".overlay").removeClass("activated");$(".white-overlay").removeClass("activated");$("#forgot-success").removeClass("visible")},closeAnnotationMode:function(){prototype.currentScreenView.closeAddAnnotationMode()}});MARVELAPP.PrototypeViewIeBar=Backbone.View.extend({id:"ie-bar",tmpl:MARVELAPP.templates.PROTOTYPE_IE_BAR,events:{"click .close":"close"},render:function(){var cookie=$.cookie("hide-ie-bar");var shouldRender=cookie==="1"?false:true;if(shouldRender){this.$el.html(this.tmpl())}return this},close:function(e){e.preventDefault();this.$el.css("display","none");$.cookie("hide-ie-bar","1")}});MARVELAPP.ScreenView=Backbone.View.extend({image_object:null,firstImage:null,screenID:null,settings:null,el:"#screens",initialize:function(options){options=options||{};this.image_object=options.image_object;this.firstImage=options.firstImage;this.isOverlay=options.isOverlay;this.isScreenUnderOverlay=options.isScreenUnderOverlay;this.newCommentModel=new MARVELAPP.CommentModel},render:function(rerender,useImage){if(rerender==undefined)rerender=false;var image_object=this.image_object;var attributes=image_object;attributes.firstImage=this.firstImage;attributes.isOverlay=this.isOverlay;attributes.isScreenUnderOverlay=this.isScreenUnderOverlay;attributes.overlayPosition=-1;screenID=attributes.id;attributes.fixedHeader="";attributes.fixedHeaderURL="";attributes.fixedFooter="";attributes.fixedFooterURL="";attributes.retina_scale=getProjectPropertyForName(project_object,projectConstants.PROJECT_PROP_RETINA_SCALE);if(attributes.retina_scale=="1"){attributes.retina_scale=true;if(!rerender)attributes.width=attributes.width/2}else{attributes.retina_scale=false}$.each(image_object.hotspots,function(hotspot){
if(image_object.hotspots[hotspot].type==projectConstants.TYPE_FIXED_HORIZONTAL){if(image_object.hotspots[hotspot].location==projectConstants.TYPE_POSITION_TOP){attributes.fixedHeader=image_object.hotspots[hotspot].y;if(image_object.hotspots[hotspot].url==""||image_object.hotspots[hotspot].url==null||useImage){attributes.fixedHeaderURL=image_object.url}else{attributes.fixedHeaderURL=image_object.hotspots[hotspot].url}attributes.fixedHeaderURLAlt=image_object.url}else{attributes.fixedFooter=image_object.height-image_object.hotspots[hotspot].y;if(image_object.hotspots[hotspot].url==""||image_object.hotspots[hotspot].url==null||useImage){attributes.fixedFooterURL=image_object.url}else{attributes.fixedFooterURL=image_object.hotspots[hotspot].url}attributes.fixedFooterURLAlt=image_object.url}}});attributes.background=attributes.prototype_background=getProjectPropertyForName(project_object,projectConstants.PROJECT_PROP_PROTOTYPE_BACKGROUND_HEX);var white=false;var rgb=parseInt(attributes.background,16);var r=rgb>>16&255;var g=rgb>>8&255;var b=rgb>>0&255;var luma=.213*(r/255)+.715*(g/255)+.072*(b/255);if(luma<.5)white=true;attributes.white=white;attributes.trim_status=getProjectPropertyForName(project_object,projectConstants.PROJECT_PROP_REMOVE_STATUS);attributes.status_type=getProjectPropertyForName(project_object,projectConstants.PROJECT_PROP_STATUS_BAR);if(iOS9==true)attributes.status_type="0";if(offline==1&&mobile)attributes.trim_status="0";globalStatusType=attributes.status_type;globalTrimStatus=attributes.trim_status;attributes.disable_resizing=getProjectPropertyForName(project_object,projectConstants.PROJECT_PROP_NON_RESPONSIVE);attributes.center_overflow=getProjectPropertyForName(project_object,projectConstants.PROJECT_PROP_CENTER_OVERFLOW);if(explore){attributes.disable_resizing="0";attributes.center_overflow="0"}attributes.disable_resizing_scale="";var frame=getProjectPropertyForName(project_object,projectConstants.PROJECT_PROP_FRAME);var disable_sidebar=getProjectPropertyForName(project_object,projectConstants.PROJECT_PROP_DISABLE_FRAME);if(frame!=="web-frame"&&frame!=="desktop-view")attributes.disable_resizing="0";if(attributes.disable_resizing=="1"){if(disable_sidebar=="1"||frame=="web-frame"||frame=="desktop-view"){attributes.disable_resizing_scale=" min-width: "+attributes.width+"px;"}}if(attributes.status!=projectConstants.QUEUE_IMG_STATUS_UPLOAD_FINISHED&&!attributes.url){attributes.syncing=true}else{attributes.syncing=false}if(attributes.status==-2&&!attributes.url){attributes.syncing=false;attributes.failed=true}else{attributes.failed=false}if(!rerender){this.$el.append(MARVELAPP.templates.SCREEN(attributes))}else{if($("#"+image_object.id).hasClass("active"))attributes.firstImage=true;$("#"+image_object.id).replaceWith(MARVELAPP.templates.SCREEN(attributes))}if(attributes.trim_status=="1"){attributes.trim=true}else{attributes.trim=false}this.settings=attributes;this.calculateFixedAreas(attributes.fixedHeader,attributes.fixedFooter,attributes.trim);if(this.isOverlay){_.defer(_.bind(function(){this.calculateOverlayPositions(prototype.possibleHotspotForInitialOverlay)},this))}$("#"+image_object.id+" .fixed-header").unbind("touchstart");$("#"+image_object.id+" .fixed-header").bind("touchstart",function(e){if(iOS)e.preventDefault()});$("#"+image_object.id+" .fixed-footer").unbind("touchstart");$("#"+image_object.id+" .fixed-footer").bind("touchstart",function(e){if(iOS)e.preventDefault()});if(!mobile){if(rerender)$(window).off("resize");$(window).resize(_.bind(function(){if(prototype.hasActiveOverlay&&prototype.activeOverlayScreen==this.settings.id){this.calculateOverlayPositions({overlay_position:this.settings.overlayPosition,overlay_y:this.settings.overlayY,overlay_x:this.settings.overlayX})}else{this.calculateFixedAreas(attributes.fixedHeader,attributes.fixedFooter,false)}},this))}if(attributes.firstImage||attributes.isOverlay){this.renderHotspots(attributes.isOverlay?true:false)}var opts={lines:11,length:8,width:2,radius:8,corners:1,rotate:0,direction:1,color:white?"#FFF":"#000",speed:1,trail:60,shadow:false,hwaccel:false,className:"spinner",zIndex:2e9,top:"50%",left:"50%"};var target=document.getElementById("spinner_"+attributes.id);var spinner=new Spinner(opts).spin(target);if(rerender&&prototype.hasActiveOverlay&&prototype.activeOverlayScreen==this.settings.id){this.calculateOverlayPositions({overlay_position:this.settings.overlayPosition,overlay_y:this.settings.overlayY,overlay_x:this.settings.overlayX})}return this.$el},renderHotspots:function(noTrimOffset){if(typeof noTrimOffset=="undefined")noTrimOffset=false;$.each(this.settings.hotspots,_.bind(function(hotspot){this.renderHotspot(this.settings.hotspots[hotspot],noTrimOffset)},this))},removeHotspots:function(){$("#"+this.settings.id+" .hotspot").remove()},renderHotspot:function(hotspot_object,noTrimOffset){if(typeof noTrimOffset=="undefined")noTrimOffset=false;hotspot_object.inside_header=false;hotspot_object.inside_footer=false;hotspot_object.duplicate=false;var trimOffset=40;if(noTrimOffset==true)trimOffset=0;if(hotspot_object.transition==""||hotspot_object.transition==null){hotspot_object.transition="none"}if(hotspot_object.images.length!=0){hotspot_object.duplicate=true}if(this.settings.fixedHeader!=""){if(this.settings.fixedFooter!=""){hotspot_object.top=(hotspot_object.y-this.settings.fixedHeader)*100/(this.image_object.height-this.settings.fixedHeader-this.settings.fixedFooter)}else{hotspot_object.top=(hotspot_object.y-this.settings.fixedHeader)*100/(this.image_object.height-this.settings.fixedHeader)}}else{if(this.settings.fixedFooter!=""){if(this.settings.trim_status=="1"&&mobile){hotspot_object.top=(hotspot_object.y-trimOffset)*100/(this.image_object.height-trimOffset-this.settings.fixedFooter)}else{hotspot_object.top=hotspot_object.y*100/(this.image_object.height-this.settings.fixedFooter)}}else{if(this.settings.trim_status=="1"&&mobile){hotspot_object.top=(hotspot_object.y-trimOffset)*100/(this.image_object.height-trimOffset)}else{hotspot_object.top=hotspot_object.y*100/this.image_object.height}}}if(hotspot_object.y<this.settings.fixedHeader&&this.settings.fixedHeader!=""){hotspot_object.inside_header=true;if(this.settings.trim_status=="1"&&mobile){hotspot_object.height=(hotspot_object.y2-hotspot_object.y)*100/(this.settings.fixedHeader-40);hotspot_object.top=(hotspot_object.y-trimOffset)*100/(this.settings.fixedHeader-trimOffset)}else{hotspot_object.height=(hotspot_object.y2-hotspot_object.y)*100/this.settings.fixedHeader;hotspot_object.top=hotspot_object.y*100/this.settings.fixedHeader}}else if(hotspot_object.y2>this.image_object.height-this.settings.fixedFooter&&this.settings.fixedFooter!=""){hotspot_object.inside_footer=true;hotspot_object.height=(hotspot_object.y2-hotspot_object.y)*100/this.settings.fixedFooter;hotspot_object.top=-(this.image_object.height-this.settings.fixedFooter-hotspot_object.y)*100/this.settings.fixedFooter}else{if(this.settings.fixedHeader!=""){if(this.settings.fixedFooter!=""){hotspot_object.height=(hotspot_object.y2-hotspot_object.y)*100/(this.image_object.height-this.settings.fixedFooter-this.settings.fixedHeader)}else{hotspot_object.height=(hotspot_object.y2-hotspot_object.y)*100/(this.image_object.height-this.settings.fixedHeader)}}else{if(this.settings.fixedFooter!=""){hotspot_object.height=(hotspot_object.y2-hotspot_object.y)*100/(this.image_object.height-this.settings.fixedFooter)}else{hotspot_object.height=(hotspot_object.y2-hotspot_object.y)*100/this.image_object.height}}}hotspot_object.width=(hotspot_object.x2-hotspot_object.x)*100/this.image_object.width;hotspot_object.left=hotspot_object.x*100/this.image_object.width;if(this.settings.retina_scale){hotspot_object.width=hotspot_object.width/2;hotspot_object.left=hotspot_object.left/2}if(hotspot_object.anchor_y_pos!=null){var anchor_offset=0;if(this.settings.trim_status=="1"&&mobile)anchor_offset=-40;if(this.settings.fixedHeader!=""){if(this.settings.trim_status=="1"&&mobile){anchor_offset=anchor_offset-this.settings.fixedHeader+40}else{anchor_offset=anchor_offset-this.settings.fixedHeader}}hotspot_object.anchor_percent=(hotspot_object.anchor_y_pos+anchor_offset)*100/(this.image_object.height+anchor_offset)}if(!hotspot_object.smooth_scroll){hotspot_object.smooth_scroll=false}if(!hotspot_object.new_window){hotspot_object.new_window=false}var emailRegex=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(hotspot_object.type==projectConstants.TYPE_URL){if(emailRegex.test(hotspot_object.external_url)){hotspot_object.external_url="mailto:"+hotspot_object.external_url}}if(hotspot_object.type==projectConstants.TYPE_EMBED){hotspot_object.external_url=MARVELAPP.utils.sanitizeEmbed(hotspot_object.external_url);if(!MARVELAPP.utils.isValidEmbedCode(hotspot_object.external_url))return;if(hotspot_object.external_url.includes('src="https://www.youtube.com')){hotspot_object.external_url=hotspot_object.external_url.replace('src="https://www.youtube.com','src="https://www.youtube-nocookie.com')}}if(hotspot_object.type!=projectConstants.TYPE_FIXED_HORIZONTAL&&hotspot_object.type!=projectConstants.TYPE_FIXED_VERTICAL){if(hotspot_object.inside_header){$("#"+this.settings.id+" .fixed-header").append(MARVELAPP.templates.HOTSPOT(hotspot_object))}else if(hotspot_object.inside_footer){$("#"+this.settings.id+" .fixed-footer").append(MARVELAPP.templates.HOTSPOT(hotspot_object))}else{$("#"+this.settings.id+" .image").append(MARVELAPP.templates.HOTSPOT(hotspot_object))}}},bindEvents:function(){if(this.settings.disable_resizing=="1"){$("#"+this.settings.id+" .antiscroll-inner").scroll(_.bind(function(){if($("#"+this.settings.id).hasClass("active")||$("#"+this.settings.id).hasClass("hover-active")){this.updateFixedAreaPositions()}},this))}},updateFixedAreaPositions:function(){if(this.settings.disable_resizing=="1"&&this.settings.center_overflow=="0"){var leftOffset=$("#"+this.settings.id+" .image").offset().left;$("#"+this.settings.id+" .fixed-header").css("left",leftOffset+"px");$("#"+this.settings.id+" .fixed-footer").css("left",leftOffset+"px")}},calculateFixedAreas:function(fixedHeader,fixedFooter,trim,sidebarToggle,ignoreStatusBars){if(typeof sidebarToggle=="undefined")sidebarToggle=false;if(typeof ignoreStatusBars=="undefined")ignoreStatusBars=false;var status_type=getProjectPropertyForName(project_object,projectConstants.PROJECT_PROP_STATUS_BAR);if(iOS9==true)status_type="0";if(this.settings.retina_scale){fixedHeader/=2;fixedFooter/=2}var headerHeight=0;var footerHeight=0;var prototypeWidth=$("#"+this.settings.id+" .antiscroll-wrap").width();if($(".marvel-device").hasClass("desktop-view")||$(".marvel-device").hasClass("web-frame")||$(".screen").hasClass("desktop")){if(prototype.annotationsView&&prototype.annotationsView.viewState.get("shown")&&sidebarToggle){prototypeWidth-=400}else if(prototype.annotationsView&&!prototype.annotationsView.viewState.get("shown")&&sidebarToggle){prototypeWidth+=400}}if(!mobile){$("#"+this.settings.id+" .image").css("width",prototypeWidth)}var containerWidth=$("#"+this.settings.id+" .image").width();var leftPosition=0;if(!mobileMode)leftPosition=Math.round(containerWidth/2);if(this.settings.disable_resizing!="1"||this.settings.disable_resizing=="1"&&this.settings.center_overflow=="1"){$("#"+this.settings.id+" .image").css("margin-left",-leftPosition);$("#"+this.settings.id+" .fixed-header").css("margin-left",-leftPosition);$("#"+this.settings.id+" .fixed-footer").css("margin-left",-leftPosition);$("#"+this.settings.id+" .topBg").css("margin-left",-leftPosition);$("#"+this.settings.id+" .bottomBg").css("margin-left",-leftPosition)}if(fixedHeader!=""){headerHeight=fixedHeader*containerWidth/this.settings.width;if(!mobile)headerHeight=Math.round(headerHeight);$("#"+this.settings.id+" .fixed-header").height(headerHeight)}if(fixedFooter!=""){footerHeight=fixedFooter*containerWidth/this.settings.width;if(!mobile)footerHeight=Math.round(footerHeight);$("#"+this.settings.id+" .fixed-footer").height(footerHeight)}$("#"+this.settings.id+" .antiscroll-wrap").height($("#screens").height());$("#"+this.settings.id+" .antiscroll-inner").outerHeight($("#screens").height());$("#"+this.settings.id+" .antiscroll-inner").width("100%");$("#"+this.settings.id+" .antiscroll-inner img").css("margin-top",-headerHeight+"px");$("#"+this.settings.id+" .antiscroll-inner").css("padding-top",headerHeight+"px");$("#"+this.settings.id+" .antiscroll-inner").css("padding-bottom",footerHeight+"px");$("#"+this.settings.id+" .antiscroll-inner img").css("margin-bottom",-footerHeight+"px");$("#"+this.settings.id+" .image").css({"max-width":this.settings.width+"px"});if(!mobile&&firefox)$("#"+this.settings.id+" .image").css("margin-bottom",footerHeight+"px");if(prototype.activeOverlayScreen!=this.settings.id){this.handleStatusBars(status_type,trim,fixedHeader,fixedFooter)}this.updateFixedAreaPositions();if(prototype.hasActiveOverlay&&sidebarToggle&&prototype.activeOverlayScreen==this.settings.id){this.calculateOverlayPositions({overlay_position:this.settings.overlayPosition,overlay_y:this.settings.overlayY,overlay_x:this.settings.overlayX})}},handleStatusBars:function(status,trim,fixedHeader,fixedFooter){if(mobile){if(trim){var headerHeight=$("#"+this.settings.id+" .fixed-header").height()-20;if(fixedHeader!=""){$("#"+this.settings.id+" .fixed-header").height(headerHeight)}else{$("#"+this.settings.id+" .antiscroll-inner img").css("margin-top",-20+"px")}$("#"+this.settings.id+" .antiscroll-inner").css("padding-top",headerHeight+"px")}if(homescreen&&trim){if(status!="0"){var padding=parseInt($("#"+this.settings.id+" .antiscroll-inner").css("padding-top"));$("#"+this.settings.id+" .fixed-header").css("top","20px");$("#"+this.settings.id+" .antiscroll-inner").css("padding-top",padding+20+"px")}}}},getActualZoom:function(e){if(this.settings.retina_scale){var width=this.settings.width*2}else{var width=this.settings.width}var zoom=$("#"+this.settings.id+" .image").width()/width;return zoom},renderAnnotation:function(annotationModel,pulse){if(pulse==undefined)pulse=true;annotationModel.attributes.pulse=pulse;if(!$("#annotations-sidebar").hasClass("activated")){annotationModel.attributes.pulse=true}var renderingAnnotationModel=annotationModel;var x=annotationModel.get("x");var y=annotationModel.get("y");var fixedHeader=this.settings.fixedHeader;var fixedFooter=this.settings.fixedFooter;var insideHeader=false,insideFooter=false;if(y<fixedHeader&&this.settings.fixedHeader!=""){insideHeader=true}var imageHeight=this.settings.height;if(y>imageHeight-fixedFooter&&this.settings.fixedFooter!=""){insideFooter=true;y=y-(imageHeight-fixedFooter)}if(this.settings.fixedHeader!=""){if(this.settings.fixedFooter!=""){if(!insideHeader&&!insideFooter)y=y-fixedHeader}else{if(!insideHeader)y=y-fixedHeader}}else{if(this.settings.fixedFooter!=""){}}this.insideHeader=insideHeader;this.insideFooter=insideFooter;var heightDimensions=this.settings.height-fixedHeader-fixedFooter;if(insideHeader)heightDimensions=fixedHeader;if(insideFooter)heightDimensions=fixedFooter;renderingAnnotationModel.attributes["topPercent"]=y/heightDimensions*100;renderingAnnotationModel.attributes["leftPercent"]=x/($("#"+this.settings.id+" .image").width()/this.getActualZoom())*100;this.newCommentModel.attributes["annotation_x"]=annotationModel.get("x");this.newCommentModel.attributes["annotation_y"]=annotationModel.get("y");var annotationView=new MARVELAPP.AnnotationView(renderingAnnotationModel);this.trigger("addAnnotationView",annotationView);if($("#annotations-sidebar").hasClass("activated")){setTimeout(_.bind(function(){$("#"+this.settings.id+" .annotation").addClass("active")},this),0)}this.trigger("addNewCommentModel",this.newCommentModel)},setAnnotationView:function(annotationView){this.listenTo(annotationView,"highlightComment",function(uuid){$(".comment-uuid").removeClass("highlighted");$(".comment-uuid."+uuid).addClass("highlighted")});this.listenTo(annotationView,"unhighlightComment",function(uuid){$(".comment-uuid."+uuid).removeClass("highlighted")});this.listenTo(annotationView,"clickAnnotation",function(uuid){prototype.annotationsView.scrollToComment(uuid)});if(this.insideHeader){$("#"+this.settings.id+" .fixed-header").append(annotationView.render().$el)}else if(this.insideFooter){$("#"+this.settings.id+" .fixed-footer").append(annotationView.render().$el)}else{$("#"+this.settings.id+" .image").append(annotationView.render().$el)}if(annotationView.model.comment.attributes.show_delete){this.handleEditAnnotation(annotationView.model)}this.currentAnnotationView=annotationView},getTopOffset:function(){var topOffset=$("#"+this.settings.id+" .fixed-header").height()+$("#"+this.settings.id+" .antiscroll-inner").scrollTop();return topOffset},handleEditAnnotation:function(annotationModel){var screenID=this.settings.id;$(".annotation."+annotationModel.attributes.commentUUID).draggable({containment:$("#screens"),helper:"clone",appendTo:$("#"+screenID),cursor:"move",cursorAt:{top:17,left:17},start:_.bind(function(event,ui){$(".annotation."+annotationModel.attributes.commentUUID).not($(".ui-draggable-dragging")).hide();this.annotationPlacement()},this),drag:_.bind(function(event,ui){},this),stop:_.bind(function(event,ui){this.annotationPlacementOff();var newCoordinates=this.getCorrectAnnotationCoordinates(this.annotationX,this.annotationY);var newCoordinateData={comment_uuid:annotationModel.attributes.commentUUID,annotation_x:newCoordinates.x,annotation_y:newCoordinates.y};var newAnnotationModel=new MARVELAPP.AnnotationModel({x:newCoordinates.x,y:newCoordinates.y,commentUUID:annotationModel.attributes.commentUUID,reference:annotationModel.attributes.reference});newAnnotationModel.setModels({comment:annotationModel.comment});this.newCommentModel.attributes.annotation_x=newCoordinates.x;this.newCommentModel.attributes.annotation_y=newCoordinates.y;$(".annotation."+annotationModel.attributes.commentUUID).remove();$("#"+annotationModel.attributes.commentUUID).remove();this.renderAnnotation(newAnnotationModel,false);prototype.annotationsView.editAnnotation(annotationModel,newCoordinateData)},this)})},checkBoundaries:function(y,x,boundaries){if(!boundaries)return false;if(y>=boundaries.top&&y<=boundaries.bottom&&x>=boundaries.left&&x<=boundaries.right){return true}else{return false}},setAnnotationBoundaries:function(){this.wrapperBoundaries=$("#"+this.settings.id).offset();this.wrapperBoundaries.right=this.wrapperBoundaries.left+$("#"+this.settings.id).outerWidth();this.wrapperBoundaries.bottom=this.wrapperBoundaries.top+$("#"+this.settings.id).outerHeight();this.imageBoundaries=$("#"+this.settings.id+" .image").offset();this.imageBoundaries.right=this.imageBoundaries.left+$("#"+this.settings.id+" .image").outerWidth();this.imageBoundaries.bottom=this.imageBoundaries.top+$("#"+this.settings.id+" .image").outerHeight();if(this.settings.fixedHeader!=""){this.headerBoundaries=$("#"+this.settings.id+" .fixed-header").offset();this.headerBoundaries.right=this.headerBoundaries.left+$("#"+this.settings.id+" .fixed-header").outerWidth();this.headerBoundaries.bottom=this.headerBoundaries.top+$("#"+this.settings.id+" .fixed-header").outerHeight()}else{this.headerBoundaries=false}if(this.settings.fixedFooter!=""){this.footerBoundaries=$("#"+this.settings.id+" .fixed-footer").offset();this.footerBoundaries.right=this.footerBoundaries.left+$("#"+this.settings.id+" .fixed-footer").outerWidth();this.footerBoundaries.bottom=this.footerBoundaries.top+$("#"+this.settings.id+" .fixed-footer").outerHeight()}else{this.footerBoundaries=false}},annotationPlacement:function(){this.setAnnotationBoundaries();$(window).bind("resize.annotations",_.bind(this.setAnnotationBoundaries,this));$("#prototype").bind("mousemove.addAnnotation",_.bind(function(e){var insideImage=this.checkBoundaries(e.pageY,e.pageX,this.imageBoundaries);var insideHeader=this.checkBoundaries(e.pageY,e.pageX,this.headerBoundaries);var insideFooter=this.checkBoundaries(e.pageY,e.pageX,this.footerBoundaries);var insideWrapper=this.checkBoundaries(e.pageY,e.pageX,this.wrapperBoundaries);this.annotationHoverInsideFooter=false;this.annotationHoverInsideHeader=false;this.annotationHoverInsideBody=false;if(!insideWrapper)return;if(insideHeader){this.annotationHoverInsideHeader=true}else if(insideFooter){this.annotationHoverInsideFooter=true}else if(insideImage){this.annotationHoverInsideBody=true}if(this.annotationHoverInsideBody||this.annotationHoverInsideHeader||this.annotationHoverInsideFooter){this.annotationX=e.pageX;this.annotationY=e.pageY;this.annotationHoverInsideWrapper=true}},this))},annotationPlacementOff:function(){$("#prototype").unbind("mousemove.addAnnotation");$(window).unbind("resize.annotations")},addAnnotationMode:function(next_reference){prototype.annotationMode=true;this.annotationHoverInsideFooter=false;this.annotationHoverInsideHeader=false;this.annotationHoverInsideBody=false;this.annotationHoverInsideWrapper=false;this.annotationX=0;this.annotationY=0;this.annotationPlacement();$("#"+this.settings.id+" .hotspot").hide();$("#prototype").addClass("annotation-mode");$("#annotations-sidebar").removeClass("activated");$("#"+this.settings.id).bind("click",_.bind(function(e){if(this.annotationHoverInsideBody||this.annotationHoverInsideHeader||this.annotationHoverInsideFooter){this.newCommentModel=new MARVELAPP.CommentModel({annotation_x:this.annotationX,annotation_y:this.annotationY,uuid:generateUUID(),reference:next_reference});this.handleAnnotation(this.newCommentModel);$("#"+this.settings.id).unbind("click")}},this))},getCorrectAnnotationCoordinates:function(x,y){var zoom=this.getActualZoom();if(this.annotationHoverInsideHeader){y=(y-$("#"+this.settings.id+" .fixed-header").offset().top)/zoom;x=(x-$("#"+this.settings.id+" .fixed-header").offset().left)/zoom}if(this.annotationHoverInsideBody){y=(y-$("#"+this.settings.id+" .image").offset().top+$("#"+this.settings.id+" .fixed-header").height())/zoom;x=(x-$("#"+this.settings.id+" .image").offset().left)/zoom}if(this.annotationHoverInsideFooter){y=(y-$("#"+this.settings.id+" .fixed-footer").offset().top)/zoom;x=(x-$("#"+this.settings.id+" .fixed-footer").offset().left)/zoom;y=this.settings.height-this.settings.fixedFooter+y}return{x:Math.round(x),y:Math.round(y)}},handleAnnotation:function(commentModel){if(!this.annotationHoverInsideWrapper)return;var correctCoordinates=this.getCorrectAnnotationCoordinates(commentModel.get("annotation_x"),commentModel.get("annotation_y"));this.closeAddAnnotationMode();$(".make-annotation").addClass("hidden");$(".current-annotation").addClass("active");$(".current-annotation").addClass("temporary-uuid");$(".current-annotation").attr("data-uuid",commentModel.get("uuid"));$(".current-annotation .icon").html(commentModel.get("reference"));$("#comment-text").focus();var annotationModel=new MARVELAPP.AnnotationModel({x:correctCoordinates.x,y:correctCoordinates.y,commentUUID:commentModel.get("uuid"),reference:commentModel.get("reference")});annotationModel.setModels({comment:commentModel});this.renderAnnotation(annotationModel)},closeAddAnnotationMode:function(){prototype.annotationMode=false;$("#"+this.settings.id+" .hotspot").show();$("#prototype").removeClass("annotation-mode");this.annotationPlacementOff();$("#annotations-sidebar").addClass("activated");$("#"+this.settings.id).unbind("click")},scrollToAnnotation:function(uuid){var annotationView=prototype.annotationsView.getAnnotationView(uuid);annotationView.pulse();if($(".annotation."+uuid).parents(".fixed-header").length!==0)return;if($(".annotation."+uuid).parents(".fixed-footer").length!==0)return;var scrollPos=$(".annotation."+uuid).position().top+$("#"+this.settings.id+" .fixed-header").height();scrollPos=scrollPos-$("#screens").height()/2;$("#"+this.settings.id+" .antiscroll-inner").scrollTop(scrollPos)},updateAnnotation:function(data){var existingAnnotationView=prototype.annotationsView.getAnnotationView(data.content.uuid);if(!existingAnnotationView){return}var annotationModel=existingAnnotationView.model;this.currentAnnotationView=undefined;$(".annotation."+data.content.uuid).remove();annotationModel.attributes.x=data.content.annotation.x;annotationModel.attributes.y=data.content.annotation.y;this.renderAnnotation(annotationModel,false)},hasTimerHotspot:function(){var timerHotspotCount=0;_.each(this.image_object.hotspots,function(hotspot){if(hotspot.action===MARVELAPP.constants.hotspot.ACTION_TIMER){timerHotspotCount++}});if(timerHotspotCount>1){Raven.captureMessage("This screen has more than one timer hotspot")}if(timerHotspotCount>0){return true}else{return false}},getTimerHotspot:function(){if(this.hasTimerHotspot()){var timerHotspot=_.findWhere(this.image_object.hotspots,{action:MARVELAPP.constants.hotspot.ACTION_TIMER});return timerHotspot}},calculateOverlayPositions:function(hotspotObject){var hotspot=_.clone(hotspotObject);if(!hotspot)return;console.log("calculateOverlayPositions",hotspot);var deviceViewportWidth=$("#screens").width();var deviceViewportHeight=$("#screens").height();if(mobile){deviceViewportWidth=window.screen.width;deviceViewportHeight=window.screen.height}var screenUnderneathOverlay=prototype.model.getImageForId(prototype.screenUnderneathOverlay);var zoom=$("#screens").width()/screenUnderneathOverlay.width;if(zoom>1)zoom=1;var screenHeight=this.settings.height*zoom;var trimScreenHeight=screenHeight;var screenWidth=this.settings.width*zoom;var adjustedWidth=this.settings.width*zoom;var ratio=this.settings.width/this.settings.height;if(this.settings.retina_scale=="1"){ratio=this.settings.width*2/this.settings.height}var needToScaleWidth=adjustedWidth<deviceViewportWidth?true:false;var needToTrimStatusBars=false;if(hotspot.overlay_position==projectConstants.OVERLAY_TOP_LEFT||hotspot.overlay_position==projectConstants.OVERLAY_TOP_CENTER||hotspot.overlay_position==projectConstants.OVERLAY_TOP_RIGHT){if(mobile&&Math.abs(deviceViewportHeight-trimScreenHeight)<4){needToTrimStatusBars=true}}$("#"+this.settings.id+" .image").removeAttr("style");this.calculateFixedAreas("","",this.settings.trim);if(needToTrimStatusBars){this.handleStatusBars(this.settings.status_type,true,"","")}else{$("#"+this.settings.id+" .fixed-header").css("top","0px");$("#"+this.settings.id+" .antiscroll-inner").css("padding-top","0px");$("#"+this.settings.id+" .antiscroll-inner img").css("margin-top","0px")}if(this.settings.disable_resizing=="1"){needToScaleWidth=false;zoom=1}if(needToScaleWidth){this.setImageWidth(adjustedWidth,hotspot)}else{this.setImageWidth($("#screens").width(),hotspot)}this.settings.overlayPosition=hotspot.overlay_position;this.settings.overlayY=hotspot.overlay_y;this.settings.overlayX=hotspot.overlay_x;if(hotspot.overlay_position==projectConstants.OVERLAY_CUSTOM&&prototype.isWebProject()){var $screenUnderneathOverlay=$("#"+prototype.screenUnderneathOverlay);var verticalScrollOffset=$screenUnderneathOverlay.find(".fixed-header").height();if(this.settings.retina_scale=="1"){hotspot.overlay_y/=2}hotspot.overlay_y-=verticalScrollOffset/zoom}var position="absolute";if(prototype.isWebProject())position="fixed";if(hotspot.overlay_position==projectConstants.OVERLAY_CENTERED){$("#"+this.settings.id+" .image").css({position:position,top:"50%",left:"50%",bottom:"auto",right:"auto","margin-left":-$("#"+this.settings.id+" .image").width()/2,"margin-top":-($("#"+this.settings.id+" .image").width()/ratio)/2})}else if(hotspot.overlay_position==projectConstants.OVERLAY_TOP_LEFT){$("#"+this.settings.id+" .image").css({position:position,top:0,left:0,bottom:"auto",right:"auto"})}else if(hotspot.overlay_position==projectConstants.OVERLAY_TOP_CENTER){$("#"+this.settings.id+" .image").css({position:position,top:0,bottom:"auto",left:"50%",right:"auto","margin-left":-$("#"+this.settings.id+" .image").width()/2})}else if(hotspot.overlay_position==projectConstants.OVERLAY_TOP_RIGHT){$("#"+this.settings.id+" .image").css({position:position,top:0,bottom:"auto",right:0,left:"auto"})}else if(hotspot.overlay_position==projectConstants.OVERLAY_BOTTOM_LEFT){$("#"+this.settings.id+" .image").css({position:position,top:"auto",bottom:0,left:0,right:"auto"})}else if(hotspot.overlay_position==projectConstants.OVERLAY_BOTTOM_CENTER){$("#"+this.settings.id+" .image").css({position:position,top:"auto",bottom:0,left:"50%",right:"auto","margin-left":-$("#"+this.settings.id+" .image").width()/2})}else if(hotspot.overlay_position==projectConstants.OVERLAY_BOTTOM_RIGHT){$("#"+this.settings.id+" .image").css({position:position,top:"auto",bottom:0,left:"auto",right:0})}else if(hotspot.overlay_position==projectConstants.OVERLAY_CUSTOM){var customPositionHeight=screenUnderneathOverlay.height;if(this.settings.trim_status=="1"){if(mobile){customPositionHeight-=80;hotspot.overlay_y-=80}}var customPositionWidth=screenUnderneathOverlay.width;if(this.settings.retina_scale=="1"){customPositionWidth*=2}$("#"+this.settings.id+" .image").css({position:"absolute",top:hotspot.overlay_y/customPositionHeight*100+"%",bottom:"auto",left:hotspot.overlay_x/customPositionWidth*100+"%",right:"auto"})}},setImageWidth:function(width,hotspot){var ratio=this.settings.width/this.settings.height;var $overlayScreen=$("#"+this.settings.id);var screenViewUnderneathOverlay=prototype.getScreenView(prototype.screenUnderneathOverlay);var screenUnderneathOverlayZoom=screenViewUnderneathOverlay.getActualZoom();var $screenUnderneathOverlay=$("#"+prototype.screenUnderneathOverlay);var screenUnderneathOverlayWidth=$screenUnderneathOverlay.find("img").width();var screenUnderneathOverlayHeight=screenViewUnderneathOverlay.settings.height*screenUnderneathOverlayZoom;var screenUnderneathOverlayRatio=prototype.screenViews[prototype.screenUnderneathOverlay].settings.width/prototype.screenViews[prototype.screenUnderneathOverlay].settings.height;if(!prototype.isWebProject()){if(hotspot.overlay_position!=projectConstants.OVERLAY_CUSTOM){if(screenUnderneathOverlayHeight>$("#screens").height())screenUnderneathOverlayHeight=$("#screens").height()}}if(prototype.isWebProject()){$overlayScreen.find(".antiscroll-wrap").width($screenUnderneathOverlay.find(".antiscroll-wrap").width());$overlayScreen.find(".antiscroll-wrap").height($screenUnderneathOverlay.find(".antiscroll-wrap").height());$overlayScreen.find(".antiscroll-inner").width($screenUnderneathOverlay.find(".antiscroll-inner").width());if(prototype.screenViews[prototype.screenUnderneathOverlay].settings.fixedHeader!=""){$overlayScreen.find(".antiscroll-inner").css({position:"absolute",top:$screenUnderneathOverlay.find(".fixed-header").height()})}if(this.settings.disable_resizing=="1"){$overlayScreen.find(".antiscroll-inner").css({position:"absolute",left:$screenUnderneathOverlay.find(".box").offset().left})}$overlayScreen.find(".antiscroll-inner").height($screenUnderneathOverlay.find(".antiscroll-inner").height());if(!$overlayScreen.find(".image").parent().is(".overlay-image-wrap")){$overlayScreen.find(".image").wrap("<div class='overlay-image-wrap'></div>")}$overlayScreen.find(".overlay-image-wrap").css({width:$screenUnderneathOverlay.find(".image").width(),height:$screenUnderneathOverlay.find(".image").width()/screenUnderneathOverlayRatio,position:"relative"});if(this.settings.disable_resizing!="1"){$overlayScreen.find(".overlay-image-wrap").css({marginTop:"0",marginRight:"auto",marginBottom:"0",marginLeft:"auto"})}if(this.settings.center_overflow=="1"){if($(window).width()<=$screenUnderneathOverlay.find(".image").width()){$overlayScreen.find(".overlay-image-wrap").css({left:"50%","margin-left":-$screenUnderneathOverlay.find(".image").width()/2+"px"})}else{$overlayScreen.find(".overlay-image-wrap").css({left:0,"margin-left":0})}}$overlayScreen.find(".image").css({width:width+"px","margin-left":0});if(this.settings.disable_resizing=="1"){$overlayScreen.find(".box").removeAttr("style")}$overlayScreen.find(".antiscroll-inner").bind("scroll.overlay",function(){
var scroll=$overlayScreen.find(".antiscroll-inner").scrollTop();var scrollLeft=$overlayScreen.find(".antiscroll-inner").scrollLeft();$screenUnderneathOverlay.find(".antiscroll-inner").scrollTop(scroll);$screenUnderneathOverlay.find(".antiscroll-inner").scrollLeft(scrollLeft)});var scroll=$screenUnderneathOverlay.find(".antiscroll-inner").scrollTop();$overlayScreen.find(".antiscroll-inner").scrollTop(scroll)}else{$overlayScreen.find(".antiscroll-wrap").width(screenUnderneathOverlayWidth);$overlayScreen.find(".antiscroll-wrap").height(screenUnderneathOverlayHeight);$overlayScreen.find(".antiscroll-inner").width(screenUnderneathOverlayWidth);$overlayScreen.find(".antiscroll-inner").height(screenUnderneathOverlayHeight);$overlayScreen.find(".box-inner").width(screenUnderneathOverlayWidth);$overlayScreen.find(".box-inner").height(screenUnderneathOverlayHeight);$overlayScreen.find(".image").css({width:width+"px","margin-left":0})}},resetOverlayPositions:function(){console.log("resetOverlayPositions",this.settings.id);$("#"+this.settings.id).find(".antiscroll-inner").unbind("scroll.overlay");$("#"+this.settings.id+" .antiscroll-wrap").removeAttr("style");$("#"+this.settings.id+" .antiscroll-inner").removeAttr("style");$("#"+this.settings.id+" .box-inner").removeAttr("style");$("#"+this.settings.id+" .image").removeAttr("style");if(this.settings.disable_resizing=="1"){$("#"+this.settings.id+" .box").css({"max-width":this.settings.width+"px"})}console.log($("#"+this.settings.id+" .image").parent(),$("#"+this.settings.id+" .image").parent().is(".overlay-image-wrap"));if($("#"+this.settings.id+" .image").parent().is(".overlay-image-wrap")){$("#"+this.settings.id+" .image").unwrap()}this.calculateFixedAreas(this.settings.fixedHeader,this.settings.fixedFooter,this.settings.trim)}});MARVELAPP.SidebarView=Backbone.View.extend({el:"#sidebar",events:{"click .home":"returnHome","click .prev":"goBack","click .next":"goForward","click .grid":"openGrid","click .close":"toggleSidebar"},initialize:function(){this.render()},render:function(){var attributes=this.model.project.toJSON();attributes.first_name=attributes.images[1].name;attributes.first_description=attributes.images[1].description;attributes.first_index=1;for(image in attributes.images){var image_object=attributes.images[image];if(image_object.id==attributes.first_image){attributes.first_description=replaceURLWithHTMLLinks(image_object.description);attributes.first_name=image_object.name;attributes.first_index=image}}if(!attributes.initial)attributes.initial==true;this.$el.html(MARVELAPP.templates.SIDEBAR(attributes));return this},updateSequence:function(index){var modelJSON=this.model.project.toJSON();this.$el.find(".current").html(index);$("#screen-name").html(_.escape(modelJSON.images[index].name).replace(/%(..)/g,"&#x$1;"));var description=_.escape(modelJSON.images[index].description);if(description!=null){this.$el.find(".description").html(replaceURLWithHTMLLinks(description))}else{this.$el.find(".description").html("")}},returnHome:function(){prototype.goHome()},goBack:function(){prototype.goBack()},goForward:function(){prototype.goForward()},openGrid:function(){prototype.openGrid()},toggleSidebar:function(e){var cookie=$.cookie("sidebar");if(cookie=="0"||typeof cookie==="undefined"){$.cookie("sidebar","1");$("#sidebar").addClass("collapsed");$("#prototype").addClass("collapsed-navigation");$("#content-wrapper").addClass("collapsed")}else{$.cookie("sidebar","0");$("#sidebar").removeClass("collapsed");$("#prototype").removeClass("collapsed-navigation");$("#content-wrapper").removeClass("collapsed")}setTimeout(function(){prototype.triggerCalculations(current_screen)},250)}});function clampName(name,chars){if(name.length>chars){var length=(chars-3)/2;var a=name.substring(0,length);var b=name.substring(name.length-length,name.length);var clampedName=a+"..."+b;return clampedName}else{return name}}MARVELAPP.utils.clampName=clampName;function convertHotspotPositionUp(image_orig_width,image_orig_height,image_width,image_height,x,y,x2,y2){var hspot_return={};hspot_return.x=x;hspot_return.y=y;hspot_return.x2=x2;hspot_return.y2=y2;var w_conversion=image_orig_width/image_width;var h_conversion=image_orig_height/image_height;hspot_return.x=x*w_conversion;hspot_return.y=y*h_conversion;hspot_return.x2=x2*w_conversion;hspot_return.y2=y2*h_conversion;return hspot_return}function roundHotspotPositionToNearest(position){var roundedUpPosition={};roundedUpPosition.x=Math.round(position.x);roundedUpPosition.y=Math.round(position.y);roundedUpPosition.x2=Math.round(position.x2);roundedUpPosition.y2=Math.round(position.y2);return roundedUpPosition}function convertHotspotPositionDown(image_orig_width,image_orig_height,image_width,image_height,x,y,x2,y2){var hspot_return={};hspot_return.x=x;hspot_return.y=y;hspot_return.x2=x2;hspot_return.y2=y2;var w_conversion=image_orig_width/image_width;var h_conversion=image_orig_height/image_height;hspot_return.x=x/w_conversion;hspot_return.y=y/h_conversion;hspot_return.x2=x2/w_conversion;hspot_return.y2=y2/h_conversion;return hspot_return}function getEmbedCode(projectModel){var projectConstants=new ProjectConstants;var vanityURL=projectModel.get("embed_url");var frame=projectModel.getPropertyForName(projectConstants.PROJECT_PROP_FRAME);var disabled=projectModel.getPropertyForName(projectConstants.PROJECT_PROP_DISABLE_FRAME);var orientation=projectModel.getPropertyForName(projectConstants.PROJECT_PROP_ORIENTATION);var landscape=false;var subscribed=projectModel.get("is_pro");var labelPadding=0;var devicePadding=20;if(subscribed)labelPadding=0;if(typeof orientation!=="undefined"){if(orientation.value==projectConstants.ORIENTATION_LANDSCAPE){landscape=true}}if(projectModel.get("images")&&projectModel.get("images")[1]){var embedWidth=projectModel.get("images")[1].width;var embedHeight=projectModel.get("images")[1].height;var firstWidth=projectModel.get("images")[1].width;if(disabled.value=="1"){embedWidth=projectModel.get("images")[1].width;embedHeight=projectModel.get("images")[1].height}else if(frame.value=="apple-watch-38-frame"){embedWidth=219+devicePadding;embedHeight=386+devicePadding+labelPadding}else if(frame.value=="apple-watch-42-frame"){embedWidth=255+devicePadding;embedHeight=447+devicePadding+labelPadding}else if(frame.value=="iphone4s-frame"){embedWidth=375+devicePadding;embedHeight=736+devicePadding+labelPadding;if(landscape){embedWidth=736+devicePadding;embedHeight=375+devicePadding+labelPadding}}else if(frame.value=="iphone5-frame"||frame.value=="iphone5photo-frame"){embedWidth=382+devicePadding;embedHeight=803+devicePadding+labelPadding;if(landscape){embedWidth=803+devicePadding;embedHeight=382+devicePadding+labelPadding}}else if(frame.value=="iphone5c-frame"||frame.value=="iphone5cphoto-frame"){embedWidth=384+devicePadding;embedHeight=806+devicePadding+labelPadding;if(landscape){embedWidth=806+devicePadding;embedHeight=384+devicePadding+labelPadding}}else if(frame.value=="nexus5-frame"){embedWidth=370+devicePadding;embedHeight=735+devicePadding+labelPadding;if(landscape){embedWidth=735+devicePadding;embedHeight=370+devicePadding+labelPadding}}else if(frame.value=="s5-frame"){embedWidth=368+devicePadding;embedHeight=713+devicePadding+labelPadding;if(landscape){embedWidth=713+devicePadding;embedHeight=368+devicePadding+labelPadding}}else if(frame.value=="lumia920-frame"){embedWidth=397+devicePadding;embedHeight=724+devicePadding+labelPadding;if(landscape){embedWidth=724+devicePadding;embedHeight=397+devicePadding+labelPadding}}else if(frame.value=="htc-one-frame"){embedWidth=370+devicePadding;embedHeight=745+devicePadding+labelPadding;if(landscape){embedWidth=745+devicePadding;embedHeight=370+devicePadding+labelPadding}}else if(frame.value=="ipad-frame"){embedWidth=656+devicePadding;embedHeight=928+devicePadding+labelPadding;if(landscape){embedWidth=928+devicePadding;embedHeight=656+devicePadding+labelPadding}}else if(frame.value=="iphone6-frame"||frame.value=="iphone6photo-frame"){embedWidth=432+devicePadding;embedHeight=881+devicePadding+labelPadding;if(landscape){embedWidth=881+devicePadding;embedHeight=432+devicePadding+labelPadding}}else if(frame.value=="iphone6plus-frame"||frame.value=="iphone6plusphoto-frame"){embedWidth=474+devicePadding;embedHeight=956+devicePadding+labelPadding;if(landscape){embedWidth=956+devicePadding;embedHeight=474+devicePadding+labelPadding}}else if(firstWidth==640||firstWidth==320){embedWidth=382+devicePadding;embedHeight=803+devicePadding+labelPadding;if(landscape){embedWidth=803+devicePadding;embedHeight=382+devicePadding+labelPadding}}else if(firstWidth==750){embedWidth=432+devicePadding;embedHeight=881+devicePadding+labelPadding;if(landscape){embedWidth=881+devicePadding;embedHeight=432+devicePadding+labelPadding}}else if(firstWidth==1242){embedWidth=474+devicePadding;embedHeight=956+devicePadding+labelPadding;if(landscape){embedWidth=956+devicePadding;embedHeight=474+devicePadding+labelPadding}}var embedCode='<iframe src="'+vanityURL+'?emb=1" width="'+embedWidth+'" height="'+embedHeight+'" '+'allowTransparency="true" frameborder="0"></iframe>';return embedCode}return}MARVELAPP.utils.getEmbedCode=getEmbedCode;function haveHotspotImagesChanged(newHotspot,existingHotspot){var screenComparisonMap,screenComparisonMap2,newHotspotId,screenIdA,screenIdB;if(newHotspot&&existingHotspot){if(!newHotspot.images&&!!existingHotspot.images){return true}if(newHotspot.images){screenComparisonMap={};for(newHotspotId in newHotspot.images){var newHotspotScreenId=newHotspot.images[newHotspotId];screenComparisonMap[newHotspotScreenId]=newHotspotScreenId}screenComparisonMap2=[];for(screenIdA in existingHotspot.images){screenIdB=existingHotspot.images[screenIdA];if(!screenComparisonMap[screenIdB]){return true}screenComparisonMap2[screenIdB]=screenIdB}for(newHotspotId in newHotspot.images){screenIdB=newHotspot.images[newHotspotId];if(!screenComparisonMap2[screenIdB]){return true}}}return false}return true}function hasHotspotChanged(newHotspot,existingHotspot){if(newHotspot){if(parseInt(newHotspot.x,10)===parseInt(existingHotspot.x,10)&&parseInt(newHotspot.x2,10)===parseInt(existingHotspot.x2,10)&&parseInt(newHotspot.y,10)===parseInt(existingHotspot.y,10)&&parseInt(newHotspot.y2,10)===parseInt(existingHotspot.y2,10)&&newHotspot.dest_img_fk===existingHotspot.dest_img_fk&&newHotspot.transition===existingHotspot.transition&&newHotspot.maintain_scroll===existingHotspot.maintain_scroll&&newHotspot.stay_on_page===existingHotspot.stay_on_page&&newHotspot.action===existingHotspot.action&&newHotspot.owner_hotspot===existingHotspot.owner_hotspot&&newHotspot.status===existingHotspot.status&&haveHotspotImagesChanged(newHotspot,existingHotspot)===false&&newHotspot.external_url===existingHotspot.external_url){return false}else{return true}}return true}MARVELAPP.utils.hasHotspotChanged=hasHotspotChanged;function MixPanelMock(){var logging=true;this.track=function(){if(logging){console.log("Mixpanel.track:",arguments)}};this.identify=function(){if(logging){console.log("Mixpanel.identify:",arguments)}};this.people={};this.people.set=function(){if(logging){console.log("Mixpanel.people.set:",arguments)}};this.toggleLogging=function(){logging=!logging;if(!logging){console.log("MixPanelMock is no longer logging. To turn it back on, run window.mixpanel.toggleLogging() in your console")}}}MARVELAPP.utils.dzCheckFilename=function(file,done){console.log("Checking filename",file.name);if(!MARVELAPP.utils.validFilename(file.name)){done(projectConstants.MSG_INVALID_FILENAME)}else{done()}};MARVELAPP.utils.validFilename=function(filename){var character;for(var index in MARVELAPP.settings.DISALLOWED_FILENAME_CHARACTERS){character=MARVELAPP.settings.DISALLOWED_FILENAME_CHARACTERS[index];if(filename.indexOf(character)>-1){return false}}return true};function preloadImage(url,callback){var img=new Image;img.onload=function(){callback(img)};img.src=url}function readLocalImage(file,callback){var fileReader=new FileReader;fileReader.readAsDataURL(file);var img=new Image;img.onload=function(){callback({url:fileReader.result,thumbnail:fileReader.result,width:img.width,height:img.height,source_platform:MARVELAPP.constants.content.SOURCE_TYPES.SOURCE_DESKTOP})};fileReader.onload=function(){img.src=fileReader.result}}function readLocalPSD(file,callback){var PSD=require("psd");var base64EncodedImage;var img=new Image;img.onload=function(){callback({url:base64EncodedImage,thumbnail:base64EncodedImage,name:file.name,width:img.width,height:img.height,source_platform:MARVELAPP.constants.content.SOURCE_TYPES.SOURCE_DESKTOP})};PSD.fromDroppedFile(file).then(function(psd){base64EncodedImage=psd.image.toBase64();img.src=base64EncodedImage})}if(!MARVELAPP.SanitizeConfig){MARVELAPP.SanitizeConfig={}}MARVELAPP.SanitizeConfig.COMMENT={elements:["a","b","div","br","code"],attributes:{a:["href","title"],div:["class","style"]},add_attributes:{a:{rel:"nofollow",target:"_blank"}},protocols:{a:{href:["http","https","mailto"]}}};MARVELAPP.SanitizeConfig.EMBED={remove_contents:true,elements:["iframe"],attributes:{iframe:["src","allowfullscreen","frameborder","scrolling","allowtransparency"]}};MARVELAPP.SanitizeConfig.STRICT={remove_contents:true};function sanitizeText(text){var elm=document.implementation.createHTMLDocument("Element to clean").body;var s=new Sanitize(MARVELAPP.SanitizeConfig.COMMENT);elm.innerHTML=text;cleaned_fragment=s.clean_node(elm);elm=document.implementation.createHTMLDocument("Element to clean").body;elm.appendChild(cleaned_fragment);return elm.innerHTML}function sanitizeEmbed(text){var elm=document.implementation.createHTMLDocument("Element to clean").body;var s=new Sanitize(MARVELAPP.SanitizeConfig.EMBED);elm.innerHTML=text;cleaned_fragment=s.clean_node(elm);elm=document.implementation.createHTMLDocument("Element to clean").body;elm.appendChild(cleaned_fragment);return elm.innerHTML}function sanitizeCompletely(text){var elm=document.implementation.createHTMLDocument("Element to clean").body;var s=new Sanitize(MARVELAPP.SanitizeConfig.STRICT);elm.innerHTML=text;cleaned_fragment=s.clean_node(elm);elm=document.implementation.createHTMLDocument("Element to clean").body;elm.appendChild(cleaned_fragment);return elm.innerHTML}function stylizeText(text){var hex_regex=/(#[a-f0-9]{6})(?![<"0-9])/gim;var email_test=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;var urlified=urlize(text,{target:"_blank"});urlified.replace(email_test,'<a href="mailto:$1">$1</a>');var hex=urlified.replace(hex_regex,'<div class="hex" style="background-color:$1"></div>$1');var full=hex.replace(/```([^`]+)```/g,'<code class="full">$1</code>');var code=full.replace(/`([^`]+)`/g,"<code>$1</code>");var cleanHTML=MARVELAPP.utils.sanitizeText(code);return cleanHTML}MARVELAPP.utils.sanitizeText=sanitizeText;MARVELAPP.utils.stylizeText=stylizeText;MARVELAPP.utils.sanitizeEmbed=sanitizeEmbed;MARVELAPP.utils.isValidEmbedCode=isValidEmbedCode;MARVELAPP.utils.sanitizeCompletely=sanitizeCompletely;function isValidEmbedCode(enteredURL){if(enteredURL.includes("<iframe")&&enteredURL.includes("></iframe>")&&(enteredURL.includes('src="https://www.youtube.com')||enteredURL.includes('src="https://www.youtube-nocookie.com')))return true;if(enteredURL.includes("<iframe")&&enteredURL.includes("></iframe>")&&enteredURL.includes('src="https://player.vimeo.com/'))return true;if(enteredURL.includes("<iframe")&&enteredURL.includes("></iframe>")&&enteredURL.includes('src="https://w.soundcloud.com/player/'))return true;if(enteredURL.includes("<iframe")&&enteredURL.includes("></iframe>")&&enteredURL.includes('src="https://embed.spotify.com/'))return true;if(enteredURL.includes("<iframe")&&enteredURL.includes("></iframe>")&&enteredURL.includes('src="https://www.google.com/maps/embed'))return true;return false}function Sanitize(){var i,e,options;options=arguments[0]||{};this.config={};this.config.elements=options.elements?options.elements:[];this.config.attributes=options.attributes?options.attributes:{};this.config.attributes[Sanitize.ALL]=this.config.attributes[Sanitize.ALL]?this.config.attributes[Sanitize.ALL]:[];this.config.allow_comments=options.allow_comments?options.allow_comments:false;this.allowed_elements={};this.config.protocols=options.protocols?options.protocols:{};this.config.add_attributes=options.add_attributes?options.add_attributes:{};this.dom=options.dom?options.dom:document;for(i=0;i<this.config.elements.length;i++){this.allowed_elements[this.config.elements[i]]=true}this.config.remove_element_contents={};this.config.remove_all_contents=false;if(options.remove_contents){if(options.remove_contents instanceof Array){for(i=0;i<options.remove_contents.length;i++){this.config.remove_element_contents[options.remove_contents[i]]=true}}else{this.config.remove_all_contents=true}}this.transformers=options.transformers?options.transformers:[]}Sanitize.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i;Sanitize.RELATIVE="__RELATIVE__";Sanitize.ALL="__ALL__";Sanitize.prototype.clean_node=function(container){var fragment=this.dom.createDocumentFragment();this.current_element=fragment;this.whitelist_nodes=[];function _array_index(needle,haystack){var i;for(i=0;i<haystack.length;i++){if(haystack[i]==needle)return i}return-1}function _merge_arrays_uniq(){var result=[];var uniq_hash={};var i,j;for(i=0;i<arguments.length;i++){if(!arguments[i]||!arguments[i].length)continue;for(j=0;j<arguments[i].length;j++){if(uniq_hash[arguments[i][j]])continue;uniq_hash[arguments[i][j]]=true;result.push(arguments[i][j])}}return result}function _clean(elem){var clone;switch(elem.nodeType){case 1:_clean_element.call(this,elem);break;case 3:clone=elem.cloneNode(false);this.current_element.appendChild(clone);break;case 5:clone=elem.cloneNode(false);this.current_element.appendChild(clone);break;case 8:if(this.config.allow_comments){clone=elem.cloneNode(false);this.current_element.appendChild(clone)}break;default:if(console&&console.log)console.log("unknown node type",elem.nodeType);break}}function _clean_element(elem){var i,j,clone,parent_element,name,allowed_attributes,attr,attr_name,attr_node,protocols,del,attr_ok;var transform=_transform_element.call(this,elem);elem=transform.node;name=elem.nodeName.toLowerCase();parent_element=this.current_element;if(this.allowed_elements[name]||transform.whitelist){this.current_element=this.dom.createElement(elem.nodeName);parent_element.appendChild(this.current_element);var attrs=this.config.attributes;allowed_attributes=_merge_arrays_uniq(attrs[name],attrs[Sanitize.ALL],transform.attr_whitelist);for(i=0;i<allowed_attributes.length;i++){attr_name=allowed_attributes[i];attr=elem.attributes[attr_name];if(attr){attr_ok=true;if(this.config.protocols[name]&&this.config.protocols[name][attr_name]){protocols=this.config.protocols[name][attr_name];del=attr.value.toLowerCase().match(Sanitize.REGEX_PROTOCOL);if(del){attr_ok=_array_index(del[1],protocols)!=-1}else{attr_ok=_array_index(Sanitize.RELATIVE,protocols)!=-1}}if(attr_ok){attr_node=document.createAttribute(attr_name);attr_node.value=attr.value;this.current_element.setAttributeNode(attr_node)}}}if(this.config.add_attributes[name]){for(attr_name in this.config.add_attributes[name]){attr_node=document.createAttribute(attr_name);attr_node.value=this.config.add_attributes[name][attr_name];this.current_element.setAttributeNode(attr_node)}}}else if(_array_index(elem,this.whitelist_nodes)!=-1){this.current_element=elem.cloneNode(true);while(this.current_element.childNodes.length>0){this.current_element.removeChild(this.current_element.firstChild)}parent_element.appendChild(this.current_element)}if(!this.config.remove_all_contents&&!this.config.remove_element_contents[name]){for(i=0;i<elem.childNodes.length;i++){_clean.call(this,elem.childNodes[i])}}if(this.current_element.normalize){this.current_element.normalize()}this.current_element=parent_element}function _transform_element(node){var output={attr_whitelist:[],node:node,whitelist:false};var i,j,transform;for(i=0;i<this.transformers.length;i++){transform=this.transformers[i]({allowed_elements:this.allowed_elements,config:this.config,node:node,node_name:node.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom});if(transform==null)continue;else if(typeof transform=="object"){if(transform.whitelist_nodes&&transform.whitelist_nodes instanceof Array){for(j=0;j<transform.whitelist_nodes.length;j++){if(_array_index(transform.whitelist_nodes[j],this.whitelist_nodes)==-1){this.whitelist_nodes.push(transform.whitelist_nodes[j])}}}output.whitelist=transform.whitelist?true:false;if(transform.attr_whitelist){output.attr_whitelist=_merge_arrays_uniq(output.attr_whitelist,transform.attr_whitelist)}output.node=transform.node?transform.node:output.node}else{throw new Error("transformer output must be an object or null")}}return output}for(i=0;i<container.childNodes.length;i++){_clean.call(this,container.childNodes[i])}if(fragment.normalize){fragment.normalize()}return fragment};if(typeof define==="function"){define("sanitize",[],function(){return Sanitize})}(function(MARVELAPP,Tourist){MARVELAPP.tours={};if(!Tourist){MARVELAPP.tours.newProjectTour={stop:function(){},showStep:function(){},on:function(){},off:function(){},view:{on:function(){},off:function(){}}};return}var steps={createFirstProject:{container:$("body"),content:"<h3>Create your first project!</h3><p>Get started with your first mobile or web project. If you haven't got any images, use the demo example.</p>",highlightTarget:true,arrowPosition:"top right",attachPosition:"bottom left",okButton:true,closeButton:true,setup:function(tour,options){$("a.create-project").bind("click",this.onCreateProjectClicked);$("body").delegate("div.create-project .close .icon-cross","click",this.onCreateProjectCanceled);$("a.try-demo").bind("click",this.onTryDemoClicked);return{target:$("a.create-project")}},teardown:function(tour,options){$("a.create-project").unbind("click",this.onCreateProjectClicked);$("a.try-demo").unbind("click",this.onTryDemoClicked);$("body").undelegate("div.create-project .close .icon-cross","click",this.onCreateProjectCanceled);Backbone.off("projectReady",this.onNewProjectReady);Backbone.off("projectThumbnailsRendered",this.onDemoProjectThumbnailsRendered)},bind:["onCreateProjectClicked","onTryDemoClicked","onNewProjectReady","onCreateProjectCanceled","onDemoProjectThumbnailsRendered"],onCreateProjectClicked:function(tour,options,view){Backbone.off("projectThumbnailsRendered",this.onDemoProjectThumbnailsRendered);Backbone.on("projectReady",this.onNewProjectReady);tour.view.hide()},onCreateProjectCanceled:function(tour,options,view){Backbone.off("projectReady",this.onNewProjectReady);Backbone.off("projectThumbnailsRendered",this.onDemoProjectThumbnailsRendered);tour.view.show()},onNewProjectReady:function(tour,options,view){tour.next();tour.view.show()},onDemoProjectThumbnailsRendered:function(tour,options,view){setTimeout(function(){tour.showStep(3);tour.view.show()},300)},onTryDemoClicked:function(tour,options,view){tour.view.hide();Backbone.off("projectReady",this.onNewProjectReady);Backbone.once("projectThumbnailsRendered",this.onDemoProjectThumbnailsRendered)}},addFirstScreen:{content:"<h3>Add your screens!</h3><p>You can add JPEG, PNG, GIF and PSDs from your computer or Dropbox and form your prototype.</p>",highlightTarget:true,okButton:true,closeButton:true,arrowPosition:"bottom left",attachPosition:"top right",bind:["handleImageAdded"],setup:function(tour,options){this.numImages=0;this.projectModel=MARVELAPP.models.current_project;this.projectModel.on("imageAdded",this.handleImageAdded);return{target:$(".add-images")}},teardown:function(tour,options){this.projectModel.off("imageAdded",this.handleImageAdded)},handleImageAdded:function(tour,options,view){this.numImages+=1;if(this.nextTimeout){return}this.nextTimeout=setTimeout(_.bind(function(){if(this.numImages>=2){tour.next();tour.next()}else{tour.next()}},this),1e3)}},addSecondScreen:{content:"<h3>Add your screens!</h3><p>One image added! Add one more and we can continue the tour. You can add JPEG, PNG, GIF and PSDs from your computer or Dropbox and form your prototype.</p>",highlightTarget:true,okButton:true,closeButton:true,arrowPosition:"bottom left",attachPosition:"top right",bind:["handleImageAdded"],setup:function(tour,options){this.numImages=1;this.projectModel=MARVELAPP.models.current_project;this.projectModel.on("imageAdded",this.handleImageAdded);return{target:$(".thumbnail-list li:first")}},teardown:function(tour,options){this.projectModel.off("imageAdded",this.handleImageAdded);delete this.numImages},handleImageAdded:function(tour,options,view){this.numImages+=1;if(this.numImages===2){tour.next()}}},linkScreensTogether:{content:"<h3>Link your screens together</h3><p>Hover over and click on any of your images to enter the editor and start linking them together to form your prototype.</p>",highlightTarget:true,okButton:true,closeButton:true,arrowPosition:"top left",attachPosition:"top right",setup:function(tour,options){$(".thumbnail-list li:first .view-item").bind("click",this.onEditButtonClicked);return{target:$(".thumbnail-list li:first")}},teardown:function(tour,options){$(".thumbnail-list li:first .view-item").unbind("click",this.onEditButtonClicked)},bind:["onEditButtonClicked"],onEditButtonClicked:function(tour,options,view){tour.view.hide();MARVELAPP.Router.currentView.projectEditorView.screenView.once("finishedLoadingFirstImage",function(){setTimeout(tour.next,1e3)})}},drawHotspot:{content:"<h3>Click and drag to draw a hotspot</h3><p>Hotspots are interactive areas on your images that can be tapped or clicked to go to another screen</p>",highlightTarget:true,okButton:true,closeButton:true,arrowPosition:"top left",attachPosition:"100px 100px",bind:["onPopoverOpened"],setup:function(tour,options){MARVELAPP.Router.currentView.projectEditorView.popoverView.once("shown",this.onPopoverOpened);return{target:$("#screen-holder")}},teardown:function(tour,options){},onPopoverOpened:function(tour){setTimeout(tour.next,500)}},selectHotspotTarget:{content:"<h3>Select a target for your hotspot</h3><p>Where would you like to go once you click on the hotspot? Select the target from your list</p>",highlightTarget:true,okButton:true,closeButton:true,arrowPosition:"top left",attachPosition:"top right",bind:["onDestinationSelected"],setup:function(){$("#popover-thumbnails li:not(.current)").bind("click",this.onDestinationSelected);return{target:$("#popover-thumbnails li:not(.current):nth(0)")}},teardown:function(){$("#popover-thumbnails li:not(.current)").unbind("click",this.onDestinationSelected)},onDestinationSelected:function(tour){tour.next()}},addTransition:{content:"<h3>Add a transition</h3><p>Transitions are a great way to bring your screens to life as you move between them, try one out!</p>",highlightTarget:true,okButton:true,arrowPosition:"top left",attachPosition:"bottom right",bind:["onTransitionSelected"],setup:function(){$("#popover-transitions li").bind("click",this.onTransitionSelected);return{target:$("#popover-transition")}},teardown:function(){$("#popover-transitions li").unbind("click",this.onTransitionSelected)},onTransitionSelected:function(tour){tour.next()}},closePopover:{content:"<h3>Close the hotspot editor</h3><p>Hit the close button to hide the hotspot editor and show the rest of the editor controls</p>",highlightTarget:true,okButton:true,closeButton:true,arrowPosition:"top right",attachPosition:"bottom left",bind:["onPopoverClosed"],setup:function(){MARVELAPP.Router.currentView.projectEditorView.popoverView.once("hiding",this.onPopoverClosed);return{target:$("#close-popover")}},teardown:function(){},onPopoverClosed:function(tour){tour.next()}},moveBetweenScreens:{content:"<h3>Move between screens</h3><p>Use the buttons above or use the arrow keys on your keyboard to move and add more hotspots</p>",highlightTarget:true,okButton:true,closeButton:true,arrowPosition:"top right",attachPosition:"bottom left",bind:["onNavigating"],setup:function(){MARVELAPP.Router.currentView.projectEditorView.once("navigated",this.onNavigating);return{target:$("#navigation")}},teardown:function(){},onNavigating:function(tour){tour.next()}},exitEditorMode:{content:"<h3>Exit once you're done</h3><p>Click 'Done' to exit or hit escape on your keyboard, it's time to play!</p>",highlightTarget:true,okButton:true,closeButton:true,arrowPosition:"top right",attachPosition:"bottom left",bind:["onEditorClosed"],setup:function(){MARVELAPP.Router.currentView.projectEditorView.once("closed",this.onEditorClosed);return{target:$("#close-editor")}},teardown:function(){},onEditorClosed:function(tour){tour.next()}},playPrototype:{content:"<h3>Play your prototype!</h3><p>Ready to test? Just click play to start playing with your prototype! Once you're happy share with others!</p>",highlightTarget:true,okButton:true,closeButton:true,arrowPosition:"top right",attachPosition:"bottom left",bind:["onPlayButtonClicked"],setup:function(){MARVELAPP.Router.currentView.projectMenuView.once("openPreview",this.onPlayButtonClicked);return{target:$("#project-preview")}},teardown:function(tour,options,view){console.log("They finished the tour");tour.trigger("tourFinished");tour.view.hide()},onPlayButtonClicked:function(tour){tour.stop()}}};MARVELAPP.tours.newProjectTour=new Tourist.Tour.MarvelTour({successStep:steps.playPrototype,tipClass:"MarvelTourTip",steps:[steps.createFirstProject,steps.addFirstScreen,steps.addSecondScreen,steps.linkScreensTogether,steps.drawHotspot,steps.selectHotspotTarget,steps.addTransition,steps.closePopover,steps.moveBetweenScreens,steps.exitEditorMode]})})(MARVELAPP,window.Tourist);var project_object=undefined;var current_screen=undefined;var transitioning=false;var projectController=new ProjectController;var projectConstants=new ProjectConstants;var prototype={};var previous_screen=null;var iOS=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?true:false;var iOS7=navigator.userAgent.match(/(iPad|iPhone);.*CPU.*OS 7_\d/i)?true:false;var iOS9=navigator.userAgent.match(/(iPad|iPhone);.*CPU.*OS 9_\d/i)?true:false;var chromeiOS=navigator.userAgent.match("CriOS")?true:false;var android=navigator.userAgent.toLowerCase().indexOf("android")>-1;var is_ie10=Function("/*@cc_on return document.documentMode===10@*/")();var mobile=false;var firstAntiscrollRun=false;var globalMaintainScroll=false;$.cloudinary.config({cloud_name:"marvel-content",api_key:"968288648947952"});(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))mobile=true;
})(navigator.userAgent||navigator.vendor||window.opera);var iPad=navigator.userAgent.match(/(iPad)/g)?true:false;if(iPad)mobile=true;var mobileMode=mobile;var firefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1;var transitionHistory=[];var transitionCursor=0;var homescreen=window.navigator.standalone;var embed=false;var explore=false;var globalStatusType=null,globalTrimStatus=null;if(window.location.href.indexOf("?emb=1")>-1)embed=true;if(window.location.href.indexOf("exp=1")>-1)explore=true;var startTopScroll;var startTime;var touchStartID;var globalTimerTimeout;function createPrototype(is_error,message,returnedProjectObject){if(Object.size(returnedProjectObject.images)==0){$(".prototype-modal .cell").html("<h3>This prototype is empty. Add some images first!</h3>");return}if(project_data.images[1].width==0){$("body").html("");project_data.images[1].width=returnedProjectObject.images[1].width;setupPrototype(returnedProjectObject);return}if(is_error!=true)project_object=returnedProjectObject;MARVELAPP.settings=settings;if(MARVELAPP.settings.APP_SENTRY_DSN){Raven.config(MARVELAPP.settings.APP_SENTRY_DSN).install()}MARVELAPP.models.teams=new MARVELAPP.TeamsModel;new MARVELAPP.PrototypeRouter;var endTime=new Date;var timeDiff=endTime-startTime;console.log("Response time: "+timeDiff+"ms");prototype=new MARVELAPP.PrototypeView(project_object);prototype.runPreloader();if(current_user.id==project_data.owner_fk){$(".powered").attr("href","https://marvelapp.com/upgrade/")}}var perc;function run_load_bar(){setTimeout(function(){perc=perc+1;if(perc<40){if(parseInt($("#page-loader .inner").css("width"))<=perc){$("#page-loader .inner").css("width",perc+"%")}run_load_bar()}},500)}$(document).ready(function(){FastClick.attach(document.body);startTime=new Date;var scrollbarTimeout;if(project_data!==undefined)setupPrototype(project_data);$(window).resize(function(){clearTimeout(scrollbarTimeout);checkOddPixel($(window).width(),$(window).height());scrollbarTimeout=setTimeout(prototype.updateEverything,100)});if(iOS){$(document).bind("touchstart",function(e){var id=$(e.target).closest(".screen-wrap").attr("id");prototype.unblockScrolling();touchStartID=id;var screenHeight=$("#"+id+" img").height();if(globalStatusType=="0"&&globalTrimStatus=="1"&&offline!=1)screenHeight=screenHeight-20;if(prototype.hasActiveOverlay&&id==prototype.activeOverlayScreen&&homescreen){prototype.blockScrolling()}if(Math.abs($(window).height()-screenHeight)<4){if(homescreen||offline==1)prototype.blockScrolling()}else{startTopScroll=$("#"+id+" .antiscroll-inner").scrollTop();scrollHeight=$("#"+id+" .antiscroll-inner").prop("scrollHeight")-$("#"+id+" .antiscroll-inner").height()-$("#"+id+" .fixed-header").height()-$("#"+id+" .fixed-footer").height();if(startTopScroll==0){$("#"+id+" .antiscroll-inner").scrollTop(1)}if(Math.abs(scrollHeight-startTopScroll)<=1){$("#"+id+" .antiscroll-inner").scrollTop(scrollHeight-1)}startTopScroll=$("#"+id+" .antiscroll-inner").scrollTop()}});$(document).bind("touchend",function(e){var id=$(e.target).closest(".screen-wrap").attr("id");var screenHeight=$("#"+id+" img").height();if(globalStatusType=="0"&&globalTrimStatus=="1"&&offline!=1)screenHeight=screenHeight-20;if(prototype.hasActiveOverlay&&id==prototype.activeOverlayScreen&&homescreen){prototype.unblockScrolling()}if(Math.abs($(window).height()-screenHeight)<4){if(homescreen||offline==1)prototype.unblockScrolling()}else{var endScroll=$("#"+id+" .antiscroll-inner").scrollTop();if(startTopScroll==endScroll){if($(e.target).is(".hotspot")){$(e.target).click()}else{prototype.flashHotspots(e)}prototype.beenClicked=false}}touchStartID=null})}else{touchStartID=0}$(document).on("click",".close-powered",function(){if(!$(".powered-popover").hasClass("active")){ga("send","pageview","/badge-close/")}$(".powered-popover").toggleClass("active")});$(document).on("click",".powered-popover",function(){ga("send","pageview","/badge-link/")})});function setupPrototype(data){attributes=data;var cookie=$.cookie("sidebar");attributes.collapsed=cookie==="1"?true:false;attributes.orientation=getProjectPropertyForName(attributes,projectConstants.PROJECT_PROP_ORIENTATION);attributes.background=getProjectPropertyForName(attributes,projectConstants.PROJECT_PROP_BACKGROUND_HEX);attributes.disable_sidebar=getProjectPropertyForName(attributes,projectConstants.PROJECT_PROP_DISABLE_FRAME);attributes.prototype_background=getProjectPropertyForName(attributes,projectConstants.PROJECT_PROP_PROTOTYPE_BACKGROUND_HEX);attributes.random_number=random_number;if(mobile)$("body").css("background","#"+attributes.prototype_background);if(embed)$("body").addClass("embedded");if(embed&&mobile)$("body").addClass("embedded-on-mobile");if(firefox)$("body").addClass("firefox");attributes.frame=getProjectPropertyForName(attributes,projectConstants.PROJECT_PROP_FRAME);attributes.colour=getProjectPropertyForName(attributes,projectConstants.PROJECT_PROP_FRAME_COLOUR);if(attributes.images[1]){if(attributes.frame=="desktop-view"||attributes.frame=="web-frame"&&embed){if(attributes.images[1].width==320||attributes.images[1].width==640){attributes.frame="iphone5-frame";attributes.colour="black"}else if(attributes.images[1].width==750){attributes.frame="iphone6-frame";attributes.colour="white"}else if(attributes.images[1].width==1242){attributes.frame="iphone6plus-frame";attributes.colour="white"}}}else{attributes.images[1]={name:""}}if(attributes.frame==""||typeof attributes.frame==="undefined"){attributes.frame="web-frame"}attributes.commentsEnabled=getProjectPropertyForName(attributes,projectConstants.PROJECT_PROP_COMMENTS_ENABLED);if(attributes.commentsEnabled=="1"){attributes.commentsEnabled=true}else{attributes.commentsEnabled=false}if(embed||offline==true)attributes.commentsEnabled=false;if(mobile&&embed){mobileMode=false;$("body").addClass("device-only");$("#content-wrapper").addClass("collapsed")}if(!mobileMode){if(!embed&&attributes.disable_sidebar!="1"){if(attributes.collapsed){$("#prototype").append("<div id='sidebar' class='collapsed'></div>");$("#prototype").addClass("collapsed-navigation")}else{$("#prototype").append("<div id='sidebar'></div>")}attributes.initial=true;$("#sidebar").append(MARVELAPP.templates.SIDEBAR(attributes))}if(attributes.disable_sidebar=="1"){attributes.frame="desktop-view";attributes.collapsed=true}$("#prototype").append(MARVELAPP.templates.PROTOTYPE_WRAPPER(attributes))}else{$("#prototype").append(MARVELAPP.templates.IOS_PROTOTYPE_WRAPPER(attributes))}checkOddPixel($(window).width(),$(window).height());if(attributes.images[1]){$(".screen").append(MARVELAPP.templates.PAGE_LOADER(attributes))}else{$(".screen").append(MARVELAPP.templates.PROTOTYPE_EMPTY());return}if(!offline){setTimeout(function(){if(parseInt($("#page-loader .inner").css("width"))<=15){$("#page-loader .inner").css("width","15%")}},500);run_load_bar(15);projectController.getPrototypeProject(project_id,createPrototype)}else{homescreen=true;createPrototype(false,"",prototype_data)}}function getProjectPropertyForName(selectedProjectObject,name){for(id in selectedProjectObject.properties){var property=selectedProjectObject.properties[id];if(name==property.name){return property.value}}}function checkOddPixel(width,height){scaleDevice()}function scaleDevice(sidebar){var orientation=getProjectPropertyForName(project_data,projectConstants.PROJECT_PROP_ORIENTATION);var frame=getProjectPropertyForName(project_data,projectConstants.PROJECT_PROP_FRAME);var disabled=getProjectPropertyForName(project_data,projectConstants.PROJECT_PROP_DISABLE_FRAME);if(frame=="web-frame"||frame=="desktop-view"||disabled=="1")return;var devicePadding=10;var verticalPadding=0;var deviceDimensions=getDeviceDimensions(project_data.frame);if(frame=="apple-watch-38-frame"||frame=="apple-watch-42-frame"){orientation="portrait"}if(orientation=="landscape"){var deviceWidth=deviceDimensions.height;var deviceHeight=deviceDimensions.width}else{var deviceWidth=deviceDimensions.width;var deviceHeight=deviceDimensions.height}var contentWidth=$("#content-wrapper").width()-devicePadding*2;var contentHeight=$("#content-wrapper").height()-devicePadding*2-verticalPadding;if(sidebar!==undefined){if(sidebar){contentWidth=contentWidth-400}else{contentWidth=contentWidth+400}}var initialWidth=deviceWidth;var initialHeight=deviceHeight;var scale=1;if(deviceHeight>contentHeight){deviceHeight=contentHeight;scale=deviceHeight/initialHeight;scaleVertical(scale);if(deviceWidth*scale>contentWidth){deviceWidth=contentWidth;scale=deviceWidth/initialWidth;scaleHorizontal(scale)}}else{deviceWidth=contentWidth;scale=deviceWidth/initialWidth;scaleHorizontal(scale);if(deviceHeight*scale>contentHeight){deviceHeight=contentHeight;scale=deviceHeight/initialHeight;scaleVertical(scale)}}}function scaleVertical(scale){removeScale();if(scale>=1)return;$("body").addClass("fit-device-height")}function scaleHorizontal(scale){removeScale();if(scale>=1)return;$("body").addClass("fit-device-width")}function removeScale(){$("body").removeClass("fit-device-width fit-device-height")}function getDeviceDimensions(frame){var dimensions={"apple-watch-38-frame":{width:219,height:386},"apple-watch-42-frame":{width:255,height:447},"iphone6-frame":{width:432,height:881},"iphone6photo-frame":{width:432,height:881},"iphone6plus-frame":{width:474,height:956},"iphone6plusphoto-frame":{width:474,height:956},"iphone5-frame":{width:382,height:803},"iphone5photo-frame":{width:382,height:803},"iphone5c-frame":{width:384,height:806},"iphone5cphoto-frame":{width:384,height:806},"nexus5-frame":{width:370,height:735},"s5-frame":{width:368,height:713},"lumia920-frame":{width:397,height:724},"htc-one-frame":{width:370,height:745},"ipad-frame":{width:656,height:928},"iphone4s-frame":{width:375,height:736}};try{return{width:dimensions[frame].width,height:dimensions[frame].height}}catch(e){console.log(e)}}Array.prototype.remove=function(from,to){var rest=this.slice((to||from)+1||this.length);this.length=from<0?this.length+from:from;return this.push.apply(this,rest)};Array.prototype.chunk=function(chunkSize){var array=this;return[].concat.apply([],array.map(function(elem,i){return i%chunkSize?[]:[array.slice(i,i+chunkSize)]}))};var logger=function(){var oldConsoleLog=null;var pub={};pub.enableLogger=function enableLogger(){if(oldConsoleLog==null)return;window["console"]["log"]=oldConsoleLog};pub.disableLogger=function disableLogger(){oldConsoleLog=console.log;window["console"]["log"]=function(){}};return pub}();if(settings.ENVIRONMENT=="live")logger.disableLogger();!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();{var c=this,d=c.opts,f=c.el=e(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});d.radius+d.length+d.width}if(e(f,{left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h});(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date;a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-38711157-1","auto");ga("send","pageview","prototype-view");(function(){function b(a,d){(null===a||void 0===a)&&b.warn("Warning","You must pass your app key when you instantiate Pusher.");d=d||{};var c=this;this.key=a;this.config=b.Util.extend(b.getGlobalConfig(),d.cluster?b.getClusterConfig(d.cluster):{},d);this.channels=new b.Channels;this.global_emitter=new b.EventsDispatcher;this.sessionID=Math.floor(1e9*Math.random());this.timeline=new b.Timeline(this.key,this.sessionID,{cluster:this.config.cluster,features:b.Util.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:b.Timeline.INFO,version:b.VERSION});this.config.disableStats||(this.timelineSender=new b.TimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/jsonp"}));this.connection=new b.ConnectionManager(this.key,b.Util.extend({getStrategy:function(a){a=b.Util.extend({},c.config,a);return b.StrategyBuilder.build(b.getDefaultStrategy(a),a)},timeline:this.timeline,activityTimeout:this.config.activity_timeout,pongTimeout:this.config.pong_timeout,unavailableTimeout:this.config.unavailable_timeout},this.config,{encrypted:this.isEncrypted()}));this.connection.bind("connected",function(){c.subscribeAll();c.timelineSender&&c.timelineSender.send(c.connection.isEncrypted())});this.connection.bind("message",function(a){var d=0===a.event.indexOf("pusher_internal:");if(a.channel){var b=c.channel(a.channel);b&&b.handleEvent(a.event,a.data)}d||c.global_emitter.emit(a.event,a.data)});this.connection.bind("disconnected",function(){c.channels.disconnect()});this.connection.bind("error",function(a){b.warn("Error",a)});b.instances.push(this);this.timeline.info({instances:b.instances.length});b.isReady&&c.connect()}var c=b.prototype;b.instances=[];b.isReady=!1;b.debug=function(){b.log&&b.log(b.Util.stringify.apply(this,arguments))};b.warn=function(){var a=b.Util.stringify.apply(this,arguments);window.console&&(window.console.warn?window.console.warn(a):window.console.log&&window.console.log(a));b.log&&b.log(a)};b.ready=function(){b.isReady=!0;for(var a=0,d=b.instances.length;a<d;a++)b.instances[a].connect()};c.channel=function(a){return this.channels.find(a)};c.allChannels=function(){return this.channels.all()};c.connect=function(){this.connection.connect();if(this.timelineSender&&!this.timelineSenderTimer){var a=this.connection.isEncrypted(),d=this.timelineSender;this.timelineSenderTimer=new b.PeriodicTimer(6e4,function(){d.send(a)})}};c.disconnect=function(){this.connection.disconnect();this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)};c.bind=function(a,d){this.global_emitter.bind(a,d);return this};c.bind_all=function(a){this.global_emitter.bind_all(a);return this};c.subscribeAll=function(){for(var a in this.channels.channels)this.channels.channels.hasOwnProperty(a)&&this.subscribe(a)};c.subscribe=function(a){a=this.channels.add(a,this);"connected"===this.connection.state&&a.subscribe();return a};c.unsubscribe=function(a){a=this.channels.remove(a);"connected"===this.connection.state&&a.unsubscribe()};c.send_event=function(a,d,b){return this.connection.send_event(a,d,b)};c.isEncrypted=function(){return"https:"===b.Util.getDocument().location.protocol?!0:Boolean(this.config.encrypted)};b.HTTP={};this.Pusher=b}).call(this);(function(){function b(a){window.clearTimeout(a)}function c(a){window.clearInterval(a)}function a(a,d,b,c){var k=this;this.clear=d;this.timer=a(function(){null!==k.timer&&(k.timer=c(k.timer))},b)}var d=a.prototype;d.isRunning=function(){return null!==this.timer};d.ensureAborted=function(){this.timer&&(this.clear(this.timer),this.timer=null)};Pusher.Timer=function(d,c){return new a(setTimeout,b,d,function(a){c();return null})};Pusher.PeriodicTimer=function(d,b){return new a(setInterval,c,d,function(a){b();return a})}}).call(this);(function(){Pusher.Util={now:function(){return Date.now?Date.now():(new Date).valueOf()},defer:function(b){return new Pusher.Timer(0,b)},extend:function(b){for(var c=1;c<arguments.length;c++){var a=arguments[c],d;for(d in a)b[d]=a[d]&&a[d].constructor&&a[d].constructor===Object?Pusher.Util.extend(b[d]||{},a[d]):a[d]}return b},stringify:function(){for(var b=["Pusher"],c=0;c<arguments.length;c++)"string"===typeof arguments[c]?b.push(arguments[c]):void 0===window.JSON?b.push(arguments[c].toString()):b.push(JSON.stringify(arguments[c]));return b.join(" : ")},arrayIndexOf:function(b,c){var a=Array.prototype.indexOf;if(null===b)return-1;if(a&&b.indexOf===a)return b.indexOf(c);for(var a=0,d=b.length;a<d;a++)if(b[a]===c)return a;return-1},objectApply:function(b,c){for(var a in b)Object.prototype.hasOwnProperty.call(b,a)&&c(b[a],a,b)},keys:function(b){var c=[];Pusher.Util.objectApply(b,function(a,d){c.push(d)});return c},values:function(b){var c=[];Pusher.Util.objectApply(b,function(a){c.push(a)});return c},apply:function(b,c,a){for(var d=0;d<b.length;d++)c.call(a||window,b[d],d,b)},map:function(b,c){for(var a=[],d=0;d<b.length;d++)a.push(c(b[d],d,b,a));return a},mapObject:function(b,c){var a={};Pusher.Util.objectApply(b,function(d,b){a[b]=c(d)});return a},filter:function(b,c){c=c||function(a){return!!a};for(var a=[],d=0;d<b.length;d++)c(b[d],d,b,a)&&a.push(b[d]);return a},filterObject:function(b,c){var a={};Pusher.Util.objectApply(b,function(d,h){if(c&&c(d,h,b,a)||Boolean(d))a[h]=d});return a},flatten:function(b){var c=[];Pusher.Util.objectApply(b,function(a,d){c.push([d,a])});return c},any:function(b,c){for(var a=0;a<b.length;a++)if(c(b[a],a,b))return!0;return!1},all:function(b,c){for(var a=0;a<b.length;a++)if(!c(b[a],a,b))return!1;return!0},method:function(b){var c=Array.prototype.slice.call(arguments,1);return function(a){return a[b].apply(a,c.concat(arguments))}},getWindow:function(){return window},getDocument:function(){return document},getNavigator:function(){return navigator},getLocalStorage:function(){try{return window.localStorage}catch(b){}},getClientFeatures:function(){return Pusher.Util.keys(Pusher.Util.filterObject({ws:Pusher.WSTransport,flash:Pusher.FlashTransport},function(b){return b.isSupported({})}))},addWindowListener:function(b,c){var a=Pusher.Util.getWindow();void 0!==a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},removeWindowListener:function(b,c){var a=Pusher.Util.getWindow();void 0!==a.addEventListener?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},isXHRSupported:function(){var b=window.XMLHttpRequest;return Boolean(b)&&void 0!==(new b).withCredentials},isXDRSupported:function(b){b=b?"https:":"http:";var c=Pusher.Util.getDocument().location.protocol;return Boolean(window.XDomainRequest)&&c===b}}}).call(this);(function(){Pusher.VERSION="2.2.4";Pusher.PROTOCOL=7;Pusher.host="ws.pusherapp.com";Pusher.ws_port=80;Pusher.wss_port=443;Pusher.sockjs_host="sockjs.pusher.com";Pusher.sockjs_http_port=80;Pusher.sockjs_https_port=443;Pusher.sockjs_path="/pusher";Pusher.stats_host="stats.pusher.com";Pusher.channel_auth_endpoint="/pusher/auth";Pusher.channel_auth_transport="ajax";Pusher.activity_timeout=12e4;Pusher.pong_timeout=3e4;Pusher.unavailable_timeout=1e4;Pusher.cdn_http="http://js.pusher.com/";Pusher.cdn_https="https://js.pusher.com/";Pusher.dependency_suffix=".min";Pusher.getDefaultStrategy=function(b){return[[":def","ws_options",{hostUnencrypted:b.wsHost+":"+b.wsPort,hostEncrypted:b.wsHost+":"+b.wssPort}],[":def","wss_options",[":extend",":ws_options",{encrypted:!0}]],[":def","sockjs_options",{hostUnencrypted:b.httpHost+":"+b.httpPort,hostEncrypted:b.httpHost+":"+b.httpsPort,httpPath:b.httpPath}],[":def","timeouts",{loop:!0,timeout:15e3,timeoutLimit:6e4}],[":def","ws_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:b.activity_timeout}]],[":def","streaming_manager",[":transport_manager",{lives:2,minPingDelay:1e4,maxPingDelay:b.activity_timeout}]],[":def_transport","ws","ws",3,":ws_options",":ws_manager"],[":def_transport","wss","ws",3,":wss_options",":ws_manager"],[":def_transport","flash","flash",2,":ws_options",":ws_manager"],[":def_transport","sockjs","sockjs",1,":sockjs_options"],[":def_transport","xhr_streaming","xhr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xdr_streaming","xdr_streaming",1,":sockjs_options",":streaming_manager"],[":def_transport","xhr_polling","xhr_polling",1,":sockjs_options"],[":def_transport","xdr_polling","xdr_polling",1,":sockjs_options"],[":def","ws_loop",[":sequential",":timeouts",":ws"]],[":def","wss_loop",[":sequential",":timeouts",":wss"]],[":def","flash_loop",[":sequential",":timeouts",":flash"]],[":def","sockjs_loop",[":sequential",":timeouts",":sockjs"]],[":def","streaming_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_streaming"],":xhr_streaming",":xdr_streaming"]]],[":def","polling_loop",[":sequential",":timeouts",[":if",[":is_supported",":xhr_polling"],":xhr_polling",":xdr_polling"]]],[":def","http_loop",[":if",[":is_supported",":streaming_loop"],[":best_connected_ever",":streaming_loop",[":delayed",4e3,[":polling_loop"]]],[":polling_loop"]]],[":def","http_fallback_loop",[":if",[":is_supported",":http_loop"],[":http_loop"],[":sockjs_loop"]]],[":def","strategy",[":cached",18e5,[":first_connected",[":if",[":is_supported",":ws"],b.encrypted?[":best_connected_ever",":ws_loop",[":delayed",2e3,[":http_fallback_loop"]]]:[":best_connected_ever",":ws_loop",[":delayed",2e3,[":wss_loop"]],[":delayed",5e3,[":http_fallback_loop"]]],[":if",[":is_supported",":flash"],[":best_connected_ever",":flash_loop",[":delayed",2e3,[":http_fallback_loop"]]],[":http_fallback_loop"]]]]]]]}}).call(this);(function(){Pusher.getGlobalConfig=function(){return{wsHost:Pusher.host,wsPort:Pusher.ws_port,wssPort:Pusher.wss_port,httpHost:Pusher.sockjs_host,httpPort:Pusher.sockjs_http_port,httpsPort:Pusher.sockjs_https_port,httpPath:Pusher.sockjs_path,statsHost:Pusher.stats_host,authEndpoint:Pusher.channel_auth_endpoint,authTransport:Pusher.channel_auth_transport,activity_timeout:Pusher.activity_timeout,pong_timeout:Pusher.pong_timeout,unavailable_timeout:Pusher.unavailable_timeout}};Pusher.getClusterConfig=function(b){return{wsHost:"ws-"+b+".pusher.com",httpHost:"sockjs-"+b+".pusher.com"}}}).call(this);(function(){function b(b){var a=function(a){Error.call(this,a);this.name=b};Pusher.Util.extend(a.prototype,Error.prototype);return a}Pusher.Errors={BadEventName:b("BadEventName"),RequestTimedOut:b("RequestTimedOut"),TransportPriorityTooLow:b("TransportPriorityTooLow"),TransportClosed:b("TransportClosed"),UnsupportedTransport:b("UnsupportedTransport"),UnsupportedStrategy:b("UnsupportedStrategy")}}).call(this);(function(){function b(a){this.callbacks=new c;this.global_callbacks=[];this.failThrough=a}function c(){this._callbacks={}}var a=b.prototype;a.bind=function(a,b,c){this.callbacks.add(a,b,c);return this};a.bind_all=function(a){this.global_callbacks.push(a);return this};a.unbind=function(a,b,c){this.callbacks.remove(a,b,c);return this};a.unbind_all=function(a,b){this.callbacks.remove(a,b);return this};a.emit=function(a,b){var c;for(c=0;c<this.global_callbacks.length;c++)this.global_callbacks[c](a,b);var e=this.callbacks.get(a);if(e&&0<e.length)for(c=0;c<e.length;c++)e[c].fn.call(e[c].context||window,b);else this.failThrough&&this.failThrough(a,b);return this};c.prototype.get=function(a){return this._callbacks["_"+a]};c.prototype.add=function(a,b,c){a="_"+a;this._callbacks[a]=this._callbacks[a]||[];this._callbacks[a].push({fn:b,context:c})};c.prototype.remove=function(a,b,c){!a&&!b&&!c?this._callbacks={}:(a=a?["_"+a]:Pusher.Util.keys(this._callbacks),b||c?Pusher.Util.apply(a,function(a){this._callbacks[a]=Pusher.Util.filter(this._callbacks[a]||[],function(a){return b&&b!==a.fn||c&&c!==a.context});0===this._callbacks[a].length&&delete this._callbacks[a]},this):Pusher.Util.apply(a,function(a){delete this._callbacks[a]},this))};Pusher.EventsDispatcher=b}).call(this);(function(){function b(a,d){this.lastId=0;this.prefix=a;this.name=d}var c=b.prototype;c.create=function(a){this.lastId++;var d=this.lastId,b=this.prefix+d,c=this.name+"["+d+"]",e=!1,f=function(){e||(a.apply(null,arguments),e=!0)};this[d]=f;return{number:d,id:b,name:c,callback:f}};c.remove=function(a){delete this[a.number]};Pusher.ScriptReceiverFactory=b;Pusher.ScriptReceivers=new b("_pusher_script_","Pusher.ScriptReceivers")}).call(this);(function(){function b(a){this.src=a}var c=b.prototype;c.send=function(a){var d=this,b="Error loading "+d.src;d.script=document.createElement("script");d.script.id=a.id;d.script.src=d.src;d.script.type="text/javascript";d.script.charset="UTF-8";d.script.addEventListener?(d.script.onerror=function(){a.callback(b)},d.script.onload=function(){a.callback(null)}):d.script.onreadystatechange=function(){("loaded"===d.script.readyState||"complete"===d.script.readyState)&&a.callback(null)};void 0===d.script.async&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(d.errorScript=document.createElement("script"),d.errorScript.id=a.id+"_error",d.errorScript.text=a.name+"('"+b+"');",d.script.async=d.errorScript.async=!1):d.script.async=!0;var c=document.getElementsByTagName("head")[0];c.insertBefore(d.script,c.firstChild);d.errorScript&&c.insertBefore(d.errorScript,d.script.nextSibling)};c.cleanup=function(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null);this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script);this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript);this.errorScript=this.script=null};Pusher.ScriptRequest=b}).call(this);(function(){function b(a){this.options=a;this.receivers=a.receivers||Pusher.ScriptReceivers;this.loading={}}var c=b.prototype;c.load=function(a,d,b){var c=this;if(c.loading[a]&&0<c.loading[a].length)c.loading[a].push(b);else{c.loading[a]=[b];var e=new Pusher.ScriptRequest(c.getPath(a,d)),f=c.receivers.create(function(d){c.receivers.remove(f);if(c.loading[a]){var b=c.loading[a];delete c.loading[a];for(var h=function(a){a||e.cleanup()},m=0;m<b.length;m++)b[m](d,h)}});e.send(f)}};c.getRoot=function(a){var d=Pusher.Util.getDocument().location.protocol;return(a&&a.encrypted||"https:"===d?this.options.cdn_https:this.options.cdn_http).replace(/\/*$/,"")+"/"+this.options.version};c.getPath=function(a,d){return this.getRoot(d)+"/"+a+this.options.suffix+".js"};Pusher.DependencyLoader=b}).call(this);(function(){function b(){Pusher.ready()}function c(a){document.body?a():setTimeout(function(){c(a)},0)}function a(){c(b)}Pusher.DependenciesReceivers=new Pusher.ScriptReceiverFactory("_pusher_dependencies","Pusher.DependenciesReceivers");Pusher.Dependencies=new Pusher.DependencyLoader({cdn_http:Pusher.cdn_http,cdn_https:Pusher.cdn_https,version:Pusher.VERSION,suffix:Pusher.dependency_suffix,receivers:Pusher.DependenciesReceivers});window.JSON?a():Pusher.Dependencies.load("json2",{},a)})();(function(){for(var b=String.fromCharCode,c=0;64>c;c++)"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c);var a=function(a){var d=a.charCodeAt(0);return 128>d?a:2048>d?b(192|d>>>6)+b(128|d&63):b(224|d>>>12&15)+b(128|d>>>6&63)+b(128|d&63)},d=function(a){var d=[0,2,1][a.length%3];a=a.charCodeAt(0)<<16|(1<a.length?a.charCodeAt(1):0)<<8|(2<a.length?a.charCodeAt(2):0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>12&63),2<=d?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6&63),1<=d?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a&63)].join("")},h=window.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,d)};Pusher.Base64={encode:function(d){return h(d.replace(/[^\x00-\x7F]/g,a))}}}).call(this);(function(){function b(a,b){this.url=a;this.data=b}function c(a){return Pusher.Util.mapObject(a,function(a){"object"===typeof a&&(a=JSON.stringify(a));return encodeURIComponent(Pusher.Base64.encode(a.toString()))})}var a=b.prototype;a.send=function(a){if(!this.request){var b=Pusher.Util.filterObject(this.data,function(a){return void 0!==a}),b=Pusher.Util.map(Pusher.Util.flatten(c(b)),Pusher.Util.method("join","=")).join("&");this.request=new Pusher.ScriptRequest(this.url+"/"+a.number+"?"+b);this.request.send(a)}};a.cleanup=function(){this.request&&this.request.cleanup()};Pusher.JSONPRequest=b}).call(this);(function(){function b(a,d,b){this.key=a;this.session=d;this.events=[];this.options=b||{};this.uniqueID=this.sent=0}var c=b.prototype;b.ERROR=3;b.INFO=6;b.DEBUG=7;c.log=function(a,d){a<=this.options.level&&(this.events.push(Pusher.Util.extend({},d,{timestamp:Pusher.Util.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())};c.error=function(a){this.log(b.ERROR,a)};c.info=function(a){this.log(b.INFO,a)};c.debug=function(a){this.log(b.DEBUG,a)};c.isEmpty=function(){return 0===this.events.length};c.send=function(a,d){var b=this,c=Pusher.Util.extend({session:b.session,bundle:b.sent+1,key:b.key,
lib:"js",version:b.options.version,cluster:b.options.cluster,features:b.options.features,timeline:b.events},b.options.params);b.events=[];a(c,function(a,c){a||b.sent++;d&&d(a,c)});return!0};c.generateUniqueID=function(){this.uniqueID++;return this.uniqueID};Pusher.Timeline=b}).call(this);(function(){function b(b,a){this.timeline=b;this.options=a||{}}b.prototype.send=function(b,a){var d=this;d.timeline.isEmpty()||d.timeline.send(function(a,g){var e=new Pusher.JSONPRequest("http"+(b?"s":"")+"://"+(d.host||d.options.host)+d.options.path,a),f=Pusher.ScriptReceivers.create(function(a,b){Pusher.ScriptReceivers.remove(f);e.cleanup();b&&b.host&&(d.host=b.host);g&&g(a,b)});e.send(f)},a)};Pusher.TimelineSender=b}).call(this);(function(){function b(a){this.strategies=a}function c(a,b,c){var h=Pusher.Util.map(a,function(a,d,h,g){return a.connect(b,c(d,g))});return{abort:function(){Pusher.Util.apply(h,d)},forceMinPriority:function(a){Pusher.Util.apply(h,function(b){b.forceMinPriority(a)})}}}function a(a){return Pusher.Util.all(a,function(a){return Boolean(a.error)})}function d(a){!a.error&&!a.aborted&&(a.abort(),a.aborted=!0)}var h=b.prototype;h.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))};h.connect=function(b,d){return c(this.strategies,b,function(b,c){return function(h,g){(c[b].error=h)?a(c)&&d(!0):(Pusher.Util.apply(c,function(a){a.forceMinPriority(g.transport.priority)}),d(null,g))}})};Pusher.BestConnectedEverStrategy=b}).call(this);(function(){function b(a,b,d){this.strategy=a;this.transports=b;this.ttl=d.ttl||18e5;this.encrypted=d.encrypted;this.timeline=d.timeline}function c(a){return"pusherTransport"+(a?"Encrypted":"Unencrypted")}function a(a){var b=Pusher.Util.getLocalStorage();if(b)try{var h=b[c(a)];if(h)return JSON.parse(h)}catch(k){d(a)}return null}function d(a){var b=Pusher.Util.getLocalStorage();if(b)try{delete b[c(a)]}catch(d){}}var h=b.prototype;h.isSupported=function(){return this.strategy.isSupported()};h.connect=function(b,h){var f=this.encrypted,k=a(f),l=[this.strategy];if(k&&k.timestamp+this.ttl>=Pusher.Util.now()){var n=this.transports[k.transport];n&&(this.timeline.info({cached:!0,transport:k.transport,latency:k.latency}),l.push(new Pusher.SequentialStrategy([n],{timeout:2*k.latency+1e3,failFast:!0})))}var m=Pusher.Util.now(),p=l.pop().connect(b,function s(a,k){if(a)d(f),0<l.length?(m=Pusher.Util.now(),p=l.pop().connect(b,s)):h(a);else{var n=k.transport.name,t=Pusher.Util.now()-m,r=Pusher.Util.getLocalStorage();if(r)try{r[c(f)]=JSON.stringify({timestamp:Pusher.Util.now(),transport:n,latency:t})}catch(u){}h(null,k)}});return{abort:function(){p.abort()},forceMinPriority:function(a){b=a;p&&p.forceMinPriority(a)}}};Pusher.CachedStrategy=b}).call(this);(function(){function b(a,b){this.strategy=a;this.options={delay:b.delay}}var c=b.prototype;c.isSupported=function(){return this.strategy.isSupported()};c.connect=function(a,b){var c=this.strategy,g,e=new Pusher.Timer(this.options.delay,function(){g=c.connect(a,b)});return{abort:function(){e.ensureAborted();g&&g.abort()},forceMinPriority:function(b){a=b;g&&g.forceMinPriority(b)}}};Pusher.DelayedStrategy=b}).call(this);(function(){function b(a){this.strategy=a}var c=b.prototype;c.isSupported=function(){return this.strategy.isSupported()};c.connect=function(a,b){var c=this.strategy.connect(a,function(a,e){e&&c.abort();b(a,e)});return c};Pusher.FirstConnectedStrategy=b}).call(this);(function(){function b(a,b,c){this.test=a;this.trueBranch=b;this.falseBranch=c}var c=b.prototype;c.isSupported=function(){return(this.test()?this.trueBranch:this.falseBranch).isSupported()};c.connect=function(a,b){return(this.test()?this.trueBranch:this.falseBranch).connect(a,b)};Pusher.IfStrategy=b}).call(this);(function(){function b(a,b){this.strategies=a;this.loop=Boolean(b.loop);this.failFast=Boolean(b.failFast);this.timeout=b.timeout;this.timeoutLimit=b.timeoutLimit}var c=b.prototype;c.isSupported=function(){return Pusher.Util.any(this.strategies,Pusher.Util.method("isSupported"))};c.connect=function(a,b){var c=this,g=this.strategies,e=0,f=this.timeout,k=null,l=function(n,m){m?b(null,m):(e+=1,c.loop&&(e%=g.length),e<g.length?(f&&(f*=2,c.timeoutLimit&&(f=Math.min(f,c.timeoutLimit))),k=c.tryStrategy(g[e],a,{timeout:f,failFast:c.failFast},l)):b(!0))},k=this.tryStrategy(g[e],a,{timeout:f,failFast:this.failFast},l);return{abort:function(){k.abort()},forceMinPriority:function(b){a=b;k&&k.forceMinPriority(b)}}};c.tryStrategy=function(a,b,c,g){var e=null,f=null;0<c.timeout&&(e=new Pusher.Timer(c.timeout,function(){f.abort();g(!0)}));f=a.connect(b,function(a,b){if(!a||!e||!e.isRunning()||c.failFast)e&&e.ensureAborted(),g(a,b)});return{abort:function(){e&&e.ensureAborted();f.abort()},forceMinPriority:function(a){f.forceMinPriority(a)}}};Pusher.SequentialStrategy=b}).call(this);(function(){function b(a,b,c,e){this.name=a;this.priority=b;this.transport=c;this.options=e||{}}function c(a,b){Pusher.Util.defer(function(){b(a)});return{abort:function(){},forceMinPriority:function(){}}}var a=b.prototype;a.isSupported=function(){return this.transport.isSupported({encrypted:this.options.encrypted})};a.connect=function(a,b){if(this.isSupported()){if(this.priority<a)return c(new Pusher.Errors.TransportPriorityTooLow,b)}else return c(new Pusher.Errors.UnsupportedStrategy,b);var g=this,e=!1,f=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),k=null,l=function(){f.unbind("initialized",l);f.connect()},n=function(){k=new Pusher.Handshake(f,function(a){e=!0;q();b(null,a)})},m=function(a){q();b(a)},p=function(){q();b(new Pusher.Errors.TransportClosed(f))},q=function(){f.unbind("initialized",l);f.unbind("open",n);f.unbind("error",m);f.unbind("closed",p)};f.bind("initialized",l);f.bind("open",n);f.bind("error",m);f.bind("closed",p);f.initialize();return{abort:function(){e||(q(),k?k.close():f.close())},forceMinPriority:function(a){e||g.priority<a&&(k?k.close():f.close())}}};Pusher.TransportStrategy=b}).call(this);(function(){function b(a,b,c){return a+(b.encrypted?"s":"")+"://"+(b.encrypted?b.hostEncrypted:b.hostUnencrypted)+c}function c(a,b){return"/app/"+a+("?protocol="+Pusher.PROTOCOL+"&client=js&version="+Pusher.VERSION+(b?"&"+b:""))}Pusher.URLSchemes={ws:{getInitial:function(a,d){return b("ws",d,c(a,"flash=false"))}},flash:{getInitial:function(a,d){return b("ws",d,c(a,"flash=true"))}},sockjs:{getInitial:function(a,c){return b("http",c,c.httpPath||"/pusher","")},getPath:function(a,b){return c(a)}},http:{getInitial:function(a,d){var h=(d.httpPath||"/pusher")+c(a);return b("http",d,h)}}}}).call(this);(function(){function b(a,b,c,g,e){Pusher.EventsDispatcher.call(this);this.hooks=a;this.name=b;this.priority=c;this.key=g;this.options=e;this.state="new";this.timeline=e.timeline;this.activityTimeout=e.activityTimeout;this.id=this.timeline.generateUniqueID()}var c=b.prototype;Pusher.Util.extend(c,Pusher.EventsDispatcher.prototype);c.handlesActivityChecks=function(){return Boolean(this.hooks.handlesActivityChecks)};c.supportsPing=function(){return Boolean(this.hooks.supportsPing)};c.initialize=function(){var a=this;a.timeline.info(a.buildTimelineMessage({transport:a.name+(a.options.encrypted?"s":"")}));a.hooks.beforeInitialize&&a.hooks.beforeInitialize.call(a);if(a.hooks.isInitialized())a.changeState("initialized");else if(a.hooks.file)a.changeState("initializing"),Pusher.Dependencies.load(a.hooks.file,{encrypted:a.options.encrypted},function(b,c){if(a.hooks.isInitialized())a.changeState("initialized"),c(!0);else{if(b)a.onError(b);a.onClose();c(!1)}});else a.onClose()};c.connect=function(){var a=this;if(a.socket||"initialized"!==a.state)return!1;var b=a.hooks.urls.getInitial(a.key,a.options);try{a.socket=a.hooks.getSocket(b,a.options)}catch(c){return Pusher.Util.defer(function(){a.onError(c);a.changeState("closed")}),!1}a.bindListeners();Pusher.debug("Connecting",{transport:a.name,url:b});a.changeState("connecting");return!0};c.close=function(){return this.socket?(this.socket.close(),!0):!1};c.send=function(a){var b=this;return"open"===b.state?(Pusher.Util.defer(function(){b.socket&&b.socket.send(a)}),!0):!1};c.ping=function(){"open"===this.state&&this.supportsPing()&&this.socket.ping()};c.onOpen=function(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options));this.changeState("open");this.socket.onopen=void 0};c.onError=function(a){this.emit("error",{type:"WebSocketError",error:a});this.timeline.error(this.buildTimelineMessage({error:a.toString()}))};c.onClose=function(a){a?this.changeState("closed",{code:a.code,reason:a.reason,wasClean:a.wasClean}):this.changeState("closed");this.unbindListeners();this.socket=void 0};c.onMessage=function(a){this.emit("message",a)};c.onActivity=function(){this.emit("activity")};c.bindListeners=function(){var a=this;a.socket.onopen=function(){a.onOpen()};a.socket.onerror=function(b){a.onError(b)};a.socket.onclose=function(b){a.onClose(b)};a.socket.onmessage=function(b){a.onMessage(b)};a.supportsPing()&&(a.socket.onactivity=function(){a.onActivity()})};c.unbindListeners=function(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))};c.changeState=function(a,b){this.state=a;this.timeline.info(this.buildTimelineMessage({state:a,params:b}));this.emit(a,b)};c.buildTimelineMessage=function(a){return Pusher.Util.extend({cid:this.id},a)};Pusher.TransportConnection=b}).call(this);(function(){function b(a){this.hooks=a}var c=b.prototype;c.isSupported=function(a){return this.hooks.isSupported(a)};c.createConnection=function(a,b,c,g){return new Pusher.TransportConnection(this.hooks,a,b,c,g)};Pusher.Transport=b}).call(this);(function(){Pusher.WSTransport=new Pusher.Transport({urls:Pusher.URLSchemes.ws,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return Boolean(window.WebSocket||window.MozWebSocket)},isSupported:function(){return Boolean(window.WebSocket||window.MozWebSocket)},getSocket:function(a){return new(window.WebSocket||window.MozWebSocket)(a)}});Pusher.FlashTransport=new Pusher.Transport({file:"flashfallback",urls:Pusher.URLSchemes.flash,handlesActivityChecks:!1,supportsPing:!1,isSupported:function(){try{return Boolean(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(a){try{var b=Pusher.Util.getNavigator();return Boolean(b&&b.mimeTypes&&void 0!==b.mimeTypes["application/x-shockwave-flash"])}catch(c){return!1}}},beforeInitialize:function(){void 0===window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&(window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0);window.WEB_SOCKET_SWF_LOCATION=Pusher.Dependencies.getRoot({encrypted:this.options.encrypted})+"/WebSocketMain.swf"},isInitialized:function(){return void 0!==window.FlashWebSocket},getSocket:function(a){return new FlashWebSocket(a)}});Pusher.SockJSTransport=new Pusher.Transport({file:"sockjs",urls:Pusher.URLSchemes.sockjs,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return void 0!==window.SockJS},getSocket:function(a,b){return new SockJS(a,null,{js_path:Pusher.Dependencies.getPath("sockjs",{encrypted:b.encrypted}),ignore_null_origin:b.ignoreNullOrigin})},beforeOpen:function(a,b){a.send(JSON.stringify({path:b}))}});var b={urls:Pusher.URLSchemes.http,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return Boolean(Pusher.HTTP.Socket)}},c=Pusher.Util.extend({getSocket:function(a){return Pusher.HTTP.getStreamingSocket(a)}},b),b=Pusher.Util.extend({getSocket:function(a){return Pusher.HTTP.getPollingSocket(a)}},b),a={file:"xhr",isSupported:Pusher.Util.isXHRSupported},d={file:"xdr",isSupported:function(a){return Pusher.Util.isXDRSupported(a.encrypted)}};Pusher.XHRStreamingTransport=new Pusher.Transport(Pusher.Util.extend({},c,a));Pusher.XDRStreamingTransport=new Pusher.Transport(Pusher.Util.extend({},c,d));Pusher.XHRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},b,a));Pusher.XDRPollingTransport=new Pusher.Transport(Pusher.Util.extend({},b,d))}).call(this);(function(){function b(a,b,c){this.manager=a;this.transport=b;this.minPingDelay=c.minPingDelay;this.maxPingDelay=c.maxPingDelay;this.pingDelay=void 0}var c=b.prototype;c.createConnection=function(a,b,c,g){var e=this;g=Pusher.Util.extend({},g,{activityTimeout:e.pingDelay});var f=e.transport.createConnection(a,b,c,g),k=null,l=function(){f.unbind("open",l);f.bind("closed",n);k=Pusher.Util.now()},n=function(a){f.unbind("closed",n);1002===a.code||1003===a.code?e.manager.reportDeath():!a.wasClean&&k&&(a=Pusher.Util.now()-k,a<2*e.maxPingDelay&&(e.manager.reportDeath(),e.pingDelay=Math.max(a/2,e.minPingDelay)))};f.bind("open",l);return f};c.isSupported=function(a){return this.manager.isAlive()&&this.transport.isSupported(a)};Pusher.AssistantToTheTransportManager=b}).call(this);(function(){function b(a){this.options=a||{};this.livesLeft=this.options.lives||Infinity}var c=b.prototype;c.getAssistant=function(a){return new Pusher.AssistantToTheTransportManager(this,a,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})};c.isAlive=function(){return 0<this.livesLeft};c.reportDeath=function(){this.livesLeft-=1};Pusher.TransportManager=b}).call(this);(function(){function b(a){return function(b){return[a.apply(this,arguments),b]}}function c(a,b){if(0===a.length)return[[],b];var h=d(a[0],b),e=c(a.slice(1),h[1]);return[[h[0]].concat(e[0]),e[1]]}function a(a,b){if("string"===typeof a[0]&&":"===a[0].charAt(0)){var h=b[a[0].slice(1)];if(1<a.length){if("function"!==typeof h)throw"Calling non-function "+a[0];var e=[Pusher.Util.extend({},b)].concat(Pusher.Util.map(a.slice(1),function(a){return d(a,Pusher.Util.extend({},b))[0]}));return h.apply(this,e)}return[h,b]}return c(a,b)}function d(b,c){if("string"===typeof b){var d;if("string"===typeof b&&":"===b.charAt(0)){d=c[b.slice(1)];if(void 0===d)throw"Undefined symbol "+b;d=[d,c]}else d=[b,c];return d}return"object"===typeof b&&b instanceof Array&&0<b.length?a(b,c):[b,c]}var h={ws:Pusher.WSTransport,flash:Pusher.FlashTransport,sockjs:Pusher.SockJSTransport,xhr_streaming:Pusher.XHRStreamingTransport,xdr_streaming:Pusher.XDRStreamingTransport,xhr_polling:Pusher.XHRPollingTransport,xdr_polling:Pusher.XDRPollingTransport},g={isSupported:function(){return!1},connect:function(a,b){var c=Pusher.Util.defer(function(){b(new Pusher.Errors.UnsupportedStrategy)});return{abort:function(){c.ensureAborted()},forceMinPriority:function(){}}}},e={extend:function(a,b,c){return[Pusher.Util.extend({},b,c),a]},def:function(a,b,c){if(void 0!==a[b])throw"Redefining symbol "+b;a[b]=c;return[void 0,a]},def_transport:function(a,b,c,d,e,p){var q=h[c];if(!q)throw new Pusher.Errors.UnsupportedTransport(c);c=(!a.enabledTransports||-1!==Pusher.Util.arrayIndexOf(a.enabledTransports,b))&&(!a.disabledTransports||-1===Pusher.Util.arrayIndexOf(a.disabledTransports,b))&&("flash"!==b||!0!==a.disableFlash)?new Pusher.TransportStrategy(b,d,p?p.getAssistant(q):q,Pusher.Util.extend({key:a.key,encrypted:a.encrypted,timeline:a.timeline,ignoreNullOrigin:a.ignoreNullOrigin},e)):g;d=a.def(a,b,c)[1];d.transports=a.transports||{};d.transports[b]=c;return[void 0,d]},transport_manager:b(function(a,b){return new Pusher.TransportManager(b)}),sequential:b(function(a,b){var c=Array.prototype.slice.call(arguments,2);return new Pusher.SequentialStrategy(c,b)}),cached:b(function(a,b,c){return new Pusher.CachedStrategy(c,a.transports,{ttl:b,timeline:a.timeline,encrypted:a.encrypted})}),first_connected:b(function(a,b){return new Pusher.FirstConnectedStrategy(b)}),best_connected_ever:b(function(){var a=Array.prototype.slice.call(arguments,1);return new Pusher.BestConnectedEverStrategy(a)}),delayed:b(function(a,b,c){return new Pusher.DelayedStrategy(c,{delay:b})}),"if":b(function(a,b,c,d){return new Pusher.IfStrategy(b,c,d)}),is_supported:b(function(a,b){return function(){return b.isSupported()}})};Pusher.StrategyBuilder={build:function(a,b){var c=Pusher.Util.extend({},e,b);return d(a,c)[1].strategy}}}).call(this);(function(){Pusher.Protocol={decodeMessage:function(b){try{var c=JSON.parse(b.data);if("string"===typeof c.data)try{c.data=JSON.parse(c.data)}catch(a){if(!(a instanceof SyntaxError))throw a}return c}catch(d){throw{type:"MessageParseError",error:d,data:b.data}}},encodeMessage:function(b){return JSON.stringify(b)},processHandshake:function(b){b=this.decodeMessage(b);if("pusher:connection_established"===b.event){if(!b.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:b.data.socket_id,activityTimeout:1e3*b.data.activity_timeout}}if("pusher:error"===b.event)return{action:this.getCloseAction(b.data),error:this.getCloseError(b.data)};throw"Invalid handshake"},getCloseAction:function(b){return 4e3>b.code?1002<=b.code&&1004>=b.code?"backoff":null:4e3===b.code?"ssl_only":4100>b.code?"refused":4200>b.code?"backoff":4300>b.code?"retry":"refused"},getCloseError:function(b){return 1e3!==b.code&&1001!==b.code?{type:"PusherError",data:{code:b.code,message:b.reason||b.message}}:null}}}).call(this);(function(){function b(a,b){Pusher.EventsDispatcher.call(this);this.id=a;this.transport=b;this.activityTimeout=b.activityTimeout;this.bindListeners()}var c=b.prototype;Pusher.Util.extend(c,Pusher.EventsDispatcher.prototype);c.handlesActivityChecks=function(){return this.transport.handlesActivityChecks()};c.send=function(a){return this.transport.send(a)};c.send_event=function(a,b,c){a={event:a,data:b};c&&(a.channel=c);Pusher.debug("Event sent",a);return this.send(Pusher.Protocol.encodeMessage(a))};c.ping=function(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})};c.close=function(){this.transport.close()};c.bindListeners=function(){var a=this,b={message:function(b){var c;try{c=Pusher.Protocol.decodeMessage(b)}catch(d){a.emit("error",{type:"MessageParseError",error:d,data:b.data})}if(void 0!==c){Pusher.debug("Event recd",c);switch(c.event){case"pusher:error":a.emit("error",{type:"PusherError",data:c.data});break;case"pusher:ping":a.emit("ping");break;case"pusher:pong":a.emit("pong")}a.emit("message",c)}},activity:function(){a.emit("activity")},error:function(b){a.emit("error",{type:"WebSocketError",error:b})},closed:function(b){c();b&&b.code&&a.handleCloseEvent(b);a.transport=null;a.emit("closed")}},c=function(){Pusher.Util.objectApply(b,function(b,c){a.transport.unbind(c,b)})};Pusher.Util.objectApply(b,function(b,c){a.transport.bind(c,b)})};c.handleCloseEvent=function(a){var b=Pusher.Protocol.getCloseAction(a);(a=Pusher.Protocol.getCloseError(a))&&this.emit("error",a);b&&this.emit(b)};Pusher.Connection=b}).call(this);(function(){function b(a,b){this.transport=a;this.callback=b;this.bindListeners()}var c=b.prototype;c.close=function(){this.unbindListeners();this.transport.close()};c.bindListeners=function(){var a=this;a.onMessage=function(b){a.unbindListeners();try{var c=Pusher.Protocol.processHandshake(b);"connected"===c.action?a.finish("connected",{connection:new Pusher.Connection(c.id,a.transport),activityTimeout:c.activityTimeout}):(a.finish(c.action,{error:c.error}),a.transport.close())}catch(g){a.finish("error",{error:g}),a.transport.close()}};a.onClosed=function(b){a.unbindListeners();var c=Pusher.Protocol.getCloseAction(b)||"backoff";b=Pusher.Protocol.getCloseError(b);a.finish(c,{error:b})};a.transport.bind("message",a.onMessage);a.transport.bind("closed",a.onClosed)};c.unbindListeners=function(){this.transport.unbind("message",this.onMessage);this.transport.unbind("closed",this.onClosed)};c.finish=function(a,b){this.callback(Pusher.Util.extend({transport:this.transport,action:a},b))};Pusher.Handshake=b}).call(this);(function(){function b(a,b){Pusher.EventsDispatcher.call(this);this.key=a;this.options=b||{};this.state="initialized";this.connection=null;this.encrypted=!!b.encrypted;this.timeline=this.options.timeline;this.connectionCallbacks=this.buildConnectionCallbacks();this.errorCallbacks=this.buildErrorCallbacks();this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var c=this;Pusher.Network.bind("online",function(){c.timeline.info({netinfo:"online"});("connecting"===c.state||"unavailable"===c.state)&&c.retryIn(0)});Pusher.Network.bind("offline",function(){c.timeline.info({netinfo:"offline"});c.connection&&c.sendActivityCheck()});this.updateStrategy()}var c=b.prototype;Pusher.Util.extend(c,Pusher.EventsDispatcher.prototype);c.connect=function(){!this.connection&&!this.runner&&(this.strategy.isSupported()?(this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()):this.updateState("failed"))};c.send=function(a){return this.connection?this.connection.send(a):!1};c.send_event=function(a,b,c){return this.connection?this.connection.send_event(a,b,c):!1};c.disconnect=function(){this.disconnectInternally();this.updateState("disconnected")};c.isEncrypted=function(){return this.encrypted};c.startConnecting=function(){var a=this,b=function(c,g){c?a.runner=a.strategy.connect(0,b):"error"===g.action?(a.emit("error",{type:"HandshakeError",error:g.error}),a.timeline.error({handshakeError:g.error})):(a.abortConnecting(),a.handshakeCallbacks[g.action](g))};a.runner=a.strategy.connect(0,b)};c.abortConnecting=function(){this.runner&&(this.runner.abort(),this.runner=null)};c.disconnectInternally=function(){this.abortConnecting();this.clearRetryTimer();this.clearUnavailableTimer();this.connection&&this.abandonConnection().close()};c.updateStrategy=function(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,encrypted:this.encrypted})};c.retryIn=function(a){var b=this;b.timeline.info({action:"retry",delay:a});0<a&&b.emit("connecting_in",Math.round(a/1e3));b.retryTimer=new Pusher.Timer(a||0,function(){b.disconnectInternally();b.connect()})};c.clearRetryTimer=function(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)};c.setUnavailableTimer=function(){var a=this;a.unavailableTimer=new Pusher.Timer(a.options.unavailableTimeout,function(){a.updateState("unavailable")})};c.clearUnavailableTimer=function(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()};c.sendActivityCheck=function(){var a=this;a.stopActivityCheck();a.connection.ping();a.activityTimer=new Pusher.Timer(a.options.pongTimeout,function(){a.timeline.error({pong_timed_out:a.options.pongTimeout});a.retryIn(0)})};c.resetActivityCheck=function(){var a=this;a.stopActivityCheck();a.connection.handlesActivityChecks()||(a.activityTimer=new Pusher.Timer(a.activityTimeout,function(){a.sendActivityCheck()}))};c.stopActivityCheck=function(){this.activityTimer&&this.activityTimer.ensureAborted()};c.buildConnectionCallbacks=function(){var a=this;return{message:function(b){a.resetActivityCheck();a.emit("message",b)},ping:function(){a.send_event("pusher:pong",{})},activity:function(){a.resetActivityCheck()},error:function(b){a.emit("error",{type:"WebSocketError",error:b})},closed:function(){a.abandonConnection();a.shouldRetry()&&a.retryIn(1e3)}}};c.buildHandshakeCallbacks=function(a){var b=this;return Pusher.Util.extend({},a,{connected:function(a){b.activityTimeout=Math.min(b.options.activityTimeout,a.activityTimeout,a.connection.activityTimeout||Infinity);b.clearUnavailableTimer();b.setConnection(a.connection);b.socket_id=b.connection.id;b.updateState("connected",{socket_id:b.socket_id})}})};c.buildErrorCallbacks=function(){function a(a){return function(c){c.error&&b.emit("error",{type:"WebSocketError",error:c.error});a(c)}}var b=this;return{ssl_only:a(function(){b.encrypted=!0;b.updateStrategy();b.retryIn(0)}),refused:a(function(){b.disconnect()}),backoff:a(function(){b.retryIn(1e3)}),retry:a(function(){b.retryIn(0)})}};c.setConnection=function(a){this.connection=a;for(var b in this.connectionCallbacks)this.connection.bind(b,this.connectionCallbacks[b]);this.resetActivityCheck()};c.abandonConnection=function(){if(this.connection){this.stopActivityCheck();for(var a in this.connectionCallbacks)this.connection.unbind(a,this.connectionCallbacks[a]);a=this.connection;this.connection=null;return a}};c.updateState=function(a,b){var c=this.state;this.state=a;c!==a&&(Pusher.debug("State changed",c+" -> "+a),this.timeline.info({state:a,params:b}),this.emit("state_change",{previous:c,current:a}),this.emit(a,b))};c.shouldRetry=function(){return"connecting"===this.state||"connected"===this.state};Pusher.ConnectionManager=b}).call(this);(function(){function b(){Pusher.EventsDispatcher.call(this);var b=this;void 0!==window.addEventListener&&(window.addEventListener("online",function(){b.emit("online")},!1),window.addEventListener("offline",function(){b.emit("offline")},!1))}Pusher.Util.extend(b.prototype,Pusher.EventsDispatcher.prototype);b.prototype.isOnline=function(){return void 0===window.navigator.onLine?!0:window.navigator.onLine};Pusher.NetInfo=b;Pusher.Network=new b}).call(this);(function(){function b(){this.reset()}var c=b.prototype;c.get=function(a){return Object.prototype.hasOwnProperty.call(this.members,a)?{id:a,info:this.members[a]}:null};c.each=function(a){var b=this;Pusher.Util.objectApply(b.members,function(c,g){a(b.get(g))})};c.setMyID=function(a){this.myID=a};c.onSubscription=function(a){this.members=a.presence.hash;this.count=a.presence.count;this.me=this.get(this.myID)};c.addMember=function(a){null===this.get(a.user_id)&&this.count++;this.members[a.user_id]=a.user_info;return this.get(a.user_id)};c.removeMember=function(a){var b=this.get(a.user_id);b&&(delete this.members[a.user_id],this.count--);return b};c.reset=function(){this.members={};this.count=0;this.me=this.myID=null};Pusher.Members=b}).call(this);(function(){function b(a,b){Pusher.EventsDispatcher.call(this,function(b,c){Pusher.debug("No callbacks on "+a+" for "+b)});this.name=a;this.pusher=b;this.subscribed=!1}var c=b.prototype;Pusher.Util.extend(c,Pusher.EventsDispatcher.prototype);c.authorize=function(a,b){return b(!1,{})};c.trigger=function(a,b){if(0!==a.indexOf("client-"))throw new Pusher.Errors.BadEventName("Event '"+a+"' does not start with 'client-'");return this.pusher.send_event(a,b,this.name)};c.disconnect=function(){this.subscribed=!1};c.handleEvent=function(a,b){0===a.indexOf("pusher_internal:")?"pusher_internal:subscription_succeeded"===a&&(this.subscribed=!0,this.emit("pusher:subscription_succeeded",b)):this.emit(a,b)};c.subscribe=function(){var a=this;a.authorize(a.pusher.connection.socket_id,function(b,c){b?a.handleEvent("pusher:subscription_error",c):a.pusher.send_event("pusher:subscribe",{auth:c.auth,channel_data:c.channel_data,channel:a.name})})};c.unsubscribe=function(){this.pusher.send_event("pusher:unsubscribe",{channel:this.name})};Pusher.Channel=b}).call(this);(function(){function b(a,b){Pusher.Channel.call(this,a,b)}var c=b.prototype;Pusher.Util.extend(c,Pusher.Channel.prototype);c.authorize=function(a,b){return new Pusher.Channel.Authorizer(this,this.pusher.config).authorize(a,b)};Pusher.PrivateChannel=b}).call(this);(function(){function b(a,b){Pusher.PrivateChannel.call(this,a,b);this.members=new Pusher.Members}var c=b.prototype;Pusher.Util.extend(c,Pusher.PrivateChannel.prototype);c.authorize=function(a,b){var c=this;Pusher.PrivateChannel.prototype.authorize.call(c,a,function(a,e){if(!a){if(void 0===e.channel_data){Pusher.warn("Invalid auth response for channel '"+c.name+"', expected 'channel_data' field");b("Invalid auth response");return}var f=JSON.parse(e.channel_data);c.members.setMyID(f.user_id)}b(a,e)})};c.handleEvent=function(a,b){switch(a){case"pusher_internal:subscription_succeeded":this.members.onSubscription(b);this.subscribed=!0;this.emit("pusher:subscription_succeeded",this.members);break;case"pusher_internal:member_added":var c=this.members.addMember(b);this.emit("pusher:member_added",c);break;case"pusher_internal:member_removed":(c=this.members.removeMember(b))&&this.emit("pusher:member_removed",c);break;default:Pusher.PrivateChannel.prototype.handleEvent.call(this,a,b)}};c.disconnect=function(){this.members.reset();Pusher.PrivateChannel.prototype.disconnect.call(this)};Pusher.PresenceChannel=b}).call(this);(function(){function b(){this.channels={}}var c=b.prototype;c.add=function(a,b){if(!this.channels[a]){var c=this.channels,g;g=0===a.indexOf("private-")?new Pusher.PrivateChannel(a,b):0===a.indexOf("presence-")?new Pusher.PresenceChannel(a,b):new Pusher.Channel(a,b);c[a]=g}return this.channels[a]};c.all=function(a){return Pusher.Util.values(this.channels)};c.find=function(a){return this.channels[a]};c.remove=function(a){var b=this.channels[a];delete this.channels[a];return b};c.disconnect=function(){Pusher.Util.objectApply(this.channels,function(a){a.disconnect()})};Pusher.Channels=b}).call(this);(function(){Pusher.Channel.Authorizer=function(b,a){this.channel=b;this.type=a.authTransport;this.options=a;this.authOptions=(a||{}).auth||{}};Pusher.Channel.Authorizer.prototype={composeQuery:function(b){b="socket_id="+encodeURIComponent(b)+"&channel_name="+encodeURIComponent(this.channel.name);for(var a in this.authOptions.params)b+="&"+encodeURIComponent(a)+"="+encodeURIComponent(this.authOptions.params[a]);return b},authorize:function(b,a){return Pusher.authorizers[this.type].call(this,b,a)}};var b=1;Pusher.auth_callbacks={};Pusher.authorizers={ajax:function(b,a){var d;d=Pusher.XHR?new Pusher.XHR:window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");d.open("POST",this.options.authEndpoint,!0);d.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var h in this.authOptions.headers)d.setRequestHeader(h,this.authOptions.headers[h]);d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status){var b,c=!1;try{b=JSON.parse(d.responseText),c=!0}catch(f){a(!0,"JSON returned from webapp was invalid, yet status code was 200. Data was: "+d.responseText)}c&&a(!1,b)}else Pusher.warn("Couldn't get auth info from your webapp",d.status),a(!0,d.status)};d.send(this.composeQuery(b));return d},jsonp:function(c,a){void 0!==this.authOptions.headers&&Pusher.warn("Warn","To send headers with the auth request, you must use AJAX, rather than JSONP.");var d=b.toString();b++;var h=Pusher.Util.getDocument(),g=h.createElement("script");Pusher.auth_callbacks[d]=function(b){a(!1,b)};g.src=this.options.authEndpoint+"?callback="+encodeURIComponent("Pusher.auth_callbacks['"+d+"']")+"&"+this.composeQuery(c);d=h.getElementsByTagName("head")[0]||h.documentElement;d.insertBefore(g,d.firstChild)}}}).call(this);
//# sourceMappingURL=js/prototype.map